!function(a,c,t){var h="function"==typeof require&&require;function l(t,e){var i=c[t];if(!i){var n=a[t];if(!n){var r="function"==typeof require&&require;if(!e&&r)return r(t,!0);if(h)return h(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var s={};i=c[t]={exports:s},n[0](function(t){return l(n[1][t]||t)},i,s)}return i.exports}for(var e=0;e<t.length;e++)l(t[e])}({1:[function(t,e,i){window.Black8CocosEngine=cc.BLACK8_COCOS_VERSION="2.3.5",cc._LogInfos=cc._LogInfos||{},window.CocosEngine=cc.ENGINE_VERSION="1.9.0",cc._renderContext=null,cc._supportRender=!1,cc._canvas=null,cc.container=null,cc._gameDiv=null,t("./cocos2d/core/utils"),t("./cocos2d/core/platform/CCSys");var s=!1,a=null;function c(){cc._engineLoaded=!0,console.log(cc.ENGINE_VERSION),a&&a()}function h(){window.removeEventListener("load",h,!1),c()}cc._engineLoaded=!1,cc.initEngine=function(t,e){if(s){var i=a;a=function(){i&&i(),e&&e()}}else a=e,!cc.game.config&&t?cc.game.config=t:cc.game.config||cc.game._loadConfig(),n=t=cc.game.config,r=cc.game.CONFIG_KEY,o=parseInt(n[r.renderMode])||0,(isNaN(o)||2<o||o<0)&&(n[r.renderMode]=0),cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!1,0===o?cc.sys.capabilities.opengl?(cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0):cc.sys.capabilities.canvas&&(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0):1===o&&cc.sys.capabilities.canvas?(cc._renderType=cc.game.RENDER_TYPE_CANVAS,cc._supportRender=!0):2===o&&cc.sys.capabilities.opengl&&(cc._renderType=cc.game.RENDER_TYPE_WEBGL,cc._supportRender=!0),document.body?c():window.addEventListener("load",h,!1),s=!0;var n,r,o}},{"./cocos2d/core/platform/CCSys":132,"./cocos2d/core/utils":172}],2:[function(t,e,i){var r,n=t("./cocos2d/core/platform/CCEnum");cc.DebugMode=n({NONE:0,INFO:1,WARN:2,ERROR:3,INFO_FOR_WEB_PAGE:4,WARN_FOR_WEB_PAGE:5,ERROR_FOR_WEB_PAGE:6}),cc._initDebugSetting=function(t){if(cc.log=cc.logID=cc.warn=cc.warnID=cc.error=cc.errorID=cc.assert=cc.assertID=function(){},t!==cc.DebugMode.NONE){t>cc.DebugMode.ERROR?function(){function i(t){if(cc._canvas){if(!r){var e=document.createElement("Div");e.setAttribute("id","logInfoDiv"),e.setAttribute("width","200"),e.setAttribute("height",cc._canvas.height);var i=e.style;i.zIndex="99999",i.position="absolute",i.top=i.left="0",(r=document.createElement("textarea")).setAttribute("rows","20"),r.setAttribute("cols","30"),r.setAttribute("disabled","true");var n=r.style;n.backgroundColor="transparent",n.borderBottom="1px solid #cccccc",n.borderTopWidth=n.borderLeftWidth=n.borderRightWidth="0px",n.borderTopStyle=n.borderLeftStyle=n.borderRightStyle="none",n.padding="0px",n.margin=0,e.appendChild(r),cc._canvas.parentNode.appendChild(e)}r.value=r.value+t+"\r\n",r.scrollTop=r.scrollHeight}}cc.error=function(){i("ERROR :  "+cc.js.formatStr.apply(null,arguments))},cc.assert=function(t,e){"use strict";!t&&e&&i("ASSERT: "+(e=cc.js.formatStr.apply(null,cc.js.shiftArguments.apply(null,arguments))))},t!==cc.DebugMode.ERROR_FOR_WEB_PAGE&&(cc.warn=function(){i("WARN :  "+cc.js.formatStr.apply(null,arguments))}),t===cc.DebugMode.INFO_FOR_WEB_PAGE&&(cc.log=cc.info=function(){i(cc.js.formatStr.apply(null,arguments))})}():console&&console.log.apply&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),console.error.bind?cc.error=console.error.bind(console):cc.error=function(){return console.error.apply(console,arguments)},cc.assert=function(t,e){if(!t)throw e&&(e=cc.js.formatStr.apply(null,cc.js.shiftArguments.apply(null,arguments))),new Error(e)}),t!==cc.DebugMode.ERROR&&(console.warn.bind?cc.warn=console.warn.bind(console):cc.warn=function(){return console.warn.apply(console,arguments)}),t===cc.DebugMode.INFO&&(console.log.bind?cc.log=console.log.bind(console):cc.log=function(){return console.log.apply(console,arguments)},cc.info=function(){(console.info||console.log).apply(console,arguments)}),cc.warnID=s(cc.warn,"Warning"),cc.errorID=s(cc.error,"Error"),cc.logID=s(cc.log,"Log");var e=s(function(){for(var t=[!1],e=0;e<arguments.length;++e)t.push(arguments[e]);cc.assert.apply(null,t)},"Assert");cc.assertID=function(t){"use strict";t||e.apply(null,cc.js.shiftArguments.apply(null,arguments))}}},cc._throw=function(t){var e=t.stack;e?cc.error(e):cc.error(t)};var o="https://github.com/cocos-creator/engine/blob/master/EngineErrorMap.md";function s(i,n){return function(t){"use strict";if(1!==arguments.length){var e="";2===arguments.length?e="Arguments: "+arguments[1]:2<arguments.length&&(e="Arguments: "+cc.js.shiftArguments.apply(null,arguments).join(", ")),i(n+" "+t+", please go to "+o+"#"+t+" to see details. "+e)}else i(n+" "+t+", please go to "+o+"#"+t+" to see details.")}}},{"./cocos2d/core/platform/CCEnum":125}],3:[function(t,e,i){},{}],4:[function(t,e,i){var n=cc.js,r=t("./playable"),b=t("./animation-curves").DynamicAnimCurve,R=t("./animation-curves").quickFindIndex,A=t("./motion-path-helper").sampleMotionPaths,g=t("./animation-curves").EventAnimCurve,m=t("./animation-curves").EventInfo,v=t("./types").WrapModeMask,O=t("../core/utils/binary-search").binarySearchEpsilon;function o(t,e){r.call(this),this.target=t,this.animation=e,this._anims=new n.array.MutableForwardIterator([])}n.extend(o,r);var s=o.prototype;function a(t,x){var E=x.clip,h=x.curves;function S(t){if(!Array.isArray(t))return!1;for(var e=0,i=t.length;e<i;e++){var n=t[e];if(!Array.isArray(n)||6!==n.length)return!1}return!0}function l(t,e,i){var n,r=t instanceof cc.Node&&"position"===e,o=[],s=new b;s.target=t;var a,c=e.indexOf(".");-1!==c?t[n=e.slice(0,c)]:n=e,s.prop=n,s.subProps=((a=e.split(".")).shift(),0<a.length?a:null);for(var h=0,l=i.length;h<l;h++){var u=i[h],_=u.frame/x.duration;if(s.ratios.push(_),r){var d=u.motionPath;d&&!S(d)&&(cc.errorID(3904,t.name,e,h),d=null),o.push(d)}var f=u.value;s.values.push(f);var p=u.curve;if(p){if("string"==typeof p){s.types.push(p);continue}if(Array.isArray(p)){p[0]===p[1]&&p[2]===p[3]?s.types.push(b.Linear):s.types.push(b.Bezier(p));continue}}s.types.push(b.Linear)}r&&A(o,s,E.duration,E.sample);for(var g,m,v=s.ratios,y=!0,C=1,T=v.length;C<T;C++)if(g=v[C]-v[C-1],1===C)m=g;else if(1e-6<Math.abs(g-m)){y=!1;break}return s._findFrameIndex=y?R:O,s}function e(t,e){var i=e.props,n=e.comps;if(i)for(var r in i){var o=l(t,r,i[r]);h.push(o)}if(n)for(var s in n){var a=t.getComponent(s);if(a){var c=n[s];for(var r in c)o=l(a,r,c[r]),h.push(o)}}}h.length=0,x.duration=E.duration,x.speed=E.speed,x.wrapMode=E.wrapMode,x.frameRate=E.sample,(x.wrapMode&v.Loop)===v.Loop?x.repeatCount=1/0:x.repeatCount=1;var i=E.curveData,n=i.paths;for(var r in e(t,i),n){var o=cc.find(r,t);o&&e(o,n[r])}var s=E.events;if(s)for(var a,c=0,u=s.length;c<u;c++){a||((a=new g).target=t,h.push(a));var _,d=s[c],f=d.frame/x.duration,p=O(a.ratios,f);0<=p?_=a.events[p]:(_=new m,a.ratios.push(f),a.events.push(_)),_.add(d.func,d.params)}}s.playState=function(t,e){t.clip&&(t.curveLoaded||a(this.target,t),t.animator=this,t.play(),"number"==typeof e&&t.setTime(e),this.play())},s.stopStatesExcept=function(t){var e=this._anims,i=e.array;for(e.i=0;e.i<i.length;++e.i){var n=i[e.i];n!==t&&this.stopState(n)}},s.addAnimation=function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t),t._setListeners(this.animation)},s.removeAnimation=function(t){var e=this._anims.array.indexOf(t);0<=e?(this._anims.fastRemoveAt(e),0===this._anims.array.length&&this.stop()):cc.errorID(3908),t.animator=null},s.sample=function(){var t=this._anims,e=t.array;for(t.i=0;t.i<e.length;++t.i)e[t.i].sample()},s.stopState=function(t){t&&t.stop()},s.pauseState=function(t){t&&t.pause()},s.resumeState=function(t){t&&t.resume(),this.isPaused&&this.resume()},s.setStateTime=function(t,e){if(void 0!==e)t&&(t.setTime(e),t.sample());else{e=t;for(var i=this._anims.array,n=0;n<i.length;++n){var r=i[n];r.setTime(e),r.sample()}}},s.onStop=function(){var t=this._anims,e=t.array;for(t.i=0;t.i<e.length;++t.i)e[t.i].stop()},s.onPause=function(){for(var t=this._anims.array,e=0;e<t.length;++e){var i=t[e];i.pause(),i.animator=null}},s.onResume=function(){for(var t=this._anims.array,e=0;e<t.length;++e){var i=t[e];i.animator=this,i.resume()}},s._reloadClip=function(t){a(this.target,t)},e.exports=o},{"../core/utils/binary-search":169,"./animation-curves":6,"./motion-path-helper":12,"./playable":13,"./types":14}],5:[function(t,e,i){var a=cc.Class({name:"cc.AnimationClip",extends:cc.Asset,properties:{_duration:{default:0,type:"Float"},duration:{get:function(){return this._duration}},sample:{default:60},speed:{default:1},wrapMode:{default:cc.WrapMode.Normal},curveData:{default:{},visible:!1},events:{default:[],visible:!1}},statics:{createWithSpriteFrames:function(t,e){if(!Array.isArray(t))return cc.errorID(3905),null;var i=new a;i.sample=e||i.sample,i._duration=t.length/i.sample;for(var n=[],r=1/i.sample,o=0,s=t.length;o<s;o++)n[o]={frame:o*r,value:t[o]};return i.curveData={comps:{"cc.Sprite":{spriteFrame:n}}},i}}});cc.AnimationClip=e.exports=a},{}],6:[function(t,e,i){var n=t("./bezier").bezierByTime,f=t("../core/utils/binary-search").binarySearchEpsilon,p=t("./types").WrapModeMask,g=t("./types").WrappedInfo;function x(t,e){if("string"==typeof e){var i=cc.Easing[e];i?t=i(t):cc.errorID(3906,e)}else Array.isArray(e)&&(t=n(e,t));return t}var r=cc.Class({name:"cc.AnimCurve",sample:function(t,e,i){},onTimeChangedManually:void 0}),o=cc.Class({name:"cc.DynamicAnimCurve",extends:r,properties:{target:null,prop:"",values:[],ratios:[],types:[],subProps:null},_findFrameIndex:f,sample:function(t,e,i){var n=this.values,r=this.ratios,o=r.length;if(0!==o){var s,a=this._findFrameIndex(r,e);if(a<0)if((a=~a)<=0)s=n[0];else if(o<=a)s=n[o-1];else{var c=n[a-1],h="number"==typeof c,l=c&&c.lerp;if(h||l){var u=r[a-1],_=r[a],d=this.types[a-1],f=(e-u)/(_-u);d&&(f=x(f,d));var p=n[a];h?s=c+(p-c)*f:l&&(s=c.lerp(p,f))}else s=c}else s=n[a];var g=this.subProps;if(g){for(var m=this.target[this.prop],v=m,y=0;y<g.length-1;y++){var C=g[y];if(!v)return;v=v[C]}var T=g[g.length-1];if(!v)return;v[T]=s,s=m}this.target[this.prop]=s}}});o.Linear=null,o.Bezier=function(t){return t};var s=function(){this.events=[]};s.prototype.add=function(t,e){this.events.push({func:t||"",params:e||[]})};var a=cc.Class({name:"cc.EventAnimCurve",extends:r,properties:{target:null,ratios:[],events:[],_wrappedInfo:{default:function(){return new g}},_lastWrappedInfo:null,_ignoreIndex:NaN},_wrapIterations:function(t){return t-(0|t)==0&&(t-=1),0|t},sample:function(t,e,i){var n=this.ratios.length,r=i.getWrappedInfo(i.time,this._wrappedInfo),o=r.direction,s=f(this.ratios,r.ratio);if(s<0&&(s=~s-1,o<0&&(s+=1)),this._ignoreIndex!==s&&(this._ignoreIndex=NaN),r.frameIndex=s,!this._lastWrappedInfo)return this._fireEvent(s),void(this._lastWrappedInfo=new g(r));var a=i.wrapMode,c=this._wrapIterations(r.iterations),h=this._lastWrappedInfo,l=this._wrapIterations(h.iterations),u=h.frameIndex,_=h.direction,d=-1!==l&&c!==l;if(u===s&&d&&1===n)this._fireEvent(0);else if(u!==s||d){o=_;do{if(u!==s){if(-1===o&&0===u&&0<s?((a&p.PingPong)===p.PingPong?o*=-1:u=n,l++):1===o&&u===n-1&&s<n-1&&((a&p.PingPong)===p.PingPong?o*=-1:u=-1,l++),u===s)break;if(c<l)break}u+=o,cc.director.getAnimationManager().pushDelayEvent(this,"_fireEvent",[u])}while(u!==s&&-1<u&&u<n)}this._lastWrappedInfo.set(r)},_fireEvent:function(t){if(!(t<0||t>=this.events.length||this._ignoreIndex===t)){var e=this.events[t].events;if(this.target.isValid)for(var i=this.target._components,n=0;n<e.length;n++)for(var r=e[n],o=r.func,s=0;s<i.length;s++){var a=i[s],c=a[o];c&&c.apply(a,r.params)}}},onTimeChangedManually:function(t,e){this._lastWrappedInfo=null,this._ignoreIndex=NaN;var i=e.getWrappedInfo(t,this._wrappedInfo),n=i.direction,r=f(this.ratios,i.ratio);r<0&&(r=~r-1,n<0&&(r+=1),this._ignoreIndex=r)}});e.exports={AnimCurve:r,DynamicAnimCurve:o,EventAnimCurve:a,EventInfo:s,computeRatioByType:x,quickFindIndex:function(t,e){var i=t.length-1;if(0===i)return 0;var n=t[0];if(e<n)return 0;var r=t[i];if(r<e)return i;var o=(e=(e-n)/(r-n))/(1/i),s=0|o;return o-s<1e-6?s:~(s+1)}}},{"../core/utils/binary-search":169,"./bezier":9,"./types":14}],7:[function(t,e,n){var r=cc.js,o=cc.Class({ctor:function(){this.__instanceId=cc.ClassManager.getNewInstanceId(),this._anims=new r.array.MutableForwardIterator([]),this._delayEvents=[]},update:function(t){var e=this._anims,n=e.array;for(e.i=0;e.i<n.length;++e.i){var r=n[e.i];r._isPlaying&&!r._isPaused&&r.update(t)}var o=this._delayEvents;for(i=0,l=o.length;i<l;i++){var s=o[i];s.target[s.func].apply(s.target,s.args)}o.length=0},destruct:function(){},addAnimation:function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t)},removeAnimation:function(t){var e=this._anims.array.indexOf(t);0<=e?this._anims.fastRemoveAt(e):cc.errorID(3907)},pushDelayEvent:function(t,e,i){this._delayEvents.push({target:t,func:e,args:i})}});cc.AnimationManager=e.exports=o},{}],8:[function(t,e,i){var n=cc.js,r=t("./playable"),o=t("./types"),u=o.WrappedInfo,s=o.WrapMode,_=o.WrapModeMask;function a(t,e){r.call(this),cc.EventTarget.call(this),this._currentFramePlayed=!1,this._delay=0,this._delayTime=0,this._wrappedInfo=new u,this._lastWrappedInfo=null,this._process=h,this._clip=t,this._name=e||t&&t.name,this.animator=null,this.curves=[],this.delay=0,this.repeatCount=1,this.duration=1,this.speed=1,this.wrapMode=s.Normal,this.time=0,this._emit=this.emit,this.emit=function(){for(var t=new Array(arguments.length),e=0,i=t.length;e<i;e++)t[e]=arguments[e];cc.director.getAnimationManager().pushDelayEvent(this,"_emit",t)}}n.extend(a,r);var c=a.prototype;function h(){var t,e=this.sample(),i=this._hasListenerCache;i&&i.lastframe&&(t=this._lastWrappedInfo?this._lastWrappedInfo:this._lastWrappedInfo=new u(e),1<this.repeatCount&&(0|e.iterations)>(0|t.iterations)&&this.emit("lastframe",this),t.set(e)),e.stopped&&(this.stop(),this.emit("finished",this))}function l(){var t=this.time,e=this.duration;e<t?0==(t%=e)&&(t=e):t<0&&0!=(t%=e)&&(t+=e);for(var i=t/e,n=this.curves,r=0,o=n.length;r<o;r++)n[r].sample(t,i,this);var s=this._hasListenerCache;s&&s.lastframe&&(void 0===this._lastIterations&&(this._lastIterations=i),(0<this.time&&this._lastIterations>i||this.time<0&&this._lastIterations<i)&&this.emit("lastframe",this),this._lastIterations=i)}cc.js.mixin(c,cc.EventTarget.prototype),c._setListeners=function(t){this._capturingListeners=t?t._capturingListeners:null,this._bubblingListeners=t?t._bubblingListeners:null,this._hasListenerCache=t?t._hasListenerCache:null},c.onPlay=function(){this.setTime(0),this._delayTime=this._delay,cc.director.getAnimationManager().addAnimation(this),this.animator&&this.animator.addAnimation(this),this.emit("play",this)},c.onStop=function(){this.isPaused||cc.director.getAnimationManager().removeAnimation(this),this.animator&&this.animator.removeAnimation(this),this.emit("stop",this)},c.onResume=function(){cc.director.getAnimationManager().addAnimation(this),this.emit("resume",this)},c.onPause=function(){cc.director.getAnimationManager().removeAnimation(this),this.emit("pause",this)},c.setTime=function(t){this._currentFramePlayed=!1,this.time=t||0;for(var e=this.curves,i=0,n=e.length;i<n;i++){var r=e[i];r.onTimeChangedManually&&r.onTimeChangedManually(t,this)}},c.update=function(t){0<this._delayTime&&(this._delayTime-=t,0<this._delayTime)||(this._currentFramePlayed?this.time+=t*this.speed:this._currentFramePlayed=!0,this._process())},c._needRevers=function(t){var e=this.wrapMode,i=!1;return(e&_.PingPong)===_.PingPong&&(t-(0|t)==0&&0<t&&(t-=1),1&t&&(i=!i)),(e&_.Reverse)===_.Reverse&&(i=!i),i},c.getWrappedInfo=function(t,e){e=e||new u;var i=!1,n=this.duration,r=this.repeatCount,o=0<t?t/n:-t/n;if(r<=o){i=!0;var s=(o=r)-(0|r);0===s&&(s=1),t=s*n*(0<t?1:-1)}if(n<t){var a=t%n;t=0===a?n:a}else t<0&&0!=(t%=n)&&(t+=n);var c=!1,h=this._wrapMode&_.ShouldWrap;h&&(c=this._needRevers(o));var l=c?-1:1;return this.speed<0&&(l*=-1),h&&c&&(t=n-t),e.ratio=t/n,e.time=t,e.direction=l,e.stopped=i,e.iterations=o,e},c.sample=function(){for(var t=this.getWrappedInfo(this.time,this._wrappedInfo),e=this.curves,i=0,n=e.length;i<n;i++)e[i].sample(t.time,t.ratio,this);return t},n.get(c,"clip",function(){return this._clip}),n.get(c,"name",function(){return this._name}),n.obsolete(c,"AnimationState.length","duration"),n.getset(c,"curveLoaded",function(){return 0<this.curves.length},function(){this.curves.length=0}),n.getset(c,"wrapMode",function(){return this._wrapMode},function(t){this._wrapMode=t,this.time=0,t&_.Loop?this.repeatCount=1/0:this.repeatCount=1}),n.getset(c,"repeatCount",function(){return this._repeatCount},function(t){this._repeatCount=t;var e=this._wrapMode&_.ShouldWrap,i=(this.wrapMode&_.Reverse)===_.Reverse;this._process=t!==1/0||e||i?h:l}),n.getset(c,"delay",function(){return this._delay},function(t){this._delayTime=this._delay=t}),cc.AnimationState=e.exports=a},{"./playable":13,"./types":14}],9:[function(t,e,i){var R=Math.cos,A=Math.acos,O=Math.max,I=2*Math.PI,w=Math.sqrt;function L(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}e.exports={bezier:function(t,e,i,n,r){var o=1-r;return t*o*o*o+3*e*o*o*r+3*i*o*r*r+n*r*r*r},bezierByTime:function(t,e){var i=function(t,e){var i,n,r,o,s=e-0,a=e-t[0],c=3*s,h=3*a,l=3*(e-t[2]),u=1/(-s+h-l+(e-1)),_=(c-6*a+l)*u,d=_*(1/3),f=(-c+h)*u,p=1/3*(3*f-_*_),g=p*(1/3),m=(2*_*_*_-9*_*f+s*u*27)/27,v=m/2,y=v*v+g*g*g;if(y<0){var C=1/3*-p,T=w(C*C*C),x=-m/(2*T),E=A(x<-1?-1:1<x?1:x),S=2*L(T);return n=S*R(E*(1/3))-d,r=S*R((E+I)*(1/3))-d,o=S*R((E+2*I)*(1/3))-d,0<=n&&n<=1?0<=r&&r<=1?0<=o&&o<=1?O(n,r,o):O(n,r):0<=o&&o<=1?O(n,o):n:0<=r&&r<=1?0<=o&&o<=1?O(r,o):r:o}if(0===y)return r=-(i=v<0?L(-v):-L(v))-d,0<=(n=2*i-d)&&n<=1?0<=r&&r<=1?O(n,r):n:r;var b=w(y);return(i=L(-v+b))-L(v+b)-d}(t,e),n=1-i;return 0*n*n*n+3*t[1]*i*n*n+3*t[3]*i*i*n+1*i*i*i}}},{}],10:[function(t,e,i){var n={constant:function(){return 0},linear:function(t){return t},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quartIn:function(t){return t*t*t*t},quartOut:function(t){return 1- --t*t*t*t},quartInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quintIn:function(t){return t*t*t*t*t},quintOut:function(t){return--t*t*t*t*t+1},quintInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sineIn:function(t){return 1-Math.cos(t*Math.PI/2)},sineOut:function(t){return Math.sin(t*Math.PI/2)},sineInOut:function(t){return.5*(1-Math.cos(Math.PI*t))},expoIn:function(t){return 0===t?0:Math.pow(1024,t-1)},expoOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},expoInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},circIn:function(t){return 1-Math.sqrt(1-t*t)},circOut:function(t){return Math.sqrt(1- --t*t)},circInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),-i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4))},elasticOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),i*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)},elasticInOut:function(t){var e,i=.1;return 0===t?0:1===t?1:(!i||i<1?(i=1,e=.1):e=.4*Math.asin(1/i)/(2*Math.PI),(t*=2)<1?i*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4)*-.5:i*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4)*.5+1)},backIn:function(t){return t*t*(2.70158*t-1.70158)},backOut:function(t){return--t*t*(2.70158*t+1.70158)+1},backInOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)},bounceOut:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},smooth:function(t){return t<=0?0:1<=t?1:t*t*(3-2*t)},fade:function(t){return t<=0?0:1<=t?1:t*t*t*(t*(6*t-15)+10)}};function r(e,i){return function(t){return t<.5?i(2*t)/2:e(2*t-1)/2+.5}}n.quadOutIn=r(n.quadIn,n.quadOut),n.cubicOutIn=r(n.cubicIn,n.cubicOut),n.quartOutIn=r(n.quartIn,n.quartOut),n.quintOutIn=r(n.quintIn,n.quintOut),n.sineOutIn=r(n.sineIn,n.sineOut),n.expoOutIn=r(n.expoIn,n.expoOut),n.circOutIn=r(n.circIn,n.circOut),n.backOutIn=r(n.backIn,n.backOut),n.backOutIn=r(n.backIn,n.backOut),n.bounceIn=function(t){return 1-n.bounceOut(1-t)},n.bounceInOut=function(t){return t<.5?.5*n.bounceIn(2*t):.5*n.bounceOut(2*t-1)+.5},n.bounceOutIn=r(n.bounceIn,n.bounceOut),cc.Easing=e.exports=n},{}],11:[function(t,e,i){t("./bezier"),t("./easing"),t("./types"),t("./motion-path-helper"),t("./animation-curves"),t("./animation-clip"),t("./animation-manager"),t("./animation-state"),t("./animation-animator")},{"./animation-animator":4,"./animation-clip":5,"./animation-curves":6,"./animation-manager":7,"./animation-state":8,"./bezier":9,"./easing":10,"./motion-path-helper":12,"./types":14}],12:[function(t,e,i){var z=t("./animation-curves").DynamicAnimCurve,U=t("./animation-curves").computeRatioByType,n=t("./bezier").bezier,V=t("../core/utils/binary-search").binarySearchEpsilon,k=cc.v2;function W(t){this.points=t||[],this.beziers=[],this.ratios=[],this.progresses=[],this.length=0,this.computeBeziers()}function o(){this.start=k(),this.end=k(),this.startCtrlPoint=k(),this.endCtrlPoint=k()}W.prototype.computeBeziers=function(){var t;this.beziers.length=0,this.ratios.length=0,this.progresses.length=0,this.length=0;for(var e=1;e<this.points.length;e++){var i=this.points[e-1],n=this.points[e];(t=new o).start=i.pos,t.startCtrlPoint=i.out,t.end=n.pos,t.endCtrlPoint=n.in,this.beziers.push(t),this.length+=t.getLength()}var r=0;for(e=0;e<this.beziers.length;e++)t=this.beziers[e],this.ratios[e]=t.getLength()/this.length,this.progresses[e]=r+=this.ratios[e];return this.beziers},o.prototype.getPointAt=function(t){var e=this.getUtoTmapping(t);return this.getPoint(e)},o.prototype.getPoint=function(t){var e=n(this.start.x,this.startCtrlPoint.x,this.endCtrlPoint.x,this.end.x,t),i=n(this.start.y,this.startCtrlPoint.y,this.endCtrlPoint.y,this.end.y,t);return new k(e,i)},o.prototype.getLength=function(){var t=this.getLengths();return t[t.length-1]},o.prototype.getLengths=function(t){if(t||(t=this.__arcLengthDivisions?this.__arcLengthDivisions:200),this.cacheArcLengths&&this.cacheArcLengths.length===t+1)return this.cacheArcLengths;var e,i,n=[],r=this.getPoint(0),o=0;for(n.push(0),i=1;i<=t;i++)e=this.getPoint(i/t),o+=cc.pDistance(e,r),n.push(o),r=e;return this.cacheArcLengths=n},o.prototype.getUtoTmapping=function(t,e){var i,n=this.getLengths(),r=0,o=n.length;i=e||t*n[o-1];for(var s,a=0,c=o-1;a<=c;)if((s=n[r=Math.floor(a+(c-a)/2)]-i)<0)a=r+1;else{if(!(0<s)){c=r;break}c=r-1}if(n[r=c]===i)return r/(o-1);var h=n[r];return(r+(i-h)/(n[r+1]-h))/(o-1)},e.exports={sampleMotionPaths:function(t,e,i,n){function r(t){return t instanceof cc.Vec2?{in:t,pos:t,out:t}:Array.isArray(t)&&6===t.length?{in:k(t[2],t[3]),pos:k(t[0],t[1]),out:k(t[4],t[5])}:{in:cc.Vec2.ZERO,pos:cc.Vec2.ZERO,out:cc.Vec2.ZERO}}var o=e.values;if(0!==t.length&&0!==o.length)if(1!==(o=o.map(function(t){return k(t[0],t[1])})).length){for(var s=e.types,a=e.ratios,c=e.values=[],h=e.types=[],l=e.ratios=[],u=0,_=z.Linear,d=0,f=t.length;d<f-1;d++){var p,g=t[d],m=a[d],v=a[d+1]-m,y=o[d],C=o[d+1],T=s[d],x=[],E=u/v,S=1/(v*i*n);if(g&&0<g.length){var b=[];b.push(r(y));for(var R=0,A=g.length;R<A;R++){var O=r(g[R]);b.push(O)}b.push(r(C));var I=new W(b);I.computeBeziers();for(var w=I.progresses;1e-6<1-E;){var L,N,P,D;if((p=U(p=E,T))<0)D=(0-p)*(N=I.beziers[0]).getLength(),P=N.start.sub(N.endCtrlPoint).normalize(),L=N.start.add(P.mul(D));else if(1<p)D=(p-1)*(N=I.beziers[I.beziers.length-1]).getLength(),P=N.end.sub(N.startCtrlPoint).normalize(),L=N.end.add(P.mul(D));else{var F=V(w,p);F<0&&(F=~F),p-=0<F?w[F-1]:0,p/=I.ratios[F],L=I.beziers[F].getPointAt(p)}x.push(L),E+=S}}else for(;1e-6<1-E;)p=U(p=E,T),x.push(y.lerp(C,p)),E+=S;for(_="constant"===T?T:z.Linear,R=0,A=x.length;R<A;R++){var M=m+u+S*R*v;B(x[R],_,M)}u=1e-6<Math.abs(E-1)?(E-1)*v:0}a[a.length-1]!==l[l.length-1]&&B(o[o.length-1],_,a[a.length-1])}else e.values=o;function B(t,e,i){c.push(t),h.push(e),l.push(i)}},Curve:W,Bezier:o}},{"../core/utils/binary-search":169,"./animation-curves":6,"./bezier":9}],13:[function(t,e,i){var n=cc.js;function r(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var o=r.prototype;n.get(o,"isPlaying",function(){return this._isPlaying},!0),n.get(o,"isPaused",function(){return this._isPaused},!0);var s=function(){};o.onPlay=s,o.onPause=s,o.onResume=s,o.onStop=s,o.onError=s,o.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError("already-playing"):(this._isPlaying=!0,this.onPlay())},o.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},o.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())},o.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},o.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},e.exports=r},{}],14:[function(t,e,i){cc.js;var n={Loop:2,ShouldWrap:4,PingPong:22,Reverse:36},r=cc.Enum({Default:0,Normal:1,Reverse:n.Reverse,Loop:n.Loop,LoopReverse:n.Loop|n.Reverse,PingPong:n.PingPong,PingPongReverse:n.PingPong|n.Reverse});function o(t){t?this.set(t):(this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0)}cc.WrapMode=r,o.prototype.set=function(t){this.ratio=t.ratio,this.time=t.time,this.direction=t.direction,this.stopped=t.stopped,this.iterations=t.iterations,this.frameIndex=t.frameIndex},e.exports={WrapModeMask:n,WrapMode:r,WrappedInfo:o}},{}],15:[function(t,e,i){var n,r=t("../core/event/event-target"),o=t("../core/platform/CCSys"),s=!1,a=[],c=function(t){r.call(this),this._src=t,this._audioType=c.Type.UNKNOWN,this._element=null,this._eventList={},this._state=c.State.INITIALZING,this._loaded=!1,this._onended=function(){this.emit("ended")}.bind(this)};cc.js.extend(c,r),c.Type={DOM:"AUDIO",WEBAUDIO:"WEBAUDIO",NATIVE:"NATIVE",UNKNOWN:"UNKNOWN"},c.State={ERROR:-1,INITIALZING:0,PLAYING:1,PAUSED:2},(n=c.prototype).preload=function(){var i=this._src,n=this;if(!i)return this._src="",this._audioType=c.Type.UNKNOWN,this._element=null,this._state=c.State.INITIALZING,void(this._loaded=!1);if(!this._element){var t=cc.loader.getItem(i);if(t||(t=cc.loader.getItem(i+"?useDom=1")),!t||!t.complete)return cc.loader.load(i,function(t){if(!t){var e=cc.loader.getItem(i);n.mount(e.element||e.buffer),n.emit("load")}});n.mount(t.element||t.buffer),n.emit("load")}},n._bindEnded=function(t){t=t||this._onended,this._audioType===c.Type.DOM?this._element.addEventListener("ended",t):this._element.onended=t},n._unbindEnded=function(){this._audioType===c.Type.DOM?this._element.removeEventListener("ended",this._onended):this._element.onended=null},n.mount=function(t){t instanceof HTMLElement?CC_QQPLAY?this._element=t:(this._element=document.createElement("audio"),this._element.src=t.src,this._audioType=c.Type.DOM):(this._element=new l(t,this),this._audioType=c.Type.WEBAUDIO),this._state=c.State.INITIALZING,this._loaded=!0},n.play=function(){this._element&&(this._bindEnded(),this._element.play(),this.emit("play"),this._state=c.State.PLAYING,!CC_QQPLAY&&this._audioType===c.Type.DOM&&this._element.paused&&a.push({instance:this,offset:0,audio:this._element}),s||(s=!0,cc.game.canvas.addEventListener("touchstart",function(){for(var t;t=a.pop();)t.audio.play(t.offset)})))},n.destroy=function(){},n.pause=function(){this._element&&(this._unbindEnded(),this._element.pause(),this.emit("pause"),this._state=c.State.PAUSED)},n.resume=function(){this._element&&0!==this._element.currentTime&&(this._bindEnded(),this._element.play(),this.emit("resume"),this._state=c.State.PLAYING)},n.stop=function(){if(this._element){try{this._element.currentTime=0}catch(t){}this._element.pause();for(var t=0;t<a.length;t++)if(a[t].instance===this){a.splice(t,1);break}this._unbindEnded(),this.emit("stop"),this._state=c.State.PAUSED}},n.setLoop=function(t){this._element&&(this._element.loop=t)},n.getLoop=function(){return this._element&&this._element.loop},n.setVolume=function(t){this._element&&(this._element.volume=t)},n.getVolume=function(){return this._element?this._element.volume:1},n.setCurrentTime=function(e){if(this._element){this._unbindEnded(),CC_QQPLAY||this._bindEnded(function(){this._bindEnded()}.bind(this));try{this._element.currentTime=e}catch(t){var i=this._element;if(i.addEventListener){var n=function(){i.removeEventListener("loadedmetadata",n),i.currentTime=e};i.addEventListener("loadedmetadata",n)}}}},n.getCurrentTime=function(){return this._element?this._element.currentTime:0},n.getDuration=function(){return this._element?this._element.duration:0},n.getState=function(){var t=this._element;return c.State.PLAYING===this._state&&t.paused&&(this._state=c.State.PAUSED),this._state},n.__defineGetter__("src",function(){return this._src}),n.__defineSetter__("src",function(t){return this._src=t}),n.__defineGetter__("paused",function(){return!this._element||this._element.paused});var h,l=function(t,e){this._audio=e,this._context=o.__audioSupport.context,this._buffer=t,this._gainObj=this._context.createGain(),this._volume=1,this._gainObj.gain.setTargetAtTime?this._gainObj.gain.setTargetAtTime(this._volume,this._context.currentTime,.01):this._gainObj.gain.value=1,this._gainObj.connect(this._context.destination),this._loop=!1,this._startTime=-1,this._currentSource=null,this.playedLength=0,this._currextTimer=null,this._endCallback=function(){this.onended&&this.onended(this)}.bind(this)};(h=l.prototype).play=function(t){this._currentSource&&!this.paused&&(this._currentSource.onended=null,this._currentSource.stop(0),this.playedLength=0);var e=this._context.createBufferSource();e.buffer=this._buffer,e.connect(this._gainObj),e.loop=this._loop,this._startTime=this._context.currentTime,(t=t||this.playedLength)&&(this._startTime-=t);var i,n=this._buffer.duration,r=t;if(this._loop?e.start?e.start(0,r):e.notoGrainOn?e.noteGrainOn(0,r):e.noteOn(0,r):(i=n-t,e.start?e.start(0,r,i):e.notoGrainOn?e.noteGrainOn(0,r,i):e.noteOn(0,r,i)),(this._currentSource=e).onended=this._endCallback,(!e.context.state||"suspended"===e.context.state)&&0===this._context.currentTime){var o=this;clearTimeout(this._currextTimer),this._currextTimer=setTimeout(function(){CC_QQPLAY||0!==o._context.currentTime||a.push({instance:o._audio,offset:t,audio:o})},10)}},h.pause=function(){if(clearTimeout(this._currextTimer),!this.paused){this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration;var t=this._currentSource;this._currentSource=null,this._startTime=-1,t&&t.stop(0)}},h.__defineGetter__("paused",function(){return(!this._currentSource||!this._currentSource.loop)&&(-1===this._startTime||this._context.currentTime-this._startTime>this._buffer.duration)}),h.__defineGetter__("loop",function(){return this._loop}),h.__defineSetter__("loop",function(t){return this._currentSource&&(this._currentSource.loop=t),this._loop=t}),h.__defineGetter__("volume",function(){return this._volume}),h.__defineSetter__("volume",function(t){return this._volume=t,this._gainObj.gain.setTargetAtTime?this._gainObj.gain.setTargetAtTime(this._volume,this._context.currentTime,.01):this._volume.gain.value=t,o.os===o.OS_IOS&&!this.paused&&this._currentSource&&(this._currentSource.onended=null,this.pause(),this.play()),t}),h.__defineGetter__("currentTime",function(){return this.paused||(this.playedLength=this._context.currentTime-this._startTime,this.playedLength%=this._buffer.duration),this.playedLength}),h.__defineSetter__("currentTime",function(t){return this.paused?this.playedLength=t:(this.pause(),this.playedLength=t,this.play()),t}),h.__defineGetter__("duration",function(){return this._buffer.duration}),e.exports=cc.Audio=c},{"../core/event/event-target":85,"../core/platform/CCSys":132}],16:[function(t,e,i){var a=t("./CCAudio"),c=0,h={},l={},n=function(t){return h[t]},u={AudioState:a.State,_maxWebAudioSize:2097152,_maxAudioInstance:24,_id2audio:h,play:function(t,e,i){var n=function(t){var e,i=c++,n=l[t];if(n||(n=l[t]=[]),u._maxAudioInstance<=n.length){var r=n.shift(),o=h[r];o.stop(),o.destroy()}var s=function(){var t=this.instanceId;delete h[t];var e=n.indexOf(t);cc.js.array.fastRemoveAt(n,e)};return(e=new a(t)).on("ended",s),e.on("stop",s),(h[i]=e).instanceId=i,n.push(i),e}(t),r=function(){n.setLoop(e||!1),("number"!=typeof i||isNaN(i))&&(i=1),n.setVolume(i),n.play()};return n.__callback=r,n.on("load",r),n.preload(),n.instanceId},setLoop:function(t,e){var i=n(t);i&&i.setLoop&&i.setLoop(e)},isLoop:function(t){var e=n(t);return!(!e||!e.isLoop)&&e.isLoop()},setVolume:function(t,e){var i=n(t);i&&(i._loaded||i.once("load",function(){i.setVolume&&i.setVolume(e)}),i.setVolume&&i.setVolume(e))},getVolume:function(t){var e=n(t);return e&&e.getVolume?e.getVolume():1},setCurrentTime:function(t,e){var i=n(t);return!!i&&(i._loaded?i.setCurrentTime&&i.setCurrentTime(e):i.once("load",function(){i.setCurrentTime&&i.setCurrentTime(e)}),!0)},getCurrentTime:function(t){var e=n(t);return e&&e.getCurrentTime?e.getCurrentTime():0},getDuration:function(t){var e=n(t);return e&&e.getDuration?e.getDuration():0},getState:function(t){var e=n(t);return e&&e.getState?e.getState():this.AudioState.ERROR},setFinishCallback:function(t,e){var i=n(t);i&&(i.off("ended",i._finishCallback),i._finishCallback=e,i.on("ended",i._finishCallback))},pause:function(t){var e=n(t);return!(!e||!e.pause||(e.pause(),0))},_pauseIDCache:[],pauseAll:function(){for(var t in h){var e=h[t];e.getState()===a.State.PLAYING&&(this._pauseIDCache.push(t),e.pause())}},resume:function(t){var e=n(t);if(!e||!e.resume)return!1;0===e.getCurrentTime()?e.play():e.resume()},resumeAll:function(){for(;0<this._pauseIDCache.length;){var t=this._pauseIDCache.pop(),e=n(t);e&&e.resume&&e.resume()}},stop:function(t){var e=n(t);return!(!e||!e.stop||(e.off("load",e.__callback),e.stop(),e.destroy(),0))},stopAll:function(){for(var t in h){var e=h[t];e&&e.stop&&(e.stop(),e.destroy(),e.off("load",e.__callback))}},setMaxAudioInstance:function(t){return this._maxAudioInstance=t},getMaxAudioInstance:function(){return this._maxAudioInstance},uncache:function(t){var e=l[t];if(e)for(;0<e.length;){var i=e.pop(),n=h[i];n&&(n.stop(),n.destroy(),delete h[i])}},uncacheAll:function(){for(var t in this.stopAll(),h){var e=h[t];e&&e.destroy()}h={},l={}},getProfile:function(t){},preload:function(t,e){cc.loader.load(t,e&&function(t){t||e()})},setMaxWebAudioSize:function(t){this._maxWebAudioSize=1024*t},_breakCache:null,_break:function(){for(var t in this._breakCache=[],h){var e=h[t];e.getState()===a.State.PLAYING&&(this._breakCache.push(t),e.pause())}},_restore:function(){if(this._breakCache){for(;0<this._breakCache.length;){var t=this._breakCache.pop(),e=n(t);e&&e.resume&&e.resume()}this._breakCache=null}}};e.exports=cc.audioEngine=u;var r=t("./deprecated");r.removed(u),r.deprecated(u)},{"./CCAudio":15,"./deprecated":17}],17:[function(t,e,i){var a=cc.js;i.removed=function(t){function e(){cc.errorID(1403)}a.getset(t,"willPlayMusic",e,e)},i.deprecated=function(n){var r=-1,i=1,o=1,s=[];a.get(n,"playMusic",function(){return function(t,e){return n.stop(r),r=n.play(t,e,i)}}),a.get(n,"stopMusic",function(){return function(){return n.stop(r),r}}),a.get(n,"pauseMusic",function(){return function(){return n.pause(r),r}}),a.get(n,"resumeMusic",function(){return function(){return n.resume(r),r}}),a.get(n,"rewindMusic",function(){return function(){return n.setCurrentTime(r,0),r}}),a.get(n,"getMusicVolume",function(){return function(){return i}}),a.get(n,"setMusicVolume",function(){return function(t){return i=t,n.setVolume(r,i),i}}),a.get(n,"isMusicPlaying",function(){return function(){return n.getState(r)===n.AudioState.PLAYING}}),a.get(n,"playEffect",function(){return function(t,e,i){return n.play(t,e||!1,void 0===i?o:i)}}),a.get(n,"setEffectsVolume",function(t){return function(t){o=t;var e=n._id2audio;for(var i in e)i!==r&&n.setVolume(i,t)}}),a.get(n,"getEffectsVolume",function(){return function(){return o}}),a.get(n,"pauseEffect",function(){return function(t){return n.pause(t)}}),a.get(n,"pauseAllEffects",function(){return function(){s.length=0;var t=n._id2audio;for(var e in t)if(e!==r){var i=t[e];i.getState()===n.AudioState.PLAYING&&(s.push(e),i.pause())}}}),a.get(n,"resumeEffect",function(){return function(t){n.resume(t)}}),a.get(n,"resumeAllEffects",function(){return function(){for(var t=n._id2audio;0<s.length;){var e=t[s.pop()];e&&e.resume&&e.resume()}}}),a.get(n,"stopEffect",function(){return function(t){return n.stop(t)}}),a.get(n,"stopAllEffects",function(){return function(){var t=n._id2audio;for(var e in t)if(e!==r){var i=t[e];i.getState()===n.AudioState.PLAYING&&i.stop()}}}),a.get(n,"unloadEffect",function(){return function(t){return n.stop(t)}}),a.get(n,"end",function(){return function(){return n.stopAll()}})}},{}],18:[function(t,e,i){cc.ClippingNode=_ccsg.Node.extend({inverted:!1,_alphaThreshold:0,_stencil:null,_className:"ClippingNode",_originStencilProgram:null,ctor:function(t){t=t||null,_ccsg.Node.prototype.ctor.call(this),(this._stencil=t)&&(this._originStencilProgram=t.getShaderProgram()),this.alphaThreshold=1,this.inverted=!1,this._renderCmd.initStencilBits()},onEnter:function(){_ccsg.Node.prototype.onEnter.call(this),this._stencil&&this._stencil.performRecursive(_ccsg.Node.performType.onEnter)},onEnterTransitionDidFinish:function(){_ccsg.Node.prototype.onEnterTransitionDidFinish.call(this),this._stencil&&this._stencil.performRecursive(_ccsg.Node.performType.onEnterTransitionDidFinish)},onExitTransitionDidStart:function(){this._stencil&&this._stencil.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),_ccsg.Node.prototype.onExitTransitionDidStart.call(this)},onExit:function(){this._stencil&&this._stencil.performRecursive(_ccsg.Node.performType.onExit),_ccsg.Node.prototype.onExit.call(this)},visit:function(t){this._renderCmd.clippingVisit(t&&t._renderCmd)},_visitChildren:function(){this._reorderChildDirty&&this.sortAllChildren();for(var t,e=this._children,i=0,n=e.length;i<n;i++)(t=e[i])&&t._visible&&t.visit(this);this._renderCmd._dirtyFlag=0},getAlphaThreshold:function(){return this._alphaThreshold},setAlphaThreshold:function(t){1===t&&t!==this._alphaThreshold&&this._renderCmd.resetProgramByStencil(),this._alphaThreshold=t},isInverted:function(){return this.inverted},setInverted:function(t){this.inverted=t},getStencil:function(){return this._stencil},setStencil:function(t){this._stencil!==t&&(t&&(this._originStencilProgram=t.getShaderProgram()),this._renderCmd.setStencil(t))},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.ClippingNode.CanvasRenderCmd(this):new cc.ClippingNode.WebGLRenderCmd(this)}}),cc.ClippingNode.stencilBits=-1;var n=cc.ClippingNode.prototype;cc.defineGetterSetter(n,"stencil",n.getStencil,n.setStencil),cc.defineGetterSetter(n,"alphaThreshold",n.getAlphaThreshold,n.setAlphaThreshold)},{}],19:[function(t,e,i){t("../shape-nodes/CCDrawNode"),cc.ClippingNode.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!1,this._rendererClipCmd=new cc.CustomRenderCmd(this,this._drawStencilCommand),this._rendererRestoreCmd=new cc.CustomRenderCmd(this,this._restoreCmdCallback)};var n=cc.ClippingNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);n.constructor=cc.ClippingNode.CanvasRenderCmd,n.resetProgramByStencil=function(){},n.initStencilBits=function(){},n.setStencil=function(t){null!=t&&((this._node._stencil=t)instanceof cc.DrawNode||cc.errorID(6300))},n._restoreCmdCallback=function(t){(t||cc._renderContext).restore()},n._drawStencilCommand=function(t,e,i){var n=t||cc._renderContext,r=n.getContext();n.save(),r.beginPath(),n.setTransform(this._worldTransform,e,i);for(var o=this._node._stencil._buffer,s=0;s<o.length;++s){var a=o[s].verts;if(!(a.length<3)){r.moveTo(a[0].x,-a[0].y);for(var c=1;c<a.length;++c)r.lineTo(a[c].x,-a[c].y)}}r.clip()},n.clippingVisit=function(t){var e=this._node;if(t=t||this.getParentRenderCmd(),this._propagateFlagsDown(t),e._visible){t&&(this._curLevel=t._curLevel+1),this._syncStatus(t),e._stencil&&cc.renderer.pushRenderCommand(this._rendererClipCmd);var i,n=e._children,r=n.length;if(0<r)for(e.sortAllChildren(),i=0;i<r;i++)n[i].visit(e);e._stencil&&cc.renderer.pushRenderCommand(this._rendererRestoreCmd),this._dirtyFlag=0}}},{"../shape-nodes/CCDrawNode":210}],20:[function(t,e,i){function s(t,e){t.shaderProgram=e;var i=t.children;if(i)for(var n=0;n<i.length;n++)s(i[n],e)}t("../core/CCDrawingPrimitives");var a={stencilEnabled:!1,depthWriteMask:!0};cc.ClippingNode.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!1,this._beforeVisitCmd=new cc.CustomRenderCmd(this,this._onBeforeVisit),this._afterDrawStencilCmd=new cc.CustomRenderCmd(this,this._onAfterDrawStencil),this._afterVisitCmd=new cc.CustomRenderCmd(this,this._onAfterVisit),this._previousState=null,this._state={stencilEnabled:!0,stencilWriteMask:0,depthWriteMask:!1,stencilFunc:0,stencilRef:0,stencilValueMask:0}};var n=cc.ClippingNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);n.constructor=cc.ClippingNode.WebGLRenderCmd,cc.ClippingNode.WebGLRenderCmd._init_once=null,cc.ClippingNode.WebGLRenderCmd._visit_once=null,cc.ClippingNode.WebGLRenderCmd._layer=-1,n.initStencilBits=function(){cc.ClippingNode.WebGLRenderCmd._init_once=!0,cc.ClippingNode.WebGLRenderCmd._init_once&&(cc.ClippingNode.stencilBits=cc._renderContext.getParameter(cc._renderContext.STENCIL_BITS),cc.ClippingNode.stencilBits<=0&&cc.logID(6301),cc.ClippingNode.WebGLRenderCmd._init_once=!1)},n.transform=function(t,e){var i=this._node;this.originTransform(t,e),i._stencil&&(i._stencil._renderCmd.transform(this,!0),i._stencil._dirtyFlag&=~_ccsg.Node._dirtyFlags.transformDirty)},n.clippingVisit=function(t){var e=this._node;if(t=t||this.getParentRenderCmd(),this.visit(t),cc.ClippingNode.stencilBits<1)e._visitChildren();else if(e._stencil&&e._stencil.visible){if(cc.ClippingNode.WebGLRenderCmd._layer+1===cc.ClippingNode.stencilBits)return cc.ClippingNode.WebGLRenderCmd._visit_once=!0,cc.ClippingNode.WebGLRenderCmd._visit_once&&(cc.logID(6302,cc.ClippingNode.stencilBits),cc.ClippingNode.WebGLRenderCmd._visit_once=!1),void e._visitChildren();cc.renderer.pushRenderCommand(this._beforeVisitCmd),e._stencil.visit(e),cc.renderer.pushRenderCommand(this._afterDrawStencilCmd);var i=e._children;if(i&&0<i.length){var n=i.length;e.sortAllChildren();for(var r=0;r<n;r++)i[r].visit(e)}cc.renderer.pushRenderCommand(this._afterVisitCmd),this._dirtyFlag=0}else e.inverted&&e._visitChildren()},n.setStencil=function(t){var e=this._node;e._stencil&&(e._stencil._parent=null),e._stencil=t,e._stencil&&(e._stencil._parent=e)},n._drawFullScreenQuadClearStencil=function(){var t=cc.math.projection_matrix_stack;t.push(),t.top.identity();var e=cc.math.modelview_matrix_stack;e.push(),e.top.identity(),cc._drawingUtil.drawSolidRect(cc.p(-1,-1),cc.p(1,1),cc.color(255,255,255,255)),t.pop(),e.pop()},n.resetProgramByStencil=function(){var t=this._node;if(t._stencil){var e=t._originStencilProgram;s(t._stencil,e)}},n._onBeforeVisit=function(t){var e=t||cc._renderContext,i=this._node;cc.ClippingNode.WebGLRenderCmd._layer++;var n=1<<cc.ClippingNode.WebGLRenderCmd._layer,r=n|n-1;if(this._previousState=a,e.enable(e.STENCIL_TEST),e.stencilMask(n),e.depthMask(!1),e.stencilFunc(e.NEVER,n,n),e.stencilOp(this._node.inverted?e.REPLACE:e.ZERO,e.KEEP,e.KEEP),this._drawFullScreenQuadClearStencil(),e.stencilFunc(e.NEVER,n,n),e.stencilOp(this._node.inverted?e.ZERO:e.REPLACE,e.KEEP,e.KEEP),i.alphaThreshold<1){var o=cc.shaderCache.programForKey(cc.macro.SHADER_POSITION_TEXTURECOLORALPHATEST);cc.gl.useProgram(o.getProgram()),o.setUniformLocationWith1f(cc.macro.UNIFORM_ALPHA_TEST_VALUE_S,i.alphaThreshold),o.setUniformLocationWithMatrix4fv(cc.macro.UNIFORM_MVMATRIX_S,cc.renderer.mat4Identity.mat),s(i._stencil,o)}this._state.stencilWriteMask=n,this._state.stencilRef=this._state.stencilValueMask=r,this._state.stencilFunc=e.NEVER,a=this._state},n._onAfterDrawStencil=function(t){var e=t||cc._renderContext;e.depthMask(this._previousState.depthWriteMask),e.stencilFunc(e.EQUAL,this._state.stencilRef,this._state.stencilValueMask),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),this._state.stencilFunc=e.EQUAL},n._onAfterVisit=function(t){var e=t||cc._renderContext,i=this._previousState;i.stencilEnabled?(e.stencilFunc(i.stencilFunc,i.stencilRef,i.stencilValueMask),e.stencilOp(e.KEEP,e.KEEP,e.KEEP),e.stencilMask(i.stencilWriteMask)):e.disable(e.STENCIL_TEST),a=this._previousState,this._previousState=null,cc.ClippingNode.WebGLRenderCmd._layer--}},{"../core/CCDrawingPrimitives":25}],21:[function(t,e,i){cc.configuration={ERROR:0,STRING:1,INT:2,DOUBLE:3,BOOLEAN:4,_maxTextureSize:0,_maxModelviewStackDepth:0,_supportsPVRTC:!1,_supportsNPOT:!1,_supportsBGRA8888:!1,_supportsDiscardFramebuffer:!1,_supportsShareableVAO:!1,_maxSamplesAllowed:0,_maxTextureUnits:0,_GlExtensions:"",_valueDict:{},_inited:!1,_init:function(){var t=this._valueDict;t["cocos2d.x.version"]=cc.ENGINE_VERSION,t["cocos2d.x.compiled_with_profiler"]=!1,t["cocos2d.x.compiled_with_gl_state_cache"]=cc.macro.ENABLE_GL_STATE_CACHE,this._inited=!0},getMaxTextureSize:function(){return this._maxTextureSize},getMaxModelviewStackDepth:function(){return this._maxModelviewStackDepth},getMaxTextureUnits:function(){return this._maxTextureUnits},supportsNPOT:function(){return this._supportsNPOT},supportsPVRTC:function(){return this._supportsPVRTC},supportsETC:function(){return!1},supportsS3TC:function(){return!1},supportsATITC:function(){return!1},supportsBGRA8888:function(){return this._supportsBGRA8888},supportsDiscardFramebuffer:function(){return this._supportsDiscardFramebuffer},supportsShareableVAO:function(){return this._supportsShareableVAO},checkForGLExtension:function(t){return-1<this._GlExtensions.indexOf(t)},getValue:function(t,e){this._inited||this._init();var i=this._valueDict;return i[t]?i[t]:e},setValue:function(t,e){this._valueDict[t]=e},gatherGPUInfo:function(){if(cc._renderType!==cc.game.RENDER_TYPE_CANVAS){this._inited||this._init();var t=cc._renderContext,e=this._valueDict;e["gl.vendor"]=t.getParameter(t.VENDOR),e["gl.renderer"]=t.getParameter(t.RENDERER),e["gl.version"]=t.getParameter(t.VERSION),this._GlExtensions="";for(var i=t.getSupportedExtensions(),n=0;n<i.length;n++)this._GlExtensions+=i[n]+" ";this._maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),e["gl.max_texture_size"]=this._maxTextureSize,this._maxTextureUnits=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS),e["gl.max_texture_units"]=this._maxTextureUnits,this._supportsPVRTC=this.checkForGLExtension("GL_IMG_texture_compression_pvrtc"),e["gl.supports_PVRTC"]=this._supportsPVRTC,this._supportsNPOT=!0,e["gl.supports_NPOT"]=this._supportsNPOT,this._supportsBGRA8888=this.checkForGLExtension("GL_IMG_texture_format_BGRA888"),e["gl.supports_BGRA8888"]=this._supportsBGRA8888,this._supportsDiscardFramebuffer=this.checkForGLExtension("GL_EXT_discard_framebuffer"),e["gl.supports_discard_framebuffer"]=this._supportsDiscardFramebuffer,this._supportsShareableVAO=this.checkForGLExtension("vertex_array_object"),e["gl.supports_vertex_array_object"]=this._supportsShareableVAO,cc.checkGLErrorDebug()}},loadConfigFile:function(t){this._inited||this._init();var e=cc.loader.getRes(t);if(!e)throw new Error("Please load the resource first : "+t);cc.assertID(e,1101,t);var i=e.data;if(i)for(var n in i)this._valueDict[n]=i[n];else cc.logID(1100,t)}}},{}],22:[function(t,e,i){var n=t("./event/event-target"),r=t("./platform/_CCClass"),p=t("./load-pipeline/auto-release-utils"),o=t("./component-scheduler"),s=t("./node-activator"),a=t("./event/event-listeners"),c=t("./event-manager");cc.g_NumberOfDraws=0,cc.Director=r.extend({ctor:function(){var t=this;n.call(t),t._landscape=!1,t._nextDeltaTimeZero=!1,t._paused=!1,t._purgeDirectorInNextLoop=!1,t._sendCleanupToScene=!1,t._animationInterval=0,t._oldAnimationInterval=0,t._projection=0,t._projectionDelegate=null,t._contentScaleFactor=1,t._winSizeInPoints=null,t._openGLView=null,t._scenesStack=null,t._nextScene=null,t._loadingScene="",t._runningScene=null,t._scene=null,t._totalFrames=0,t._lastUpdate=Date.now(),t._deltaTime=0,t._dirtyRegion=null,t._scheduler=null,t._compScheduler=null,t._nodeActivator=null,t._actionManager=null,cc.game.on(cc.game.EVENT_SHOW,function(){t._lastUpdate=Date.now()})},init:function(){return this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS,this._scenesStack=[],this._projection=cc.Director.PROJECTION_DEFAULT,this._projectionDelegate=null,this._totalFrames=0,this._lastUpdate=Date.now(),this._paused=!1,this._purgeDirectorInNextLoop=!1,this._winSizeInPoints=cc.size(0,0),this._openGLView=null,this._contentScaleFactor=1,this._scheduler=new cc.Scheduler,cc.ActionManager?(this._actionManager=new cc.ActionManager,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._actionManager=null,this.sharedInit(),!0},sharedInit:function(){this._compScheduler=new o,this._nodeActivator=new s,cc.AnimationManager?(this._animationManager=new cc.AnimationManager,this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._animationManager=null,cc.CollisionManager?(this._collisionManager=new cc.CollisionManager,this._scheduler.scheduleUpdate(this._collisionManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._collisionManager=null,cc.PhysicsManager?(this._physicsManager=new cc.PhysicsManager,this._scheduler.scheduleUpdate(this._physicsManager,cc.Scheduler.PRIORITY_SYSTEM,!1)):this._physicsManager=null,cc._widgetManager&&cc._widgetManager.init(this),cc.loader.init(this)},calculateDeltaTime:function(){var t=Date.now();this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):(this._deltaTime=(t-this._lastUpdate)/1e3,0<cc.game.config[cc.game.CONFIG_KEY.debugMode]&&1<this._deltaTime&&(this._deltaTime=1/60)),this._lastUpdate=t},convertToGL:function(t){var e=cc.game.container,i=cc.view,n=e.getBoundingClientRect(),r=n.left+window.pageXOffset-e.clientLeft,o=n.top+window.pageYOffset-e.clientTop,s=i._devicePixelRatio*(t.x-r),a=i._devicePixelRatio*(o+n.height-t.y);return i._isRotated?{x:i._viewPortRect.width-a,y:s}:{x:s,y:a}},convertToUI:function(t){var e=cc.game.container,i=cc.view,n=e.getBoundingClientRect(),r=n.left+window.pageXOffset-e.clientLeft,o=n.top+window.pageYOffset-e.clientTop,s={x:0,y:0};return i._isRotated?(s.x=r+t.y/i._devicePixelRatio,s.y=o+n.height-(i._viewPortRect.width-t.x)/i._devicePixelRatio):(s.x=r+t.x*i._devicePixelRatio,s.y=o+n.height-t.y*i._devicePixelRatio),s},_visitScene:function(){if(this._runningScene){var t=cc.renderer;t.childrenOrderDirty?(t.clearRenderCommands(),cc.renderer.assignedZ=0,this._runningScene._renderCmd._curLevel=0,this._runningScene.visit(),t.resetFlag()):t.transformDirty()&&t.transform()}},end:function(){this._purgeDirectorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getWinSize:function(){return cc.size(this._winSizeInPoints)},getWinSizeInPixels:function(){return cc.size(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor)},getVisibleSize:null,getVisibleOrigin:null,getZEye:null,pause:function(){this._paused||(this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(.25),this._paused=!0)},popScene:function(){cc.assertID(this._runningScene,1204),this._scenesStack.pop();var t=this._scenesStack.length;0===t?this.end():(this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[t-1])},purgeCachedData:function(){cc.textureCache._clear(),cc.loader.releaseAll()},purgeDirector:function(){this.getScheduler().unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),c&&c.setEnabled(!1),this._runningScene&&(this._runningScene.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),this._runningScene.performRecursive(_ccsg.Node.performType.onExit),this._runningScene.performRecursive(_ccsg.Node.performType.cleanup),cc.renderer.clearRenderCommands()),this._runningScene=null,this._nextScene=null,this._scenesStack.length=0,this.stopAnimation(),this.purgeCachedData()},reset:function(){this.purgeDirector(),c&&c.setEnabled(!0),this._actionManager&&this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._animationManager&&this._scheduler.scheduleUpdate(this._animationManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._collisionManager&&this._scheduler.scheduleUpdate(this._collisionManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this._physicsManager&&this._scheduler.scheduleUpdate(this._physicsManager,cc.Scheduler.PRIORITY_SYSTEM,!1),this.startAnimation()},pushScene:function(t){cc.assertID(t,1205),this._sendCleanupToScene=!1,this._scenesStack.push(t),this._nextScene=t},runSceneImmediate:function(t,e,i){t instanceof cc.Scene&&t._load();for(var n=cc.game,r=Object.keys(n._persistRootNodes).map(function(t){return n._persistRootNodes[t]}),o=0;o<r.length;o++){var s=r[o];(n._ignoreRemovePersistNode=s).parent=null,n._ignoreRemovePersistNode=null}var a=this._scene,c=a&&a.autoReleaseAssets&&a.dependAssets;p.autoRelease(c,t.dependAssets,r),cc.isValid(a)&&a.destroy(),this._scene=null,cc.Object._deferredDestroy(),e&&e(),this.emit(cc.Director.EVENT_BEFORE_SCENE_LAUNCH,t);var h=t;if(t instanceof cc.Scene){h=(this._scene=t)._sgNode;for(var l=0;l<r.length;l++){var u=r[l],_=t.getChildByUuid(u.uuid);if(_){var d=_.getSiblingIndex();_._destroyImmediate(),t.insertChild(u,d)}else u.parent=t}t._activate()}if(this._runningScene){var f=this._scenesStack.length;this._scenesStack[Math.max(f-1,0)]=h,this._sendCleanupToScene=!0,this._nextScene=h}else this.pushScene(h),this.startAnimation();this._nextScene&&this.setNextScene(),i&&i(null,t),this.emit(cc.Director.EVENT_AFTER_SCENE_LAUNCH,t)},runScene:function(t,e,i){cc.assertID(t,1205),t instanceof cc.Scene&&t._load(),this.once(cc.Director.EVENT_AFTER_UPDATE,function(){this.runSceneImmediate(t,e,i)})},_getSceneUuid:function(t){var e=cc.game._sceneInfos;if("string"==typeof t){t.endsWith(".fire")||(t+=".fire"),"/"===t[0]||t.startsWith("db://assets/")||(t="/"+t);for(var i=0;i<e.length;i++){var n=e[i];if(n.url.endsWith(t))return n}}else if("number"==typeof t){if(0<=t&&t<e.length)return e[t];cc.errorID(1206,t)}else cc.errorID(1207,t);return null},loadScene:function(t,e,i){if(this._loadingScene)return cc.errorID(1208,t,this._loadingScene),!1;var n=this._getSceneUuid(t);if(n){var r=n.uuid;return this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,t),this._loadingScene=t,this._loadSceneByUuid(r,e,i),!0}return cc.errorID(1209,t),!1},preloadScene:function(i,n){var t=this._getSceneUuid(i);if(t)this.emit(cc.Director.EVENT_BEFORE_SCENE_LOADING,i),cc.loader.load({uuid:t.uuid,type:"uuid"},function(t,e){t&&cc.errorID(1210,i,t.message),n&&n(t,e)});else{var e='Can not preload the scene "'+i+'" because it is not in the build settings.';n(new Error(e)),cc.error("preloadScene: "+e)}},_loadSceneByUuid:function(r,o,s,t){console.time("LoadScene "+r),cc.AssetLibrary.loadAsset(r,function(t,e){console.timeEnd("LoadScene "+r);var i=cc.director;if(i._loadingScene="",t)t="Failed to load scene: "+t,cc.error(t);else{if(e instanceof cc.SceneAsset){var n=e.scene;return n._id=e._uuid,n._name=e._name,void i.runSceneImmediate(n,s,o)}t="The asset "+r+" is not a scene",cc.error(t)}o&&o(t)})},resume:function(){this._paused&&(this.setAnimationInterval(this._oldAnimationInterval),this._lastUpdate=Date.now(),this._lastUpdate||cc.logID(1200),this._paused=!1,this._deltaTime=0)},setContentScaleFactor:function(t){t!==this._contentScaleFactor&&(this._contentScaleFactor=t)},setDepthTest:null,setClearColor:null,setDefaultValues:function(){},setNextDeltaTimeZero:function(t){this._nextDeltaTimeZero=t},setNextScene:function(){var t=!1,e=!1;if(cc.TransitionScene&&(t=!!this._runningScene&&this._runningScene instanceof cc.TransitionScene,e=!!this._nextScene&&this._nextScene instanceof cc.TransitionScene),!e){var i=this._runningScene;i&&(i.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),i.performRecursive(_ccsg.Node.performType.onExit)),this._sendCleanupToScene&&i&&i.performRecursive(_ccsg.Node.performType.cleanup)}this._runningScene=this._nextScene,cc.renderer.childrenOrderDirty=!0,this._nextScene=null,t||null===this._runningScene||(this._runningScene.performRecursive(_ccsg.Node.performType.onEnter),this._runningScene.performRecursive(_ccsg.Node.performType.onEnterTransitionDidFinish))},getDelegate:function(){return this._projectionDelegate},setDelegate:function(t){this._projectionDelegate=t},setOpenGLView:null,setProjection:null,setViewport:null,getOpenGLView:null,getProjection:null,setAlphaBlending:null,isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getScene:function(){return this._scene},getAnimationInterval:function(){return this._animationInterval},isDisplayStats:function(){return!!cc.profiler&&cc.profiler.isShowingStats()},setDisplayStats:function(t){cc.profiler&&(t?cc.profiler.showStats():cc.profiler.hideStats(),cc.game.config[cc.game.CONFIG_KEY.showFPS]=!!t)},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getTotalFrames:function(){return this._totalFrames},popToRootScene:function(){this.popToSceneStackLevel(1)},popToSceneStackLevel:function(t){cc.assertID(this._runningScene,1203);var e=this._scenesStack,i=e.length;if(0!==i){if(!(i<t)){for(;t<i;){var n=e.pop();n.running&&(n.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),n.performRecursive(_ccsg.Node.performType.onExit)),n.performRecursive(_ccsg.Node.performType.cleanup),i--}this._nextScene=e[e.length-1],this._sendCleanupToScene=!0}}else this.end()},getScheduler:function(){return this._scheduler},setScheduler:function(t){this._scheduler!==t&&(this._scheduler=t)},getActionManager:function(){return this._actionManager},setActionManager:function(t){this._actionManager!==t&&(this._actionManager&&this._scheduler.unscheduleUpdate(this._actionManager),this._actionManager=t,this._scheduler.scheduleUpdate(this._actionManager,cc.Scheduler.PRIORITY_SYSTEM,!1))},getAnimationManager:function(){return this._animationManager},getCollisionManager:function(){return this._collisionManager},getPhysicsManager:function(){return this._physicsManager},getDeltaTime:function(){return this._deltaTime}}),cc.js.addon(cc.Director.prototype,n.prototype),cc.Director.EVENT_PROJECTION_CHANGED="director_projection_changed",cc.Director.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",cc.Director.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",cc.Director.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",cc.Director.EVENT_BEFORE_UPDATE="director_before_update",cc.Director.EVENT_AFTER_UPDATE="director_after_update",cc.Director.EVENT_BEFORE_VISIT="director_before_visit",cc.Director.EVENT_AFTER_VISIT="director_after_visit",cc.Director.EVENT_AFTER_DRAW="director_after_draw",cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._nextDeltaTimeZero=!0,this.invalid=!1},mainLoop:function(){this._purgeDirectorInNextLoop?(this._purgeDirectorInNextLoop=!1,this.purgeDirector()):this.invalid||(this.calculateDeltaTime(),this._paused||(this.emit(cc.Director.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(this._deltaTime),this._scheduler.update(this._deltaTime),this._compScheduler.lateUpdatePhase(this._deltaTime),this.emit(cc.Director.EVENT_AFTER_UPDATE),cc.Object._deferredDestroy()),this._nextScene&&this.setNextScene(),this.emit(cc.Director.EVENT_BEFORE_VISIT),this._visitScene(),this.emit(cc.Director.EVENT_AFTER_VISIT),cc.g_NumberOfDraws=0,cc.renderer.clear(),cc.renderer.rendering(cc._renderContext),this._totalFrames++,this.emit(cc.Director.EVENT_AFTER_DRAW),c.frameUpdateListeners())},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(t){this._animationInterval=t,this.invalid||(this.stopAnimation(),this.startAnimation())},__fastOn:function(t,e,i){var n=this._bubblingListeners;n||(n=this._bubblingListeners=new a),n.add(t,e,i),this._addEventFlag(t,n,!1)},__fastOff:function(t,e,i){var n=this._bubblingListeners;n&&(n.remove(t,e,i),this._purgeEventFlag(t,n,!1))}}),cc.Director.sharedDirector=null,cc.Director.firstUseDirector=!0,cc.Director._getInstance=function(){return cc.Director.firstUseDirector&&(cc.Director.firstUseDirector=!1,cc.Director.sharedDirector=new cc.DisplayLinkDirector,cc.Director.sharedDirector.init()),cc.Director.sharedDirector},cc.defaultFPS=60,cc.Director.PROJECTION_2D=0,cc.Director.PROJECTION_3D=1,cc.Director.PROJECTION_CUSTOM=3,cc.Director.PROJECTION_DEFAULT=cc.Director.PROJECTION_2D},{"./component-scheduler":49,"./event-manager":83,"./event/event-listeners":84,"./event/event-target":85,"./load-pipeline/auto-release-utils":107,"./node-activator":120,"./platform/_CCClass":135}],23:[function(t,e,i){t("./CCDirector"),t("./CCGame");var n=t("./event-manager");cc.game.once(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var t=cc.Director.prototype;t.getProjection=function(t){return this._projection},t.setProjection=function(t){this._projection=t,this.emit(cc.Director.EVENT_PROJECTION_CHANGED,this)},t.setDepthTest=function(){},t.setClearColor=function(t){cc.renderer._clearColor=t,cc.renderer._clearFillStyle="rgb("+t.r+","+t.g+","+t.b+")"},t.setOpenGLView=function(t){this._winSizeInPoints.width=cc._canvas.width,this._winSizeInPoints.height=cc._canvas.height,this._openGLView=t||cc.view,n&&n.setEnabled(!0)},t.getVisibleSize=function(){return this.getWinSize()},t.getVisibleOrigin=function(){return cc.p(0,0)}}})},{"./CCDirector":22,"./CCGame":28,"./event-manager":83}],24:[function(t,e,i){t("./CCDirector"),t("./CCGame"),t("../kazmath");var r=t("./event-manager"),d=cc.math;cc.game.once(cc.game.EVENT_RENDERER_INITED,function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){cc.DirectorDelegate=cc._Class.extend({updateProjection:function(){}});var t=cc.Director.prototype,n=function(t){if(t&&t._renderCmd){t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty);var e,i=t._children;for(e=0;e<i.length;e++)n(i[e])}};cc.Director._getInstance().on(cc.Director.EVENT_PROJECTION_CHANGED,function(){for(var t=cc.director._scenesStack,e=0;e<t.length;e++)n(t[e])}),t.setProjection=function(t){var e=this,i=e._winSizeInPoints;e.setViewport();var n=e._openGLView,r=n._viewPortRect.x/n._scaleX,o=n._viewPortRect.y/n._scaleY;switch(t){case cc.Director.PROJECTION_2D:d.glMatrixMode(d.KM_GL_PROJECTION),d.glLoadIdentity();var s=d.Matrix4.createOrthographicProjection(0,i.width,0,i.height,-1024,1024);d.glMultMatrix(s),d.glMatrixMode(d.KM_GL_MODELVIEW),d.glLoadIdentity();break;case cc.Director.PROJECTION_3D:var a=e.getZEye(),c=new d.Matrix4,h=new d.Matrix4;d.glMatrixMode(d.KM_GL_PROJECTION),d.glLoadIdentity(),c=d.Matrix4.createPerspectiveProjection(60,i.width/i.height,.1,2*a),d.glMultMatrix(c);var l=new d.Vec3(-r+i.width/2,-o+i.height/2,a),u=new d.Vec3(-r+i.width/2,-o+i.height/2,0),_=new d.Vec3(0,1,0);h.lookAt(l,u,_),d.glMultMatrix(h),d.glMatrixMode(d.KM_GL_MODELVIEW),d.glLoadIdentity();break;case cc.Director.PROJECTION_CUSTOM:e._projectionDelegate&&e._projectionDelegate.updateProjection();break;default:cc.logID(1201)}e._projection=t,e.emit(cc.Director.EVENT_PROJECTION_CHANGED,e),cc.gl.setProjectionMatrixDirty(),cc.renderer.childrenOrderDirty=!0},t.setDepthTest=function(t){cc.renderer.setDepthTest(t)},t.setClearColor=function(t){var e=cc.renderer._clearColor;e.r=t.r/255,e.g=t.g/255,e.b=t.b/255,e.a=t.a/255},t.setOpenGLView=function(t){this._winSizeInPoints.width=cc._canvas.width,this._winSizeInPoints.height=cc._canvas.height,this._openGLView=t||cc.view,CC_QQPLAY||cc.configuration.gatherGPUInfo(),this.setGLDefaultValues(),r&&r.setEnabled(!0)},t.getVisibleSize=function(){return this._openGLView.getVisibleSize()},t.getVisibleOrigin=function(){return this._openGLView.getVisibleOrigin()},t.getZEye=function(){return this._winSizeInPoints.height/1.1566},t.setViewport=function(){var t=this._openGLView;if(t){var e=this._winSizeInPoints;t.setViewPortInPoints(-t._viewPortRect.x/t._scaleX,-t._viewPortRect.y/t._scaleY,e.width,e.height)}},t.getOpenGLView=function(){return this._openGLView},t.getProjection=function(){return this._projection},t.setAlphaBlending=function(t){t?cc.gl.blendFunc(cc.macro.BLEND_SRC,cc.macro.BLEND_DST):cc.gl.blendFunc(cc.macro.ONE,cc.macro.ZERO)},t.setGLDefaultValues=function(){this.setAlphaBlending(!0),this.setProjection(this._projection),cc._renderContext.clearColor(0,0,0,0)}}})},{"../kazmath":192,"./CCDirector":22,"./CCGame":28,"./event-manager":83}],25:[function(t,e,i){var n=t("./CCGame");cc._drawingUtil=null,n.once(n.EVENT_RENDERER_INITED,function(){cc._renderType===n.RENDER_TYPE_WEBGL?cc._drawingUtil=new(t("./CCDrawingPrimitivesWebGL"))(cc._renderContext):cc._drawingUtil=new(t("./CCDrawingPrimitivesCanvas"))(cc._renderContext)})},{"./CCDrawingPrimitivesCanvas":26,"./CCDrawingPrimitivesWebGL":27,"./CCGame":28}],26:[function(t,e,i){var n=cc._Class.extend({_cacheArray:[],ctor:function(t){this._renderContext=t},drawPoint:function(t,e){e||(e=1);var i=cc.view.getScaleX(),n=cc.view.getScaleY(),r=cc.p(t.x*i,t.y*n),o=this._renderContext.getContext();o.beginPath(),o.arc(r.x,-r.y,e*i,0,2*Math.PI,!1),o.closePath(),o.fill()},drawPoints:function(t,e,i){if(null!=t){i||(i=1);var n=this._renderContext.getContext(),r=cc.view.getScaleX(),o=cc.view.getScaleY();n.beginPath();for(var s=0,a=t.length;s<a;s++)n.arc(t[s].x*r,-t[s].y*o,i*r,0,2*Math.PI,!1);n.closePath(),n.fill()}},drawLine:function(t,e){var i=this._renderContext.getContext(),n=cc.view.getScaleX(),r=cc.view.getScaleY();i.beginPath(),i.moveTo(t.x*n,-t.y*r),i.lineTo(e.x*n,-e.y*r),i.closePath(),i.stroke()},drawRect:function(t,e){this.drawLine(cc.p(t.x,t.y),cc.p(e.x,t.y)),this.drawLine(cc.p(e.x,t.y),cc.p(e.x,e.y)),this.drawLine(cc.p(e.x,e.y),cc.p(t.x,e.y)),this.drawLine(cc.p(t.x,e.y),cc.p(t.x,t.y))},drawSolidRect:function(t,e,i){var n=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)];this.drawSolidPoly(n,4,i)},drawPoly:function(t,e,i,n){if(n=n||!1,null!=t){if(t.length<3)throw new Error("Polygon's point must greater than 2");var r=t[0],o=this._renderContext.getContext(),s=cc.view.getScaleX(),a=cc.view.getScaleY();o.beginPath(),o.moveTo(r.x*s,-r.y*a);for(var c=1,h=t.length;c<h;c++)o.lineTo(t[c].x*s,-t[c].y*a);i&&o.closePath(),n?o.fill():o.stroke()}},drawSolidPoly:function(t,e,i){this.setDrawColor(i.r,i.g,i.b,i.a),this.drawPoly(t,e,!0,!0)},drawCircle:function(t,e,i,n,r){r=r||!1;var o=this._renderContext.getContext(),s=cc.view.getScaleX(),a=cc.view.getScaleY();o.beginPath();var c=i-2*Math.PI;o.arc(0|t.x*s,0|-t.y*a,e*s,-i,-c,!1),r&&o.lineTo(0|t.x*s,0|-t.y*a),o.stroke()},drawQuadBezier:function(t,e,i,n){for(var r=this._cacheArray,o=r.length=0,s=0;s<n;s++){var a=Math.pow(1-o,2)*t.x+2*(1-o)*o*e.x+o*o*i.x,c=Math.pow(1-o,2)*t.y+2*(1-o)*o*e.y+o*o*i.y;r.push(cc.p(a,c)),o+=1/n}r.push(cc.p(i.x,i.y)),this.drawPoly(r,n+1,!1,!1)},drawCubicBezier:function(t,e,i,n,r){for(var o=this._cacheArray,s=o.length=0,a=0;a<r;a++){var c=Math.pow(1-s,3)*t.x+3*Math.pow(1-s,2)*s*e.x+3*(1-s)*s*s*i.x+s*s*s*n.x,h=Math.pow(1-s,3)*t.y+3*Math.pow(1-s,2)*s*e.y+3*(1-s)*s*s*i.y+s*s*s*n.y;o.push(cc.p(c,h)),s+=1/r}o.push(cc.p(n.x,n.y)),this.drawPoly(o,r+1,!1,!1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,e,i){cc._renderContext.setStrokeStyle("rgba(255,255,255,1)");var n,r,o=this._cacheArray;o.length=0;for(var s=1/t.length,a=0;a<i+1;a++){var c=a/i;1===c?(n=t.length-1,r=1):r=(c-s*(n=0|c/s))/s;var h=cc.cardinalSplineAt(cc.getControlPointAt(t,n-1),cc.getControlPointAt(t,n-0),cc.getControlPointAt(t,n+1),cc.getControlPointAt(t,n+2),e,r);o.push(h)}this.drawPoly(o,i+1,!1,!1)},drawImage:function(t,e,i,n,r){var o=arguments.length,s=this._renderContext.getContext();switch(o){case 2:var a=t.height;s.drawImage(t,e.x,-(e.y+a));break;case 3:s.drawImage(t,e.x,-(e.y+i.height),i.width,i.height);break;case 5:s.drawImage(t,e.x,e.y,i.width,i.height,n.x,-(n.y+r.height),r.width,r.height);break;default:throw new Error("Argument must be non-nil")}},drawStar:function(t,e,i){var n=t||this._renderContext,r=n.getContext();e*=cc.view.getScaleX();var o="rgba("+(0|i.r)+","+(0|i.g)+","+(0|i.b);n.setFillStyle(o+",1)");var s=e/10;r.beginPath(),r.moveTo(-e,e),r.lineTo(0,s),r.lineTo(e,e),r.lineTo(s,0),r.lineTo(e,-e),r.lineTo(0,-s),r.lineTo(-e,-e),r.lineTo(-s,0),r.lineTo(-e,e),r.closePath(),r.fill();var a=r.createRadialGradient(0,0,s,0,0,e);a.addColorStop(0,o+", 1)"),a.addColorStop(.3,o+", 0.8)"),a.addColorStop(1,o+", 0.0)"),n.setFillStyle(a),r.beginPath();var c=cc.macro.PI2;r.arc(0,0,e-s,0,c,!1),r.closePath(),r.fill()},drawColorBall:function(t,e,i){var n=t||this._renderContext,r=n.getContext();e*=cc.view.getScaleX();var o="rgba("+(0|i.r)+","+(0|i.g)+","+(0|i.b),s=e/10,a=r.createRadialGradient(0,0,s,0,0,e);a.addColorStop(0,o+", 1)"),a.addColorStop(.3,o+", 0.8)"),a.addColorStop(.6,o+", 0.4)"),a.addColorStop(1,o+", 0.0)"),n.setFillStyle(a),r.beginPath();var c=cc.macro.PI2;r.arc(0,0,e,0,c,!1),r.closePath(),r.fill()},fillText:function(t,e,i){this._renderContext.getContext().fillText(t,e,-i)},setDrawColor:function(t,e,i,n){this._renderContext.setFillStyle("rgba("+t+","+e+","+i+","+n/255+")"),this._renderContext.setStrokeStyle("rgba("+t+","+e+","+i+","+n/255+")")},setPointSize:function(t){},setLineWidth:function(t){this._renderContext.getContext().lineWidth=t*cc.view.getScaleX()}});e.exports=n},{}],27:[function(t,e,i){var f=cc.macro,n=cc._Class.extend({_initialized:!1,_shader:null,_colorLocation:"u_color",_pointSizeLocation:"u_pointSize",_pointSize:-1,ctor:function(t){if(!CC_QQPLAY&&!t instanceof WebGLRenderingContext)throw new Error("Can't initialise DrawingPrimitiveWebGL. context need is WebGLRenderingContext");this._renderContext=t,this._colorArray=new Float32Array([1,1,1,1])},lazy_init:function(){var t=this;t._initialized||(t._shader=cc.shaderCache.programForKey(f.SHADER_POSITION_UCOLOR),t._shader._addUniformLocation(t._colorLocation),t._shader._addUniformLocation(t._pointSizeLocation),t._initialized=!0)},drawInit:function(){this._initialized=!1},drawPoint:function(t){this.lazy_init();var e=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),e.enableVertexAttribArray(f.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var i=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,new Float32Array([t.x,t.y]),e.STATIC_DRAW),e.vertexAttribPointer(f.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,0,0),e.drawArrays(e.POINTS,0,1),e.deleteBuffer(i),cc.incrementGLDraws(1)},drawPoints:function(t,e){if(t&&0!==t.length){this.lazy_init();var i=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),i.enableVertexAttribArray(f.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray),this._shader.setUniformLocationWith1f(this._pointSizeLocation,this._pointSize);var n=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,n),i.bufferData(i.ARRAY_BUFFER,this._pointsToTypeArray(t),i.STATIC_DRAW),i.vertexAttribPointer(f.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,0),i.drawArrays(i.POINTS,0,t.length),i.deleteBuffer(n),cc.incrementGLDraws(1)}},_pointsToTypeArray:function(t){for(var e=new Float32Array(2*t.length),i=0;i<t.length;i++)e[2*i]=t[i].x,e[2*i+1]=t[i].y;return e},drawLine:function(t,e){this.lazy_init();var i=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),i.enableVertexAttribArray(f.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var n=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,n),i.bufferData(i.ARRAY_BUFFER,this._pointsToTypeArray([t,e]),i.STATIC_DRAW),i.vertexAttribPointer(f.VERTEX_ATTRIB_POSITION,2,i.FLOAT,!1,0,0),i.drawArrays(i.LINES,0,2),i.deleteBuffer(n),cc.incrementGLDraws(1)},drawRect:function(t,e){this.drawLine(cc.p(t.x,t.y),cc.p(e.x,t.y)),this.drawLine(cc.p(e.x,t.y),cc.p(e.x,e.y)),this.drawLine(cc.p(e.x,e.y),cc.p(t.x,e.y)),this.drawLine(cc.p(t.x,e.y),cc.p(t.x,t.y))},drawSolidRect:function(t,e,i){var n=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)];this.drawSolidPoly(n,4,i)},drawPoly:function(t,e,i){this.lazy_init();var n=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),n.enableVertexAttribArray(f.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var r=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,r),n.bufferData(n.ARRAY_BUFFER,this._pointsToTypeArray(t),n.STATIC_DRAW),n.vertexAttribPointer(f.VERTEX_ATTRIB_POSITION,2,n.FLOAT,!1,0,0),i?n.drawArrays(n.LINE_LOOP,0,t.length):n.drawArrays(n.LINE_STRIP,0,t.length),n.deleteBuffer(r),cc.incrementGLDraws(1)},drawSolidPoly:function(t,e,i){this.lazy_init(),i&&this.setDrawColor(i.r,i.g,i.b,i.a);var n=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),n.enableVertexAttribArray(f.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var r=n.createBuffer();n.bindBuffer(n.ARRAY_BUFFER,r),n.bufferData(n.ARRAY_BUFFER,this._pointsToTypeArray(t),n.STATIC_DRAW),n.vertexAttribPointer(f.VERTEX_ATTRIB_POSITION,2,n.FLOAT,!1,0,0),n.drawArrays(n.TRIANGLE_FAN,0,t.length),n.deleteBuffer(r),cc.incrementGLDraws(1)},drawCircle:function(t,e,i,n,r){this.lazy_init();var o=1;r&&o++;var s=2*Math.PI/n,a=new Float32Array(2*(n+2));if(a){for(var c=0;c<=n;c++){var h=c*s,l=e*Math.cos(h+i)+t.x,u=e*Math.sin(h+i)+t.y;a[2*c]=l,a[2*c+1]=u}a[2*(n+1)]=t.x,a[2*(n+1)+1]=t.y;var _=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),_.enableVertexAttribArray(f.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var d=_.createBuffer();_.bindBuffer(_.ARRAY_BUFFER,d),_.bufferData(_.ARRAY_BUFFER,a,_.STATIC_DRAW),_.vertexAttribPointer(f.VERTEX_ATTRIB_POSITION,2,_.FLOAT,!1,0,0),_.drawArrays(_.LINE_STRIP,0,n+o),_.deleteBuffer(d),cc.incrementGLDraws(1)}},drawQuadBezier:function(t,e,i,n){this.lazy_init();for(var r=new Float32Array(2*(n+1)),o=0,s=0;s<n;s++)r[2*s]=Math.pow(1-o,2)*t.x+2*(1-o)*o*e.x+o*o*i.x,r[2*s+1]=Math.pow(1-o,2)*t.y+2*(1-o)*o*e.y+o*o*i.y,o+=1/n;r[2*n]=i.x,r[2*n+1]=i.y;var a=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),a.enableVertexAttribArray(f.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c),a.bufferData(a.ARRAY_BUFFER,r,a.STATIC_DRAW),a.vertexAttribPointer(f.VERTEX_ATTRIB_POSITION,2,a.FLOAT,!1,0,0),a.drawArrays(a.LINE_STRIP,0,n+1),a.deleteBuffer(c),cc.incrementGLDraws(1)},drawCubicBezier:function(t,e,i,n,r){this.lazy_init();for(var o=new Float32Array(2*(r+1)),s=0,a=0;a<r;a++)o[2*a]=Math.pow(1-s,3)*t.x+3*Math.pow(1-s,2)*s*e.x+3*(1-s)*s*s*i.x+s*s*s*n.x,o[2*a+1]=Math.pow(1-s,3)*t.y+3*Math.pow(1-s,2)*s*e.y+3*(1-s)*s*s*i.y+s*s*s*n.y,s+=1/r;o[2*r]=n.x,o[2*r+1]=n.y;var c=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),c.enableVertexAttribArray(f.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var h=c.createBuffer();c.bindBuffer(c.ARRAY_BUFFER,h),c.bufferData(c.ARRAY_BUFFER,o,c.STATIC_DRAW),c.vertexAttribPointer(f.VERTEX_ATTRIB_POSITION,2,c.FLOAT,!1,0,0),c.drawArrays(c.LINE_STRIP,0,r+1),c.deleteBuffer(h),cc.incrementGLDraws(1)},drawCatmullRom:function(t,e){this.drawCardinalSpline(t,.5,e)},drawCardinalSpline:function(t,e,i){this.lazy_init();for(var n,r,o=new Float32Array(2*(i+1)),s=1/t.length,a=0;a<i+1;a++){var c=a/i;1===c?(n=t.length-1,r=1):r=(c-s*(n=0|c/s))/s;var h=cc.cardinalSplineAt(cc.getControlPointAt(t,n-1),cc.getControlPointAt(t,n),cc.getControlPointAt(t,n+1),cc.getControlPointAt(t,n+2),e,r);o[2*a]=h.x,o[2*a+1]=h.y}var l=this._renderContext;this._shader.use(),this._shader.setUniformForModelViewAndProjectionMatrixWithMat4(),l.enableVertexAttribArray(f.VERTEX_ATTRIB_POSITION),this._shader.setUniformLocationWith4fv(this._colorLocation,this._colorArray);var u=l.createBuffer();l.bindBuffer(l.ARRAY_BUFFER,u),l.bufferData(l.ARRAY_BUFFER,o,l.STATIC_DRAW),l.vertexAttribPointer(f.VERTEX_ATTRIB_POSITION,2,l.FLOAT,!1,0,0),l.drawArrays(l.LINE_STRIP,0,i+1),l.deleteBuffer(u),cc.incrementGLDraws(1)},setDrawColor:function(t,e,i,n){this._colorArray[0]=t/255,this._colorArray[1]=e/255,this._colorArray[2]=i/255,this._colorArray[3]=n/255},setPointSize:function(t){this._pointSize=t},setLineWidth:function(t){this._renderContext.lineWidth&&this._renderContext.lineWidth(t)}});e.exports=n},{}],28:[function(t,e,i){var o,n=t("./event/event-target");o=t("./platform/CCView"),t("../audio/CCAudioEngine");var r=CC_QQPLAY?t("./platform/BKInputManager"):t("./platform/CCInputManager"),_={EVENT_HIDE:"game_on_hide",EVENT_SHOW:"game_on_show",EVENT_GAME_INITED:"game_inited",EVENT_RENDERER_INITED:"renderer_inited",RENDER_TYPE_CANVAS:0,RENDER_TYPE_WEBGL:1,RENDER_TYPE_OPENGL:2,_persistRootNodes:{},_ignoreRemovePersistNode:null,CONFIG_KEY:{width:"width",height:"height",debugMode:"debugMode",exposeClassName:"exposeClassName",showFPS:"showFPS",frameRate:"frameRate",id:"id",renderMode:"renderMode",registerSystemEvent:"registerSystemEvent",jsList:"jsList",scenes:"scenes"},_configLoaded:!1,_isCloning:!1,_prepareCalled:!1,_prepared:!1,_rendererInitialized:!1,_renderContext:null,_intervalId:null,_lastTime:null,_frameTime:null,_sceneInfos:[],frame:null,container:null,canvas:null,config:null,onStart:null,setFrameRate:function(t){},step:function(){cc.director.mainLoop()},pause:function(){},resume:function(){},isPaused:function(){return!1},restart:function(){cc.director.once(cc.Director.EVENT_AFTER_DRAW,function(){for(var t in _._persistRootNodes)_.removePersistRootNode(_._persistRootNodes[t]);cc.director.getScene().destroy(),cc.Object._deferredDestroy(),cc.director.purgeDirector(),cc.audioEngine&&cc.audioEngine.uncacheAll(),cc.director.reset(),_.onStart()})},end:function(){close()},prepare:function(e){var i=this,t=i.config,n=i.CONFIG_KEY;if(this._configLoaded){if(this._prepared)e&&e();else if(!this._prepareCalled)if(cc._engineLoaded){this._prepareCalled=!0,this._initRenderer(t[n.width],t[n.height]),cc.view=o?o._getInstance():null,cc.director=cc.Director._getInstance(),cc.director.setOpenGLView&&cc.director.setOpenGLView(cc.view),cc.winSize=cc.director.getWinSize(),this._initEvents();var r=t[n.jsList];r&&0<r.length?cc.loader.load(r,function(t){if(t)throw new Error(JSON.stringify(t));i._prepared=!0,e&&e(),i.emit(i.EVENT_GAME_INITED)}):(e&&e(),i.emit(i.EVENT_GAME_INITED))}else cc.initEngine(this.config,function(){i.prepare(e)})}else this._loadConfig(function(){i.prepare(e)})},run:function(t,e){"function"==typeof t?_.onStart=t:(t&&(_.config=t),"function"==typeof e&&(_.onStart=e)),this.prepare(_.onStart&&_.onStart.bind(_))},addPersistRootNode:function(t){if(cc.Node.isNode(t)&&t.uuid){var e=t.uuid;if(!this._persistRootNodes[e]){var i=cc.director._scene;if(cc.isValid(i)){if(t.parent){if(!(t.parent instanceof cc.Scene))return void cc.warnID(3801);if(t.parent!==i)return void cc.warnID(3802)}else t.parent=i;(this._persistRootNodes[e]=t)._persistNode=!0}}}else cc.warnID(3800)},removePersistRootNode:function(t){if(t!==this._ignoreRemovePersistNode){var e=t.uuid||"";t===this._persistRootNodes[e]&&(delete this._persistRootNodes[e],t._persistNode=!1)}},isPersistRootNode:function(t){return t._persistNode},_loadConfig:function(i){if(this.config)return this._initConfig(this.config),void(i&&i());if(document.ccConfig)return this._initConfig(document.ccConfig),void(i&&i());var n=this;cc.loader.load("project.json",function(t,e){t&&cc.logID(3818),n._initConfig(e||{}),i&&i()})},_initConfig:function(t){var e=this.CONFIG_KEY;"number"!=typeof t[e.debugMode]&&(t[e.debugMode]=0),t[e.exposeClassName]=!!t[e.exposeClassName],"number"!=typeof t[e.frameRate]&&(t[e.frameRate]=60),"number"!=typeof t[e.renderMode]&&(t[e.renderMode]=0),"boolean"!=typeof t[e.registerSystemEvent]&&(t[e.registerSystemEvent]=!0),t[e.showFPS]=!(e.showFPS in t&&!t[e.showFPS]),this._sceneInfos=t[e.scenes]||[],this.collisionMatrix=t.collisionMatrix||[],this.groupList=t.groupList||[],cc._initDebugSetting(t[e.debugMode]),this.config=t,this._configLoaded=!0},_initRenderer:function(t,e){if(!this._rendererInitialized){if(!cc._supportRender)throw new Error("The renderer doesn't support the renderMode "+this.config[this.CONFIG_KEY.renderMode]);var i,n,r=this.config[_.CONFIG_KEY.id],o=window,s=cc.sys.platform===cc.sys.WECHAT_GAME,a=cc.sys.platform===cc.sys.QQ_PLAY;if(s)this.container=cc.container=n=document.createElement("DIV"),this.frame=n.parentNode===document.body?document.documentElement:n.parentNode,i=cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB?wx.getSharedCanvas():canvas,this.canvas=cc._canvas=i;else if(a)this.container=cc.container=document.createElement("DIV"),this.frame=document.documentElement,this.canvas=cc._canvas=i=canvas;else{var c=r instanceof HTMLElement?r:document.querySelector(r)||document.querySelector("#"+r);"CANVAS"===c.tagName?(t=t||c.width,e=e||c.height,this.canvas=cc._canvas=i=c,this.container=cc.container=n=document.createElement("DIV"),i.parentNode&&i.parentNode.insertBefore(n,i)):("DIV"!==c.tagName&&cc.warnID(3819),t=t||c.clientWidth,e=e||c.clientHeight,this.canvas=cc._canvas=i=document.createElement("CANVAS"),this.container=cc.container=n=document.createElement("DIV"),c.appendChild(n)),n.setAttribute("id","Cocos2dGameContainer"),n.appendChild(i),this.frame=n.parentNode===document.body?document.documentElement:n.parentNode,u="gameCanvas",-1<(" "+(l=i).className+" ").indexOf(" "+u+" ")||(l.className&&(l.className+=" "),l.className+=u),i.setAttribute("width",t||480),i.setAttribute("height",e||320),i.setAttribute("tabindex",99)}if(cc._renderType===_.RENDER_TYPE_WEBGL){var h={stencil:!0,antialias:cc.macro.ENABLE_WEBGL_ANTIALIAS,alpha:cc.macro.ENABLE_TRANSPARENT_CANVAS};s&&(h.preserveDrawingBuffer=!0),this._renderContext=cc._renderContext=cc.webglContext=cc.create3DContext(i,h)}this._renderContext?(cc.renderer=cc.rendererWebGL,o.gl=this._renderContext,cc.renderer.init()):(cc._renderType=_.RENDER_TYPE_CANVAS,cc.renderer=cc.rendererCanvas,cc.renderer.init(),this._renderContext=cc._renderContext=new cc.CanvasContextWrapper(i.getContext("2d"))),cc._gameDiv=n,_.canvas.oncontextmenu=function(){if(!cc._isContextMenuEnable)return!1},this.emit(this.EVENT_RENDERER_INITED,!0),this._rendererInitialized=!0}var l,u},_initEvents:function(){window,this.config[this.CONFIG_KEY.registerSystemEvent]&&r.registerSystemEvent(this.canvas),this.on(_.EVENT_HIDE,function(){_.pause()}),this.on(_.EVENT_SHOW,function(){_.resume()})}};n.call(_),cc.js.addon(_,n.prototype),cc.game=e.exports=_},{"../audio/CCAudioEngine":16,"./event/event-target":85,"./platform/BKInputManager":121,"./platform/CCInputManager":127,"./platform/CCView":133}],29:[function(t,e,i){"use strict";var r=t("./utils/prefab-helper"),n=t("./utils/scene-graph-helper"),o=t("./event-manager"),s=cc.Object.Flags.Destroying,a=t("./utils/misc"),c=(t("./event/event"),!!cc.ActionManager),h=function(){},l=cc.Enum({TOUCH_START:"touchstart",TOUCH_MOVE:"touchmove",TOUCH_END:"touchend",TOUCH_CANCEL:"touchcancel",MOUSE_DOWN:"mousedown",MOUSE_MOVE:"mousemove",MOUSE_ENTER:"mouseenter",MOUSE_LEAVE:"mouseleave",MOUSE_UP:"mouseup",MOUSE_WHEEL:"mousewheel"}),u=[l.TOUCH_START,l.TOUCH_MOVE,l.TOUCH_END,l.TOUCH_CANCEL],_=[l.MOUSE_DOWN,l.MOUSE_ENTER,l.MOUSE_MOVE,l.MOUSE_LEAVE,l.MOUSE_UP,l.MOUSE_WHEEL],d=null,f=function(t,e){var i=t.getLocation(),n=this.owner;return!!n._hitTest(i,this)&&(e.type=l.TOUCH_START,e.touch=t,e.bubbles=!0,n.dispatchEvent(e),!0)},p=function(t,e){var i=this.owner;e.type=l.TOUCH_MOVE,e.touch=t,e.bubbles=!0,i.dispatchEvent(e)},g=function(t,e){var i=t.getLocation(),n=this.owner;n._hitTest(i,this)?e.type=l.TOUCH_END:e.type=l.TOUCH_CANCEL,e.touch=t,e.bubbles=!0,n.dispatchEvent(e)},m=function(t,e){t.getLocation();var i=this.owner;e.type=l.TOUCH_CANCEL,e.touch=t,e.bubbles=!0,i.dispatchEvent(e)},v=function(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=l.MOUSE_DOWN,t.bubbles=!0,i.dispatchEvent(t),t.stopPropagation())},y=function(t){var e=t.getLocation(),i=this.owner;if(i._hitTest(e,this))this._previousIn||(d&&(t.type=l.MOUSE_LEAVE,d.dispatchEvent(t),d._mouseListener._previousIn=!1),d=this.owner,t.type=l.MOUSE_ENTER,i.dispatchEvent(t),this._previousIn=!0),t.type=l.MOUSE_MOVE,t.bubbles=!0,i.dispatchEvent(t);else{if(!this._previousIn)return;t.type=l.MOUSE_LEAVE,i.dispatchEvent(t),this._previousIn=!1,d=null}t.stopPropagation()},C=function(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=l.MOUSE_UP,t.bubbles=!0,i.dispatchEvent(t),t.stopPropagation())},T=function(t){var e=t.getLocation(),i=this.owner;i._hitTest(e,this)&&(t.type=l.MOUSE_WHEEL,t.bubbles=!0,i.dispatchEvent(t),t.stopPropagation())};function x(t){var e=cc.Mask;if(e)for(var i=0,n=t;n&&cc.Node.isNode(n);n=n._parent,++i)if(n.getComponent(e))return{index:i,node:n};return null}var E=cc.Class({name:"cc.Node",extends:t("./utils/base-node"),properties:{_opacity:255,_color:cc.Color.WHITE,_cascadeOpacityEnabled:!0,_anchorPoint:cc.p(.5,.5),_contentSize:cc.size(0,0),_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:cc.p(0,0),_skewX:0,_skewY:0,_localZOrder:0,_globalZOrder:0,_opacityModifyRGB:!1,groupIndex:{default:0,type:cc.Integer},group:{get:function(){return cc.game.groupList[this.groupIndex]||""},set:function(t){this.groupIndex=cc.game.groupList.indexOf(t),this.emit("group-changed")}},x:{get:function(){return this._position.x},set:function(t){var e=this._position;if(t!==e.x){e.x=t,this._sgNode.setPositionX(t);var i=this._hasListenerCache;i&&i["position-changed"]&&this.emit("position-changed")}}},y:{get:function(){return this._position.y},set:function(t){var e=this._position;if(t!==e.y){e.y=t,this._sgNode.setPositionY(t);var i=this._hasListenerCache;i&&i["position-changed"]&&this.emit("position-changed")}}},rotation:{get:function(){return this._rotationX!==this._rotationY&&cc.logID(1602),this._rotationX},set:function(t){if(this._rotationX!==t||this._rotationY!==t){this._rotationX=this._rotationY=t,this._sgNode.rotation=t;var e=this._hasListenerCache;e&&e["rotation-changed"]&&this.emit("rotation-changed")}}},rotationX:{get:function(){return this._rotationX},set:function(t){if(this._rotationX!==t){this._rotationX=t,this._sgNode.rotationX=t;var e=this._hasListenerCache;e&&e["rotation-changed"]&&this.emit("rotation-changed")}}},rotationY:{get:function(){return this._rotationY},set:function(t){if(this._rotationY!==t){this._rotationY=t,this._sgNode.rotationY=t;var e=this._hasListenerCache;e&&e["rotation-changed"]&&this.emit("rotation-changed")}}},scaleX:{get:function(){return this._scaleX},set:function(t){if(this._scaleX!==t){this._scaleX=t,this._sgNode.scaleX=t;var e=this._hasListenerCache;e&&e["scale-changed"]&&this.emit("scale-changed")}}},scaleY:{get:function(){return this._scaleY},set:function(t){if(this._scaleY!==t){this._scaleY=t,this._sgNode.scaleY=t;var e=this._hasListenerCache;e&&e["scale-changed"]&&this.emit("scale-changed")}}},skewX:{get:function(){return this._skewX},set:function(t){this._skewX=t,this._sgNode.skewX=t}},skewY:{get:function(){return this._skewY},set:function(t){this._skewY=t,this._sgNode.skewY=t}},opacity:{get:function(){return this._opacity},set:function(t){if(this._opacity!==t&&(this._opacity=t,this._sgNode.setOpacity(t),!this._cascadeOpacityEnabled)){var e=this._sizeProvider;e instanceof _ccsg.Node&&e!==this._sgNode&&e.setOpacity(t)}},range:[0,255]},cascadeOpacity:{get:function(){return this._cascadeOpacityEnabled},set:function(t){if(this._cascadeOpacityEnabled!==t){this._cascadeOpacityEnabled=t;var e=(this._sgNode.cascadeOpacity=t)?255:this._opacity,i=this._sizeProvider;i instanceof _ccsg.Node&&i.setOpacity(e)}}},color:{get:function(){return this._color.clone()},set:function(t){this._color.equals(t)||(this._color.fromColor(t),this._sizeProvider instanceof _ccsg.Node&&this._sizeProvider.setColor(t))}},anchorX:{get:function(){return this._anchorPoint.x},set:function(t){var e=this._anchorPoint;if(e.x!==t){e.x=t;var i=this._sizeProvider;i instanceof _ccsg.Node&&i.setAnchorPoint(e),this.emit("anchor-changed")}}},anchorY:{get:function(){return this._anchorPoint.y},set:function(t){var e=this._anchorPoint;if(e.y!==t){e.y=t;var i=this._sizeProvider;i instanceof _ccsg.Node&&i.setAnchorPoint(e),this.emit("anchor-changed")}}},width:{get:function(){if(this._sizeProvider){var t=this._sizeProvider._getWidth();return this._contentSize.width=t}return this._contentSize.width},set:function(t){if(t!==this._contentSize.width){var e=this._sizeProvider;e&&e.setContentSize(t,e._getHeight()),this._contentSize.width=t,this.emit("size-changed")}}},height:{get:function(){if(this._sizeProvider){var t=this._sizeProvider._getHeight();return this._contentSize.height=t}return this._contentSize.height},set:function(t){if(t!==this._contentSize.height){var e=this._sizeProvider;e&&e.setContentSize(e._getWidth(),t),this._contentSize.height=t,this.emit("size-changed")}}},zIndex:{get:function(){return this._localZOrder},set:function(t){var e;this._localZOrder!==t&&(this._localZOrder=t,this._sgNode.zIndex=t,this._parent&&((e=this)._parent._delaySort(),o._setDirtyForNode(e)))}}},ctor:function(t){var e=this._sgNode=new _ccsg.Node;cc.game._isCloning||(e.cascadeOpacity=!0),this._sizeProvider=null,this._reorderChildDirty=!1,this._widget=null,this._touchListener=null,this._mouseListener=null},statics:{isNode:function(t){return t instanceof E&&(t.constructor===E||!(t instanceof cc.Scene))}},_onSetParent:function(t){var e=this._sgNode;e.parent&&e.parent.removeChild(e,!1),t&&(t._sgNode.addChild(e),t._delaySort())},_onSiblingIndexChanged:function(t){for(var e=this._parent,i=e._children,n=0,r=i.length;n<r;n++)i[n]._sgNode._arrivalOrder=n,o._setDirtyForNode(i[n]);cc.renderer.childrenOrderDirty=!0,e._sgNode._reorderChildDirty=!0,e._delaySort()},_onPreDestroy:function(){var t=this._onPreDestroyBase();c&&cc.director.getActionManager().removeAllActionsFromTarget(this),d===this&&(d=null),this._reorderChildDirty&&cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this),o.removeListeners(this),this instanceof cc.Scene||(this.active=!1),this.onDestroy&&this.onDestroy(),t||this._removeSgNode()},_onPostActivated:function(t){var e=c?cc.director.getActionManager():null;if(t)if(e&&e.resumeTarget(this),o.resumeTarget(this),this._touchListener){var i=this._touchListener.mask=x(this);this._mouseListener&&(this._mouseListener.mask=i)}else this._mouseListener&&(this._mouseListener.mask=x(this));else e&&e.pauseTarget(this),o.pauseTarget(this)},_onHierarchyChanged:function(t){this._onHierarchyChangedBase(t),cc._widgetManager._nodesOrderDirty=!0},_onBatchCreated:function(){var t=this._prefab;t&&t.sync&&!t._synced&&t.root===this&&r.syncWithPrefab(this),this._updateDummySgNode(),this._parent&&this._parent._sgNode.addChild(this._sgNode),this._activeInHierarchy||(c&&cc.director.getActionManager().pauseTarget(this),o.pauseTarget(this));for(var e=this._children,i=0,n=e.length;i<n;i++)e[i]._onBatchCreated()},on:function(t,e,i,n){var r=!1;return-1!==u.indexOf(t)?this._touchListener||(this._touchListener=cc.EventListener.create({event:cc.EventListener.TOUCH_ONE_BY_ONE,swallowTouches:!0,owner:this,mask:x(this),onTouchBegan:f,onTouchMoved:p,onTouchEnded:g,onTouchCancelled:m}),o.addListener(this._touchListener,this),r=!0):-1!==_.indexOf(t)&&(this._mouseListener||(this._mouseListener=cc.EventListener.create({event:cc.EventListener.MOUSE,_previousIn:!1,owner:this,mask:x(this),onMouseDown:v,onMouseMove:y,onMouseUp:C,onMouseScroll:T}),o.addListener(this._mouseListener,this),r=!0)),r&&!this._activeInHierarchy&&cc.director.getScheduler().schedule(function(){this._activeInHierarchy||o.pauseTarget(this)},this,0,0,0,!1),this._EventTargetOn(t,e,i,n)},off:function(t,e,i,n){this._EventTargetOff(t,e,i,n),-1!==u.indexOf(t)?this._checkTouchListeners():-1!==_.indexOf(t)&&this._checkMouseListeners()},targetOff:function(t){this._EventTargetTargetOff(t),this._checkTouchListeners(),this._checkMouseListeners()},pauseSystemEvents:function(t){o.pauseTarget(this,t)},resumeSystemEvents:function(t){o.resumeTarget(this,t)},_checkTouchListeners:function(){if(!(this._objFlags&s)&&this._touchListener){var t=0;if(this._bubblingListeners)for(;t<u.length;++t)if(this._bubblingListeners.has(u[t]))return;if(this._capturingListeners)for(;t<u.length;++t)if(this._capturingListeners.has(u[t]))return;o.removeListener(this._touchListener),this._touchListener=null}},_checkMouseListeners:function(){if(!(this._objFlags&s)&&this._mouseListener){var t=0;if(this._bubblingListeners)for(;t<_.length;++t)if(this._bubblingListeners.has(_[t]))return;if(this._capturingListeners)for(;t<_.length;++t)if(this._capturingListeners.has(_[t]))return;d===this&&(d=null),o.removeListener(this._mouseListener),this._mouseListener=null}},_hitTest:function(t,e){var i=this.width,n=this.height,r=t,o=cc.Camera;o&&o.main&&o.main.containsNode(this)&&(r=o.main.getCameraToWorldPoint(r));var s=cc.affineTransformInvertIn(this._sgNode.getNodeToWorldTransform());(r=cc.pointApplyAffineTransform(r,s)).x+=this._anchorPoint.x*i,r.y+=this._anchorPoint.y*n;var a=r.x,c=i-r.x,h=r.y,l=n-r.y;if(0<=a&&0<=c&&0<=l&&0<=h){if(e&&e.mask){for(var u=e.mask,_=this,d=0;_&&d<u.index;++d,_=_.parent);if(_===u.node){var f=_.getComponent(cc.Mask);return!f||!f.enabledInHierarchy||f._hitTest(t)}return!(e.mask=null)}return!0}return!1},_getCapturingTargets:function(t,e){for(var i=this.parent;i;)i.hasEventListener(t,!0)&&e.push(i),i=i.parent},_getBubblingTargets:function(t,e){for(var i=this.parent;i;)i.hasEventListener(t)&&e.push(i),i=i.parent},isRunning:function(){return this._activeInHierarchy},runAction:c?function(t){if(this.active)return cc.assertID(t,1618),cc.macro.ENABLE_GC_FOR_NATIVE_OBJECTS||this._retainAction(t),cc.director.getActionManager().addAction(t,this,!1),t}:h,pauseAllActions:c?function(){cc.director.getActionManager().pauseTarget(this)}:h,resumeAllActions:c?function(){cc.director.getActionManager().resumeTarget(this)}:h,stopAllActions:c?function(){cc.director.getActionManager().removeAllActionsFromTarget(this)}:h,stopAction:c?function(t){cc.director.getActionManager().removeAction(t)}:h,stopActionByTag:c?function(t){t!==cc.Action.TAG_INVALID?cc.director.getActionManager().removeActionByTag(t,this):cc.logID(1612)}:h,getActionByTag:c?function(t){return t===cc.Action.TAG_INVALID?(cc.logID(1613),null):cc.director.getActionManager().getActionByTag(t,this)}:function(){return null},getNumberOfRunningActions:c?function(){return cc.director.getActionManager().getNumberOfRunningActionsInTarget(this)}:function(){return 0},_retainAction:function(t){},_releaseAllActions:function(){},setTag:function(t){this._tag=t,this._sgNode.tag=t},getPosition:function(){return new cc.Vec2(this._position)},setPosition:function(t,e){var i;void 0===e?(i=t.x,e=t.y):i=t;var n=this._position;if(n.x!==i||n.y!==e){n.x=i,n.y=e,this._sgNode.setPosition(i,e);var r=this._hasListenerCache;r&&r["position-changed"]&&this.emit("position-changed")}},getScale:function(){return this._scaleX!==this._scaleY&&cc.logID(1603),this._scaleX},setScale:function(t,e){if("object"==typeof t?(e=t.y,t=t.x):e=e||0===e?e:t,this._scaleX!==t||this._scaleY!==e){this._scaleX=t,this._scaleY=e,this._sgNode.setScale(t,e);var i=this._hasListenerCache;i&&i["scale-changed"]&&this.emit("scale-changed")}},getContentSize:function(t){if(this._sizeProvider&&!t){var e=this._sizeProvider.getContentSize();return this._contentSize=e,cc.size(e)}return cc.size(this._contentSize)},setContentSize:function(t,e){var i=this._contentSize;if(void 0===e){if(t.width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e}this._sizeProvider&&this._sizeProvider.setContentSize(i),this.emit("size-changed")},setOpacityModifyRGB:function(t){if(this._opacityModifyRGB!==t){this._opacityModifyRGB=t,this._sgNode.setOpacityModifyRGB(t);var e=this._sizeProvider;e instanceof _ccsg.Node&&e!==this._sgNode&&e.setOpacityModifyRGB(t)}},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setGlobalZOrder:function(t){this._globalZOrder=t,this._sgNode.setGlobalZOrder(t)},getGlobalZOrder:function(){return this._globalZOrder=this._sgNode.getGlobalZOrder(),this._globalZOrder},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(t,e){var i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}var n=this._sizeProvider;n instanceof _ccsg.Node&&n.setAnchorPoint(i),this.emit("anchor-changed")},getAnchorPointInPoints:function(){return this._sgNode.getAnchorPointInPoints()},getDisplayedOpacity:function(){return this._sgNode.getDisplayedOpacity()},_updateDisplayedOpacity:function(t){this._sgNode.updateDisplayedOpacity(t)},getDisplayedColor:function(){return this._sgNode.getDisplayedColor()},getNodeToParentTransformAR:function(){var t=this.getContentSize(),e=this._sgNode.getNodeToParentTransform();if(!this._isSgTransformArToMe(t)){var i=this._anchorPoint.x*t.width,n=this._anchorPoint.y*t.height,r=cc.affineTransformMake(1,0,0,1,i,n);e=cc.affineTransformConcatIn(r,e)}return e},getBoundingBox:function(){var t=this.getContentSize(),e=cc.rect(0,0,t.width,t.height);return cc._rectApplyAffineTransformIn(e,this.getNodeToParentTransform())},getBoundingBoxToWorld:function(){var t;return this.parent&&(t=this.parent.getNodeToWorldTransformAR()),this._getBoundingBoxTo(t)},_getBoundingBoxTo:function(t){var e=this.getContentSize(),i=e.width,n=e.height,r=cc.rect(-this._anchorPoint.x*i,-this._anchorPoint.y*n,i,n),o=cc.affineTransformConcat(this.getNodeToParentTransformAR(),t);if(cc._rectApplyAffineTransformIn(r,o),!this._children)return r;for(var s=this._children,a=0;a<s.length;a++){var c=s[a];if(c&&c.active){var h=c._getBoundingBoxTo(o);h&&(r=cc.rectUnion(r,h))}}return r},getNodeToParentTransform:function(){var t=this.getContentSize(),e=this._sgNode.getNodeToParentTransform();if(this._isSgTransformArToMe(t)){var i=-this._anchorPoint.x*t.width,n=-this._anchorPoint.y*t.height,r=cc.affineTransformMake(1,0,0,1,i,n);e=cc.affineTransformConcatIn(r,e)}return e},getNodeToWorldTransform:function(){var t=this.getContentSize();cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var e=this._sgNode.getNodeToWorldTransform();if(this._isSgTransformArToMe(t)){var i=-this._anchorPoint.x*t.width,n=-this._anchorPoint.y*t.height,r=cc.affineTransformMake(1,0,0,1,i,n);e=cc.affineTransformConcatIn(r,e)}return e},getNodeToWorldTransformAR:function(){var t=this.getContentSize();cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var e=this._sgNode.getNodeToWorldTransform();if(!this._isSgTransformArToMe(t)){var i=this._anchorPoint.x*t.width,n=this._anchorPoint.y*t.height,r=cc.affineTransformMake(1,0,0,1,i,n);e=cc.affineTransformConcatIn(r,e)}return e},getParentToNodeTransform:function(){return this._sgNode.getParentToNodeTransform()},getWorldToNodeTransform:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene(),this._sgNode.getWorldToNodeTransform()},_isSgTransformArToMe:function(t){var e=this._sgNode.getContentSize();return 0===e.width&&0===e.height&&(0!==t.width||0!==t.height)||!!this._sgNode.isIgnoreAnchorPointForPosition()},convertToNodeSpace:function(t){cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var e=this._sgNode.convertToNodeSpace(t);return cc.pAdd(e,cc.p(this._anchorPoint.x*this._contentSize.width,this._anchorPoint.y*this._contentSize.height))},convertToWorldSpace:function(t){cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene();var e=t.x-this._anchorPoint.x*this._contentSize.width,i=t.y-this._anchorPoint.y*this._contentSize.height;return cc.v2(this._sgNode.convertToWorldSpace(cc.v2(e,i)))},convertToNodeSpaceAR:function(t){return cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene(),this._sgNode.isIgnoreAnchorPointForPosition()?cc.v2(this._sgNode.convertToNodeSpace(t)):this._sgNode.convertToNodeSpaceAR(t)},convertToWorldSpaceAR:function(t){return cc._renderType===cc.game.RENDER_TYPE_CANVAS&&cc.director._visitScene(),this._sgNode.isIgnoreAnchorPointForPosition()?cc.v2(this._sgNode.convertToWorldSpace(t)):cc.v2(this._sgNode.convertToWorldSpaceAR(t))},convertTouchToNodeSpace:function(t){return this.convertToNodeSpace(t.getLocation())},convertTouchToNodeSpaceAR:function(t){return this.convertToNodeSpaceAR(t.getLocation())},setNodeDirty:function(){this._sgNode.setNodeDirty()},addChild:function(t,e,i){e=void 0===e?t._localZOrder:e;var n,r=!1;void 0===i?(i=void 0,n=t._name):cc.js.isString(i)?(n=i,i=void 0):cc.js.isNumber(i)&&(r=!0,n=""),cc.assertID(t,1606),cc.assertID(null===t._parent,1605),t.parent=this,t.zIndex=e,r?t.setTag(i):t.setName(n)},cleanup:function(){c&&cc.director.getActionManager().removeAllActionsFromTarget(this),o.removeListeners(this);var t,e,i=this._children.length;for(t=0;t<i;++t)(e=this._children[t])&&e.cleanup()},sortAllChildren:function(){if(this._reorderChildDirty){this._reorderChildDirty=!1;var t=this._children;if(1<t.length){var e,i,n,r=t.length;for(e=1;e<r;e++){for(n=t[e],i=e-1;0<=i;){if(n._localZOrder<t[i]._localZOrder)t[i+1]=t[i];else{if(!(n._localZOrder===t[i]._localZOrder&&n._sgNode._arrivalOrder<t[i]._sgNode._arrivalOrder))break;t[i+1]=t[i]}i--}t[i+1]=n}this.emit("child-reorder")}cc.director.__fastOff(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this)}},_delaySort:function(){this._reorderChildDirty||(this._reorderChildDirty=!0,cc.director.__fastOn(cc.Director.EVENT_AFTER_UPDATE,this.sortAllChildren,this))},_updateDummySgNode:function(){var t=this._sgNode;t.setPosition(this._position),t.setRotationX(this._rotationX),t.setRotationY(this._rotationY),t.setScale(this._scaleX,this._scaleY),t.setSkewX(this._skewX),t.setSkewY(this._skewY);var e=t._arrivalOrder;t.setLocalZOrder(this._localZOrder),t._arrivalOrder=e,t.setGlobalZOrder(this._globalZOrder),t.setOpacity(this._opacity),t.setOpacityModifyRGB(this._opacityModifyRGB),t.setCascadeOpacityEnabled(this._cascadeOpacityEnabled),t.setTag(this._tag)},_updateSgNode:function(){this._updateDummySgNode();var t=this._sgNode;t.setAnchorPoint(this._anchorPoint),t.setVisible(this._active),t.setColor(this._color);var e=c?cc.director.getActionManager():null;this._activeInHierarchy?(e&&e.resumeTarget(this),o.resumeTarget(this)):(e&&e.pauseTarget(this),o.pauseTarget(this))},_removeSgNode:n.removeSgNode,onRestore:!1});a.propertyDefine(E,["parent","tag","skewX","skewY","position","rotation","rotationX","rotationY","scale","scaleX","scaleY","opacity","color"],{x:["getPositionX","setPositionX"],y:["getPositionY","setPositionY"],zIndex:["getLocalZOrder","setLocalZOrder"],opacityModifyRGB:["isOpacityModifyRGB","setOpacityModifyRGB"],cascadeOpacity:["isCascadeOpacityEnabled","setCascadeOpacityEnabled"]}),E.EventType=l,cc.Node=e.exports=E},{"./event-manager":83,"./event/event":86,"./utils/base-node":168,"./utils/misc":173,"./utils/prefab-helper":175,"./utils/scene-graph-helper":176}],30:[function(t,e,i){cc.Scene=cc.Class({name:"cc.Scene",extends:t("./CCNode"),properties:{autoReleaseAssets:{default:void 0,type:cc.Boolean}},ctor:function(){(this._sgNode=new _ccsg.Scene).setAnchorPoint(0,0),this._anchorPoint.x=0,this._anchorPoint.y=0,this._activeInHierarchy=!1,this._inited=!cc.game._isCloning,this.dependAssets=null},destroy:function(){this._super(),this._activeInHierarchy=!1},_onHierarchyChanged:function(){},_instantiate:null,_load:function(){this._inited||(this._onBatchCreated(),this._inited=!0)},_activate:function(t){t=!1!==t,cc.director._nodeActivator.activateNode(this,t)}}),e.exports=cc.Scene},{"./CCNode":29}],31:[function(t,e,i){var c=function(t,e,i,n,r,o,s){this.prev=t,this.next=e,this.callback=i,this.target=n,this.priority=r,this.paused=o,this.markedForDeletion=s,this.isUpdate=!i},h=[];c.get=function(t,e,i,n,r,o,s){var a=h.pop();return a?(a.prev=t,a.next=e,a.callback=i,a.target=n,a.priority=r,a.paused=o,a.markedForDeletion=s,a.isUpdate=!i):a=new c(t,e,i,n,r,o,s),a},c.put=function(t){h.length<20&&(t.prev=t.next=t.callback=t.target=null,h.push(t))};var l=function(t,e,i,n){this.list=t,this.entry=e,this.target=i,this.callback=n},o=[];l.get=function(t,e,i,n){var r=o.pop();return r?(r.list=t,r.entry=e,r.target=i,r.callback=n):r=new l(t,e,i,n),r},l.put=function(t){o.length<20&&(t.list=t.entry=t.target=t.callback=null,o.push(t))};var u=function(t,e,i,n,r,o){var s=this;s.timers=t,s.target=e,s.timerIndex=i,s.currentTimer=n,s.currentTimerSalvaged=r,s.paused=o},a=[];function _(){this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}u.get=function(t,e,i,n,r,o){var s=a.pop();return s?(s.timers=t,s.target=e,s.timerIndex=i,s.currentTimer=n,s.currentTimerSalvaged=r,s.paused=o):s=new u(t,e,i,n,r,o),s},u.put=function(t){a.length<20&&(t.timers=t.target=t.currentTimer=null,a.push(t))};var n=_.prototype;n.initWithCallback=function(t,e,i,n,r,o){return this._lock=!1,this._scheduler=t,this._target=i,this._callback=e,this._elapsed=-1,this._interval=n,this._delay=o,this._useDelay=0<this._delay,this._repeat=r,this._runForever=this._repeat===cc.macro.REPEAT_FOREVER,!0},n.getInterval=function(){return this._interval},n.setInterval=function(t){this._interval=t},n.update=function(t){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},n.getCallback=function(){return this._callback},n.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},n.cancel=function(){this._scheduler.unschedule(this._callback,this._target)};var r=[];_.get=function(){return r.pop()||new _},_.put=function(t){r.length<20&&!t._lock&&(t._scheduler=t._target=t._callback=null,r.push(t))};var d=function(t){return t.__instanceId||t.uuid};cc.Scheduler=cc._Class.extend({ctor:function(){this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates={},this._hashForTimers={},this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,this._arrayForTimers=[]},_removeHashElement:function(t){delete this._hashForTimers[d(t.target)];for(var e=this._arrayForTimers,i=0,n=e.length;i<n;i++)if(e[i]===t){e.splice(i,1);break}u.put(t)},_removeUpdateFromHash:function(t){var e=d(t.target),i=this._hashForUpdates[e];if(i){for(var n=i.list,r=i.entry,o=0,s=n.length;o<s;o++)if(n[o]===r){n.splice(o,1);break}delete this._hashForUpdates[e],c.put(r),l.put(i)}},_priorityIn:function(t,e,i){for(var n=0;n<t.length;n++)if(i<t[n].priority)return void t.splice(n,0,e);t.push(e)},_appendIn:function(t,e){t.push(e)},setTimeScale:function(t){this._timeScale=t},getTimeScale:function(){return this._timeScale},update:function(t){var e,i,n,r;for(this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale),e=0,n=(i=this._updatesNegList).length;e<n;e++)(r=i[e]).paused||r.markedForDeletion||(r.isUpdate?r.target.update(t):r.callback.call(r.target,t));for(e=0,n=(i=this._updates0List).length;e<n;e++)(r=i[e]).paused||r.markedForDeletion||(r.isUpdate?r.target.update(t):r.callback.call(r.target,t));for(e=0,n=(i=this._updatesPosList).length;e<n;e++)(r=i[e]).paused||r.markedForDeletion||(r.isUpdate?r.target.update(t):r.callback.call(r.target,t));var o,s=this._arrayForTimers;for(e=0;e<s.length;e++){if(o=s[e],this._currentTarget=o,this._currentTargetSalvaged=!1,!o.paused)for(o.timerIndex=0;o.timerIndex<o.timers.length;++o.timerIndex)o.currentTimer=o.timers[o.timerIndex],o.currentTimerSalvaged=!1,o.currentTimer.update(t),o.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--e)}for(e=0,i=this._updatesNegList;e<i.length;)(r=i[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,i=this._updates0List;e<i.length;)(r=i[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,i=this._updatesPosList;e<i.length;)(r=i[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;this._updateHashLocked=!1,this._currentTarget=null},scheduleCallbackForTarget:function(t,e,i,n,r,o){this.schedule(e,t,i,n,r,o)},schedule:function(t,e,i,n,r,o){"use strict";if("function"!=typeof t){var s=t;t=e,e=s}4!==arguments.length&&5!==arguments.length||(o=!!n,n=cc.macro.REPEAT_FOREVER,r=0),cc.assertID(e,1502);var a=d(e);cc.assertID(a,1510);var c,h,l=this._hashForTimers[a];if(l?l.paused!==o&&cc.warnID(1511):(l=u.get(null,e,0,null,null,o),this._arrayForTimers.push(l),this._hashForTimers[a]=l),null==l.timers)l.timers=[];else for(h=0;h<l.timers.length;++h)if((c=l.timers[h])&&t===c._callback)return cc.logID(1507,c.getInterval(),i),void(c._interval=i);(c=_.get()).initWithCallback(this,t,e,i,n,r),l.timers.push(c),this._currentTarget===l&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)},scheduleUpdate:function(t,e,i,n){var r=d(t);cc.assertID(r,1510);var o=this._hashForUpdates[r];if(o&&o.entry){if(o.entry.priority===e)return o.entry.markedForDeletion=!1,void(o.entry.paused=i);if(this._updateHashLocked)return cc.logID(1506),o.entry.markedForDeletion=!1,void(o.entry.paused=i);this.unscheduleUpdate(t)}n&&cc.warnID(1512);var s,a=c.get(null,null,n,t,e,i,!1);0===e?(s=this._updates0List,this._appendIn(s,a)):(s=e<0?this._updatesNegList:this._updatesPosList,this._priorityIn(s,a,e)),this._hashForUpdates[r]=l.get(s,a,t,null)},unschedule:function(t,e){if(e&&t){var i=d(e);cc.assertID(i,1510);var n=this._hashForTimers[i];if(n)for(var r=n.timers,o=0,s=r.length;o<s;o++){var a=r[o];if(t===a._callback)return a!==n.currentTimer||n.currentTimerSalvaged||(n.currentTimerSalvaged=!0),r.splice(o,1),_.put(a),n.timerIndex>=o&&n.timerIndex--,void(0===r.length&&(this._currentTarget===n?this._currentTargetSalvaged=!0:this._removeHashElement(n)))}}},unscheduleUpdate:function(t){if(t){var e=d(t);cc.assertID(e,1510);var i=this._hashForUpdates[e];i&&(this._updateHashLocked?i.entry.markedForDeletion=!0:this._removeUpdateFromHash(i.entry))}},unscheduleAllForTarget:function(t){if(t){var e=d(t);cc.assertID(e,1510);var i=this._hashForTimers[e];if(i){var n=i.timers;-1<n.indexOf(i.currentTimer)&&!i.currentTimerSalvaged&&(i.currentTimerSalvaged=!0);for(var r=0,o=n.length;r<o;r++)_.put(n[r]);n.length=0,this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)}this.unscheduleUpdate(t)}},unscheduleAll:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllWithMinPriority:function(t){var e,i,n,r=this._arrayForTimers;for(e=r.length-1;0<=e;e--)i=r[e],this.unscheduleAllForTarget(i.target);var o=0;if(t<0)for(e=0;e<this._updatesNegList.length;)o=this._updatesNegList.length,(n=this._updatesNegList[e])&&n.priority>=t&&this.unscheduleUpdate(n.target),o==this._updatesNegList.length&&e++;if(t<=0)for(e=0;e<this._updates0List.length;)o=this._updates0List.length,(n=this._updates0List[e])&&this.unscheduleUpdate(n.target),o==this._updates0List.length&&e++;for(e=0;e<this._updatesPosList.length;)o=this._updatesPosList.length,(n=this._updatesPosList[e])&&n.priority>=t&&this.unscheduleUpdate(n.target),o==this._updatesPosList.length&&e++},isScheduled:function(t,e){cc.assertID(t,1508),cc.assertID(e,1509);var i=d(e);cc.assertID(i,1510);var n=this._hashForTimers[i];if(!n)return!1;if(null==n.timers)return!1;for(var r=n.timers,o=0;o<r.length;++o)if(t===r[o]._callback)return!0;return!1},pauseAllTargets:function(){return this.pauseAllTargetsWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},pauseAllTargetsWithMinPriority:function(t){var e,i,n,r,o=[],s=this._arrayForTimers;for(i=0,n=s.length;i<n;i++)(e=s[i])&&(e.paused=!0,o.push(e.target));if(t<0)for(i=0;i<this._updatesNegList.length;i++)(r=this._updatesNegList[i])&&r.priority>=t&&(r.paused=!0,o.push(r.target));if(t<=0)for(i=0;i<this._updates0List.length;i++)(r=this._updates0List[i])&&(r.paused=!0,o.push(r.target));for(i=0;i<this._updatesPosList.length;i++)(r=this._updatesPosList[i])&&r.priority>=t&&(r.paused=!0,o.push(r.target));return o},resumeTargets:function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},pauseTarget:function(t){cc.assertID(t,1503);var e=d(t);cc.assertID(e,1510);var i=this._hashForTimers[e];i&&(i.paused=!0);var n=this._hashForUpdates[e];n&&(n.entry.paused=!0)},resumeTarget:function(t){cc.assertID(t,1504);var e=d(t);cc.assertID(e,1510);var i=this._hashForTimers[e];i&&(i.paused=!1);var n=this._hashForUpdates[e];n&&(n.entry.paused=!1)},isTargetPaused:function(t){cc.assertID(t,1505);var e=d(t);cc.assertID(e,1510);var i=this._hashForTimers[e];if(i)return i.paused;var n=this._hashForUpdates[e];return!!n&&n.entry.paused},scheduleUpdateForTarget:function(t,e,i){this.scheduleUpdate(t,e,i)},unscheduleCallbackForTarget:function(t,e){this.unschedule(e,t)},unscheduleUpdateForTarget:function(t){this.unscheduleUpdate(t)},unscheduleAllCallbacksForTarget:function(t){this.unscheduleAllForTarget(t)},unscheduleAllCallbacks:function(){this.unscheduleAllWithMinPriority(cc.Scheduler.PRIORITY_SYSTEM)},unscheduleAllCallbacksWithMinPriority:function(t){this.unscheduleAllWithMinPriority(t)}}),cc.Scheduler.PRIORITY_SYSTEM=1<<31,cc.Scheduler.PRIORITY_NON_SYSTEM=cc.Scheduler.PRIORITY_SYSTEM+1},{}],32:[function(t,e,i){var n=t("./CCRawAsset");cc.Asset=cc.Class({name:"cc.Asset",extends:n,properties:{rawUrl:{get:function(){if(this._rawFiles){if(cc.AssetLibrary)return cc.AssetLibrary.getLibUrlNoExt(this._uuid)+"/"+this._rawFiles[0];cc.errorID(6400)}return""},visible:!1},rawUrls:{get:function(){if(this._rawFiles){if(cc.AssetLibrary){var e=cc.AssetLibrary.getLibUrlNoExt(this._uuid)+"/";return this._rawFiles.map(function(t){return e+t})}cc.errorID(6401)}return[]},visible:!1},_rawFiles:null},statics:{deserialize:function(t){return cc.deserialize(t)},preventDeferredLoadDependents:!1},serialize:function(){return Editor.serialize(this)},createNode:null,_setRawFiles:function(t){this._rawFiles=0<t.length?t:null},_preloadRawFiles:null}),e.exports=cc.Asset},{"./CCRawAsset":38}],33:[function(t,e,i){var n=cc.Class({name:"cc.AudioClip",extends:cc.RawAsset});cc.AudioClip=n,e.exports=n},{}],34:[function(t,e,i){var n=cc.Class({name:"cc.BitmapFont",extends:cc.Font,properties:{fntDataStr:{default:""},spriteFrame:{default:null,type:cc.SpriteFrame},fontSize:{default:-1},_fntConfig:null}});cc.BitmapFont=n,e.exports=n},{}],35:[function(t,e,i){var n=cc.Class({name:"cc.Font",extends:cc.Asset});cc.Font=n,e.exports=n},{}],36:[function(t,e,i){var n=cc.Class({name:"cc.LabelAtlas",extends:cc.BitmapFont});cc.LabelAtlas=n,e.exports=n},{}],37:[function(e,t,i){var n=cc.Class({name:"cc.Prefab",extends:cc.Asset,properties:{data:null,asyncLoadAssets:void 0,_createFunction:{default:null,serializable:!1}},createNode:!1,compileCreateFunction:function(){var t=e("../platform/instantiate-jit");this._createFunction=t.compile(this.data)},_doInstantiate:function(t){return this.data._prefab?this.data._prefab._synced=!0:cc.warnID(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(t)},_instantiate:function(){var t;return t=this._doInstantiate(),this.data._instantiate(t),t}});cc.Prefab=t.exports=n,cc.js.obsolete(cc,"cc._Prefab","Prefab")},{"../platform/instantiate-jit":142}],38:[function(t,e,i){var n=t("../platform/CCObject");cc.RawAsset=cc.Class({name:"cc.RawAsset",extends:n,ctor:function(){Object.defineProperty(this,"_uuid",{value:"",writable:!0})},statics:{createNodeByInfo:null}}),Object.defineProperty(cc.RawAsset,"isRawAssetType",{value:function(t){return cc.isChildClassOf(t,cc.RawAsset)&&!cc.isChildClassOf(t,cc.Asset)}}),e.exports=cc.RawAsset},{"../platform/CCObject":129}],39:[function(t,e,i){var n=cc.Class({name:"cc.SceneAsset",extends:cc.Asset,properties:{scene:null,asyncLoadAssets:void 0}});cc.SceneAsset=n,e.exports=n},{}],40:[function(t,e,i){var n=cc.Class({name:"cc.Script",extends:cc.Asset});cc._Script=n;var r=cc.Class({name:"cc.JavaScript",extends:n});cc._JavaScript=r;var o=cc.Class({name:"cc.CoffeeScript",extends:n});cc._CoffeeScript=o;var s=cc.Class({name:"cc.TypeScript",extends:n});cc._TypeScript=s},{}],41:[function(t,e,i){var n=cc.Class({name:"cc.SpriteAtlas",extends:cc.Asset,properties:{_spriteFrames:{default:{}}},getTexture:function(){var t=Object.keys(this._spriteFrames);if(0<t.length){var e=this._spriteFrames[t[0]];return e?e.getTexture():null}return null},getSpriteFrame:function(t){return this._spriteFrames[t]},getSpriteFrames:function(){var t=[],e=this._spriteFrames;for(var i in e)t.push(e[i]);return t}});cc.SpriteAtlas=n,e.exports=n},{}],42:[function(t,e,i){var n=cc.Class({name:"cc.TTFFont",extends:cc.Font});cc.TTFFont=n,e.exports=n},{}],43:[function(t,e,i){t("./CCRawAsset"),t("./CCAsset"),t("./CCFont"),t("./CCPrefab"),t("./CCAudioClip"),t("./CCScripts"),t("./CCSceneAsset"),t("../sprites/CCSpriteFrame"),t("../textures/CCTexture2D"),t("./CCTTFFont"),t("./CCSpriteAtlas"),t("./CCBitmapFont"),t("./CCLabelAtlas")},{"../sprites/CCSpriteFrame":162,"../textures/CCTexture2D":163,"./CCAsset":32,"./CCAudioClip":33,"./CCBitmapFont":34,"./CCFont":35,"./CCLabelAtlas":36,"./CCPrefab":37,"./CCRawAsset":38,"./CCSceneAsset":39,"./CCScripts":40,"./CCSpriteAtlas":41,"./CCTTFFont":42}],44:[function(t,e,i){var n=t("../utils/misc"),r=t("../event-manager"),o=!!cc.ActionManager,s=function(){};cc.s_globalOrderOfArrival=1,_ccsg.Node=cc.Class({name:"ccsg.Node",properties:{_running:!1,_localZOrder:0,_globalZOrder:0,_arrivalOrder:0,_reorderChildDirty:!1,_vertexZ:0,_customZ:void 0,_rotationX:0,_rotationY:0,_scaleX:1,_scaleY:1,_position:cc.p(0,0),_skewX:0,_skewY:0,_children:[],_visible:!0,_anchorPoint:cc.p(0,0),_contentSize:cc.size(0,0),_parent:null,_ignoreAnchorPointForPosition:!1,tag:cc.macro.NODE_TAG_INVALID,_name:"",_realOpacity:255,_realColor:cc.Color.WHITE,_cascadeColorEnabled:!1,_cascadeOpacityEnabled:!1,_isTransitionFinished:!1,_actionManager:null,_scheduler:null,_renderCmd:null},ctor:function(){this.__instanceId=cc.ClassManager.getNewInstanceId(),this._renderCmd=this._createRenderCmd()},init:function(){return!0},attr:function(t){for(var e in t)this[e]=t[e]},getSkewX:function(){return this._skewX},setSkewX:function(t){this._skewX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getSkewY:function(){return this._skewY},setSkewY:function(t){this._skewY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},setLocalZOrder:function(t){this._parent?this._parent.reorderChild(this,t):this._localZOrder=t,r._setDirtyForNode(this)},_setLocalZOrder:function(t){this._localZOrder=t},getLocalZOrder:function(){return this._localZOrder},getZOrder:function(){return cc.logID(1600),this.getLocalZOrder()},setZOrder:function(t){cc.logID(1601),this.setLocalZOrder(t)},setGlobalZOrder:function(t){this._globalZOrder!==t&&(this._globalZOrder=t,r._setDirtyForNode(this))},getGlobalZOrder:function(){return this._globalZOrder},getVertexZ:function(){return this._vertexZ},setVertexZ:function(t){this._customZ=this._vertexZ=t},getRotation:function(){return this._rotationX!==this._rotationY&&cc.logID(1602),this._rotationX},setRotation:function(t){this._rotationX=this._rotationY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getRotationX:function(){return this._rotationX},setRotationX:function(t){this._rotationX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getRotationY:function(){return this._rotationY},setRotationY:function(t){this._rotationY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScale:function(){return this._scaleX!==this._scaleY&&cc.logID(1603),this._scaleX},setScale:function(t,e){this._scaleX=t,this._scaleY=e||0===e?e:t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScaleX:function(){return this._scaleX},setScaleX:function(t){this._scaleX=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getScaleY:function(){return this._scaleY},setScaleY:function(t){this._scaleY=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},setPosition:function(t,e){var i=this._position;if(void 0===e){if(i.x===t.x&&i.y===t.y)return;i.x=t.x,i.y=t.y}else{if(i.x===t&&i.y===e)return;i.x=t,i.y=e}this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getPosition:function(){return cc.p(this._position)},getPositionX:function(){return this._position.x},setPositionX:function(t){this._position.x=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getPositionY:function(){return this._position.y},setPositionY:function(t){this._position.y=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},getChildrenCount:function(){return this._children.length},getChildren:function(){return this._children},isVisible:function(){return this._visible},setVisible:function(t){this._visible!==t&&(this._visible=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),cc.renderer.childrenOrderDirty=!0)},getAnchorPoint:function(){return cc.p(this._anchorPoint)},setAnchorPoint:function(t,e){var i=this._anchorPoint;if(void 0===e){if(t.x===i.x&&t.y===i.y)return;i.x=t.x,i.y=t.y}else{if(t===i.x&&e===i.y)return;i.x=t,i.y=e}this._renderCmd._updateAnchorPointInPoint()},_getAnchorX:function(){return this._anchorPoint.x},_setAnchorX:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this._renderCmd._updateAnchorPointInPoint())},_getAnchorY:function(){return this._anchorPoint.y},_setAnchorY:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this._renderCmd._updateAnchorPointInPoint())},getAnchorPointInPoints:function(){return this._renderCmd.getAnchorPointInPoints()},_getWidth:function(){return this._contentSize.width},_setWidth:function(t){this._contentSize.width=t,this._renderCmd._updateAnchorPointInPoint()},_getHeight:function(){return this._contentSize.height},_setHeight:function(t){this._contentSize.height=t,this._renderCmd._updateAnchorPointInPoint()},getContentSize:function(){return cc.size(this._contentSize)},setContentSize:function(t,e){var i=this._contentSize;if(void 0===e){if(t.width===i.width&&t.height===i.height)return;i.width=t.width,i.height=t.height}else{if(t===i.width&&e===i.height)return;i.width=t,i.height=e}this._renderCmd._updateAnchorPointInPoint()},isRunning:function(){return this._running},getParent:function(){return this._parent},setParent:function(t){this._parent=t;var e=_ccsg.Node._dirtyFlags;this._renderCmd.setDirtyFlag(e.transformDirty|e.opacityDirty)},isIgnoreAnchorPointForPosition:function(){return this._ignoreAnchorPointForPosition},setIgnoreAnchorPointForPosition:function(t){t!==this._ignoreAnchorPointForPosition&&(this._ignoreAnchorPointForPosition=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty))},getTag:function(){return this.tag},setTag:function(t){this.tag=t},setName:function(t){this._name=t},getName:function(){return this._name},updateOrderOfArrival:function(){this._arrivalOrder=++cc.s_globalOrderOfArrival},getScheduler:function(){return this._scheduler||cc.director.getScheduler()},setScheduler:function(t){this._scheduler!==t&&(this.unscheduleAllCallbacks(),this._scheduler=t)},boundingBox:function(){return cc.logID(1608),this.getBoundingBox()},getBoundingBox:function(){var t=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc._rectApplyAffineTransformIn(t,this.getNodeToParentTransform())},cleanup:function(){this.stopAllActions(),this.unscheduleAllCallbacks(),r.removeListeners(this)},getChildByTag:function(t){var e=this._children;if(null!==e)for(var i=0;i<e.length;i++){var n=e[i];if(n&&n.tag===t)return n}return null},getChildByName:function(t){if(!t)return cc.log("Invalid name"),null;for(var e=this._children,i=0,n=e.length;i<n;i++)if(e[i]._name===t)return e[i];return null},addChild:function(t,e,i){e=void 0===e?t._localZOrder:e;var n,r=!1;void 0===i?n=t._name:"string"==typeof i?(n=i,i=void 0):"number"==typeof i&&(r=!0,n=""),cc.assertID(t,1606),cc.assertID(null===t._parent,1605),this._addChildHelper(t,e,i,n,r)},_addChildHelper:function(t,e,i,n,r){this._children||(this._children=[]),this._insertChild(t,e),r?t.setTag(i):t.setName(n),t.setParent(this),t.updateOrderOfArrival(),this._running&&(t.performRecursive(_ccsg.Node.performType.onEnter),this._isTransitionFinished&&t.performRecursive(_ccsg.Node.performType.onEnterTransitionDidFinish)),t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty),this._cascadeColorEnabled&&t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty),this._cascadeOpacityEnabled&&t._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},removeFromParent:function(t){this._parent&&(void 0===t&&(t=!0),this._parent.removeChild(this,t))},removeFromParentAndCleanup:function(t){cc.logID(1607),this.removeFromParent(t)},removeChild:function(t,e){0!==this._children.length&&(void 0===e&&(e=!0),-1<this._children.indexOf(t)&&this._detachChild(t,e),cc.renderer.childrenOrderDirty=!0)},removeChildByTag:function(t,e){t===cc.macro.NODE_TAG_INVALID&&cc.logID(1609);var i=this.getChildByTag(t);i?this.removeChild(i,e):cc.logID(1610,t)},removeAllChildrenWithCleanup:function(t){this.removeAllChildren(t)},removeAllChildren:function(t){var e=this._children;if(null!==e){void 0===t&&(t=!0);for(var i=0;i<e.length;i++){var n=e[i];n&&(this._running&&(n.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),n.performRecursive(_ccsg.Node.performType.onExit)),t&&n.performRecursive(_ccsg.Node.performType.cleanup),n.parent=null,n._renderCmd.detachFromParent())}this._children.length=0,cc.renderer.childrenOrderDirty=!0}},_detachChild:function(t,e){this._running&&(t.performRecursive(_ccsg.Node.performType.onExitTransitionDidStart),t.performRecursive(_ccsg.Node.performType.onExit)),e&&t.performRecursive(_ccsg.Node.performType.cleanup),t.parent=null,t._renderCmd.detachFromParent(),cc.js.array.remove(this._children,t)},_insertChild:function(t,e){cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,this._children.push(t),t._setLocalZOrder(e)},setNodeDirty:function(){this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.transformDirty)},reorderChild:function(t,e){cc.assertID(t,1617),-1!==this._children.indexOf(t)?e!==t.zIndex&&(cc.renderer.childrenOrderDirty=this._reorderChildDirty=!0,t.updateOrderOfArrival(),t._setLocalZOrder(e),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.orderDirty)):cc.logID(1635)},sortAllChildren:function(){if(this._reorderChildDirty){var t,e,i,n=this._children,r=n.length;for(t=1;t<r;t++){for(i=n[t],e=t-1;0<=e;){if(i._localZOrder<n[e]._localZOrder)n[e+1]=n[e];else{if(!(i._localZOrder===n[e]._localZOrder&&i._arrivalOrder<n[e]._arrivalOrder))break;n[e+1]=n[e]}e--}n[e+1]=i}this._reorderChildDirty=!1}},draw:function(t){},transformAncestors:function(){null!==this._parent&&(this._parent.transformAncestors(),this._parent.transform())},onEnter:function(){this._isTransitionFinished=!1,this._running=!0,this.resume()},performRecursive:function(t){var e=_ccsg.Node.performType;if(!(t>=e.max)){var i,n,r,o,s,a=0,c=_ccsg.Node._performStacks[_ccsg.Node._performing];for(c||(c=[],_ccsg.Node._performStacks.push(c)),c.length=0,_ccsg.Node._performing++,r=c[0]=this;r;){if((i=r._children)&&0<i.length)for(o=0,s=i.length;o<s;++o)n=i[o],c.push(n);r=c[++a]}switch(t){case e.onEnter:for(o=c.length-1;0<=o;--o)r=c[o],c[o]=null,r&&r.onEnter();break;case e.onExit:for(o=c.length-1;0<=o;--o)r=c[o],c[o]=null,r&&r.onExit();break;case e.onEnterTransitionDidFinish:for(o=c.length-1;0<=o;--o)r=c[o],c[o]=null,r&&r.onEnterTransitionDidFinish();break;case e.cleanup:for(o=c.length-1;0<=o;--o)r=c[o],c[o]=null,r&&r.cleanup();break;case e.onExitTransitionDidStart:for(o=c.length-1;0<=o;--o)r=c[o],c[o]=null,r&&r.onExitTransitionDidStart()}_ccsg.Node._performing--}},onEnterTransitionDidFinish:function(){this._isTransitionFinished=!0},onExitTransitionDidStart:function(){},onExit:function(){this._running=!1,this.pause()},runAction:o?function(t){return cc.assertID(t,1618),cc.director.getActionManager().addAction(t,this,!this._running),t}:s,stopAllActions:o?function(){cc.director.getActionManager().removeAllActionsFromTarget(this)}:s,stopAction:o?function(t){cc.director.getActionManager().removeAction(t)}:s,stopActionByTag:o?function(t){t!==cc.Action.TAG_INVALID?cc.director.getActionManager().removeActionByTag(t,this):cc.logID(1612)}:s,getActionByTag:o?function(t){return t===cc.Action.TAG_INVALID?(cc.logID(1613),null):cc.director.getActionManager().getActionByTag(t,this)}:function(){return null},getNumberOfRunningActions:o?function(){return cc.director.getActionManager().getNumberOfRunningActionsInTarget(this)}:function(){return 0},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(t){this.scheduler.scheduleUpdate(this,t,!this._running)},unscheduleUpdate:function(){this.scheduler.unscheduleUpdate(this)},schedule:function(t,e,i,n,r){var o=arguments.length;"function"==typeof t?1===o?(e=0,i=cc.macro.REPEAT_FOREVER,n=0,r=this.__instanceId):2===o?"number"==typeof e?(i=cc.macro.REPEAT_FOREVER,n=0,r=this.__instanceId):(r=e,e=0,i=cc.macro.REPEAT_FOREVER,n=0):3===o?("string"==typeof i?(r=i,i=cc.macro.REPEAT_FOREVER):r=this.__instanceId,n=0):4===o&&(r=this.__instanceId):1===o?(e=0,i=cc.macro.REPEAT_FOREVER,n=0):2===o&&(i=cc.macro.REPEAT_FOREVER,n=0),cc.assertID(t,1619),cc.assertID(0<=e,1620),e=e||0,i=isNaN(i)?cc.macro.REPEAT_FOREVER:i,n=n||0,this.scheduler.schedule(t,this,e,i,n,!this._running,r)},scheduleOnce:function(t,e,i){void 0===i&&(i=this.__instanceId),this.schedule(t,0,0,e,i)},unschedule:function(t){t&&this.scheduler.unschedule(t,this)},unscheduleAllCallbacks:function(){this.scheduler.unscheduleAllForTarget(this)},resumeSchedulerAndActions:function(){cc.logID(1614),this.resume()},resume:function(){this.scheduler.resumeTarget(this),o&&cc.director.getActionManager().resumeTarget(this),r.resumeTarget(this)},pauseSchedulerAndActions:function(){cc.logID(1615),this.pause()},pause:function(){this.scheduler.pauseTarget(this),o&&cc.director.getActionManager().pauseTarget(this),r.pauseTarget(this)},getParentToNodeTransform:function(){return this._renderCmd.getParentToNodeTransform()},parentToNodeTransform:function(){return this.getParentToNodeTransform()},getNodeToWorldTransform:function(){for(var t=this.getNodeToParentTransform(),e=this._parent;null!==e;e=e.parent)t=cc.affineTransformConcat(t,e.getNodeToParentTransform());return t},nodeToWorldTransform:function(){return this.getNodeToWorldTransform()},getWorldToNodeTransform:function(){return cc.affineTransformInvert(this.getNodeToWorldTransform())},worldToNodeTransform:function(){return this.getWorldToNodeTransform()},convertToNodeSpace:function(t){return cc.pointApplyAffineTransform(t,this.getWorldToNodeTransform())},convertToWorldSpace:function(t){return t=t||cc.v2(0,0),cc.pointApplyAffineTransform(t,this.getNodeToWorldTransform())},convertToNodeSpaceAR:function(t){return cc.pSub(this.convertToNodeSpace(t),this._renderCmd.getAnchorPointInPoints())},convertToWorldSpaceAR:function(t){t=t||cc.v2(0,0);var e=cc.pAdd(t,this._renderCmd.getAnchorPointInPoints());return this.convertToWorldSpace(e)},_convertToWindowSpace:function(t){var e=this.convertToWorldSpace(t);return cc.director.convertToUI(e)},convertTouchToNodeSpace:function(t){var e=t.getLocation();return this.convertToNodeSpace(e)},convertTouchToNodeSpaceAR:function(t){var e=cc.director.convertToGL(t.getLocation());return this.convertToNodeSpaceAR(e)},updateTransform:function(){for(var t=this._children,e=0;e<t.length;e++){var i;(i=t[e])&&i.updateTransform()}},retain:function(){},release:function(){},visit:function(t){var e=this._renderCmd,i=t?t._renderCmd:null;if(this._visible){var n=cc.renderer;e.visit(i);var r,o,s=this._children,a=s.length;if(0<a){for(this._reorderChildDirty&&this.sortAllChildren(),r=0;r<a&&(o=s[r])._localZOrder<0;r++)o.visit(this);for(n.pushRenderCommand(e);r<a;r++)s[r].visit(this)}else n.pushRenderCommand(e);e._dirtyFlag=0}else e._propagateFlagsDown(i)},transform:function(t,e){this._renderCmd.transform(t,e)},nodeToParentTransform:function(){return this.getNodeToParentTransform()},getNodeToParentTransform:function(t){var e=this._renderCmd.getNodeToParentTransform();if(t){for(var i={a:e.a,b:e.b,c:e.c,d:e.d,tx:e.tx,ty:e.ty},n=this._parent;null!=n&&n!=t;n=n.getParent())cc.affineTransformConcatIn(i,n.getNodeToParentTransform());return i}return e},getNodeToParentAffineTransform:function(t){return this.getNodeToParentTransform(t)},getShaderProgram:function(){return this._renderCmd.getShaderProgram()},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t)},getGLServerState:function(){return 0},setGLServerState:function(t){},getBoundingBoxToWorld:function(){var t=cc.rect(0,0,this._contentSize.width,this._contentSize.height),e=this.getNodeToWorldTransform();if(cc._rectApplyAffineTransformIn(t,e),!this._children)return t;for(var i=this._children,n=0;n<i.length;n++){var r=i[n];if(r&&r._visible){var o=r._getBoundingBoxToCurrentNode(e);o&&(t=cc.rectUnion(t,o))}}return t},_getBoundingBoxToCurrentNode:function(t){var e=cc.rect(0,0,this._contentSize.width,this._contentSize.height),i=void 0===t?this.getNodeToParentTransform():cc.affineTransformConcat(this.getNodeToParentTransform(),t);if(cc._rectApplyAffineTransformIn(e,i),!this._children)return e;for(var n=this._children,r=0;r<n.length;r++){var o=n[r];if(o&&o._visible){var s=o._getBoundingBoxToCurrentNode(i);s&&(e=cc.rectUnion(e,s))}}return e},getOpacity:function(){return this._realOpacity},getDisplayedOpacity:function(){return this._renderCmd.getDisplayedOpacity()},setOpacity:function(t){this._realOpacity=t,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.opacityDirty)},updateDisplayedOpacity:function(t){this._renderCmd._updateDisplayOpacity(t)},isCascadeOpacityEnabled:function(){return this._cascadeOpacityEnabled},setCascadeOpacityEnabled:function(t){this._cascadeOpacityEnabled!==t&&(this._cascadeOpacityEnabled=t,this._renderCmd.setCascadeOpacityEnabledDirty())},getColor:function(){var t=this._realColor;return cc.color(t.r,t.g,t.b,t.a)},getDisplayedColor:function(){return this._renderCmd.getDisplayedColor()},setColor:function(t){var e=this._realColor;e.r=t.r,e.g=t.g,e.b=t.b,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty)},updateDisplayedColor:function(t){this._renderCmd._updateDisplayColor(t)},isCascadeColorEnabled:function(){return this._cascadeColorEnabled},setCascadeColorEnabled:function(t){this._cascadeColorEnabled!==t&&(this._cascadeColorEnabled=t,this._renderCmd.setCascadeColorEnabledDirty())},setOpacityModifyRGB:function(t){},isOpacityModifyRGB:function(){return!1},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new _ccsg.Node.CanvasRenderCmd(this):new _ccsg.Node.WebGLRenderCmd(this)}}),_ccsg.Node.extend=cc._Class.extend,_ccsg.Node.prototype.ctor=_ccsg.Node,_ccsg.Node.performType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,onExitTransitionDidStart:5,max:6},_ccsg.Node._performStacks=[[]],_ccsg.Node._performing=0,n.propertyDefine(_ccsg.Node,["skewX","skewY","vertexZ","rotation","rotationX","rotationY","scale","scaleX","scaleY","children","childrenCount","parent","scheduler","shaderProgram","opacity","color"],{x:["getPositionX","setPositionX"],y:["getPositionY","setPositionY"],width:["_getWidth","_setWidth"],height:["_getHeight","_setHeight"],anchorX:["_getAnchorX","_setAnchorX"],anchorY:["_getAnchorY","_setAnchorY"],zIndex:["getLocalZOrder","setLocalZOrder"],visible:["isVisible","setVisible"],running:["isRunning"],ignoreAnchor:["isIgnoreAnchorPointForPosition","setIgnoreAnchorPointForPosition"],opacityModifyRGB:["isOpacityModifyRGB","setOpacityModifyRGB"],cascadeOpacity:["isCascadeOpacityEnabled","setCascadeOpacityEnabled"],cascadeColor:["isCascadeColorEnabled","setCascadeColorEnabled"]})},{"../event-manager":83,"../utils/misc":173}],45:[function(t,e,i){cc.CustomRenderCmd=function(t,e){this._needDraw=!0,this._target=t,this._callback=e},cc.CustomRenderCmd.prototype.rendering=function(t,e,i){this._callback&&this._callback.call(this._target,t,e,i)};var l=_ccsg.Node._dirtyFlags={transformDirty:1,visibleDirty:2,colorDirty:4,opacityDirty:8,cacheDirty:16,orderDirty:32,textDirty:64,gradientDirty:128,textureDirty:256,contentDirty:512,cullingDirty:1024,COUNT:9};cc.js.get(l,"all",function(){return(1<<l.COUNT)-1},!1),_ccsg.Node._requestDirtyFlag=function(t){cc.assertID(!l[t],1622,t);var e=1<<l.COUNT;return l[t]=e,l.COUNT++,e};var C=Math.PI/180;function n(t,e){var i,n,r,o,s,a,c=1,h=_ccsg.Node._performStacks[_ccsg.Node._performing];for(h||(h=[],_ccsg.Node._performStacks.push(h)),h.length=0,_ccsg.Node._performing++,h[0]=t;c;)if(r=h[--c],h[c]=null,r&&(i=r._children)&&0<i.length)for(o=r._renderCmd,s=0,a=i.length;s<a;++s)n=i[s],h[c]=n,c++,n._renderCmd[e](o);_ccsg.Node._performing--}_ccsg.Node.RenderCmd=function(t){this._node=t,this._anchorPointInPoints=new cc.Vec2(0,0),this._needDraw=!1,this._dirtyFlag=1,this._curLevel=-1,this._cameraFlag=0,this._displayedColor=new cc.Color(255,255,255,255),this._displayedOpacity=255,this._cascadeColorEnabledDirty=!1,this._cascadeOpacityEnabledDirty=!1,this._transform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._worldTransform={a:1,b:0,c:0,d:1,tx:0,ty:0},this._inverse={a:1,b:0,c:0,d:1,tx:0,ty:0},this._transformUpdated=!1,cc.renderer.pushDirtyNode(this)},_ccsg.Node.RenderCmd.prototype={constructor:_ccsg.Node.RenderCmd,_ctor:_ccsg.Node.RenderCmd,getAnchorPointInPoints:function(){return cc.p(this._anchorPointInPoints)},getDisplayedColor:function(){var t=this._displayedColor;return cc.color(t.r,t.g,t.b,t.a)},getDisplayedOpacity:function(){return this._displayedOpacity},setCascadeColorEnabledDirty:function(){this._cascadeColorEnabledDirty=!0,this.setDirtyFlag(l.colorDirty)},setCascadeOpacityEnabledDirty:function(){this._cascadeOpacityEnabledDirty=!0,this.setDirtyFlag(l.opacityDirty)},getParentToNodeTransform:function(){return this._dirtyFlag&l.transformDirty&&cc.affineTransformInvertOut(this.getNodeToParentTransform(),this._inverse),this._inverse},detachFromParent:function(){},_updateAnchorPointInPoint:function(){var t=this._anchorPointInPoints,e=this._node._contentSize,i=this._node._anchorPoint;t.x=e.width*i.x,t.y=e.height*i.y,this.setDirtyFlag(l.transformDirty)},setDirtyFlag:function(t){0===this._dirtyFlag&&0!==t&&cc.renderer.pushDirtyNode(this),this._dirtyFlag|=t},getParentRenderCmd:function(){return this._node&&this._node._parent&&this._node._parent._renderCmd?this._node._parent._renderCmd:null},updateTransform:function(t,e){var i=this._node,n=t?t._worldTransform:null,r=this._transform,o=this._worldTransform;if(!this._transformUpdated){var s=i._rotationX||i._rotationY,a=i._skewX||i._skewY,c=i._scaleX,h=i._scaleY,l=this._anchorPointInPoints.x,u=this._anchorPointInPoints.y,_=1,d=0,f=0,p=1;if(s||a){if(r.tx=i._position.x,r.ty=i._position.y,s){var g=i._rotationX*C;if(f=Math.sin(g),p=Math.cos(g),i._rotationY===i._rotationX)_=p,d=-f;else{var m=i._rotationY*C;_=Math.cos(m),d=-Math.sin(m)}}if(r.a=_*=c,r.b=d*=c,r.c=f*=h,r.d=p*=h,a){var v=Math.tan(i._skewX*C),y=Math.tan(i._skewY*C);v===1/0&&(v=99999999),y===1/0&&(y=99999999),r.a=_+f*y,r.b=d+p*y,r.c=f+_*v,r.d=p+d*v}(l||u)&&(r.tx-=r.a*l+r.c*u,r.ty-=r.b*l+r.d*u,i._ignoreAnchorPointForPosition&&(r.tx+=l,r.ty+=u))}else r.a=c,r.b=0,r.c=0,r.d=h,r.tx=i._position.x,r.ty=i._position.y,(l||u)&&(r.tx-=r.a*l,r.ty-=r.d*u,i._ignoreAnchorPointForPosition&&(r.tx+=l,r.ty+=u))}n?(o.a=r.a*n.a+r.b*n.c,o.b=r.a*n.b+r.b*n.d,o.c=r.c*n.a+r.d*n.c,o.d=r.c*n.b+r.d*n.d,o.tx=r.tx*n.a+r.ty*n.c+n.tx,o.ty=r.tx*n.b+r.ty*n.d+n.ty):(o.a=r.a,o.b=r.b,o.c=r.c,o.d=r.d,o.tx=r.tx,o.ty=r.ty)},transform:function(t,e){this.updateTransform(t),this._currentRegion&&(this._updateCurrentRegions(),this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.DirtyDouble)),cc.macro.ENABLE_CULLING?(this._updateCameraFlag(t),this._doCulling&&this._doCulling()):this._doCulling&&(this._needDraw=!0),e&&n(this._node,"transform")},_updateCameraFlag:function(t){var e=cc.Camera;cc._renderType===cc.game.RENDER_TYPE_WEBGL&&e&&t&&this._cameraFlag!=e.flags.InCamera&&(this._cameraFlag=0<t._cameraFlag?e.flags.ParentInCamera:0)},culling:function(t,e){cc.macro.ENABLE_CULLING?(this._updateCameraFlag(t),this._doCulling&&this._doCulling(),e&&n(this._node,"culling")):this._doCulling&&(this._needDraw=!0)},getNodeToParentTransform:function(){return this._dirtyFlag&l.transformDirty&&this.transform(),this._transform},setNodeToParentTransform:function(t){t?(this._transform=t,this._transformUpdated=!0):this._transformUpdated=!1,this.setDirtyFlag(l.transformDirty)},_propagateFlagsDown:function(t){if(t){var e=this._dirtyFlag,i=t._node,n=t._dirtyFlag;i._cascadeColorEnabled&&n&l.colorDirty&&(e|=l.colorDirty),i._cascadeOpacityEnabled&&n&l.opacityDirty&&(e|=l.opacityDirty),n&l.transformDirty&&(e|=l.transformDirty),n&l.cullingDirty&&(e|=l.cullingDirty),this._dirtyFlag=e}},visit:function(t){var e=this._node,i=cc.renderer;t&&(this._curLevel=t._curLevel+1),this._propagateFlagsDown(t),isNaN(e._customZ)&&(e._vertexZ=i.assignedZ,i.assignedZ+=i.assignedZStep),this._syncStatus(t)},_updateDisplayColor:function(t){var e,i,n,r,o=this._node,s=this._displayedColor,a=o._realColor;if(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeColorEnabledDirty&&!o._cascadeColorEnabled){s.r=a.r,s.g=a.g,s.b=a.b;var c=new cc.Color(255,255,255,255);for(e=0,i=(n=o._children).length;e<i;e++)(r=n[e])&&r._renderCmd&&r._renderCmd._updateDisplayColor(c);this._cascadeColorEnabledDirty=!1}else{if(void 0===t){var h=o._parent;t=h&&h._cascadeColorEnabled?h.getDisplayedColor():cc.Color.WHITE}if(s.r=0|a.r*t.r/255,s.g=0|a.g*t.g/255,s.b=0|a.b*t.b/255,o._cascadeColorEnabled)for(e=0,i=(n=o._children).length;e<i;e++)(r=n[e])&&r._renderCmd&&(r._renderCmd._updateDisplayColor(s),r._renderCmd._updateColor())}this._dirtyFlag&=~l.colorDirty},_updateDisplayOpacity:function(t){var e,i,n,r,o=this._node;if(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._cascadeOpacityEnabledDirty&&!o._cascadeOpacityEnabled){for(this._displayedOpacity=o._realOpacity,e=0,i=(n=o._children).length;e<i;e++)(r=n[e])&&r._renderCmd&&r._renderCmd._updateDisplayOpacity(255);this._cascadeOpacityEnabledDirty=!1}else{if(void 0===t){var s=o._parent;t=255,s&&s._cascadeOpacityEnabled&&(t=s.getDisplayedOpacity())}if(this._displayedOpacity=o._realOpacity*t/255,o._cascadeOpacityEnabled)for(e=0,i=(n=o._children).length;e<i;e++)(r=n[e])&&r._renderCmd&&(r._renderCmd._updateDisplayOpacity(this._displayedOpacity),r._renderCmd._updateColor())}this._dirtyFlag&=~l.opacityDirty},_syncDisplayColor:function(t){var e=this._node,i=this._displayedColor,n=e._realColor;if(void 0===t){var r=e._parent;t=r&&r._cascadeColorEnabled?r.getDisplayedColor():cc.Color.WHITE}i.r=0|n.r*t.r/255,i.g=0|n.g*t.g/255,i.b=0|n.b*t.b/255},_syncDisplayOpacity:function(t){var e=this._node;if(void 0===t){var i=e._parent;t=255,i&&i._cascadeOpacityEnabled&&(t=i.getDisplayedOpacity())}this._displayedOpacity=e._realOpacity*t/255},_updateColor:function(){},updateStatus:function(){var t=this._dirtyFlag,e=t&l.colorDirty,i=t&l.opacityDirty;if(t&l.contentDirty&&(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._dirtyFlag&=~l.contentDirty),e&&this._updateDisplayColor(),i&&this._updateDisplayOpacity(),(e||i)&&this._updateColor(),t&l.transformDirty){var n=this.getParentRenderCmd();this.transform(n,!0),this._dirtyFlag&=~l.transformDirty,this._dirtyFlag&=~l.cullingDirty}else t&l.cullingDirty&&(this.culling(n,!0),this._dirtyFlag&=~l.cullingDirty)},_syncStatus:function(t){var e=this._dirtyFlag,i=e&l.colorDirty,n=e&l.opacityDirty;i&&this._syncDisplayColor(),n&&this._syncDisplayOpacity(),(i||n)&&this._updateColor(),e&l.transformDirty?this.transform(t):e&l.cullingDirty&&this.culling(t)}},_ccsg.Node.RenderCmd.prototype.originUpdateTransform=_ccsg.Node.RenderCmd.prototype.updateTransform,_ccsg.Node.RenderCmd.prototype.originTransform=_ccsg.Node.RenderCmd.prototype.transform,_ccsg.Node.RenderCmd.prototype.originCulling=_ccsg.Node.RenderCmd.prototype.culling,_ccsg.Node.RenderCmd.prototype.originUpdateStatus=_ccsg.Node.RenderCmd.prototype.updateStatus,_ccsg.Node.RenderCmd.prototype._originSyncStatus=_ccsg.Node.RenderCmd.prototype._syncStatus},{}],46:[function(t,e,i){_ccsg.Node.CanvasRenderCmd=function(t){this._ctor(t),this._currentRegion=new cc.Region,this._oldRegion=new cc.Region,this._regionFlag=0},_ccsg.Node.CanvasRenderCmd.RegionStatus={NotDirty:0,Dirty:1,DirtyDouble:2};var n=_ccsg.Node.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.RenderCmd.prototype);n.constructor=_ccsg.Node.CanvasRenderCmd,n._rootCtor=_ccsg.Node.CanvasRenderCmd,n._notifyRegionStatus=function(t){this._needDraw&&this._regionFlag<t&&(this._regionFlag=t)};var r=new cc.Rect;n.getLocalBB=function(){var t=this._node;return r.x=r.y=0,r.width=t._contentSize.width,r.height=t._contentSize.height,r},n._updateCurrentRegions=function(){var t=this._currentRegion;this._currentRegion=this._oldRegion,this._oldRegion=t,_ccsg.Node.CanvasRenderCmd.RegionStatus.DirtyDouble!==this._regionFlag||this._currentRegion.isEmpty()||this._oldRegion.union(this._currentRegion),this._currentRegion.updateRegion(this.getLocalBB(),this._worldTransform)},n.detachFromParent=function(){for(var t,e=this._node._children,i=0,n=e.length;i<n;i++)(t=e[i])&&t._renderCmd&&t._renderCmd.detachFromParent()},n.setShaderProgram=function(t){},n.getShaderProgram=function(){return null},_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc=function(t){return t?t.src===cc.macro.SRC_ALPHA&&t.dst===cc.macro.ONE||t.src===cc.macro.ONE&&t.dst===cc.macro.ONE?"lighter":t.src===cc.macro.ZERO&&t.dst===cc.macro.SRC_ALPHA?"destination-in":t.src===cc.macro.ZERO&&t.dst===cc.macro.ONE_MINUS_SRC_ALPHA?"destination-out":"source-over":"source-over"}},{}],47:[function(t,e,i){_ccsg.Node.WebGLRenderCmd=function(t){this._ctor(t),this._shaderProgram=null};var n=_ccsg.Node.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.RenderCmd.prototype);n.constructor=_ccsg.Node.WebGLRenderCmd,n._rootCtor=_ccsg.Node.WebGLRenderCmd,n._updateColor=function(){},n.setShaderProgram=function(t){this._shaderProgram=t},n.getShaderProgram=function(){return this._shaderProgram}},{}],48:[function(t,e,i){var I=56,w=7;var L=cc.Vec2.ZERO,N=cc.Vec2.ONE;function s(t,e){var i,n,r,o=e._target;o?function(t,e,i,n){for(var r=t._parent._scaleX,o=t._parent._scaleY,s=0,a=0,c=t._parent;;){var h=c._position;if(s+=h.x,a+=h.y,!(c=c._parent))return i.x=i.y=0,n.x=n.y=1;if(c===e)break;var l=c._scaleX,u=c._scaleY;s*=l,a*=u,r*=l,o*=u}n.x=0!==r?1/r:1,n.y=0!==o?1/o:1,i.x=-s,i.y=-a}(t,i=o,n=L,r=N):i=t._parent;var s,a=(s=i)instanceof cc.Scene?cc.visibleRect:!s._sizeProvider||s._sizeProvider instanceof _ccsg.Node?s._contentSize:s.getContentSize(),c=i._anchorPoint,h=i instanceof cc.Scene,l=t._position.x,u=t._position.y,_=t._anchorPoint;if(e._alignFlags&I){var d,f,p=a.width;h?(d=cc.visibleRect.left.x,f=cc.visibleRect.right.x):f=(d=-c.x*p)+p,d+=e._isAbsLeft?e._left:e._left*p,f-=e._isAbsRight?e._right:e._right*p,o&&(d+=n.x,d*=r.x,f+=n.x,f*=r.x);var g,m=_.x,v=t._scaleX;if(v<0&&(m=1-m,v=-v),e.isStretchWidth)g=f-d,0!==v&&(t.width=g/v),l=d+m*g;else if(g=t.width*v,e.isAlignHorizontalCenter){var y=e._isAbsHorizontalCenter?e._horizontalCenter:e._horizontalCenter*p,C=(.5-c.x)*a.width;o&&(y*=r.x,C+=n.x,C*=r.x),l=C+(m-.5)*g+y}else l=e.isAlignLeft?d+m*g:f+(m-1)*g}if(e._alignFlags&w){var T,x,E=a.height;h?(x=cc.visibleRect.bottom.y,T=cc.visibleRect.top.y):T=(x=-c.y*E)+E,x+=e._isAbsBottom?e._bottom:e._bottom*E,T-=e._isAbsTop?e._top:e._top*E,o&&(x+=n.y,x*=r.y,T+=n.y,T*=r.y);var S,b=_.y,R=t._scaleY;if(R<0&&(b=1-b,R=-R),e.isStretchHeight)S=T-x,0!==R&&(t.height=S/R),u=x+b*S;else if(S=t.height*R,e.isAlignVerticalCenter){var A=e._isAbsVerticalCenter?e._verticalCenter:e._verticalCenter*E,O=(.5-c.y)*a.height;o&&(A*=r.y,O+=n.y,O*=r.y),u=O+(b-.5)*S+A}else u=e.isAlignBottom?x+b*S:T+(b-1)*S}t.setPosition(l,u)}function n(){var t=cc.director.getScene();if(t){if(r.isAligning=!0,r._nodesOrderDirty)a.length=0,function t(e){var i=e._widget;i&&(s(e,i),i.isAlignOnce?i.enabled=!1:a.push(i));for(var n=e._children,r=0;r<n.length;r++){var o=n[r];o._active&&t(o)}}(t),r._nodesOrderDirty=!1;else{var e,i=r._activeWidgetsIterator;for(i.i=0;i.i<a.length;++i.i)s((e=a[i.i]).node,e)}r.isAligning=!1}}var a=[],r=cc._widgetManager=e.exports={_AlignFlags:{TOP:1,MID:2,BOT:4,LEFT:8,CENTER:16,RIGHT:32},isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new cc.js.array.MutableForwardIterator(a),init:function(t){t.on(cc.Director.EVENT_BEFORE_VISIT,n)},add:function(t){t.node._widget=t,this._nodesOrderDirty=!0},remove:function(t){t.node._widget=null,this._activeWidgetsIterator.remove(t)},updateAlignment:function t(e){var i=e._parent;cc.Node.isNode(i)&&t(i);var n=e._widget||e.getComponent(cc.Widget);n&&s(e,n)}}},{}],49:[function(t,e,i){t("./platform/CCClass");var n=t("./platform/CCObject").Flags,r=t("./platform/js").array,o=n.IsStartCalled,s=n.IsOnEnableCalled,a=(n.IsEditorOnEnableCalled,"c.start();c._objFlags|="+o);function c(t,e){for(var i=e.constructor._executionOrder,n=e.__instanceId,r=0,o=t.length-1,s=o>>>1;r<=o;s=r+o>>>1){var a=t[s],c=a.constructor._executionOrder;if(i<c)o=s-1;else if(c<i)r=s+1;else{var h=a.__instanceId;if(n<h)o=s-1;else{if(!(h<n))return s;r=s+1}}}return~r}function h(t,e){for(var i=t.array,n=t.i+1;n<i.length;){var r=i[n];r._enabled&&r.node._activeInHierarchy?++n:(t.removeAt(n),e&&(r._objFlags&=~e))}}var l=cc.Class({__ctor__:function(t){var e=r.MutableForwardIterator;this._zero=new e([]),this._neg=new e([]),this._pos=new e([]),this._invoke=t},statics:{stableRemoveInactive:h},add:null,remove:null,invoke:null});function u(t,e){return t.constructor._executionOrder-e.constructor._executionOrder}var _=cc.Class({extends:l,add:function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).array.push(t)},remove:function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).fastRemove(t)},cancelInactive:function(t){h(this._zero,t),h(this._neg,t),h(this._pos,t)},invoke:function(){var t=this._neg;0<t.array.length&&(t.array.sort(u),this._invoke(t),t.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var e=this._pos;0<e.array.length&&(e.array.sort(u),this._invoke(e),e.array.length=0)}}),d=cc.Class({extends:l,add:function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.array.push(t);else{var i=e<0?this._neg.array:this._pos.array,n=c(i,t);n<0&&i.splice(~n,0,t)}},remove:function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.fastRemove(t);else{var i=e<0?this._neg:this._pos,n=c(i.array,t);0<=n&&i.removeAt(n)}},invoke:function(t){0<this._neg.array.length&&this._invoke(this._neg,t),this._invoke(this._zero,t),0<this._pos.array.length&&this._invoke(this._pos,t)}});function f(r,t){if("function"==typeof r)return t?function(t,e){var i=t.array;for(t.i=0;t.i<i.length;++t.i){var n=i[t.i];r(n,e)}}:function(t){var e=t.array;for(t.i=0;t.i<e.length;++t.i){var i=e[t.i];r(i)}};var e="var a=it.array;for(it.i=0;it.i<a.length;++it.i){var c=a[it.i];"+r+"}";return t?Function("it","dt",e):Function("it",e)}function p(){this.startInvoker=new _(f(a)),this.updateInvoker=new d(f("c.update(dt)",!0)),this.lateUpdateInvoker=new d(f("c.lateUpdate(dt)",!0)),this.scheduleInNextFrame=[],this._updating=!1}var g=cc.Class({ctor:p,unscheduleAll:p,statics:{LifeCycleInvoker:l,OneOffInvoker:_,createInvokeImpl:f,invokeOnEnable:function(t){var e=cc.director._compScheduler,i=t.array;for(t.i=0;t.i<i.length;++t.i){var n=i[t.i];n._enabled&&(n.onEnable(),!n.node._activeInHierarchy||e._onEnabled(n))}}},_onEnabled:function(t){cc.director.getScheduler().resumeTarget(t),t._objFlags|=s,this._updating?this.scheduleInNextFrame.push(t):this._scheduleImmediate(t)},_onDisabled:function(t){cc.director.getScheduler().pauseTarget(t),t._objFlags&=~s;var e=this.scheduleInNextFrame.indexOf(t);0<=e?r.fastRemoveAt(this.scheduleInNextFrame,e):(!t.start||t._objFlags&o||this.startInvoker.remove(t),t.update&&this.updateInvoker.remove(t),t.lateUpdate&&this.lateUpdateInvoker.remove(t))},enableComp:function(t,e){if(!(t._objFlags&s)){if(t.onEnable){if(e)return void e.add(t);if(t.onEnable(),!t.node._activeInHierarchy)return}this._onEnabled(t)}},disableComp:function(t){t._objFlags&s&&(t.onDisable&&t.onDisable(),this._onDisabled(t))},_scheduleImmediate:function(t){!t.start||t._objFlags&o||this.startInvoker.add(t),t.update&&this.updateInvoker.add(t),t.lateUpdate&&this.lateUpdateInvoker.add(t)},_deferredSchedule:function(){for(var t=this.scheduleInNextFrame,e=0,i=t.length;e<i;e++){var n=t[e];this._scheduleImmediate(n)}t.length=0},startPhase:function(){this._updating=!0,0<this.scheduleInNextFrame.length&&this._deferredSchedule(),this.startInvoker.invoke()},updatePhase:function(t){this.updateInvoker.invoke(t)},lateUpdatePhase:function(t){this.lateUpdateInvoker.invoke(t),this._updating=!1}});e.exports=g},{"./platform/CCClass":123,"./platform/CCObject":129,"./platform/js":144,"./utils/misc":173}],50:[function(t,e,i){var n=t("../../animation/animation-animator"),r=t("../../animation/animation-clip");var o=cc.Class({name:"cc.Animation",extends:t("./CCComponent"),mixins:[cc.EventTarget],editor:!1,ctor:function(){cc.EventTarget.call(this),this._animator=null,this._nameToState={},this._didInit=!1,this._currentClip=null},properties:{_defaultClip:{default:null,type:r},defaultClip:{type:r,get:function(){return this._defaultClip},set:function(t){},tooltip:!1},currentClip:{get:function(){return this._currentClip},set:function(t){this._currentClip=t},type:r,visible:!1},_clips:{default:[],type:[r],tooltip:!1,visible:!0},playOnLoad:{default:!1,tooltip:!1}},start:function(){if(this.playOnLoad&&this._defaultClip&&(!this._animator||!this._animator.isPlaying)){var t=this.getAnimationState(this._defaultClip.name);this._animator.playState(t)}},onEnable:function(){this._animator&&this._animator.resume()},onDisable:function(){this._animator&&this._animator.pause()},onDestroy:function(){this.stop()},getClips:function(){return this._clips},play:function(t,e){var i=this.playAdditive(t,e);return this._animator.stopStatesExcept(i),i},playAdditive:function(t,e){this._init();var i=this.getAnimationState(t||this._defaultClip&&this._defaultClip.name);if(i){this.enabled=!0;var n=this._animator;n.isPlaying&&i.isPlaying?i.isPaused?n.resumeState(i):(n.stopState(i),n.playState(i,e)):n.playState(i,e),this.currentClip=i.clip}return i},stop:function(t){if(this._didInit)if(t){var e=this._nameToState[t];e&&this._animator.stopState(e)}else this._animator.stop()},pause:function(t){if(this._didInit)if(t){var e=this._nameToState[t];e&&this._animator.pauseState(e)}else this.enabled=!1},resume:function(t){if(this._didInit)if(t){var e=this._nameToState[t];e&&this._animator.resumeState(e)}else this.enabled=!0},setCurrentTime:function(t,e){if(this._init(),e){var i=this._nameToState[e];i&&this._animator.setStateTime(i,t)}else this._animator.setStateTime(t)},getAnimationState:function(t){this._init();var e=this._nameToState[t];return e&&!e.curveLoaded&&this._animator._reloadClip(e),e||null},addClip:function(t,e){if(t){this._init(),cc.js.array.contains(this._clips,t)||this._clips.push(t),e=e||t.name;var i=this._nameToState[e];if(i){if(i.clip===t)return i;var n=this._clips.indexOf(i.clip);-1!==n&&this._clips.splice(n,1)}var r=new cc.AnimationState(t,e);return this._nameToState[e]=r}cc.warnID(3900)},removeClip:function(e,t){if(e){var i;for(var n in this._init(),this._nameToState)if((i=this._nameToState[n]).clip===e)break;if(e===this._defaultClip){if(!t)return void cc.warnID(3902);this._defaultClip=null}if(i&&i.isPlaying){if(!t)return void cc.warnID(3903);this.stop(i.name)}this._clips=this._clips.filter(function(t){return t!==e}),i&&delete this._nameToState[i.name]}else cc.warnID(3901)},sample:function(t){if(this._init(),t){var e=this._nameToState[t];e&&e.sample()}else this._animator.sample()},on:function(t,e,i,n){this._init();for(var r=cc.EventTarget.prototype.on.call(this,t,e,i,n),o=this._animator._anims.array,s=0;s<o.length;++s)o[s]._setListeners(this);return r},off:function(t,e,i,n){this._init(),cc.EventTarget.prototype.off.call(this,t,e,i,n);var r=this._nameToState;for(var o in r)r[o]._setListeners(null)},_init:function(){this._didInit||(this._didInit=!0,this._animator=new n(this.node,this),this._createStates())},_createStates:function(){for(var t=null,e=!(this._nameToState={}),i=0;i<this._clips.length;++i){var n=this._clips[i];n&&(t=new cc.AnimationState(n),this._nameToState[t.name]=t,((r=this._defaultClip)===(o=n)||r&&o&&(r.name===o.name||r._uuid===o._uuid))&&(e=t))}var r,o;this._defaultClip&&!e&&(t=new cc.AnimationState(this._defaultClip),this._nameToState[t.name]=t)}});cc.Animation=e.exports=o},{"../../animation/animation-animator":4,"../../animation/animation-clip":5,"./CCComponent":55}],51:[function(t,e,i){var n=cc.Class({name:"cc.AudioSource",extends:t("./CCComponent"),editor:!1,ctor:function(){this.audio=new cc.Audio},properties:{_clip:{default:"",url:cc.AudioClip},_volume:1,_mute:!1,_loop:!1,_pausedFlag:{default:!1,serializable:!1},isPlaying:{get:function(){return!!this.audio&&this.audio.getState()===cc.Audio.State.PLAYING},visible:!1},clip:{get:function(){return this._clip},set:function(t){t!==this._clip&&(this._clip=t,this.audio.stop(),this.audio.src=this._clip,this.audio.preload&&this.audio.preload())},url:cc.AudioClip,tooltip:!1,animatable:!1},volume:{get:function(){return this._volume},set:function(t){t=cc.clamp01(t),this._volume=t;var e=this.audio;return e&&!this._mute&&(e.setVolume(t),e._loaded||e.on("load",function(){e.setVolume(t)})),t},tooltip:!1},mute:{get:function(){return this._mute},set:function(t){return this._mute=t,this.audio&&this.audio.setVolume(t?0:this._volume),t},animatable:!1,tooltip:!1},loop:{get:function(){return this._loop},set:function(t){return this._loop=t,this.audio&&this.audio.setLoop(t),t},animatable:!1,tooltip:!1},playOnLoad:{default:!1,tooltip:!1,animatable:!1},preload:{default:!1,animatable:!1}},_pausedCallback:function(){var t=this.audio;t&&!t.paused&&(this.audio.pause(),this._pausedFlag=!0)},_restoreCallback:function(){this.audio&&(this._pausedFlag&&this.audio.resume(),this._pausedFlag=!1)},onEnable:function(){this.playOnLoad?this.play():this.preload&&(this.audio.src=this._clip,this.audio.preload()),cc.game.on(cc.game.EVENT_HIDE,this._pausedCallback,this),cc.game.on(cc.game.EVENT_SHOW,this._restoreCallback,this)},onDisable:function(){this.stop(),cc.game.off(cc.game.EVENT_HIDE,this._pausedCallback,this),cc.game.off(cc.game.EVENT_SHOW,this._restoreCallback,this)},onDestroy:function(){this.stop(),this.audio.destroy(),cc.audioEngine.uncache(this._clip)},play:function(){if(this._clip){var t=this._mute?0:this._volume,e=this.audio,i=this._loop;if(e._loaded)return e.stop(),e.setCurrentTime(0),void e.play();e.src=this._clip,e.once("load",function(){e.setLoop(i),e.setVolume(t),e.play()}),e.preload()}},stop:function(){this.audio&&this.audio.stop()},pause:function(){this.audio&&this.audio.pause()},resume:function(){this.audio&&this.audio.resume()},rewind:function(){this.audio&&this.audio.setCurrentTime(0)},getCurrentTime:function(){var t=0;return this.audio&&(t=this.audio.getCurrentTime()),t},setCurrentTime:function(t){var e=this.audio;return e&&(e._loaded?e.setCurrentTime(t):e.once("load",function(){e.setCurrentTime(t)})),t},getDuration:function(){var t=0;return this.audio&&(t=this.audio.getDuration()),t}});cc.AudioSource=e.exports=n},{"./CCComponent":55}],52:[function(t,e,i){var n=["touchstart","touchmove","touchend","mousedown","mousemove","mouseup","mouseenter","mouseleave","mousewheel"];function r(t){t.stopPropagation()}var o=cc.Class({name:"cc.BlockInputEvents",extends:t("./CCComponent"),editor:{menu:"i18n:MAIN_MENU.component.ui/Block Input Events",inspector:"packages://inspector/inspectors/comps/block-input-events.js",help:"i18n:COMPONENT.help_url.block-input-events"},onEnable:function(){for(var t=0;t<n.length;t++)this.node.on(n[t],r,this)},onDisable:function(){for(var t=0;t<n.length;t++)this.node.off(n[t],r,this)}});cc.BlockInputEvents=e.exports=o},{"./CCComponent":55}],53:[function(t,e,i){var r=cc.Enum({NONE:0,COLOR:1,SPRITE:2,SCALE:3}),n=cc.Class({name:"cc.Button",extends:t("./CCComponent"),ctor:function(){this._resetState(),this._fromColor=null,this._toColor=null,this._time=0,this._transitionFinished=!0,this._fromScale=1,this._toScale=1,this._originalScale=1,this._sprite=null},_resetState:function(){this._pressed=!1,this._hovered=!1},editor:!1,properties:{interactable:{default:!0,tooltip:!1,notify:function(t){this._updateState(),this.interactable||this._resetState()},animatable:!1},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}},enableAutoGrayEffect:{default:!1,tooltip:!1,notify:function(){this._updateDisabledState()}},transition:{default:r.NONE,tooltip:!1,type:r,animatable:!1},normalColor:{default:cc.color(214,214,214),displayName:"Normal",tooltip:!1,notify:function(){this._updateState()}},pressedColor:{default:cc.color(211,211,211),displayName:"Pressed",tooltip:!1},hoverColor:{default:cc.Color.WHITE,displayName:"Hover",tooltip:!1},disabledColor:{default:cc.color(124,124,124),displayName:"Disabled",tooltip:!1,notify:function(){this._updateState()}},duration:{default:.1,range:[0,10],tooltip:!1},zoomScale:{default:1.2,tooltip:!1},normalSprite:{default:null,type:cc.SpriteFrame,displayName:"Normal",tooltip:!1,notify:function(){this._updateState()}},pressedSprite:{default:null,type:cc.SpriteFrame,displayName:"Pressed",tooltip:!1,formerlySerializedAs:"pressedSprite",notify:function(){this._updateState()}},hoverSprite:{default:null,type:cc.SpriteFrame,displayName:"Hover",tooltip:!1,formerlySerializedAs:"hoverSprite",notify:function(){this._updateState()}},disabledSprite:{default:null,type:cc.SpriteFrame,displayName:"Disabled",tooltip:!1,notify:function(){this._updateState()}},target:{default:null,type:cc.Node,tooltip:!1,notify:function(){this._applyTarget()}},clickEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1}},statics:{Transition:r},__preload:function(){this.target||(this.target=this.node),this._applyTarget(),this._updateState()},onEnable:function(){this.normalSprite&&this.normalSprite.ensureLoadTexture(),this.hoverSprite&&this.hoverSprite.ensureLoadTexture(),this.pressedSprite&&this.pressedSprite.ensureLoadTexture(),this.disabledSprite&&this.disabledSprite.ensureLoadTexture(),this._registerEvent()},update:function(t){var e=this.target;if(!this._transitionFinished&&(this.transition===r.COLOR||this.transition===r.SCALE)){this.time+=t;var i=1;0<this.duration&&(i=this.time/this.duration),1<=i&&(i=1,this._transitionFinished=!0),this.transition===r.COLOR?e.color=this._fromColor.lerp(this._toColor,i):this.transition===r.SCALE&&(e.scale=cc.lerp(this._fromScale,this._toScale,i))}},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_getTargetSprite:function(t){var e=null;return t&&(e=t.getComponent(cc.Sprite)),e},_applyTarget:function(){this._sprite=this._getTargetSprite(this.target),this.target&&(this._originalScale=this.target.scale)},_onTouchBegan:function(t){this.interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),t.stopPropagation())},_onTouchMove:function(t){if(this.interactable&&this.enabledInHierarchy&&this._pressed){var e,i=t.touch,n=this.node._hitTest(i.getLocation());this.transition===r.SCALE&&this.target?n?(this._fromScale=this._originalScale,this._toScale=this._originalScale*this.zoomScale,this._transitionFinished=!1):(this.time=0,this._transitionFinished=!0,this.target.scale=this._originalScale):(e=n?"pressed":"normal",this._applyTransition(e)),t.stopPropagation()}},_onTouchEnded:function(t){this.interactable&&this.enabledInHierarchy&&(this._pressed&&(cc.Component.EventHandler.emitEvents(this.clickEvents,t),this.node.emit("click",this)),this._pressed=!1,this._updateState(),t.stopPropagation())},_zoomUp:function(){this._fromScale=this._originalScale,this._toScale=this._originalScale*this.zoomScale,this.time=0,this._transitionFinished=!1},_zoomBack:function(){this._fromScale=this.target.scale,this._toScale=this._originalScale,this.time=0,this._transitionFinished=!1},_onTouchCancel:function(){this.interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},_onMouseMoveIn:function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(this.transition!==r.SPRITE||this.hoverSprite)&&(this._hovered||(this._hovered=!0,this._updateState()))},_onMouseMoveOut:function(){this._hovered&&(this._hovered=!1,this._updateState())},_updateState:function(){var t=this._getButtonState();this._applyTransition(t),this._updateDisabledState()},onDisable:function(){this._hovered=!1,this._pressed=!1,this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(cc.Node.EventType.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.off(cc.Node.EventType.MOUSE_LEAVE,this._onMouseMoveOut,this)},_getButtonState:function(){return this.interactable?this._pressed?"pressed":this._hovered?"hover":"normal":"disabled"},_updateColorTransition:function(t){var e=this[t+"Color"],i=this.target;this._fromColor=i.color.clone(),this._toColor=e,this.time=0,this._transitionFinished=!1},_updateSpriteTransition:function(t){var e=this[t+"Sprite"];this._sprite&&e&&(this._sprite.spriteFrame=e)},_updateScaleTransition:function(t){"pressed"===t?this._zoomUp():this._zoomBack()},_applyTransition:function(t){var e=this.transition;e===r.COLOR?this._updateColorTransition(t):e===r.SPRITE?this._updateSpriteTransition(t):e===r.SCALE&&this._updateScaleTransition(t)},_resizeNodeToTargetNode:!1,_updateDisabledState:function(){this._sprite&&this._sprite._sgNode.setState(0),this.enableAutoGrayEffect&&this.transition!==r.COLOR&&(this.transition===r.SPRITE&&this.disabledSprite||this._sprite&&!this.interactable&&this._sprite._sgNode.setState(1))}});cc.Button=e.exports=n},{"./CCComponent":55}],54:[function(t,e,i){var n=t("../event-manager"),r={getContentSize:function(){return cc.visibleRect},setContentSize:function(t){},_getWidth:function(){return this.getContentSize().width},_getHeight:function(){return this.getContentSize().height}},o=cc.Class({name:"cc.Canvas",extends:t("./CCComponent"),editor:!1,resetInEditor:!1,statics:{instance:null},properties:{_designResolution:cc.size(960,640),designResolution:{get:function(){return cc.size(this._designResolution)},set:function(t){this._designResolution.width=t.width,this._designResolution.height=t.height,this.applySettings()},tooltip:!1},_fitWidth:!1,_fitHeight:!0,fitHeight:{get:function(){return this._fitHeight},set:function(t){this._fitHeight!==t&&(this._fitHeight=t,this.applySettings())},tooltip:!1},fitWidth:{get:function(){return this._fitWidth},set:function(t){this._fitWidth!==t&&(this._fitWidth=t,this.applySettings())},tooltip:!1}},ctor:function(){this._thisOnResized=this.onResized.bind(this)},__preload:function(){if(o.instance)return cc.errorID(6700,this.node.name,o.instance.node.name);(o.instance=this).node._sizeProvider||(this.node._sizeProvider=r),cc.director.on(cc.Director.EVENT_BEFORE_VISIT,this.alignWithScreen,this),cc.sys.isMobile?window.addEventListener("resize",this._thisOnResized):n.addCustomListener("canvas-resize",this._thisOnResized),this.applySettings(),this.onResized()},onDestroy:function(){this.node._sizeProvider===r&&(this.node._sizeProvider=null),cc.director.off(cc.Director.EVENT_BEFORE_VISIT,this.alignWithScreen,this),cc.sys.isMobile?window.removeEventListener("resize",this._thisOnResized):n.removeCustomListeners("canvas-resize",this._thisOnResized),o.instance===this&&(o.instance=null)},alignWithScreen:function(){var t,e=cc.visibleRect,i=0,n=0;!this.fitHeight&&!this.fitWidth&&(i=.5*((t=cc.view.getDesignResolutionSize()).width-e.width),n=.5*(t.height-e.height)),this.node.setPosition(.5*e.width+i,.5*e.height+n)},onResized:function(){this.alignWithScreen()},applySettings:function(){var t,e=cc.ResolutionPolicy;t=this.fitHeight&&this.fitWidth?e.SHOW_ALL:this.fitHeight||this.fitWidth?this.fitWidth?e.FIXED_WIDTH:e.FIXED_HEIGHT:e.NO_BORDER;var i=this._designResolution;cc.view.setDesignResolutionSize(i.width,i.height,t)}});cc.Canvas=e.exports=o},{"../event-manager":83,"./CCComponent":55}],55:[function(t,e,i){var n=t("../platform/CCObject"),r=t("../platform/js"),o=new(t("../platform/id-generater"))("Comp"),s=n.Flags.IsOnEnableCalled,a=n.Flags.IsOnLoadCalled,c=cc.Class({name:"cc.Component",extends:n,ctor:function(){this.__instanceId=cc.ClassManager.getNewInstanceId(),this.__eventTargets=[]},properties:{node:{default:null,visible:!1},name:{get:function(){if(this._name)return this._name;var t=cc.js.getClassName(this),e=t.lastIndexOf(".");return 0<=e&&(t=t.slice(e+1)),this.node.name+"<"+t+">"},set:function(t){this._name=t},visible:!1},_id:{default:"",serializable:!1},uuid:{get:function(){var t=this._id;return t||(t=this._id=o.getNewId()),t},visible:!1},__scriptAsset:!1,_enabled:!0,enabled:{get:function(){return this._enabled},set:function(t){if(this._enabled!==t&&(this._enabled=t,this.node._activeInHierarchy)){var e=cc.director._compScheduler;t?e.enableComp(this):e.disableComp(this)}},visible:!1},enabledInHierarchy:{get:function(){return 0<(this._objFlags&s)},visible:!1},_isOnLoadCalled:{get:function(){return this._objFlags&a}}},update:null,lateUpdate:null,__preload:null,onLoad:null,start:null,onEnable:null,onDisable:null,onDestroy:null,onFocusInEditor:null,onLostFocusInEditor:null,resetInEditor:null,addComponent:function(t){return this.node.addComponent(t)},getComponent:function(t){return this.node.getComponent(t)},getComponents:function(t){return this.node.getComponents(t)},getComponentInChildren:function(t){return this.node.getComponentInChildren(t)},getComponentsInChildren:function(t){return this.node.getComponentsInChildren(t)},_getLocalBounds:null,onRestore:null,destroy:function(){this._super()&&this._enabled&&this.node._activeInHierarchy&&cc.director._compScheduler.disableComp(this)},_onPreDestroy:function(){this.unscheduleAllCallbacks();for(var t=this.__eventTargets,e=0,i=t.length;e<i;++e){var n=t[e];n&&n.targetOff(this)}t.length=0,cc.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},_instantiate:function(t){return t||(t=cc.instantiate._clone(this,this)),t.node=null,t},isRunning:function(){return this.enabledInHierarchy},schedule:function(t,e,i,n){cc.assertID(t,1619),cc.assertID(0<=e,1620),e=e||0,i=isNaN(i)?cc.macro.REPEAT_FOREVER:i,n=n||0;var r=cc.director.getScheduler(),o=r.isTargetPaused(this);r.schedule(t,this,e,i,n,o)},scheduleOnce:function(t,e){this.schedule(t,0,0,e)},unschedule:function(t){t&&cc.director.getScheduler().unschedule(t,this)},unscheduleAllCallbacks:function(){cc.director.getScheduler().unscheduleAllForTarget(this)}});c._requireComponent=null,c._executionOrder=0,r.value(c,"_registerEditorProps",function(t,e){var i=e.requireComponent;i&&(t._requireComponent=i);var n=e.executionOrder;n&&"number"==typeof n&&(t._executionOrder=n)}),c.prototype.__scriptUuid="",cc.Component=e.exports=c},{"../platform/CCObject":129,"../platform/id-generater":140,"../platform/js":144}],56:[function(t,e,i){cc.Component.EventHandler=cc.Class({name:"cc.ClickEvent",properties:{target:{default:null,type:cc.Node},component:{default:""},handler:{default:""},customEventData:{default:""}},statics:{emitEvents:function(t){"use strict";var e,i,n;if(0<arguments.length)for(i=0,n=(e=new Array(arguments.length-1)).length;i<n;i++)e[i]=arguments[i+1];for(i=0,n=t.length;i<n;i++){var r=t[i];r instanceof cc.Component.EventHandler&&r.emit(e)}}},emit:function(t){var e=this.target;if(cc.isValid(e)){var i=e.getComponent(this.component);if(cc.isValid(i)){var n=i[this.handler];"function"==typeof n&&(null!=this.customEventData&&""!==this.customEventData&&(t=t.slice()).push(this.customEventData),n.apply(i,t))}}}})},{}],57:[function(t,e,i){t("../editbox/CCSGEditBox");var n=_ccsg.EditBox.KeyboardReturnType,r=_ccsg.EditBox.InputMode,o=_ccsg.EditBox.InputFlag,s=cc.Class({name:"cc.EditBox",extends:cc._RendererUnderSG,editor:!1,properties:{_useOriginalSize:!0,_string:"",string:{tooltip:!1,get:function(){return this._sgNode.string},set:function(t){this._sgNode.string=this._string=t}},backgroundImage:{tooltip:!1,default:null,type:cc.SpriteFrame,notify:function(){var t=this._sgNode,e=t.getBackgroundSprite();this.backgroundImage?this._createBackgroundSprite().setContentSize(t.getContentSize()):e.removeFromParent()}},returnType:{default:n.DEFAULT,tooltip:!1,displayName:"KeyboardReturnType",type:n,notify:function(){this._sgNode.returnType=this.returnType}},inputFlag:{tooltip:!1,default:o.DEFAULT,type:o,notify:function(){this._sgNode.inputFlag=this.inputFlag}},inputMode:{tooltip:!1,default:r.ANY,type:r,notify:function(){this._sgNode.inputMode=this.inputMode}},fontSize:{tooltip:!1,default:20,notify:function(){this._sgNode.fontSize=this.fontSize}},lineHeight:{tooltip:!1,default:28,notify:function(){this._sgNode.setLineHeight(this.lineHeight)}},fontColor:{tooltip:!1,default:cc.Color.WHITE,notify:function(){this._sgNode.fontColor=this.fontColor}},placeholder:{tooltip:!1,default:"Enter text here...",notify:function(){this._sgNode.placeholder=this.placeholder}},placeholderFontSize:{tooltip:!1,default:20,notify:function(){this._sgNode.placeholderFontSize=this.placeholderFontSize}},placeholderFontColor:{tooltip:!1,default:cc.Color.GRAY,notify:function(){this._sgNode.placeholderFontColor=this.placeholderFontColor}},maxLength:{tooltip:!1,default:20,notify:function(){this._sgNode.maxLength=this.maxLength}},stayOnTop:{tooltip:!1,default:!1,notify:function(){this._sgNode.stayOnTop(this.stayOnTop),this._sgNode.fontSize=this.fontSize,this._sgNode.fontColor=this.fontColor}},_tabIndex:0,tabIndex:{tooltip:!1,get:function(){return this._tabIndex},set:function(t){this._tabIndex=t,this._sgNode.setTabIndex(t)}},editingDidBegan:{default:[],type:cc.Component.EventHandler},textChanged:{default:[],type:cc.Component.EventHandler},editingDidEnded:{default:[],type:cc.Component.EventHandler},editingReturn:{default:[],type:cc.Component.EventHandler}},statics:{KeyboardReturnType:n,InputFlag:o,InputMode:r},_applyCapInset:function(t){var e=this.backgroundImage;t.setInsetTop(e.insetTop),t.setInsetBottom(e.insetBottom),t.setInsetRight(e.insetRight),t.setInsetLeft(e.insetLeft)},_createSgNode:function(){return new _ccsg.EditBox(cc.size(160,40))},_createBackgroundSprite:function(){var t=this._sgNode,e=new cc.Scale9Sprite;return e.setRenderingType(cc.Scale9Sprite.RenderingType.SLICED),this.backgroundImage&&(this.backgroundImage.ensureLoadTexture(),e.setSpriteFrame(this.backgroundImage),this._applyCapInset(e)),t.initWithSizeAndBackgroundSprite(cc.size(160,40),e),e},_initSgNode:function(){var t=this._sgNode;t.createDomElementIfNeeded(),this._createBackgroundSprite(),t.setContentSize(this.node.getContentSize()),t.inputMode=this.inputMode,t.maxLength=this.maxLength,t.string=this._string,t.fontSize=this.fontSize,t.fontColor=this.fontColor,t.placeholder=this.placeholder,t.placeholderFontSize=this.placeholderFontSize,t.placeholderFontColor=this.placeholderFontColor,t.inputFlag=this.inputFlag,t.returnType=this.returnType,t.setLineHeight(this.lineHeight),t.stayOnTop(this.stayOnTop),t.setTabIndex(this.tabIndex),t.setDelegate(this),b8e&&b8e.macro&&(cc.sys.platform!==cc.sys.WECHAT_GAME&&cc.sys.platform!==cc.sys.QQ_PLAY?this.stayOnTop=!!b8e.macro.EDTEXT_ALAWYS_ON_TOP:this.stayOnTop=!1)},editBoxEditingDidBegan:function(){cc.Component.EventHandler.emitEvents(this.editingDidBegan,this),this.node.emit("editing-did-began",this)},editBoxEditingDidEnded:function(){cc.Component.EventHandler.emitEvents(this.editingDidEnded,this),this.node.emit("editing-did-ended",this)},editBoxTextChanged:function(t,e){cc.Component.EventHandler.emitEvents(this.textChanged,e,this),this.node.emit("text-changed",this)},editBoxEditingReturn:function(){cc.Component.EventHandler.emitEvents(this.editingReturn,this),this.node.emit("editing-return",this)},onDestroy:function(){this._sgNode.setDelegate(null),this._super()},__preload:function(){this._super(),this._registerEvent()},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_onTouchBegan:function(t){this._sgNode&&this._sgNode._onTouchBegan(t.touch),t.stopPropagation()},_onTouchEnded:function(t){this._sgNode&&this._sgNode._onTouchEnded(),t.stopPropagation()},setFocus:function(){this._sgNode&&this._sgNode.setFocus()},isFocused:function(){var t=!1;return this._sgNode&&(t=this._sgNode.isFocused()),t}});cc.EditBox=e.exports=s},{"../editbox/CCSGEditBox":78}],58:[function(t,e,i){t("../label/CCSGLabel"),t("../label/CCSGLabelCanvasRenderCmd"),t("../label/CCSGLabelWebGLRenderCmd");var n=cc.TextAlignment,r=cc.VerticalTextAlignment,o=_ccsg.Label.Overflow,s=cc.Class({name:"cc.Label",extends:cc._RendererUnderSG,ctor:function(){},editor:!1,__string:"",_updateSgNodeString:function(){this.__string!=this.string&&(this.__string=this.string,this._sgNode.setString(this.string),this._updateNodeSize())},_updateSgNodeFontSize:function(){this._sgNode&&(this._sgNode.setFontSize(this._fontSize),this._updateNodeSize())},properties:{_useOriginalSize:!0,string:{default:"Label",multiline:!0,tooltip:!1,notify:function(){this._sgNode&&this._updateSgNodeString()}},horizontalAlign:{default:n.LEFT,type:n,tooltip:!1,notify:function(){this._sgNode&&this._sgNode.setHorizontalAlign(this.horizontalAlign)},animatable:!1},verticalAlign:{default:r.TOP,type:r,tooltip:!1,notify:function(){this._sgNode&&this._sgNode.setVerticalAlign(this.verticalAlign)},animatable:!1},_actualFontSize:{default:24},actualFontSize:{displayName:"Actual Font Size",animatable:!1,readonly:!0,get:function(){return this._sgNode&&(this._actualFontSize=this._sgNode.getFontSize()),this._actualFontSize}},_fontSize:24,fontSize:{get:function(){return this._fontSize},set:function(t){this._fontSize=t,this._updateSgNodeFontSize()},tooltip:!1},fontFamily:{default:"Arial",tooltip:!1,notify:function(){this._sgNode&&this._sgNode.setFontFamily(this.fontFamily)},animatable:!1},_lineHeight:28,lineHeight:{get:function(){return this._sgNode&&(this._lineHeight=this._sgNode.getLineHeight()),this._lineHeight},set:function(t){this._lineHeight=t,this._sgNode&&(this._sgNode.setLineHeight(t),this._updateNodeSize())},tooltip:!1},overflow:{default:o.NONE,type:o,tooltip:!1,notify:function(){this._sgNode&&(this._sgNode.setOverflow(this.overflow),this._updateNodeSize())},animatable:!1},_enableWrapText:!0,enableWrapText:{get:function(){return this._sgNode&&(this._enableWrapText=this._sgNode.isWrapTextEnabled()),this._enableWrapText},set:function(t){this._enableWrapText=t,this._sgNode&&this._sgNode.enableWrapText(t)},animatable:!1,tooltip:!1},_N$file:null,font:{get:function(){return this._N$file},set:function(t){if(t||(this._isSystemFontUsed=!0),this._N$file=t,this._bmFontOriginalSize=-1,t&&this._isSystemFontUsed&&(this._isSystemFontUsed=!1),this._sgNode){"string"==typeof t&&cc.warnID(4e3);var e=this.font;e instanceof cc.BitmapFont?e.spriteFrame?this._sgNode.setFontAsset(e):(cc.warnID(4011,e.name),this._sgNode.setFontFamily("")):this._sgNode.setFontAsset(e)}t instanceof cc.BitmapFont&&(this._bmFontOriginalSize=t.fontSize)},type:cc.Font,tooltip:!1,animatable:!1},_isSystemFontUsed:!0,useSystemFont:{get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed=!!t,t&&(this.font=null,this._sgNode&&this._sgNode.setFontFamily(this.fontFamily))},animatable:!1,tooltip:!1},_bmFontOriginalSize:{displayName:"BMFont Original Size",default:-1,serializable:!1,readonly:!0,visible:!0,animatable:!1},_spacingX:0,spacingX:{get:function(){return this._spacingX},set:function(t){this._spacingX=t,this._sgNode&&(this._sgNode.setSpacingX(this.spacingX),this._updateNodeSize())}}},statics:{HorizontalAlign:n,VerticalAlign:r,Overflow:o},__preload:function(){this._super(),this._sgNode.on("load",this._updateNodeSize,this),this._updateNodeSize()},_createSgNode:function(){return null},_initSgNode:function(){var t,e=this.font;"string"==typeof e&&cc.warnID(4e3),e instanceof cc.BitmapFont?e.spriteFrame?t=this._sgNode=_ccsg.Label.pool.get(this.string,e):(cc.warnID(4011,e.name),t=this._sgNode=_ccsg.Label.pool.get(this.string)):t=this._sgNode=_ccsg.Label.pool.get(this.string,e,null,this._fontSize),e instanceof cc.BitmapFont&&(this._bmFontOriginalSize=e.fontSize),t.setVisible(!1),t.setHorizontalAlign(this.horizontalAlign),t.setVerticalAlign(this.verticalAlign),t.setFontSize(this._fontSize),this.useSystemFont&&t.setFontFamily(this.fontFamily),t.setOverflow(this.overflow),t.enableWrapText(this._enableWrapText),t.setLineHeight(this._lineHeight),t.setString(this.string),e instanceof cc.BitmapFont&&t.setSpacingX(this.spacingX),t.setContentSize(this.node.getContentSize()),t.setColor(this.node.color)},_updateNodeSize:function(){this._sgNode&&this._sgNode.parent&&(this.overflow!==o.NONE&&this.overflow!==o.RESIZE_HEIGHT||this.node.setContentSize(this._sgNode.getContentSize()))},onDestroy:function(){var t=this._sgNode;this._super(),t&&(t.removeFromParent(!0),_ccsg.Label.pool.put(t))}});cc.Label=e.exports=s},{"../label/CCSGLabel":99,"../label/CCSGLabelCanvasRenderCmd":100,"../label/CCSGLabelWebGLRenderCmd":101}],59:[function(t,e,i){var n=cc.Class({name:"cc.LabelOutline",extends:t("./CCComponent"),editor:!1,ctor:function(){this._labelSGNode=null},properties:{_color:cc.color(255,255,255,255),_width:1,color:{get:function(){return this._color},set:function(t){this._color=cc.color(t),this._labelSGNode&&this._labelSGNode.setOutlineColor(cc.color(this._color))}},width:{get:function(){return this._width},set:function(t){this._width=t,this._labelSGNode&&(this._labelSGNode.setOutlineWidth(t),this._labelSGNode.setMargin(t))}}},onEnable:function(){var t=this.node.getComponent("cc.Label"),e=this._labelSGNode=t&&t._sgNode;this._labelSGNode&&(e.setOutlined(!0),e.setOutlineColor(cc.color(this._color)),e.setOutlineWidth(this._width),e.setMargin(this._width))},onDisable:function(){this._labelSGNode&&(this._labelSGNode.setOutlined(!1),this._labelSGNode.setMargin(0)),this._labelSGNode=null}});cc.LabelOutline=e.exports=n},{"./CCComponent":55}],60:[function(t,e,i){var R=cc.Enum({NONE:0,HORIZONTAL:1,VERTICAL:2,GRID:3}),A=cc.Enum({NONE:0,CONTAINER:1,CHILDREN:2}),n=cc.Enum({HORIZONTAL:0,VERTICAL:1}),O=cc.Enum({BOTTOM_TO_TOP:0,TOP_TO_BOTTOM:1}),I=cc.Enum({LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1}),r=cc.Class({name:"cc.Layout",extends:t("./CCComponent"),editor:!1,properties:{_layoutSize:cc.size(300,200),_layoutDirty:{default:!0,serializable:!1},_resize:A.NONE,_N$layoutType:R.NONE,type:{type:R,get:function(){return this._N$layoutType},set:function(t){this._N$layoutType=t,this._doLayoutDirty()},tooltip:!1,animatable:!1},resizeMode:{type:A,tooltip:!1,animatable:!1,get:function(){return this._resize},set:function(t){this.type===R.NONE&&t===A.CHILDREN||(this._resize=t,this._doLayoutDirty())}},cellSize:{default:cc.size(40,40),tooltip:!1,type:cc.Size,notify:function(){this._doLayoutDirty()}},startAxis:{default:n.HORIZONTAL,tooltip:!1,type:n,notify:function(){this._doLayoutDirty()},animatable:!1},_N$padding:{default:0},paddingLeft:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingRight:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingTop:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},paddingBottom:{default:0,tooltip:!1,notify:function(){this._doLayoutDirty()}},spacingX:{default:0,notify:function(){this._doLayoutDirty()},tooltip:!1},spacingY:{default:0,notify:function(){this._doLayoutDirty()},tooltip:!1},verticalDirection:{default:O.TOP_TO_BOTTOM,type:O,notify:function(){this._doLayoutDirty()},tooltip:!1,animatable:!1},horizontalDirection:{default:I.LEFT_TO_RIGHT,type:I,notify:function(){this._doLayoutDirty()},tooltip:!1,animatable:!1}},statics:{Type:R,VerticalDirection:O,HorizontalDirection:I,ResizeMode:A,AxisDirection:n},_migratePaddingData:function(){this.paddingLeft=this._N$padding,this.paddingRight=this._N$padding,this.paddingTop=this._N$padding,this.paddingBottom=this._N$padding,this._N$padding=0},onEnable:function(){this._addEventListeners(),cc.sizeEqualToSize(this.node.getContentSize(),cc.size(0,0))&&this.node.setContentSize(this._layoutSize),0!==this._N$padding&&this._migratePaddingData(),this._doLayoutDirty()},onDisable:function(){this._removeEventListeners()},_doLayoutDirty:function(){this._layoutDirty=!0},_addEventListeners:function(){cc.director.on(cc.Director.EVENT_BEFORE_VISIT,this.updateLayout,this),this.node.on("size-changed",this._resized,this),this.node.on("anchor-changed",this._doLayoutDirty,this),this.node.on("child-added",this._childAdded,this),this.node.on("child-removed",this._childRemoved,this),this.node.on("child-reorder",this._doLayoutDirty,this),this._addChildrenEventListeners()},_removeEventListeners:function(){cc.director.off(cc.Director.EVENT_BEFORE_VISIT,this.updateLayout,this),this.node.off("size-changed",this._resized,this),this.node.off("anchor-changed",this._doLayoutDirty,this),this.node.off("child-added",this._childAdded,this),this.node.off("child-removed",this._childRemoved,this),this.node.off("child-reorder",this._doLayoutDirty,this),this._removeChildrenEventListeners()},_addChildrenEventListeners:function(){this.node.children.forEach(function(t){t.on("size-changed",this._doLayoutDirty,this),t.on("position-changed",this._doLayoutDirty,this),t.on("anchor-changed",this._doLayoutDirty,this),t.on("active-in-hierarchy-changed",this._doLayoutDirty,this)}.bind(this))},_removeChildrenEventListeners:function(){this.node.children.forEach(function(t){t.off("size-changed",this._doLayoutDirty,this),t.off("position-changed",this._doLayoutDirty,this),t.off("anchor-changed",this._doLayoutDirty,this),t.off("active-in-hierarchy-changed",this._doLayoutDirty,this)}.bind(this))},_childAdded:function(t){var e=t.detail;e.on("size-changed",this._doLayoutDirty,this),e.on("position-changed",this._doLayoutDirty,this),e.on("anchor-changed",this._doLayoutDirty,this),e.on("active-in-hierarchy-changed",this._doLayoutDirty,this),this._doLayoutDirty()},_childRemoved:function(t){var e=t.detail;e.off("size-changed",this._doLayoutDirty,this),e.off("position-changed",this._doLayoutDirty,this),e.off("anchor-changed",this._doLayoutDirty,this),e.off("active-in-hierarchy-changed",this._doLayoutDirty,this),this._doLayoutDirty()},_resized:function(){this._layoutSize=this.node.getContentSize(),this._doLayoutDirty()},_doLayoutHorizontally:function(l,u,_,d){var f=this.node.getAnchorPoint(),t=this.node.children,p=1,g=this.paddingLeft,m=-f.x*l;this.horizontalDirection===I.RIGHT_TO_LEFT&&(p=-1,m=(1-f.x)*l,g=this.paddingRight);var v=m+p*g-p*this.spacingX,y=0,C=0,T=0,x=0,E=0,S=0,b=this.cellSize.width;return this.type!==R.GRID&&this.resizeMode===A.CHILDREN&&(b=(l-(this.paddingLeft+this.paddingRight)-(t.length-1)*this.spacingX)/t.length),t.forEach(function(t){if(t.activeInHierarchy){this._resize===A.CHILDREN&&(t.width=b,this.type===R.GRID&&(t.height=this.cellSize.height));var e=t.anchorX;C<T&&(C=T),t.height>=C&&(T=C,C=t.height,S=t.getAnchorPoint().y),this.horizontalDirection===I.RIGHT_TO_LEFT&&(e=1-t.anchorX),v=v+p*e*t.width+p*this.spacingX;var i=p*(1-e)*t.width;if(u){var n=v+i+p*(0<p?this.paddingRight:this.paddingLeft),r=this.horizontalDirection===I.LEFT_TO_RIGHT&&n>(1-f.x)*l,o=this.horizontalDirection===I.RIGHT_TO_LEFT&&n<-f.x*l;(r||o)&&(t.height>=C?(0===T&&(T=C),y+=T,T=C):(y+=C,T=t.height,C=0),v=m+p*(g+e*t.width),x++)}var s=_(t,y,x);l>=t.width+this.paddingLeft+this.paddingRight&&d&&t.setPosition(cc.p(v,s));var a,c=1,h=0===C?t.height:C;this.verticalDirection===O.TOP_TO_BOTTOM?(E=E||this.node._contentSize.height,(a=s+(c=-1)*(h*S+this.paddingBottom))<E&&(E=a)):(E=E||-this.node._contentSize.height,(a=s+c*(h*S+this.paddingTop))>E&&(E=a)),v+=i}}.bind(this)),E},_getVerticalBaseHeight:function(t){var e=0,i=0;return this.resizeMode===A.CONTAINER?(t.forEach(function(t){t.activeInHierarchy&&(i++,e+=t.height)}),e+=(i-1)*this.spacingY+this.paddingBottom+this.paddingTop):e=this.node.getContentSize().height,e},_doLayoutVertically:function(l,u,_,d){var f=this.node.getAnchorPoint(),t=this.node.children,p=1,g=this.paddingBottom,m=-f.y*l;this.verticalDirection===O.TOP_TO_BOTTOM&&(p=-1,m=(1-f.y)*l,g=this.paddingTop);var v=m+p*g-p*this.spacingY,y=0,C=0,T=0,x=0,E=0,S=0,b=this.cellSize.height;return this.type!==R.GRID&&this.resizeMode===A.CHILDREN&&(b=(l-(this.paddingTop+this.paddingBottom)-(t.length-1)*this.spacingY)/t.length),t.forEach(function(t){if(t.activeInHierarchy){this.resizeMode===A.CHILDREN&&(t.height=b,this.type===R.GRID&&(t.width=this.cellSize.width));var e=t.anchorY;C<T&&(C=T),t.width>=C&&(T=C,C=t.width,S=t.getAnchorPoint().x),this.verticalDirection===O.TOP_TO_BOTTOM&&(e=1-t.anchorY),v=v+p*e*t.height+p*this.spacingY;var i=p*(1-e)*t.height;if(u){var n=v+i+p*(0<p?this.paddingTop:this.paddingBottom),r=this.verticalDirection===O.BOTTOM_TO_TOP&&n>(1-f.y)*l,o=this.verticalDirection===O.TOP_TO_BOTTOM&&n<-f.y*l;(r||o)&&(t.width>=C?(0===T&&(T=C),y+=T,T=C):(y+=C,T=t.width,C=0),v=m+p*(g+e*t.height),x++)}var s=_(t,y,x);l>=t.height+(this.paddingTop+this.paddingBottom)&&d&&t.setPosition(cc.p(s,v));var a,c=1,h=0===C?t.width:C;this.horizontalDirection===I.RIGHT_TO_LEFT?(c=-1,E=E||this.node._contentSize.width,(a=s+c*(h*S+this.paddingLeft))<E&&(E=a)):(E=E||-this.node._contentSize.width,(a=s+c*(h*S+this.paddingRight))>E&&(E=a)),v+=i}}.bind(this)),E},_doLayoutBasic:function(){var e=null;if(this.node.children.forEach(function(t){t.activeInHierarchy&&(e=e?cc.rectUnion(e,t.getBoundingBoxToWorld()):t.getBoundingBoxToWorld())}),e){var t=this.node.parent.convertToNodeSpaceAR(cc.p(e.x,e.y));t=cc.pAdd(t,cc.p(-this.paddingLeft,-this.paddingBottom));var i=this.node.parent.convertToNodeSpaceAR(cc.p(e.x+e.width,e.y+e.height));i=cc.pAdd(i,cc.p(this.paddingRight,this.paddingTop));var n=cc.size(parseFloat((i.x-t.x).toFixed(2)),parseFloat((i.y-t.y).toFixed(2))),r=this.node.getPosition(),o=(r.x-t.x)/n.width,s=(r.y-t.y)/n.height,a=cc.p(parseFloat(o.toFixed(2)),parseFloat(s.toFixed(2)));this.node.setAnchorPoint(a),this.node.setContentSize(n)}},_doLayoutGridAxisHorizontal:function(t,e){var i=e.width,n=1,r=-t.y*e.height,o=this.paddingBottom;this.verticalDirection===O.TOP_TO_BOTTOM&&(n=-1,r=(1-t.y)*e.height,o=this.paddingTop);var s=function(t,e,i){return r+n*(e+t.anchorY*t.height+o+i*this.spacingY)}.bind(this),a=0;if(this.resizeMode===A.CONTAINER){var c=this._doLayoutHorizontally(i,!0,s,!1);(a=r-c)<0&&(a*=-1),r=-t.y*a,this.verticalDirection===O.TOP_TO_BOTTOM&&(n=-1,r=(1-t.y)*a)}this._doLayoutHorizontally(i,!0,s,!0),this.resizeMode===A.CONTAINER&&this.node.setContentSize(i,a)},_doLayoutGridAxisVertical:function(t,e){var i=e.height,n=1,r=-t.x*e.width,o=this.paddingLeft;this.horizontalDirection===I.RIGHT_TO_LEFT&&(n=-1,r=(1-t.x)*e.width,o=this.paddingRight);var s=function(t,e,i){return r+n*(e+t.anchorX*t.width+o+i*this.spacingX)}.bind(this),a=0;if(this.resizeMode===A.CONTAINER){var c=this._doLayoutVertically(i,!0,s,!1);(a=r-c)<0&&(a*=-1),r=-t.x*a,this.horizontalDirection===I.RIGHT_TO_LEFT&&(n=-1,r=(1-t.x)*a)}this._doLayoutVertically(i,!0,s,!0),this.resizeMode===A.CONTAINER&&this.node.setContentSize(a,i)},_doLayoutGrid:function(){var t=this.node.getAnchorPoint(),e=this.node.getContentSize();this.startAxis===n.HORIZONTAL?this._doLayoutGridAxisHorizontal(t,e):this.startAxis===n.VERTICAL&&this._doLayoutGridAxisVertical(t,e)},_getHorizontalBaseWidth:function(t){var e=0,i=0;return this.resizeMode===A.CONTAINER?(t.forEach(function(t){t.activeInHierarchy&&(i++,e+=t.width)}),e+=(i-1)*this.spacingX+this.paddingLeft+this.paddingRight):e=this.node.getContentSize().width,e},_doLayout:function(){if(this.type===R.HORIZONTAL){var t=this._getHorizontalBaseWidth(this.node.children);this._doLayoutHorizontally(t,!1,function(t){return t.y},!0),this.node.width=t}else if(this.type===R.VERTICAL){var e=this._getVerticalBaseHeight(this.node.children);this._doLayoutVertically(e,!1,function(t){return t.x},!0),this.node.height=e}else this.type===R.NONE?this.resizeMode===A.CONTAINER&&this._doLayoutBasic():this.type===R.GRID&&this._doLayoutGrid()},updateLayout:function(){this._layoutDirty&&0<this.node.children.length&&(this._doLayout(),this._layoutDirty=!1)}});Object.defineProperty(r.prototype,"padding",{get:function(){return cc.warnID(4100),this.paddingLeft},set:function(t){this._N$padding=t,this._migratePaddingData(),this._doLayoutDirty()}}),cc.Layout=e.exports=r},{"./CCComponent":55}],61:[function(t,e,i){t("../../clipping-nodes/CCClippingNode"),t("../../clipping-nodes/CCClippingNodeCanvasRenderCmd"),t("../../clipping-nodes/CCClippingNodeWebGLRenderCmd"),t("../../shape-nodes/CCDrawNode");var n=cc._RendererInSG,g=cc.Enum({RECT:0,ELLIPSE:1,IMAGE_STENCIL:2}),r=cc.Class({name:"cc.Mask",extends:n,editor:!1,properties:{_clippingStencil:{default:null,serializable:!1},_type:g.RECT,type:{get:function(){return this._type},set:function(t){this._type=t,this._refreshStencil()},type:g,tooltip:!1},spriteFrame:{default:null,type:cc.SpriteFrame,tooltip:!1,notify:function(){this._refreshStencil()}},alphaThreshold:{default:1,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){cc._renderType!==cc.game.RENDER_TYPE_CANVAS?this._sgNode.setAlphaThreshold(this.alphaThreshold):cc.warnID(4201)}},inverted:{default:!1,type:cc.Boolean,tooltip:!1,notify:function(){cc._renderType!==cc.game.RENDER_TYPE_CANVAS?this._sgNode.setInverted(this.inverted):cc.warnID(4202)}},_segements:64,segements:{get:function(){return this._segements},set:function(t){this._segements=cc.clampf(t,3,1e4),this._refreshStencil()},tooltip:!1},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}}},statics:{Type:g},_resizeNodeToTargetNode:!1,_initSgNode:function(){},_createSgNode:function(){return new cc.ClippingNode},_hitTest:function(t){var e=this.node.getContentSize(),i=e.width,n=e.height,r=this.node.getNodeToWorldTransform();if(this.type===g.RECT||this.type===g.IMAGE_STENCIL){var o=cc.rect(0,0,i,n);cc._rectApplyAffineTransformIn(o,r);var s=t.x-o.x,a=o.x+o.width-t.x,c=t.y-o.y,h=o.y+o.height-t.y;return 0<=s&&0<=a&&0<=h&&0<=c}if(this.type===g.ELLIPSE){var l=i/2,u=n/2,_=r.a*l+r.c*u+r.tx,d=r.b*l+r.d*u+r.ty,f=t.x-_,p=t.y-d;return f*f/(l*l)+p*p/(u*u)<1}},onEnable:function(){this._super(),this.spriteFrame&&this.spriteFrame.ensureLoadTexture(),this._refreshStencil(),this.node.on("size-changed",this._refreshStencil,this),this.node.on("anchor-changed",this._refreshStencil,this)},onDisable:function(){this._super(),this.node.off("size-changed",this._refreshStencil,this),this.node.off("anchor-changed",this._refreshStencil,this)},_calculateCircle:function(t,e,i){for(var n=[],r=2*Math.PI/i,o=0;o<i;++o)n.push(cc.v2(e.x*Math.cos(r*o)+t.x,e.y*Math.sin(r*o)+t.y));return n},_refreshStencil:function(){if(this.type!==g.IMAGE_STENCIL||cc._renderType===cc.game.RENDER_TYPE_WEBGL){var t=this.node.getContentSize(),e=this.node.getAnchorPoint(),i=this._clippingStencil;if(this._type===g.IMAGE_STENCIL)i instanceof cc.Scale9Sprite&&i._spriteFrame===this.spriteFrame||((i=new cc.Scale9Sprite).setSpriteFrame(this.spriteFrame),this._sgNode.setStencil(i)),i.setContentSize(t),i.setAnchorPoint(e),this._sgNode.setAlphaThreshold(this.alphaThreshold);else{i instanceof cc.DrawNode||(i=new cc.DrawNode,this._sgNode.setStencil(i));var n=t.width,r=t.height,o=-n*e.x,s=-r*e.y,a=cc.color(255,255,255,0);if(i.clear(),this._type===g.RECT){var c=[cc.v2(o,s),cc.v2(o+n,s),cc.v2(o+n,s+r),cc.v2(o,s+r)];i.drawPoly(c,a,0,a)}else if(this._type===g.ELLIPSE){var h=cc.v2(o+n/2,s+r/2),l={x:n/2,y:r/2};i.drawPoly(this._calculateCircle(h,l,this._segements),a,0,a)}}this._sgNode.setInverted(this.inverted),this._clippingStencil=i,cc.renderer.childrenOrderDirty=!0}else cc.warnID(4200)}});cc.Mask=e.exports=r},{"../../clipping-nodes/CCClippingNode":18,"../../clipping-nodes/CCClippingNodeCanvasRenderCmd":19,"../../clipping-nodes/CCClippingNodeWebGLRenderCmd":20,"../../shape-nodes/CCDrawNode":210}],62:[function(t,e,i){var d=cc.Enum({HORIZONTAL:0,VERTICAL:1,FILLED:2}),n=cc.Class({name:"cc.ProgressBar",extends:t("./CCComponent"),editor:!1,_initBarSprite:function(){if(this.barSprite){var t=this.barSprite.node;if(!t)return;var e=this.node.getContentSize(),i=this.node.getAnchorPoint(),n=t.getContentSize();t.parent===this.node&&this.node.setContentSize(n),this.barSprite.fillType===cc.Sprite.FillType.RADIAL&&(this.mode=d.FILLED);var r=t.getContentSize();if(this.mode===d.HORIZONTAL?this.totalLength=r.width:this.mode===d.VERTICAL?this.totalLength=r.height:this.totalLength=this.barSprite.fillRange,t.parent===this.node){var o=-e.width*i.x;t.setPosition(cc.p(o,0))}}},_updateBarStatus:function(){if(this.barSprite){var t=this.barSprite.node;if(!t)return;var e,i,n,r=t.getAnchorPoint(),o=t.getContentSize(),s=t.getPosition(),a=cc.p(0,.5),c=cc.clamp01(this.progress),h=this.totalLength*c;switch(this.mode){case d.HORIZONTAL:this.reverse&&(a=cc.p(1,.5)),e=cc.size(h,o.height),i=this.totalLength,n=o.height;break;case d.VERTICAL:a=this.reverse?cc.p(.5,1):cc.p(.5,0),e=cc.size(o.width,h),i=o.width,n=this.totalLength}if(this.mode===d.FILLED)this.barSprite.type!==cc.Sprite.Type.FILLED?cc.warn("ProgressBar FILLED mode only works when barSprite's Type is FILLED!"):(this.reverse&&(h*=-1),this.barSprite.fillRange=h);else if(this.barSprite.type!==cc.Sprite.Type.FILLED){var l=a.x-r.x,u=a.y-r.y,_=cc.p(i*l,n*u);t.setPosition(cc.pAdd(s,_)),t.setAnchorPoint(a),t.setContentSize(e)}else cc.warn("ProgressBar non-FILLED mode only works when barSprite's Type is non-FILLED!")}},properties:{barSprite:{default:null,type:cc.Sprite,tooltip:!1,notify:function(){this._initBarSprite()},animatable:!1},mode:{default:d.HORIZONTAL,type:d,tooltip:!1,notify:function(){if(this.barSprite){var t=this.barSprite.node;if(!t)return;var e=t.getContentSize();this.mode===d.HORIZONTAL?this.totalLength=e.width:this.mode===d.VERTICAL?this.totalLength=e.height:this.mode===d.FILLED&&(this.totalLength=this.barSprite.fillRange)}},animatable:!1},_N$totalLength:1,totalLength:{range:[0,Number.MAX_VALUE],tooltip:!1,get:function(){return this._N$totalLength},set:function(t){this.mode===d.FILLED&&(t=cc.clamp01(t)),this._N$totalLength=t,this._updateBarStatus()}},progress:{default:1,type:"Float",range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){this._updateBarStatus()}},reverse:{default:!1,tooltip:!1,notify:function(){this.barSprite&&(this.barSprite.fillStart=1-this.barSprite.fillStart),this._updateBarStatus()},animatable:!1}},statics:{Mode:d}});cc.ProgressBar=e.exports=n},{"./CCComponent":55}],63:[function(t,e,i){var n=cc.Class({extends:t("./CCSGComponent"),name:"cc._RendererInSG",ctor:function(){(this._sgNode=this._createSgNode()).setVisible(!1),this._plainNode=new _ccsg.Node},__preload:function(){this._initSgNode()},onEnable:function(){this._replaceSgNode(this._sgNode)},onDisable:function(){this._replaceSgNode(this._plainNode)},onDestroy:function(){this._removeSgNode()},_replaceSgNode:function(t){var e=this.node,i=e._sgNode;i._entity=null;var n=i.getChildren().slice();i.removeAllChildren(!1),0<t.getChildrenCount()&&t.removeAllChildren(!1);for(var r=0,o=n.length;r<o;++r)t.addChild(n[r]);var s=i.getParent();s&&(s.removeChild(i,!1),s.addChild(t),t._arrivalOrder=i._arrivalOrder,cc.renderer.childrenOrderDirty=s._reorderChildDirty=!0),e._sgNode=t,(e._sgNode._entity=e)._updateSgNode()}});cc._RendererInSG=e.exports=n},{"./CCSGComponent":66}],64:[function(t,e,i){var n=cc.Class({extends:t("./CCSGComponent"),name:"cc._RendererUnderSG",ctor:function(){var t=this._sgNode=this._createSgNode();t&&t.setVisible(!1)},__preload:function(){this._initSgNode(),this._registSizeProvider(),this._appendSgNode(this._sgNode)},onEnable:function(){this._sgNode&&this._sgNode.setVisible(!0)},onDisable:function(){this._sgNode&&this._sgNode.setVisible(!1)},onDestroy:function(){this.node._sizeProvider===this._sgNode&&(this.node._sizeProvider=null),this._removeSgNode()},_appendSgNode:function(t){if(t){var e=this.node;t.setColor(e._color),e._cascadeOpacityEnabled||t.setOpacity(e._opacity),t.setAnchorPoint(e._anchorPoint),t.setOpacityModifyRGB(e._opacityModifyRGB),t.setLocalZOrder(-1),e._sgNode.addChild(t)}}});cc._RendererUnderSG=e.exports=n},{"./CCSGComponent":66}],65:[function(t,e,i){t("../label/CCHtmlTextParser"),t("../label/CCTextUtils");var n=cc.TextAlignment,r=cc.VerticalTextAlignment,o=cc.Class({name:"cc.RichText",extends:cc._RendererUnderSG,ctor:function(){this._textArray=null,this._labelSegments=[],this._labelSegmentsCache=[],this._linesWidth=[],this.thisArg=null,this._resetState(),this._updateRichTextStatus=this._updateRichText},editor:!1,properties:{string:{default:"<color=#00ff00>Rich</c><color=#0fffff>Text11</color>",multiline:!0,tooltip:!1,notify:function(){this._updateRichTextStatus()}},horizontalAlign:{default:n.LEFT,type:n,tooltip:!1,animatable:!1,notify:function(t){this.horizontalAlign!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},fontSize:{default:24,tooltip:!1,notify:function(t){this.fontSize!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},font:{default:null,type:cc.TTFFont,tooltip:!1,notify:function(t){this.font!==t&&(this._layoutDirty=!0,this.font&&this._onTTFLoaded(),this._updateRichTextStatus())}},maxWidth:{default:0,tooltip:!1,notify:function(t){this.maxWidth!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},lineHeight:{default:24,tooltip:!1,notify:function(t){this.lineHeight!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},imageAtlas:{default:null,type:cc.SpriteAtlas,tooltip:!1,notify:function(t){this.imageAtlas!==t&&(this._layoutDirty=!0,this._updateRichTextStatus())}},handleTouchEvent:{default:!0,tooltip:!1,notify:function(t){this.handleTouchEvent!==t&&this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners())}}},statics:{HorizontalAlign:n,VerticalAlign:r},onEnable:function(){this._super(),this.handleTouchEvent&&this._addEventListeners()},onDisable:function(){this._super(),this.handleTouchEvent&&this._removeEventListeners()},_addEventListeners:function(){this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_removeEventListeners:function(){this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this)},_createSgNode:function(){var t=new _ccsg.Node;t.setCascadeOpacityEnabled(!0);var e=this;return t.setColor=function(){e._updateLabelSegmentTextAttributes()},t._setContentSize=t.setContentSize,t.setContentSize=function(){},t},_updateLabelSegmentTextAttributes:function(){this._labelSegments.forEach(function(t){this._applyTextAttribute(t)}.bind(this))},_initSgNode:function(){this._updateRichText(),this._onTTFLoaded()},_createFontLabel:function(t){return _ccsg.Label.pool.get(t,this.font,null,this.fontSize)},_getFontRawUrl:function(){return this.font instanceof cc.TTFFont?this.font.rawUrl:""},_onTTFLoaded:function(){var t=this._getFontRawUrl();if(t){var e=this;cc.CustomFontLoader.loadTTF(t,function(){e._layoutDirty=!0,e._updateRichText()})}},_measureText:function(i,t){var n=this,e=function(t){var e;return 0===n._labelSegmentsCache.length?(e=n._createFontLabel(t),n._labelSegmentsCache.push(e)):(e=n._labelSegmentsCache[0]).setString(t),e._styleIndex=i,n._applyTextAttribute(e),e.getContentSize().width};return t?e(t):e},_onTouchEnded:function(e){for(var t=this.node.getComponents(cc.Component),i=0;i<this._labelSegments.length;++i){var n=this._labelSegments[i],r=n._clickHandler,o=n._clickType;r&&this._containsTouchLocation(n,e.touch.getLocation())&&(t.forEach(function(t){t.enabledInHierarchy&&t[r]&&(t.thisArg?t[r].call(t.thisArg,e,o):(t[r](e,o),console.log("this.data.thisArgnull")))}),e.stopPropagation())}},_containsTouchLocation:function(t,e){var i=t.getBoundingBoxToWorld();return cc.rectContainsPoint(i,e)},_resetState:function(){var t=this._sgNode;t&&t.removeAllChildren(),this._labelSegments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},_addLabelSegment:function(t,e){var i;return 0===this._labelSegmentsCache.length?i=this._createFontLabel(t):(i=this._labelSegmentsCache.pop()).setString(t),i._styleIndex=e,i._lineCount=this._lineCount,this._applyTextAttribute(i),i.setAnchorPoint(0,0),this._sgNode.addChild(i),this._labelSegments.push(i),i},_updateRichTextWithMaxWidth:function(t,e,i){var n=e;if(0<this._lineOffsetX&&n+this._lineOffsetX>this.maxWidth)for(var r=0;this._lineOffsetX<=this.maxWidth;){var o=this._getFirstWordLen(t,r,t.length),s=t.substr(r,o),a=this._measureText(i,s);if(!(this._lineOffsetX+a<=this.maxWidth)){if(0<r){var c=t.substr(0,r);this._addLabelSegment(c,i),t=t.substr(r,t.length),n=this._measureText(i,t)}this._updateLineInfo();break}this._lineOffsetX+=a,r+=o}if(n>this.maxWidth)for(var h=cc.TextUtils.fragmentText(t,n,this.maxWidth,this._measureText(i)),l=0;l<h.length;++l){var u=h[l],_=this._addLabelSegment(u,i).getContentSize();this._lineOffsetX+=_.width,1<h.length&&l<h.length-1&&this._updateLineInfo()}else this._lineOffsetX+=n,this._addLabelSegment(t,i)},_isLastComponentCR:function(t){return t.length-1===t.lastIndexOf("\n")},_updateLineInfo:function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},_needsUpdateTextLayout:function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;++e){var i=this._textArray[e],n=t[e];if(i.text!=n.text)return!0;if(i.style){if(n.style){if(i.style.size!==n.style.size||i.style.italic!==n.style.italic||i.style.isImage!==n.style.isImage)return!0;if(i.style.isImage===n.style.isImage&&i.style.src!==n.style.src)return!0}else if(i.style.size||i.style.italic||i.style.isImage)return!0}else if(n.style&&(n.style.size||n.style.italic||n.style.isImage))return!0}return!1},_onSpriteFrameLoaded:function(t,e){var i;(i=e||t.target).__sprite.setSpriteFrame(i)},_applySpriteFrame:function(t){t&&(t.textureLoaded()?this._onSpriteFrameLoaded(null,t):(t.once("load",this._onSpriteFrameLoaded,this),t.ensureLoadTexture()))},_addRichTextImageElement:function(t){var e=t.style.src,i=this.imageAtlas.getSpriteFrame(e);if(i){var n=new cc.Scale9Sprite;n.setAnchorPoint(0,0),i.__sprite=n,this._sgNode.addChild(n),this._labelSegments.push(n);var r=i.getRect(),o=1,s=r.width,a=r.height,c=t.style.imageWidth,h=t.style.imageHeight;0<h&&h<this.lineHeight?s*=o=h/a:s*=o=this.lineHeight/a,a*=o,0<c&&(s=c),0<this.maxWidth?(this._lineOffsetX+s>this.maxWidth&&this._updateLineInfo(),this._lineOffsetX+=s):(this._lineOffsetX+=s,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),this._applySpriteFrame(i),n.setContentSize(s,a),n._lineCount=this._lineCount,t.style.event&&t.style.event.click&&(n._clickHandler=t.style.event.click,n._clickType=t.style.event.eventType)}else cc.warnID(4400)},__string:"",_updateRichText:function(){if(this.enabled&&this.__string!=this.string){this.__string=this.string;var t=cc.htmlTextParser.parse(this.string);if(!this._needsUpdateTextLayout(t))return this._textArray=t,void this._updateLabelSegmentTextAttributes();this._textArray=t,this._resetState();for(var e,i=!1,n=0;n<this._textArray.length;++n){var r=this._textArray[n],o=r.text;if(""===o){if(r.style&&r.style.newline){this._updateLineInfo();continue}if(r.style&&r.style.isImage&&this.imageAtlas){this._addRichTextImageElement(r);continue}}for(var s=o.split("\n"),a=0;a<s.length;++a){var c=s[a];if(""!==c)if(i=!1,0<this.maxWidth){var h=this._measureText(n,c);this._updateRichTextWithMaxWidth(c,h,n),1<s.length&&a<s.length-1&&this._updateLineInfo()}else e=this._addLabelSegment(c,n).getContentSize(),this._lineOffsetX+=e.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),1<s.length&&a<s.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(o)&&a==s.length-1)continue;this._updateLineInfo(),i=!0}}}i||this._linesWidth.push(this._lineOffsetX),0<this.maxWidth&&(this._labelWidth=this.maxWidth),this._labelHeight=this._lineCount*this.lineHeight,this.node.setContentSize(this._labelWidth,this._labelHeight),this._sgNode._setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},_getFirstWordLen:function(t,e,i){var n=t.charAt(e);if(cc.TextUtils.isUnicodeCJK(n)||cc.TextUtils.isUnicodeSpace(n))return 1;for(var r=1,o=e+1;o<i&&(n=t.charAt(o),!cc.TextUtils.isUnicodeSpace(n)&&!cc.TextUtils.isUnicodeCJK(n));++o)r++;return r},_updateRichTextPosition:function(){for(var t=0,e=1,i=this._lineCount,n=0;n<this._labelSegments.length;++n){var r=this._labelSegments[n],o=r._lineCount;e<o&&(t=0,e=o);var s=0;switch(this.horizontalAlign){case cc.TextAlignment.LEFT:s=0;break;case cc.TextAlignment.CENTER:s=(this._labelWidth-this._linesWidth[o-1])/2;break;case cc.TextAlignment.RIGHT:s=this._labelWidth-this._linesWidth[o-1]}r.setPositionX(t+s);var a=r.getContentSize(),c=(i-o)*this.lineHeight;r instanceof cc.Scale9Sprite&&(c+=(this.lineHeight-r.getContentSize().height)/2),r.setPositionY(c),o===e&&(t+=a.width)}},_convertLiteralColorValue:function(t){var e=t.toUpperCase();return cc.Color[e]?cc.Color[e]:cc.hexToColor(t)},_applyTextAttribute:function(t){if(!(t instanceof cc.Scale9Sprite)){var e=t._styleIndex;t.setLineHeight(this.lineHeight),t.setVerticalAlign(r.CENTER);var i=null;this._textArray[e]&&(i=this._textArray[e].style),i&&i.color?t.setColor(this._convertLiteralColorValue(i.color)):t.setColor(this.node.color),i&&i.bold?t.enableBold(!0):t.enableBold(!1),i&&i.italic?t.enableItalics(!0):t.enableItalics(!1),i&&i.underline?t.enableUnderline(!0):t.enableUnderline(!1),i&&i.outline?(t.setOutlined(!0),t.setOutlineColor(this._convertLiteralColorValue(i.outline.color)),t.setOutlineWidth(i.outline.width),t.setMargin(i.outline.width)):(t.setOutlined(!1),t.setMargin(0)),i&&i.size?t.setFontSize(i.size):t.setFontSize(this.fontSize),i&&i.event&&i.event.click&&(t._clickHandler=i.event.click,t._clickType=i.event.eventType)}},onDestroy:function(){this._super();for(var t=0;t<this._labelSegments.length;++t)this._labelSegments[t].removeFromParent(!0),_ccsg.Label.pool.put(this._labelSegments[t]);this._resetState()}});cc.RichText=e.exports=o},{"../label/CCHtmlTextParser":98,"../label/CCTextUtils":102}],66:[function(t,e,i){var n=t("../utils/scene-graph-helper"),r=cc.Class({extends:t("./CCComponent"),name:"cc._SGComponent",editor:!1,properties:{_sgNode:{default:null,serializable:!1}},_createSgNode:null,_initSgNode:null,_removeSgNode:n.removeSgNode,_registSizeProvider:function(){this.node._sizeProvider||(this.node._sizeProvider=this._sgNode)}});cc._SGComponent=e.exports=r},{"../utils/scene-graph-helper":176,"./CCComponent":55}],67:[function(t,e,i){var _=cc.Enum({HORIZONTAL:0,VERTICAL:1}),n=cc.Class({name:"cc.Scrollbar",extends:t("./CCComponent"),editor:!1,properties:{_scrollView:null,_touching:!1,_autoHideRemainingTime:{default:0,serializable:!1},_opacity:255,handle:{default:null,type:cc.Sprite,tooltip:!1,notify:function(){this._onScroll(cc.p(0,0))},animatable:!1},direction:{default:_.HORIZONTAL,type:_,tooltip:!1,notify:function(){this._onScroll(cc.p(0,0))},animatable:!1},enableAutoHide:{default:!0,animatable:!1,tooltip:!1},autoHideTime:{default:1,animatable:!1,tooltip:!1}},statics:{Direction:_},setTargetScrollView:function(t){this._scrollView=t},_convertToScrollViewSpace:function(t){var e=t.convertToWorldSpace(cc.p(0,0));return this._scrollView.node.convertToNodeSpace(e)},_setOpacity:function(t){this.handle&&this.node.setOpacity(t)},_onScroll:function(t){if(this._scrollView){var e=this._scrollView.content;if(e){var i=e.getContentSize(),n=this._scrollView.node.getContentSize(),r=this.node.getContentSize();if(this._conditionalDisableScrollBar(i,n))return;this.enableAutoHide&&(this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity));var o=0,s=0,a=0,c=0,h=0;this.direction===_.HORIZONTAL?(o=i.width,s=n.width,h=r.width,a=t.x,c=-this._convertToScrollViewSpace(e).x):this.direction===_.VERTICAL&&(o=i.height,s=n.height,h=r.height,a=t.y,c=-this._convertToScrollViewSpace(e).y);var l=this._calculateLength(o,s,h,a),u=this._calculatePosition(o,s,h,c,a,l);this._updateLength(l),this._updateHanlderPosition(u)}}},_updateHanlderPosition:function(t){if(this.handle){var e=this._fixupHandlerPosition();this.handle.node.setPosition(cc.pAdd(t,e))}},_fixupHandlerPosition:function(){var t=this.node.getContentSize(),e=this.node.getAnchorPoint(),i=this.handle.node.getContentSize(),n=this.handle.node.parent,r=this.node.convertToWorldSpaceAR(cc.p(-t.width*e.x,-t.height*e.y)),o=n.convertToNodeSpaceAR(r);return this.direction===_.HORIZONTAL?o=cc.pAdd(o,cc.p(0,(t.height-i.height)/2)):this.direction===_.VERTICAL&&(o=cc.pAdd(o,cc.p((t.width-i.width)/2,0))),this.handle.node.setPosition(o),o},_onTouchBegan:function(){this.enableAutoHide&&(this._touching=!0)},_conditionalDisableScrollBar:function(t,e){return t.width<=e.width&&this.direction===_.HORIZONTAL||t.height<=e.height&&this.direction===_.VERTICAL},_onTouchEnded:function(){if(this.enableAutoHide&&(this._touching=!1,!(this.autoHideTime<=0))){if(this._scrollView){var t=this._scrollView.content;if(t){var e=t.getContentSize(),i=this._scrollView.node.getContentSize();if(this._conditionalDisableScrollBar(e,i))return}}this._autoHideRemainingTime=this.autoHideTime}},_calculateLength:function(t,e,i,n){var r=t;return n&&(r+=20*(0<n?n:-n)),i*(e/r)},_calculatePosition:function(t,e,i,n,r,o){var s=t-e;r&&(s+=Math.abs(r));var a=0;s&&(a=n/s,a=cc.clamp01(a));var c=(i-o)*a;return this.direction===_.VERTICAL?cc.p(0,c):cc.p(c,0)},_updateLength:function(t){if(this.handle){var e=this.handle.node,i=e.getContentSize();e.setAnchorPoint(cc.p(0,0)),this.direction===_.HORIZONTAL?e.setContentSize(t,i.height):e.setContentSize(i.width,t)}},_processAutoHide:function(t){if(this.enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this.autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var e=this._opacity*(this._autoHideRemainingTime/this.autoHideTime);this._setOpacity(e)}},start:function(){this.enableAutoHide&&this._setOpacity(0)},hide:function(){this._autoHideRemainingTime=0,this._setOpacity(0)},show:function(){this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity)},update:function(t){this._processAutoHide(t)}});cc.Scrollbar=e.exports=n},{"./CCComponent":55}],68:[function(t,e,i){var n=function(){return(new Date).getMilliseconds()},r=cc.Enum({SCROLL_TO_TOP:0,SCROLL_TO_BOTTOM:1,SCROLL_TO_LEFT:2,SCROLL_TO_RIGHT:3,SCROLLING:4,BOUNCE_TOP:5,BOUNCE_BOTTOM:6,BOUNCE_LEFT:7,BOUNCE_RIGHT:8,SCROLL_ENDED:9,TOUCH_UP:10,AUTOSCROLL_ENDED_WITH_THRESHOLD:11,SCROLL_BEGAN:12}),o={"scroll-to-top":r.SCROLL_TO_TOP,"scroll-to-bottom":r.SCROLL_TO_BOTTOM,"scroll-to-left":r.SCROLL_TO_LEFT,"scroll-to-right":r.SCROLL_TO_RIGHT,scrolling:r.SCROLLING,"bounce-bottom":r.BOUNCE_BOTTOM,"bounce-left":r.BOUNCE_LEFT,"bounce-right":r.BOUNCE_RIGHT,"bounce-top":r.BOUNCE_TOP,"scroll-ended":r.SCROLL_ENDED,"touch-up":r.TOUCH_UP,"scroll-ended-with-threshold":r.AUTOSCROLL_ENDED_WITH_THRESHOLD,"scroll-began":r.SCROLL_BEGAN},s=cc.Class({name:"cc.ScrollView",extends:t("./CCViewGroup"),editor:!1,ctor:function(){this._topBoundary=0,this._bottomBoundary=0,this._leftBoundary=0,this._rightBoundary=0,this._touchMoveDisplacements=[],this._touchMoveTimeDeltas=[],this._touchMovePreviousTimestamp=0,this._touchMoved=!1,this._autoScrolling=!1,this._autoScrollAttenuate=!1,this._autoScrollStartPosition=cc.p(0,0),this._autoScrollTargetDelta=cc.p(0,0),this._autoScrollTotalTime=0,this._autoScrollAccumulatedTime=0,this._autoScrollCurrentlyOutOfBoundary=!1,this._autoScrollBraking=!1,this._autoScrollBrakingStartPosition=cc.p(0,0),this._outOfBoundaryAmount=cc.p(0,0),this._outOfBoundaryAmountDirty=!0,this._stopMouseWheel=!1,this._mouseWheelEventElapsedTime=0,this._isScrollEndedWithThresholdEventFired=!1,this._scrollEventEmitMask=0,this._isBouncing=!1,this._scrolling=!1},properties:{content:{default:void 0,type:cc.Node,tooltip:!1},horizontal:{default:!0,animatable:!1,tooltip:!1},vertical:{default:!0,animatable:!1,tooltip:!1},inertia:{default:!0,tooltip:!1},brake:{default:.5,type:"Float",range:[0,1,.1],tooltip:!1},elastic:{default:!0,animatable:!1,tooltip:!1},bounceDuration:{default:1,range:[0,10],tooltip:!1},horizontalScrollBar:{default:void 0,type:cc.Scrollbar,tooltip:!1,notify:function(){this.horizontalScrollBar&&(this.horizontalScrollBar.setTargetScrollView(this),this._updateScrollBar(0))},animatable:!1},verticalScrollBar:{default:void 0,type:cc.Scrollbar,tooltip:!1,notify:function(){this.verticalScrollBar&&(this.verticalScrollBar.setTargetScrollView(this),this._updateScrollBar(0))},animatable:!1},scrollEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1},cancelInnerEvents:{default:!0,animatable:!1,tooltip:!1}},statics:{EventType:r},scrollToBottom:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(0,0),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i,!0)},scrollToTop:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(0,1),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(0,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(1,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToTopLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(0,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToTopRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(1,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToBottomLeft:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(0,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToBottomRight:function(t,e){var i=this._calculateMovePercentDelta({anchor:cc.p(1,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(i,t,!1!==e):this._moveContent(i)},scrollToOffset:function(t,e,i){var n=this.getMaxScrollOffset(),r=cc.p(0,0);0===n.x?r.x=0:r.x=t.x/n.x,0===n.y?r.y=1:r.y=(n.y-t.y)/n.y,this.scrollTo(r,e,i)},getScrollOffset:function(){var t=this._getContentTopBoundary()-this._topBoundary,e=this._getContentLeftBoundary()-this._leftBoundary;return cc.p(e,t)},getMaxScrollOffset:function(){var t=this.node.getContentSize(),e=this.content.getContentSize(),i=e.width-t.width,n=e.height-t.height;return i=0<=i?i:0,n=0<=n?n:0,cc.p(i,n)},scrollToPercentHorizontal:function(t,e,i){var n=this._calculateMovePercentDelta({anchor:cc.p(t,0),applyToHorizontal:!0,applyToVertical:!1});e?this._startAutoScroll(n,e,!1!==i):this._moveContent(n)},scrollTo:function(t,e,i){var n=this._calculateMovePercentDelta({anchor:t,applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(n,e,!1!==i):this._moveContent(n)},scrollToPercentVertical:function(t,e,i){var n=this._calculateMovePercentDelta({anchor:cc.p(0,t),applyToHorizontal:!1,applyToVertical:!0});e?this._startAutoScroll(n,e,!1!==i):this._moveContent(n)},stopAutoScroll:function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},setContentPosition:function(t){cc.pFuzzyEqual(t,this.getContentPosition(),1e-4)||(this.content.setPosition(t),this._outOfBoundaryAmountDirty=!0)},getContentPosition:function(){return this.content.getPosition()},isScrolling:function(){return this._scrolling},isAutoScrolling:function(){return this._autoScrolling},_registerEvent:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.on(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},_unregisterEvent:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this,!0),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this,!0),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.off(cc.Node.EventType.MOUSE_WHEEL,this._onMouseWheel,this,!0)},_onMouseWheel:function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){var i=cc.p(0,0);this.vertical?i=cc.p(0,-.1*t.getScrollY()):this.horizontal&&(i=cc.p(-.1*t.getScrollY(),0)),this._mouseWheelEventElapsedTime=0,this._processDeltaMove(i),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60),this._stopMouseWheel=!0),this._stopPropagationIfTargetIsMe(t)}},_checkMouseWheel:function(t){var e=this._getHowMuchOutOfBoundary();if(!cc.pFuzzyEqual(e,cc.p(0,0),1e-4))return this._processInertiaScroll(),this.unschedule(this._checkMouseWheel),void(this._stopMouseWheel=!1);this._mouseWheelEventElapsedTime+=t,.1<this._mouseWheelEventElapsedTime&&(this._onScrollBarTouchEnded(),this.unschedule(this._checkMouseWheel),this._stopMouseWheel=!1)},_calculateMovePercentDelta:function(t){var e=t.anchor,i=t.applyToHorizontal,n=t.applyToVertical;this._calculateBoundary(),e=cc.pClamp(e,cc.p(0,0),cc.p(1,1));var r=this.node.getContentSize(),o=this.content.getContentSize(),s=this._getContentBottomBoundary()-this._bottomBoundary;s=-s;var a=this._getContentLeftBoundary()-this._leftBoundary;a=-a;var c=cc.p(0,0),h=0;return i&&(h=o.width-r.width,c.x=a-h*e.x),n&&(h=o.height-r.height,c.y=s-h*e.y),c},_moveContentToTopLeft:function(t){var e=this.content.getContentSize(),i=this._getContentBottomBoundary()-this._bottomBoundary;i=-i;var n=cc.p(0,0),r=0,o=this._getContentLeftBoundary()-this._leftBoundary;o=-o,e.height<t.height?(r=e.height-t.height,n.y=i-r,this.verticalScrollBar&&this.verticalScrollBar.hide()):this.verticalScrollBar&&this.verticalScrollBar.show(),e.width<t.width?(r=e.width-t.width,n.x=o,this.horizontalScrollBar&&this.horizontalScrollBar.hide()):this.horizontalScrollBar&&this.horizontalScrollBar.show(),this._moveContent(n),this._adjustContentOutOfBoundary()},_calculateBoundary:function(){if(this.content){var t=this.content.getComponent(cc.Layout);t&&t.enabledInHierarchy&&t.updateLayout();var e=this.node.getContentSize(),i=this._convertToContentParentSpace(cc.p(0,0));this._leftBoundary=i.x,this._bottomBoundary=i.y;var n=this._convertToContentParentSpace(cc.p(e.width,e.height));this._rightBoundary=n.x,this._topBoundary=n.y,this._moveContentToTopLeft(e)}},_convertToContentParentSpace:function(t){var e=this.node.convertToWorldSpace(t);return this.content.parent.convertToNodeSpaceAR(e)},_hasNestedViewGroup:function(t,e){if(t.eventPhase===cc.Event.CAPTURING_PHASE){if(e)for(var i=0;i<e.length;++i){var n=e[i];if(this.node===n)return!!t.target.getComponent(cc.ViewGroup);if(n.getComponent(cc.ViewGroup))return!0}return!1}},_stopPropagationIfTargetIsMe:function(t){t.eventPhase===cc.Event.AT_TARGET&&t.target===this.node&&t.stopPropagation()},_onTouchBegan:function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){var i=t.touch;this.content&&this._handlePressLogic(i),this._touchMoved=!1,this._stopPropagationIfTargetIsMe(t)}},_onTouchMoved:function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){var i=t.touch;if(this.content&&this._handleMoveLogic(i),this.cancelInnerEvents){var n=cc.pSub(i.getLocation(),i.getStartLocation());if(7<cc.pLength(n)&&!this._touchMoved&&t.target!==this.node){var r=new cc.Event.EventTouch(t.getTouches(),t.bubbles);r.type=cc.Node.EventType.TOUCH_CANCEL,r.touch=t.touch,r.simulate=!0,t.target.dispatchEvent(r),this._touchMoved=!0}this._stopPropagationIfTargetIsMe(t)}}},_onTouchEnded:function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){this._dispatchEvent("touch-up");var i=t.touch;this.content&&this._handleReleaseLogic(i),this._touchMoved?t.stopPropagation():this._stopPropagationIfTargetIsMe(t)}},_onTouchCancelled:function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){if(!t.simulate){var i=t.touch;this.content&&this._handleReleaseLogic(i)}this._stopPropagationIfTargetIsMe(t)}},_processDeltaMove:function(t){this._scrollChildren(t),this._gatherTouchMove(t)},_handleMoveLogic:function(t){var e=t.getDelta();this._processDeltaMove(e)},_scrollChildren:function(t){var e,i=t=this._clampDelta(t);this.elastic&&(e=this._getHowMuchOutOfBoundary(),i.x*=0===e.x?1:.5,i.y*=0===e.y?1:.5),this.elastic||(e=this._getHowMuchOutOfBoundary(i),i=cc.pAdd(i,e));var n=-1;0<i.y?this.content.y-this.content.anchorY*this.content.height+i.y>this._bottomBoundary&&(n="scroll-to-bottom"):i.y<0?this.content.y-this.content.anchorY*this.content.height+this.content.height+i.y<=this._topBoundary&&(n="scroll-to-top"):i.x<0?this.content.x-this.content.anchorX*this.content.width+this.content.width+i.x<=this._rightBoundary&&(n="scroll-to-right"):0<i.x&&this.content.x-this.content.anchorX*this.content.width+i.x>=this._leftBoundary&&(n="scroll-to-left"),this._moveContent(i,!1),0===i.x&&0===i.y||(this._scrolling||(this._scrolling=!0,this._dispatchEvent("scroll-began")),this._dispatchEvent("scrolling")),-1!==n&&this._dispatchEvent(n)},_handlePressLogic:function(){this._autoScrolling&&this._dispatchEvent("scroll-ended"),this._autoScrolling=!1,this._isBouncing=!1,this._touchMovePreviousTimestamp=n(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._onScrollBarTouchBegan()},_clampDelta:function(t){var e=this.content.getContentSize(),i=this.node.getContentSize();return e.width<i.width&&(t.x=0),e.height<i.height&&(t.y=0),t},_gatherTouchMove:function(t){for(t=this._clampDelta(t);5<=this._touchMoveDisplacements.length;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(t);var e=n();this._touchMoveTimeDeltas.push((e-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=e},_startBounceBackIfNeeded:function(){if(!this.elastic)return!1;var t=this._getHowMuchOutOfBoundary();if(t=this._clampDelta(t),cc.pFuzzyEqual(t,cc.p(0,0),1e-4))return!1;var e=Math.max(this.bounceDuration,0);return this._startAutoScroll(t,e,!0),this._isBouncing||(0<t.y&&this._dispatchEvent("bounce-top"),t.y<0&&this._dispatchEvent("bounce-bottom"),0<t.x&&this._dispatchEvent("bounce-right"),t.x<0&&this._dispatchEvent("bounce-left"),this._isBouncing=!0),!0},_processInertiaScroll:function(){if(!this._startBounceBackIfNeeded()&&this.inertia){var t=this._calculateTouchMoveVelocity();!cc.pFuzzyEqual(t,cc.p(0,0),1e-4)&&this.brake<1&&this._startInertiaScroll(t)}this._onScrollBarTouchEnded()},_handleReleaseLogic:function(t){var e=t.getDelta();this._gatherTouchMove(e),this._processInertiaScroll(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent("scroll-ended"))},_isOutOfBoundary:function(){var t=this._getHowMuchOutOfBoundary();return!cc.pFuzzyEqual(t,cc.p(0,0),1e-4)},_isNecessaryAutoScrollBrake:function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,this._autoScrollBrakingStartPosition=this.getContentPosition(),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},getScrollEndedEventTiming:function(){return 1e-4},_processAutoScrolling:function(t){var e=this._isNecessaryAutoScrollBrake(),i=e?.05:1;this._autoScrollAccumulatedTime+=t*(1/i);var n,r=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(n=r,r=(n-=1)*n*n*n*n+1);var o=cc.pAdd(this._autoScrollStartPosition,cc.pMult(this._autoScrollTargetDelta,r)),s=Math.abs(r-1)<=1e-4;if(Math.abs(r-1)<=this.getScrollEndedEventTiming()&&!this._isScrollEndedWithThresholdEventFired&&(this._dispatchEvent("scroll-ended-with-threshold"),this._isScrollEndedWithThresholdEventFired=!0),this.elastic){var a=cc.pSub(o,this._autoScrollBrakingStartPosition);e&&(a=cc.pMult(a,i)),o=cc.pAdd(this._autoScrollBrakingStartPosition,a)}else{var c=cc.pSub(o,this.getContentPosition()),h=this._getHowMuchOutOfBoundary(c);cc.pFuzzyEqual(h,cc.p(0,0),1e-4)||(o=cc.pAdd(o,h),s=!0)}s&&(this._autoScrolling=!1);var l=cc.pSub(o,this.getContentPosition());this._moveContent(l,s),this._dispatchEvent("scrolling"),this._autoScrolling||(this._isBouncing=!1,this._dispatchEvent("scroll-ended"))},_startInertiaScroll:function(t){var e=cc.pMult(t,.7);this._startAttenuatingAutoScroll(e,t)},_calculateAttenuatedFactor:function(t){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*t+t*t*8e-9))},_startAttenuatingAutoScroll:function(t,e){var i=this._calculateAutoScrollTimeByInitalSpeed(cc.pLength(e)),n=cc.pNormalize(t),r=this.content.getContentSize(),o=this.node.getContentSize(),s=r.width-o.width,a=r.height-o.height,c=this._calculateAttenuatedFactor(s),h=this._calculateAttenuatedFactor(a);n=cc.p(n.x*s*(1-this.brake)*c,n.y*a*h*(1-this.brake));var l=cc.pLength(t),u=cc.pLength(n)/l;n=cc.pAdd(n,t),0<this.brake&&7<u&&(u=Math.sqrt(u),n=cc.pAdd(cc.pMult(t,u),t)),0<this.brake&&3<u&&(i*=u=3),0===this.brake&&1<u&&(i*=u),this._startAutoScroll(n,i,!0)},_calculateAutoScrollTimeByInitalSpeed:function(t){return Math.sqrt(Math.sqrt(t/5))},_startAutoScroll:function(t,e,i){var n=this._flattenVectorByDirection(t);this._autoScrolling=!0,this._autoScrollTargetDelta=n,this._autoScrollAttenuate=i,this._autoScrollStartPosition=this.getContentPosition(),this._autoScrollTotalTime=e,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._isScrollEndedWithThresholdEventFired=!1,this._autoScrollBrakingStartPosition=cc.p(0,0);var r=this._getHowMuchOutOfBoundary();if(!cc.pFuzzyEqual(r,cc.p(0,0),1e-4)){this._autoScrollCurrentlyOutOfBoundary=!0;var o=this._getHowMuchOutOfBoundary(n);(0<r.x*o.x||0<r.y*o.y)&&(this._autoScrollBraking=!0)}},_calculateTouchMoveVelocity:function(){var t=0;if((t=this._touchMoveTimeDeltas.reduce(function(t,e){return t+e},t))<=0||.5<=t)return cc.p(0,0);var e=cc.p(0,0);return e=this._touchMoveDisplacements.reduce(function(t,e){return cc.pAdd(t,e)},e),cc.p(e.x*(1-this.brake)/t,e.y*(1-this.brake)/t)},_flattenVectorByDirection:function(t){var e=t;return e.x=this.horizontal?e.x:0,e.y=this.vertical?e.y:0,e},_moveContent:function(t,e){var i=this._flattenVectorByDirection(t),n=cc.pAdd(this.getContentPosition(),i);this.setContentPosition(n);var r=this._getHowMuchOutOfBoundary();this._updateScrollBar(r),this.elastic&&e&&this._startBounceBackIfNeeded()},_getContentLeftBoundary:function(){return this.getContentPosition().x-this.content.getAnchorPoint().x*this.content.getContentSize().width},_getContentRightBoundary:function(){var t=this.content.getContentSize();return this._getContentLeftBoundary()+t.width},_getContentTopBoundary:function(){var t=this.content.getContentSize();return this._getContentBottomBoundary()+t.height},_getContentBottomBoundary:function(){return this.getContentPosition().y-this.content.getAnchorPoint().y*this.content.getContentSize().height},_getHowMuchOutOfBoundary:function(t){if(t=t||cc.p(0,0),cc.pFuzzyEqual(t,cc.p(0,0),1e-4)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var e=cc.p(0,0);return this._getContentLeftBoundary()+t.x>this._leftBoundary?e.x=this._leftBoundary-(this._getContentLeftBoundary()+t.x):this._getContentRightBoundary()+t.x<this._rightBoundary&&(e.x=this._rightBoundary-(this._getContentRightBoundary()+t.x)),this._getContentTopBoundary()+t.y<this._topBoundary?e.y=this._topBoundary-(this._getContentTopBoundary()+t.y):this._getContentBottomBoundary()+t.y>this._bottomBoundary&&(e.y=this._bottomBoundary-(this._getContentBottomBoundary()+t.y)),cc.pFuzzyEqual(t,cc.p(0,0),1e-4)&&(this._outOfBoundaryAmount=e,this._outOfBoundaryAmountDirty=!1),this._clampDelta(e)},_updateScrollBar:function(t){this.horizontalScrollBar&&this.horizontalScrollBar._onScroll(t),this.verticalScrollBar&&this.verticalScrollBar._onScroll(t)},_onScrollBarTouchBegan:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchBegan(),this.verticalScrollBar&&this.verticalScrollBar._onTouchBegan()},_onScrollBarTouchEnded:function(){this.horizontalScrollBar&&this.horizontalScrollBar._onTouchEnded(),this.verticalScrollBar&&this.verticalScrollBar._onTouchEnded()},_dispatchEvent:function(t){if("scroll-ended"===t)this._scrollEventEmitMask=0;else if("scroll-to-top"===t||"scroll-to-bottom"===t||"scroll-to-left"===t||"scroll-to-right"===t){var e=1<<o[t];if(this._scrollEventEmitMask&e)return;this._scrollEventEmitMask|=e}cc.Component.EventHandler.emitEvents(this.scrollEvents,this,o[t]),this.node.emit(t,this)},_adjustContentOutOfBoundary:function(){if(this._outOfBoundaryAmountDirty=!0,this._isOutOfBoundary()){var t=this._getHowMuchOutOfBoundary(cc.p(0,0)),e=cc.pAdd(this.getContentPosition(),t);this.content&&(this.content.setPosition(e),this._updateScrollBar(0))}},start:function(){this._calculateBoundary(),this.content&&cc.director.once(cc.Director.EVENT_AFTER_VISIT,this._adjustContentOutOfBoundary,this)},_hideScrollbar:function(){this.horizontalScrollBar&&this.horizontalScrollBar.hide(),this.verticalScrollBar&&this.verticalScrollBar.hide()},_showScrollbar:function(){this.horizontalScrollBar&&this.horizontalScrollBar.show(),this.verticalScrollBar&&this.verticalScrollBar.show()},onDisable:function(){this._unregisterEvent(),this.node.off("size-changed",this._calculateBoundary,this),this.node.off("scale-changed",this._calculateBoundary,this),this.content&&(this.content.off("size-changed",this._calculateBoundary,this),this.content.off("scale-changed",this._calculateBoundary,this)),this._hideScrollbar(),this.stopAutoScroll()},onEnable:function(){this._registerEvent(),this.node.on("size-changed",this._calculateBoundary,this),this.node.on("scale-changed",this._calculateBoundary,this),this.content&&(this.content.on("size-changed",this._calculateBoundary,this),this.content.on("scale-changed",this._calculateBoundary,this)),this._showScrollbar()},update:function(t){this._autoScrolling&&this._processAutoScrolling(t)}});cc.ScrollView=e.exports=s},{"./CCViewGroup":74}],69:[function(t,e,i){var r=cc.Enum({Horizontal:0,Vertical:1}),n=cc.Class({name:"cc.Slider",extends:t("./CCComponent"),editor:!1,ctor:function(){this._dragging=!1},properties:{handle:{default:null,type:cc.Button,tooltip:!1,notify:function(){}},direction:{default:r.Horizontal,type:r,tooltip:!1},progress:{default:.5,type:cc.Float,range:[0,1,.1],slide:!0,tooltip:!1,notify:function(){this._updateHandlePosition()}},slideEvents:{default:[],type:cc.Component.EventHandler,tooltip:!1}},statics:{Direction:r},__preload:function(){this._updateHandlePosition()},onEnable:function(){this.node.on(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.on(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this),this.handle&&this.handle.isValid&&(this.handle.node.on(cc.Node.EventType.TOUCH_START,this._onHandleDragStart,this),this.handle.node.on(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.handle.node.on(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this))},onDisable:function(){this.node.off(cc.Node.EventType.TOUCH_START,this._onTouchBegan,this),this.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this),this.node.off(cc.Node.EventType.TOUCH_CANCEL,this._onTouchCancelled,this),this.handle&&this.handle.isValid&&(this.handle.node.off(cc.Node.EventType.TOUCH_START,this._onHandleDragStart,this),this.handle.node.off(cc.Node.EventType.TOUCH_MOVE,this._onTouchMoved,this),this.handle.node.off(cc.Node.EventType.TOUCH_END,this._onTouchEnded,this))},_onHandleDragStart:function(t){this._dragging=!0,t.stopPropagation()},_onTouchBegan:function(t){this.handle&&(this._dragging=!0,this._handleSliderLogic(t.touch),t.stopPropagation())},_onTouchMoved:function(t){this._dragging&&(this._handleSliderLogic(t.touch),t.stopPropagation())},_onTouchEnded:function(t){this._dragging=!1,t.stopPropagation()},_onTouchCancelled:function(t){this._dragging=!1,t.stopPropagation()},_handleSliderLogic:function(t){this._updateProgress(t),this._emitSlideEvent()},_emitSlideEvent:function(){cc.Component.EventHandler.emitEvents(this.slideEvents,this),this.node.emit("slide",this)},_updateProgress:function(t){if(this.handle){var e=null,i=0,n=this.node.convertTouchToNodeSpaceAR(t);this.direction===r.Horizontal?(e=this.node.width/2-this.handle.node.width*this.handle.node.anchorX,i=cc.clamp01((n.x+e)/(2*e),0,1)):this.direction===r.Vertical&&(e=this.node.height/2-this.handle.node.height*this.handle.node.anchorY,i=cc.clamp01((n.y+e)/(2*e),0,1)),this.progress=i}},_updateHandlePosition:function(){if(this.handle){var t;t=this.direction===r.Horizontal?cc.p(-this.node.width*this.node.anchorX+this.progress*this.node.width,0):cc.p(0,-this.node.height*this.node.anchorY+this.progress*this.node.height);var e=this.node.convertToWorldSpaceAR(t);this.handle.node.position=this.handle.node.parent.convertToNodeSpaceAR(e)}}});cc.Slider=e.exports=n},{"./CCComponent":55}],70:[function(t,e,i){var n=t("./CCRendererUnderSG"),r=cc.Scale9Sprite.RenderingType,o=cc.Scale9Sprite.FillType,s=cc.BlendFunc.BlendFactor,a=cc.Enum({CUSTOM:0,TRIMMED:1,RAW:2}),c=cc.Class({name:"cc.Sprite",extends:n,editor:!1,ctor:function(){this._blendFunc=new cc.BlendFunc(this._srcBlendFactor,this._dstBlendFactor)},properties:{_spriteFrame:{default:null,type:cc.SpriteFrame},_type:r.SIMPLE,_sizeMode:a.TRIMMED,_fillType:0,_fillCenter:cc.v2(0,0),_fillStart:0,_fillRange:0,_isTrimmedMode:!0,_srcBlendFactor:s.SRC_ALPHA,_dstBlendFactor:s.ONE_MINUS_SRC_ALPHA,_atlas:{default:null,type:cc.SpriteAtlas,tooltip:!1,editorOnly:!0,visible:!0,animatable:!1},spriteFrame:{get:function(){return this._spriteFrame},set:function(t,e){var i=this._spriteFrame;i!==t&&(this._spriteFrame=t,this._applySpriteFrame(i))},type:cc.SpriteFrame},type:{get:function(){return this._type},set:function(t){this._type=t,this._sgNode.setRenderingType(t)},type:r,animatable:!1,tooltip:!1},fillType:{get:function(){return this._fillType},set:function(t){this._fillType=t,this._sgNode&&this._sgNode.setFillType(t)},type:o,tooltip:!1},fillCenter:{get:function(){return this._fillCenter},set:function(t){this._fillCenter=cc.v2(t),this._sgNode&&this._sgNode.setFillCenter(this._fillCenter)},tooltip:!1},fillStart:{get:function(){return this._fillStart},set:function(t){this._fillStart=cc.clampf(t,-1,1),this._sgNode&&this._sgNode.setFillStart(t)},tooltip:!1},fillRange:{get:function(){return this._fillRange},set:function(t){this._fillRange=cc.clampf(t,-1,1),this._sgNode&&this._sgNode.setFillRange(t)},tooltip:!1},trim:{get:function(){return this._isTrimmedMode},set:function(t){this._isTrimmedMode!==t&&(this._isTrimmedMode=t,this._sgNode.enableTrimmedContentSize(t))},animatable:!1,tooltip:!1},srcBlendFactor:{get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor=t,this._blendFunc.src=t,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:s,tooltip:!1},dstBlendFactor:{get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor=t,this._blendFunc.dst=t,this._sgNode.setBlendFunc(this._blendFunc)},animatable:!1,type:s,tooltip:!1},sizeMode:{get:function(){return this._sizeMode},set:function(t){(this._sizeMode=t)!==a.CUSTOM&&this._applySpriteSize()},animatable:!1,type:a,tooltip:!1}},statics:{FillType:o,Type:r,SizeMode:a},setVisible:function(t){this.enabled=t},setInsetLeft:function(t){this._sgNode.setInsetLeft(t)},getInsetLeft:function(){return this._sgNode.getInsetLeft()},setInsetTop:function(t){this._sgNode.setInsetTop(t)},getInsetTop:function(){return this._sgNode.getInsetTop()},setInsetRight:function(t){this._sgNode.setInsetRight(t)},getInsetRight:function(){return this._sgNode.getInsetRight()},setInsetBottom:function(t){this._sgNode.setInsetBottom(t)},getInsetBottom:function(){return this._sgNode.getInsetBottom()},onEnable:function(){this._sgNode&&this._spriteFrame&&this._spriteFrame.textureLoaded()&&this._sgNode.setVisible(!0)},_applyAtlas:!1,_applySpriteFrameInsets:function(){var t=this._spriteFrame,e=this._sgNode;e.setInsetTop(t.insetTop),e.setInsetBottom(t.insetBottom),e.setInsetRight(t.insetRight),e.setInsetLeft(t.insetLeft)},_applySpriteSize:function(){if(this._spriteFrame)if(a.RAW===this._sizeMode){var t=this._spriteFrame.getOriginalSize();this.node.setContentSize(t)}else if(a.TRIMMED===this._sizeMode){var e=this._spriteFrame.getRect();this.node.setContentSize(e.width,e.height)}},_onTextureLoaded:function(t){if(this.isValid){var e=this._sgNode;e.setSpriteFrame(this._spriteFrame),this._applySpriteSize(),this.enabledInHierarchy&&!e.isVisible()&&e.setVisible(!0)}},_applySpriteFrame:function(t,e){var i=this._sgNode;t&&t.off&&t.off("load",this._onTextureLoaded,this);var n=this._spriteFrame;n?(e||this._applySpriteFrameInsets(),n.textureLoaded()?this._onTextureLoaded(null):(n.once("load",this._onTextureLoaded,this),n.ensureLoadTexture())):(i.setSpriteFrame(null),i.setVisible(!1))},_createSgNode:function(){return new cc.Scale9Sprite},_initSgNode:function(){var t=this._sgNode,e=0!==t.getInsetLeft()||0!==t.getInsetRight()||0!==t.getInsetTop()||0!==t.getInsetBottom();this._applySpriteFrame(null,e),t.setContentSize(this.node.getContentSize(!0)),this._applySpriteSize(),t.setRenderingType(this._type),t.setFillType(this._fillType),t.setFillCenter(this._fillCenter),t.setFillStart(this._fillStart),t.setFillRange(this._fillRange),t.enableTrimmedContentSize(this._isTrimmedMode),this._blendFunc.src=this._srcBlendFactor,this._blendFunc.dst=this._dstBlendFactor,t.setBlendFunc(this._blendFunc)},_resized:!1});t("../utils/misc").propertyDefine(c,["insetLeft","insetTop","insetRight","insetBottom"],{type:[null,"setRenderingType"]}),cc.Sprite=e.exports=c},{"../utils/misc":173,"./CCRendererUnderSG":64}],71:[function(t,e,i){var n=cc.Class({name:"cc.Toggle",extends:t("./CCButton"),editor:!1,properties:{isChecked:{default:!0,tooltip:!1,notify:function(){this._updateCheckMark()}},toggleGroup:{default:null,tooltip:!1,type:t("./CCToggleGroup")},checkMark:{default:null,type:cc.Sprite,tooltip:!1},checkEvents:{default:[],type:cc.Component.EventHandler},_resizeToTarget:{animatable:!1,set:function(t){t&&this._resizeNodeToTargetNode()}}},onEnable:function(){this._super(),this._registerToggleEvent(),this.toggleGroup&&this.toggleGroup.enabled&&this.toggleGroup.addToggle(this)},onDisable:function(){this._super(),this._unregisterToggleEvent(),this.toggleGroup&&this.toggleGroup.enabled&&this.toggleGroup.removeToggle(this)},_updateCheckMark:function(){this.checkMark&&(this.checkMark.node.active=!!this.isChecked)},_updateDisabledState:function(){this._super(),this.checkMark&&this.checkMark._sgNode.setState(0),this.enableAutoGrayEffect&&this.checkMark&&!this.interactable&&this.checkMark._sgNode.setState(1)},_registerToggleEvent:function(){this.node.on("click",this.toggle,this)},_unregisterToggleEvent:function(){this.node.off("click",this.toggle,this)},toggle:function(t){var e=this.toggleGroup||this._toggleContainer;e&&e.enabled&&this.isChecked&&!e.allowSwitchOff||(this.isChecked=!this.isChecked,this._updateCheckMark(),e&&e.enabled&&e.updateToggles(this),this._emitToggleEvents(t))},_emitToggleEvents:function(){this.node.emit("toggle",this),this.checkEvents&&cc.Component.EventHandler.emitEvents(this.checkEvents,this)},check:function(){var t=this.toggleGroup||this._toggleContainer;t&&t.enabled&&this.isChecked&&!t.allowSwitchOff||(this.isChecked=!0,t&&t.enabled&&t.updateToggles(this),this._emitToggleEvents())},uncheck:function(){var t=this.toggleGroup||this._toggleContainer;t&&t.enabled&&this.isChecked&&!t.allowSwitchOff||(this.isChecked=!1,this._emitToggleEvents())}});cc.Toggle=e.exports=n,t("../platform/js").get(n.prototype,"_toggleContainer",function(){var t=this.node.parent;return cc.Node.isNode(t)?t.getComponent(cc.ToggleContainer):null})},{"../platform/js":144,"./CCButton":53,"./CCToggleGroup":73}],72:[function(t,e,i){var n=cc.Class({name:"cc.ToggleContainer",extends:cc.Component,editor:!1,properties:{allowSwitchOff:{tooltip:!1,default:!1}},updateToggles:function(e){this.toggleItems.forEach(function(t){e.isChecked&&t!==e&&(t.isChecked=!1)})},_allowOnlyOneToggleChecked:function(){var e=!1;return this.toggleItems.forEach(function(t){e?t.isChecked=!1:t.isChecked&&(e=!0)}),e},_makeAtLeastOneToggleChecked:function(){if(!this._allowOnlyOneToggleChecked()&&!this.allowSwitchOff){var t=this.toggleItems;0<t.length&&t[0].check()}},onEnable:function(){this.node.on("child-added",this._allowOnlyOneToggleChecked,this),this.node.on("child-removed",this._makeAtLeastOneToggleChecked,this)},onDisable:function(){this.node.off("child-added",this._allowOnlyOneToggleChecked,this),this.node.off("child-removed",this._makeAtLeastOneToggleChecked,this)},start:function(){this._makeAtLeastOneToggleChecked()}});t("../platform/js").get(n.prototype,"toggleItems",function(){return this.node.getComponentsInChildren(cc.Toggle)}),cc.ToggleContainer=e.exports=n},{"../platform/js":144}],73:[function(t,e,i){var n=cc.Class({name:"cc.ToggleGroup",extends:cc.Component,ctor:function(){this._toggleItems=[]},editor:!1,properties:{allowSwitchOff:{tooltip:!1,default:!1},toggleItems:{get:function(){return this._toggleItems}}},updateToggles:function(e){this.enabledInHierarchy&&this._toggleItems.forEach(function(t){e.isChecked&&t!==e&&t.isChecked&&t.enabled&&(t.isChecked=!1)})},addToggle:function(t){-1===this._toggleItems.indexOf(t)&&this._toggleItems.push(t),this._allowOnlyOneToggleChecked()},removeToggle:function(t){var e=this._toggleItems.indexOf(t);-1<e&&this._toggleItems.splice(e,1),this._makeAtLeastOneToggleChecked()},_allowOnlyOneToggleChecked:function(){var e=!1;return this._toggleItems.forEach(function(t){e&&t.enabled&&(t.isChecked=!1),t.isChecked&&t.enabled&&(e=!0)}),e},_makeAtLeastOneToggleChecked:function(){},start:function(){this._makeAtLeastOneToggleChecked()}}),r=(t("../platform/js"),!1);cc.js.get(cc,"ToggleGroup",function(){return r||(cc.logID(1405,"cc.ToggleGroup","cc.ToggleContainer"),r=!0),n}),cc.ToggleGroup=e.exports=n},{"../platform/js":144}],74:[function(t,e,i){var n=cc.Class({name:"cc.ViewGroup",extends:t("./CCComponent")});cc.ViewGroup=e.exports=n},{"./CCComponent":55}],75:[function(t,e,i){var n=t("../base-ui/CCWidgetManager"),r=n._AlignFlags,o=r.TOP,s=r.MID,a=r.BOT,c=r.LEFT,h=r.CENTER,l=r.RIGHT,u=o|a,_=c|l,d=cc.Class({name:"cc.Widget",extends:t("./CCComponent"),editor:!1,properties:{target:{get:function(){return this._target},set:function(t){this._target=t},type:cc.Node,tooltip:!1},isAlignTop:{get:function(){return 0<(this._alignFlags&o)},set:function(t){this._setAlign(o,t)},animatable:!1,tooltip:!1},isAlignVerticalCenter:{get:function(){return 0<(this._alignFlags&s)},set:function(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=s):this._alignFlags&=~s},animatable:!1,tooltip:!1},isAlignBottom:{get:function(){return 0<(this._alignFlags&a)},set:function(t){this._setAlign(a,t)},animatable:!1,tooltip:!1},isAlignLeft:{get:function(){return 0<(this._alignFlags&c)},set:function(t){this._setAlign(c,t)},animatable:!1,tooltip:!1},isAlignHorizontalCenter:{get:function(){return 0<(this._alignFlags&h)},set:function(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=h):this._alignFlags&=~h},animatable:!1,tooltip:!1},isAlignRight:{get:function(){return 0<(this._alignFlags&l)},set:function(t){this._setAlign(l,t)},animatable:!1,tooltip:!1},isStretchWidth:{get:function(){return(this._alignFlags&_)===_},visible:!1},isStretchHeight:{get:function(){return(this._alignFlags&u)===u},visible:!1},top:{get:function(){return this._top},set:function(t){this._top=t},tooltip:!1},bottom:{get:function(){return this._bottom},set:function(t){this._bottom=t},tooltip:!1},left:{get:function(){return this._left},set:function(t){this._left=t},tooltip:!1},right:{get:function(){return this._right},set:function(t){this._right=t},tooltip:!1},horizontalCenter:{get:function(){return this._horizontalCenter},set:function(t){this._horizontalCenter=t},tooltip:!1},verticalCenter:{get:function(){return this._verticalCenter},set:function(t){this._verticalCenter=t},tooltip:!1},isAbsoluteHorizontalCenter:{get:function(){return this._isAbsHorizontalCenter},set:function(t){this._isAbsHorizontalCenter=t},animatable:!1},isAbsoluteVerticalCenter:{get:function(){return this._isAbsVerticalCenter},set:function(t){this._isAbsVerticalCenter=t},animatable:!1},isAbsoluteTop:{get:function(){return this._isAbsTop},set:function(t){this._isAbsTop=t},animatable:!1},isAbsoluteBottom:{get:function(){return this._isAbsBottom},set:function(t){this._isAbsBottom=t},animatable:!1},isAbsoluteLeft:{get:function(){return this._isAbsLeft},set:function(t){this._isAbsLeft=t},animatable:!1},isAbsoluteRight:{get:function(){return this._isAbsRight},set:function(t){this._isAbsRight=t},animatable:!1},isAlignOnce:{default:!0,tooltip:!1,displayName:"AlignOnce"},_target:null,_alignFlags:0,_left:0,_right:0,_top:0,_bottom:0,_verticalCenter:0,_horizontalCenter:0,_isAbsLeft:!0,_isAbsRight:!0,_isAbsTop:!0,_isAbsBottom:!0,_isAbsHorizontalCenter:!0,_isAbsVerticalCenter:!0,_originalWidth:0,_originalHeight:0},onEnable:function(){n.add(this)},onDisable:function(){n.remove(this)},_setAlign:function(t,e){if(e!=0<(this._alignFlags&t)){var i=0<(t&_);e?(this._alignFlags|=t,i?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=this.node.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=this.node.height))):(i?this.isStretchWidth&&(this.node.width=this._originalWidth):this.isStretchHeight&&(this.node.height=this._originalHeight),this._alignFlags&=~t)}},updateAlignment:function(){n.updateAlignment(this.node)}});cc.Widget=e.exports=d},{"../base-ui/CCWidgetManager":48,"./CCComponent":55}],76:[function(t,e,i){t("./CCComponent"),t("./CCRendererInSG"),t("./CCRendererUnderSG"),t("./CCComponentEventHandler"),t("./missing-script"),e.exports=[t("./CCSprite"),t("./CCWidget"),t("./CCCanvas"),t("./CCAudioSource"),t("./CCAnimation"),t("./CCButton"),t("./CCLabel"),t("./CCProgressBar"),t("./CCMask"),t("./CCScrollBar"),t("./CCScrollView"),t("./CCPageViewIndicator"),t("./CCPageView"),t("./CCSlider"),t("./CCLayout"),t("./CCEditBox"),t("./CCVideoPlayer"),t("./CCWebView"),t("./CCSpriteDistortion"),t("./CCLabelOutline"),t("./CCRichText"),t("./CCToggleContainer"),t("./CCToggleGroup"),t("./CCToggle"),t("./CCBlockInputEvents")]},{"./CCAnimation":50,"./CCAudioSource":51,"./CCBlockInputEvents":52,"./CCButton":53,"./CCCanvas":54,"./CCComponent":55,"./CCComponentEventHandler":56,"./CCEditBox":57,"./CCLabel":58,"./CCLabelOutline":59,"./CCLayout":60,"./CCMask":61,"./CCPageView":218,"./CCPageViewIndicator":218,"./CCProgressBar":62,"./CCRendererInSG":63,"./CCRendererUnderSG":64,"./CCRichText":65,"./CCScrollBar":67,"./CCScrollView":68,"./CCSlider":69,"./CCSprite":70,"./CCSpriteDistortion":218,"./CCToggle":71,"./CCToggleContainer":72,"./CCToggleGroup":73,"./CCVideoPlayer":218,"./CCWebView":218,"./CCWidget":75,"./missing-script":77}],77:[function(t,e,i){var n=cc.js,r=t("../utils/misc").BUILTIN_CLASSID_RE,o=cc.Class({name:"cc.MissingClass",properties:{_$erialized:{default:null,visible:!1,editorOnly:!0}}}),s=cc.Class({name:"cc.MissingScript",extends:cc.Component,editor:{inspector:"packages://inspector/inspectors/comps/missing-script.js"},properties:{compiled:{default:!1,serializable:!1},_$erialized:{default:null,visible:!1,editorOnly:!0}},ctor:!1,statics:{safeFindClass:function(t,e){return n._getClassById(t)||(t?(cc.deserialize.reportMissingClass(t),s.getMissingWrapper(t,e)):null)},getMissingWrapper:function(t,e){return e.node&&(/^[0-9a-zA-Z+/]{23}$/.test(t)||r.test(t))?s:o}},onLoad:function(){cc.warnID(4600,this.node.name)}});cc._MissingScript=e.exports=s},{"../utils/misc":173}],78:[function(t,e,i){var n=t("../platform/utils"),r=t("../platform/CCSys");function o(t){var e=t.convertToWorldSpace(cc.p(0,0)),i=cc.visibleRect.height,n=.5;cc.visibleRect.width>i&&(n=.7),setTimeout(function(){if(window.scrollY<40&&e.y<i*n){var t=i*n-e.y-window.scrollY;t<35&&(t=35),320<t&&(t=320),window.scrollTo(t,t)}},400)}var s=cc.Enum({DEFAULT:0,DONE:1,SEND:2,SEARCH:3,GO:4}),a=cc.Enum({ANY:0,EMAIL_ADDR:1,NUMERIC:2,PHONE_NUMBER:3,URL:4,DECIMAL:5,SINGLE_LINE:6}),c=cc.Enum({PASSWORD:0,SENSITIVE:1,INITIAL_CAPS_WORD:2,INITIAL_CAPS_SENTENCE:3,INITIAL_CAPS_ALL_CHARACTERS:4,DEFAULT:5});cc.EditBoxDelegate=cc._Class.extend({editBoxEditingDidBegan:function(t){},editBoxEditingDidEnded:function(t){},editBoxTextChanged:function(t,e){},editBoxEditingReturn:function(t){}}),_ccsg.EditBox=_ccsg.Node.extend({_backgroundSprite:null,_delegate:null,_editBoxInputMode:a.ANY,_editBoxInputFlag:c.DEFAULT,_keyboardReturnType:s.DEFAULT,_maxLength:50,_text:"",_placeholderText:"",_alwaysOnTop:!1,_placeholderFontName:"",_placeholderFontSize:14,__fullscreen:!1,__autoResize:!1,_placeholderColor:null,_className:"EditBox",ctor:function(t,e){_ccsg.Node.prototype.ctor.call(this),this._textColor=cc.Color.WHITE,this._placeholderColor=cc.Color.GRAY,this.initWithSizeAndBackgroundSprite(t,e),this._renderCmd._createLabels()},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new _ccsg.EditBox.CanvasRenderCmd(this):new _ccsg.EditBox.WebGLRenderCmd(this)},setContentSize:function(t,e){void 0!==t.width&&void 0!==t.height&&(e=t.height,t=t.width),_ccsg.Node.prototype.setContentSize.call(this,t,e),this._updateEditBoxSize(t,e)},setVisible:function(t){_ccsg.Node.prototype.setVisible.call(this,t),this._renderCmd.updateVisibility()},createDomElementIfNeeded:function(){this._renderCmd._edTxt||this._renderCmd.setInputMode(this._editBoxInputMode)},setTabIndex:function(t){this._renderCmd._edTxt&&(this._renderCmd._edTxt.tabIndex=t)},getTabIndex:function(){return this._renderCmd._edTxt?this._renderCmd._edTxt.tabIndex:(cc.warnID(4700),-1)},setFocus:function(){this._renderCmd._edTxt&&this._renderCmd._edTxt.focus()},isFocused:function(){return this._renderCmd._edTxt?document.activeElement===this._renderCmd._edTxt:(cc.warnID(4700),!1)},stayOnTop:function(t){this._alwaysOnTop!==t&&(this._alwaysOnTop=t,this._renderCmd.stayOnTop(this._alwaysOnTop))},cleanup:function(){this._super(),this._renderCmd.removeDom()},_onTouchBegan:function(t){var e=t.getLocation(),i=cc.rect(0,0,this._contentSize.width,this._contentSize.height);return cc.rectContainsPoint(i,this.convertToNodeSpace(e))?(CC_QQPLAY&&this._renderCmd._showBKKeyboard(),!0):(this._renderCmd._endEditing(),!1)},_onTouchEnded:function(){this._renderCmd._beginEditing()},_updateBackgroundSpriteSize:function(t,e){this._backgroundSprite&&this._backgroundSprite.setContentSize(t,e)},_updateEditBoxSize:function(t,e){var i="number"==typeof t.width?t.width:t,n="number"==typeof t.height?t.height:e;this._updateBackgroundSpriteSize(i,n),this._renderCmd.updateSize(i,n)},setLineHeight:function(t){this._renderCmd.setLineHeight(t)},setFont:function(t,e){this._renderCmd.setFont(t,e)},_setFont:function(t){this._renderCmd._setFont(t)},getBackgroundSprite:function(){return this._backgroundSprite},setFontName:function(t){this._renderCmd.setFontName(t)},setFontSize:function(t){this._renderCmd.setFontSize(t)},setString:function(t){t.length>=this._maxLength&&(t=t.slice(0,this._maxLength)),this._text=t,this._renderCmd.setString(t)},setFontColor:function(t){this._textColor=t,this._renderCmd.setFontColor(t)},setMaxLength:function(t){isNaN(t)||(t<0&&(t=65535),this._maxLength=t,this._renderCmd.setMaxLength(t))},getMaxLength:function(){return this._maxLength},setPlaceHolder:function(t){null!==t&&(this._renderCmd.setPlaceHolder(t),this._placeholderText=t)},setPlaceholderFont:function(t,e){this._placeholderFontName=t,this._placeholderFontSize=e,this._renderCmd._updateDOMPlaceholderFontStyle()},_setPlaceholderFont:function(t){var e=cc.LabelTTF._fontStyleRE.exec(t);e&&(this._placeholderFontName=e[2],this._placeholderFontSize=parseInt(e[1]),this._renderCmd._updateDOMPlaceholderFontStyle())},setPlaceholderFontName:function(t){this._placeholderFontName=t,this._renderCmd._updateDOMPlaceholderFontStyle()},setPlaceholderFontSize:function(t){this._placeholderFontSize=t,this._renderCmd._updateDOMPlaceholderFontStyle()},setPlaceholderFontColor:function(t){this._placeholderColor=t,this._renderCmd.setPlaceholderFontColor(t)},setInputFlag:function(t){this._editBoxInputFlag=t,this._renderCmd.setInputFlag(t)},getString:function(){return this._text},initWithSizeAndBackgroundSprite:function(t,e){return this._backgroundSprite&&this._backgroundSprite.removeFromParent(),this._backgroundSprite=e,_ccsg.Node.prototype.setContentSize.call(this,t),this._backgroundSprite&&!this._backgroundSprite.parent&&(this._backgroundSprite.setAnchorPoint(cc.p(0,0)),this.addChild(this._backgroundSprite),this._updateBackgroundSpriteSize(t.width,t.height)),this.x=0,!(this.y=0)},setDelegate:function(t){this._delegate=t},getPlaceHolder:function(){return this._placeholderText},setInputMode:function(t){if(this._editBoxInputMode!==t){var e=this.getString();this._editBoxInputMode=t,this._renderCmd.setInputMode(t),this._renderCmd.transform(),this.setString(e),this._renderCmd._updateLabelPosition(this.getContentSize())}},setReturnType:function(t){this._keyboardReturnType=t,this._renderCmd._updateDomInputType()},initWithBackgroundColor:function(t,e){this._edWidth=t.width,this.dom.style.width=this._edWidth.toString()+"px",this._edHeight=t.height,this.dom.style.height=this._edHeight.toString()+"px",this.dom.style.backgroundColor=cc.colorToHex(e)}});var h,l=_ccsg.EditBox.prototype;cc.defineGetterSetter(l,"font",null,l._setFont),cc.defineGetterSetter(l,"fontName",null,l.setFontName),cc.defineGetterSetter(l,"fontSize",null,l.setFontSize),cc.defineGetterSetter(l,"fontColor",null,l.setFontColor),cc.defineGetterSetter(l,"string",l.getString,l.setString),cc.defineGetterSetter(l,"maxLength",l.getMaxLength,l.setMaxLength),cc.defineGetterSetter(l,"placeholder",l.getPlaceHolder,l.setPlaceHolder),cc.defineGetterSetter(l,"placeholderFont",null,l._setPlaceholderFont),cc.defineGetterSetter(l,"placeholderFontName",null,l.setPlaceholderFontName),cc.defineGetterSetter(l,"placeholderFontSize",null,l.setPlaceholderFontSize),cc.defineGetterSetter(l,"placeholderFontColor",null,l.setPlaceholderFontColor),cc.defineGetterSetter(l,"inputFlag",null,l.setInputFlag),cc.defineGetterSetter(l,"delegate",null,l.setDelegate),cc.defineGetterSetter(l,"inputMode",null,l.setInputMode),cc.defineGetterSetter(l,"returnType",null,l.setReturnType),l=null,_ccsg.EditBox.InputMode=a,_ccsg.EditBox.InputFlag=c,_ccsg.EditBox.KeyboardReturnType=s,(h=_ccsg.EditBox)._polyfill={zoomInvalid:!1},r.OS_ANDROID!==r.os||r.browserType!==r.BROWSER_TYPE_SOUGOU&&r.browserType!==r.BROWSER_TYPE_360||(h._polyfill.zoomInvalid=!0),function(p){var t=function(){}.prototype=Object.create(Object.prototype);t.updateMatrix=function(){if(this._edTxt){var t=this._node,e=cc.view._scaleX,i=cc.view._scaleY,n=cc.view._devicePixelRatio,r=this._worldTransform;e/=n,i/=n;var o=cc.game.container,s=r.a*e,a=r.b,c=r.c,h=r.d*i,l=o&&o.style.paddingLeft&&parseInt(o.style.paddingLeft),u=o&&o.style.paddingBottom&&parseInt(o.style.paddingBottom),_=r.tx*e+l,d=r.ty*i+u;p.zoomInvalid&&(this.updateSize(t._contentSize.width*s,t._contentSize.height*h),h=s=1);var f="matrix("+s+","+-a+","+-c+","+h+","+_+","+-d+")";this._edTxt.style.transform=f,this._edTxt.style["-webkit-transform"]=f,this._edTxt.style["transform-origin"]="0px 100% 0px",this._edTxt.style["-webkit-transform-origin"]="0px 100% 0px"}},t.updateVisibility=function(){this._edTxt&&(this._node.visible?this._edTxt.style.visibility="visible":this._edTxt.style.visibility="hidden")},t.stayOnTop=function(t){t?(this._removeLabels(),this._edTxt.style.display=""):(this._createLabels(),this._edTxt.style.display="none",this._showLabels())},t._beginEditingOnMobile=function(t){this.__orientationChanged=function(){o(t)},window.addEventListener("orientationchange",this.__orientationChanged),cc.view.isAutoFullScreenEnabled()?(this.__fullscreen=!0,cc.view.enableAutoFullScreen(!1),cc.screen.exitFullScreen()):this.__fullscreen=!1,this.__autoResize=cc.view.__resizeWithBrowserSize,cc.view.resizeWithBrowserSize(!1)},t._endEditingOnMobile=function(){this.__rotateScreen&&("undefined"!=typeof engine&&engine.endEditOnMobile&&engine.endEditOnMobile(),this.__rotateScreen=!1),window.removeEventListener("orientationchange",this.__orientationChanged),window.scrollTo(0,0),this.__fullscreen&&cc.view.enableAutoFullScreen(!0),this.__autoResize&&cc.view.resizeWithBrowserSize(!0)},t._onFocusOnMobile=function(t){cc.view._isRotated?(cc.view._isRotated=!1,"undefined"!=typeof engine&&engine.endEditOnMobile&&engine.focusOnMobile(),cc.view._isRotated=!0,this.__rotateScreen=!0):this.__rotateScreen=!1,o(t)},t._createDomInput=function(){this.removeDom();var i=this,t=this._edTxt=document.createElement("input");function e(t){var e=i._editBox;t.value.length>t.maxLength&&(t.value=t.value.slice(0,t.maxLength)),e._delegate&&e._delegate.editBoxTextChanged&&e._text!==t.value&&(e._text=t.value,i._updateDomTextCases(),e._delegate.editBoxTextChanged(e,e._text))}t.type="text",t.style.fontSize=this._edFontSize+"px",t.style.color="#000000",t.style.border=0,t.style.background="transparent",t.style.width="100%",t.style.height="100%",t.style.active=0,t.style.outline="medium",t.style.padding="0",t.style.textTransform="uppercase",t.style.display="none",t.style.position="absolute",t.style.bottom="0px",t.style.left="2px",t.style["-moz-appearance"]="textfield";var n=!(t.style.className="cocosEditBox");return t.addEventListener("compositionstart",function(){n=!0}),t.addEventListener("compositionend",function(){n=!1,e(this)}),t.addEventListener("input",function(){n||e(this)}),t.addEventListener("keypress",function(t){var e=i._editBox;t.keyCode===cc.KEY.enter&&(t.stopPropagation(),t.preventDefault(),""===this.value&&(this.style.fontSize=e._placeholderFontSize+"px",this.style.color=cc.colorToHex(e._placeholderColor)),e._text=this.value,i._updateDomTextCases(),i._endEditing(),e._delegate&&e._delegate.editBoxEditingReturn&&e._delegate.editBoxEditingReturn(e),cc._canvas.focus())}),t.addEventListener("focus",function(){var t=i._editBox;this.style.fontSize=i._edFontSize+"px",this.style.color=cc.colorToHex(t._textColor),i._hiddenLabels(),r.isMobile&&i._onFocusOnMobile(t),t._delegate&&t._delegate.editBoxEditingDidBegan&&t._delegate.editBoxEditingDidBegan(t)}),t.addEventListener("blur",function(){var t=i._editBox;t._text=this.value,i._updateDomTextCases(),t._delegate&&t._delegate.editBoxEditingDidEnded&&t._delegate.editBoxEditingDidEnded(t),""===this.value&&(this.style.fontSize=t._placeholderFontSize+"px",this.style.color=cc.colorToHex(t._placeholderColor)),i._endEditing()}),this._addDomToGameContainer(),t},t._createDomTextArea=function(){this.removeDom();var i=this,t=this._edTxt=document.createElement("textarea");function e(t){t.value.length>t.maxLength&&(t.value=t.value.slice(0,t.maxLength));var e=i._editBox;e._delegate&&e._delegate.editBoxTextChanged&&e._text.toLowerCase()!==t.value.toLowerCase()&&(e._text=t.value,i._updateDomTextCases(),e._delegate.editBoxTextChanged(e,e._text))}t.type="text",t.style.fontSize=this._edFontSize+"px",t.style.color="#000000",t.style.border=0,t.style.background="transparent",t.style.width="100%",t.style.height="100%",t.style.active=0,t.style.outline="medium",t.style.padding="0",t.style.resize="none",t.style.textTransform="uppercase",t.style.overflow_y="scroll",t.style.display="none",t.style.position="absolute",t.style.bottom="0px",t.style.left="2px";var n=!(t.style.className="cocosEditBox");return t.addEventListener("compositionstart",function(){n=!0}),t.addEventListener("compositionend",function(){n=!1,e(this)}),t.addEventListener("input",function(){n||e(this)}),t.addEventListener("focus",function(){var t=i._editBox;i._hiddenLabels(),this.style.fontSize=i._edFontSize+"px",this.style.color=cc.colorToHex(t._textColor),r.isMobile&&i._onFocusOnMobile(t),t._delegate&&t._delegate.editBoxEditingDidBegan&&t._delegate.editBoxEditingDidBegan(t)}),t.addEventListener("keypress",function(t){var e=i._editBox;t.keyCode===cc.KEY.enter&&(t.stopPropagation(),e._delegate&&e._delegate.editBoxEditingReturn&&e._delegate.editBoxEditingReturn(e))}),t.addEventListener("blur",function(){var t=i._editBox;t._text=this.value,i._updateDomTextCases(),t._delegate&&t._delegate.editBoxEditingDidEnded&&t._delegate.editBoxEditingDidEnded(t),""===this.value&&(this.style.fontSize=t._placeholderFontSize+"px",this.style.color=cc.colorToHex(t._placeholderColor)),i._endEditing()}),this._addDomToGameContainer(),t},CC_QQPLAY&&(t._onBKBtnClick=function(t){var e=this._editBox;e._text=t,this._updateDomTextCases(),this._endEditing(),e._delegate&&e._delegate.editBoxEditingReturn&&e._delegate.editBoxEditingReturn(e),e._delegate&&e._delegate.editBoxEditingDidEnded&&e._delegate.editBoxEditingDidEnded(e)},t._onBKTextChange=function(t){var e=this._editBox;e._delegate&&e._delegate.editBoxTextChanged&&e._text!==t&&(e._text=t,this._updateDomTextCases(),e._delegate.editBoxTextChanged(e,e._text))},t._createBKInput=function(t){this._edTxt=document.createElement("input")},t._showBKKeyboard=function(){BK.Editor.showKeyBoard(this._onBKBtnClick.bind(this),this._onBKTextChange.bind(this));var t=this._editBox;t._delegate&&t._delegate.editBoxEditingDidBegan&&t._delegate.editBoxEditingDidBegan(t)}),t._createWXInput=function(t){this.removeDom();var i=this,e=this._edTxt=document.createElement("input");e.type="text",e.focus=function(){var e=i._editBox;wx.showKeyboard({defaultValue:e._text,maxLength:140,multiple:t,confirmHold:!0,confirmType:"done",success:function(t){e._delegate&&e._delegate.editBoxEditingDidBegan&&e._delegate.editBoxEditingDidBegan(e)},fail:function(t){cc.warn(t.errMsg),i._endEditing()}}),wx.onKeyboardConfirm(function(t){e._text=t.value,i._updateDomTextCases(),e._delegate&&e._delegate.editBoxEditingReturn&&e._delegate.editBoxEditingReturn(e),wx.hideKeyboard({success:function(t){e._delegate&&e._delegate.editBoxEditingDidEnded&&e._delegate.editBoxEditingDidEnded(e)},fail:function(t){cc.warn(t.errMsg)}})}),wx.onKeyboardInput(function(t){e._delegate&&e._delegate.editBoxTextChanged&&e._text!==t.value&&(e._text=t.value,i._updateDomTextCases(),e._delegate.editBoxTextChanged(e,e._text))}),wx.onKeyboardComplete(function(){i._endEditing(),wx.offKeyboardConfirm(),wx.offKeyboardInput(),wx.offKeyboardComplete()})}},t._createLabels=function(){var t=this._editBox.getContentSize();this._textLabel||(this._textLabel=_ccsg.Label.pool.get(),this._textLabel.setAnchorPoint(cc.p(0,1)),this._textLabel.setOverflow(_ccsg.Label.Overflow.CLAMP),this._editBox.addChild(this._textLabel,100)),this._placeholderLabel||(this._placeholderLabel=_ccsg.Label.pool.get(),this._placeholderLabel.setAnchorPoint(cc.p(0,1)),this._placeholderLabel.setColor(cc.Color.GRAY),this._editBox.addChild(this._placeholderLabel,100)),this._updateLabelPosition(t)},t._removeLabels=function(){this._textLabel&&(this._editBox.removeChild(this._textLabel),this._textLabel=null)},t._updateLabelPosition=function(t){if(this._textLabel&&this._placeholderLabel){var e=cc.size(t.width-2,t.height);this._textLabel.setContentSize(e),this._placeholderLabel.setLineHeight(t.height);var i=this._placeholderLabel.getContentSize();this._editBox._editBoxInputMode===a.ANY?(this._textLabel.setPosition(2,t.height),this._placeholderLabel.setPosition(2,t.height),this._placeholderLabel.setVerticalAlign(cc.VerticalTextAlignment.TOP),this._textLabel.setVerticalAlign(cc.VerticalTextAlignment.TOP),this._textLabel.enableWrapText(!0)):(this._textLabel.enableWrapText(!1),this._textLabel.setPosition(2,t.height),this._placeholderLabel.setPosition(2,(t.height+i.height)/2),this._placeholderLabel.setVerticalAlign(cc.VerticalTextAlignment.CENTER),this._textLabel.setVerticalAlign(cc.VerticalTextAlignment.CENTER))}},t.setLineHeight=function(t){this._textLabel&&this._textLabel.setLineHeight(t)},t._hiddenLabels=function(){this._textLabel&&this._textLabel.setVisible(!1),this._placeholderLabel&&this._placeholderLabel.setVisible(!1)},t._updateDomTextCases=function(){var t,e=this._editBox._editBoxInputFlag;e===c.INITIAL_CAPS_ALL_CHARACTERS?this._editBox._text=this._editBox._text.toUpperCase():e===c.INITIAL_CAPS_WORD?this._editBox._text=this._editBox._text.replace(/(?:^|\s)\S/g,function(t){return t.toUpperCase()}):e===c.INITIAL_CAPS_SENTENCE&&(this._editBox._text=(t=this._editBox._text).charAt(0).toUpperCase()+t.slice(1))},t._updateLabelStringStyle=function(){if("password"===this._edTxt.type){for(var t="",e=this._editBox._text.length,i=0;i<e;++i)t+="";this._textLabel&&this._textLabel.setString(t)}else this._updateDomTextCases(),this._textLabel&&this._textLabel.setString(this._editBox._text)},t._showLabels=function(){this._hiddenLabels(),""===(CC_QQPLAY?this._editBox._text:this._edTxt.value)?this._placeholderLabel&&(this._placeholderLabel.setVisible(!0),this._placeholderLabel.setString(this._editBox._placeholderText)):this._textLabel&&(this._textLabel.setVisible(!0),this._textLabel.setString(this._editBox._text)),this._updateLabelStringStyle()},t._beginEditing=function(){var t=this;if(r.platform===r.WECHAT_GAME)this._edTxt.focus();else if(!t._editBox._alwaysOnTop&&r.platform!==r.QQ_PLAY&&"none"===t._edTxt.style.display){function e(){t._edTxt.focus()}t._edTxt.style.display="",r.browserType===r.BROWSER_TYPE_UC?setTimeout(e,400):r.browserType===r.BROWSER_TYPE_FIREFOX?setTimeout(e,0):e()}r.isMobile&&!t._editingMode&&r.platform!==r.QQ_PLAY&&t._beginEditingOnMobile(t._editBox),t._editingMode=!0},t._endEditing=function(){if(this._editBox._alwaysOnTop||r.platform===r.QQ_PLAY||(this._edTxt.style.display="none"),this._showLabels(),r.platform!==r.WECHAT_GAME&&r.platform!==r.QQ_PLAY&&r.isMobile&&this._editingMode){var t=this;setTimeout(function(){t._endEditingOnMobile()},400)}this._editingMode=!1},t._setFont=function(t){var e=cc.LabelTTF._fontStyleRE.exec(t),i=e[2],n=parseInt(e[1]);e&&this.setFont(i,n)},t.setFont=function(t,e){this._edFontName=t||this._edFontName,this._edFontSize=e||this._edFontSize,this._updateDOMFontStyle()},t.setFontName=function(t){this._edFontName=t||this._edFontName,this._updateDOMFontStyle()},t.setFontSize=function(t){this._edFontSize=t||this._edFontSize,this._updateDOMFontStyle()},t.setFontColor=function(t){this._edTxt&&(this._edTxt.value!==this._editBox._placeholderText&&(this._edTxt.style.color=cc.colorToHex(t)),this._textLabel&&this._textLabel.setColor(t))},t.setPlaceHolder=function(t){this._placeholderLabel.setString(t)},t.setMaxLength=function(t){this._edTxt&&(this._edTxt.maxLength=t)},t._updateDOMPlaceholderFontStyle=function(){this._placeholderLabel.setFontFamily(this._editBox._placeholderFontName),this._placeholderLabel.setFontSize(this._editBox._placeholderFontSize)},t.setPlaceholderFontColor=function(t){this._placeholderLabel.setColor(t)},t._updateDomInputType=function(){if(this._edTxt){var t=this._editBox._editBoxInputMode;t===a.EMAIL_ADDR?this._edTxt.type="email":t===a.NUMERIC||t===a.DECIMAL?this._edTxt.type="number":t===a.PHONE_NUMBER?(this._edTxt.type="number",this._edTxt.pattern="[0-9]*"):t===a.URL?this._edTxt.type="url":(this._edTxt.type="text",this._editBox._keyboardReturnType===s.SEARCH&&(this._edTxt.type="search")),this._editBox._editBoxInputFlag===c.PASSWORD&&(this._edTxt.type="password")}},t.setInputFlag=function(t){this._edTxt&&(this._updateDomInputType(),this._edTxt.style.textTransform="none",t===c.INITIAL_CAPS_ALL_CHARACTERS?this._edTxt.style.textTransform="uppercase":t===c.INITIAL_CAPS_WORD&&(this._edTxt.style.textTransform="capitalize"),this._updateLabelStringStyle())},t.setInputMode=function(t){r.platform===r.WECHAT_GAME?this._createWXInput(t===a.ANY):CC_QQPLAY?this._createBKInput(t===a.ANY):t===a.ANY?this._createDomTextArea():this._createDomInput(),this._updateDomInputType();var e=this._node.getContentSize();this.updateSize(e.width,e.height)},t.setString=function(t){this._edTxt&&null!==t&&(""===(this._edTxt.value=t)?(this._placeholderLabel&&(this._placeholderLabel.setString(this._editBox._placeholderText),this._placeholderLabel.setColor(this._editBox._placeholderColor)),this._editingMode||(this._placeholderLabel&&this._placeholderLabel.setVisible(!0),this._textLabel&&this._textLabel.setVisible(!1))):(this._edTxt.style.color=cc.colorToHex(this._editBox._textColor),this._textLabel&&this._textLabel.setColor(this._editBox._textColor),this._editingMode||(this._placeholderLabel&&this._placeholderLabel.setVisible(!1),this._textLabel&&this._textLabel.setVisible(!0)),this._updateLabelStringStyle()))},t._updateDOMFontStyle=function(){this._edTxt&&(this._edTxt.style.fontFamily=this._edFontName,this._edTxt.style.fontSize=this._edFontSize+"px",this._textLabel&&(this._textLabel.setFontSize(this._edFontSize),this._textLabel.setFontFamily(this._edFontName)))},t.updateSize=function(t,e){var i=this._edTxt;i&&(i.style.width=t+"px",i.style.height=e+"px",this._updateLabelPosition(cc.size(t,e)))},t._addDomToGameContainer=function(){cc.game.container.appendChild(this._edTxt)},t.removeDom=function(){var t=this._edTxt;t&&n.contains(cc.game.container,t)&&cc.game.container.removeChild(t),this._edTxt=null},t.initializeRenderCmd=function(t){this._editBox=t,this._edFontSize=14,this._edFontName="Arial",this._textLabel=null,this._placeholderLabel=null,this._editingMode=!1,this.__fullscreen=!1,this.__autoResize=!1,this.__rotateScreen=!1,this.__orientationChanged=null},_ccsg.EditBox.CanvasRenderCmd=function(t){this._rootCtor(t),this.initializeRenderCmd(t)};var e=_ccsg.EditBox.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);cc.js.mixin(e,t),e.constructor=_ccsg.EditBox.CanvasRenderCmd,e.transform=function(t,e){this.originTransform(t,e),this.updateMatrix()},_ccsg.EditBox.WebGLRenderCmd=function(t){this._rootCtor(t),this.initializeRenderCmd(t)};var i=_ccsg.EditBox.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);cc.js.mixin(i,t),i.constructor=_ccsg.EditBox.WebGLRenderCmd,i.transform=function(t,e){this.originTransform(t,e),this.updateMatrix()}}(_ccsg.EditBox._polyfill)},{"../platform/CCSys":132,"../platform/utils":148}],79:[function(t,e,i){var n=cc.js;t("../event/event");var r=function(t,e){cc.Event.call(this,cc.Event.MOUSE,e),this._eventType=t,this._button=0,this._x=0,this._y=0,this._prevX=0,this._prevY=0,this._scrollX=0,this._scrollY=0};n.extend(r,cc.Event);var o=r.prototype;o.setScrollData=function(t,e){this._scrollX=t,this._scrollY=e},o.getScrollX=function(){return this._scrollX},o.getScrollY=function(){return this._scrollY},o.setLocation=function(t,e){this._x=t,this._y=e},o.getLocation=function(){return{x:this._x,y:this._y}},o.getLocationInView=function(){return{x:this._x,y:cc.view._designResolutionSize.height-this._y}},o._setPrevCursor=function(t,e){this._prevX=t,this._prevY=e},o.getPreviousLocation=function(){return{x:this._prevX,y:this._prevY}},o.getDelta=function(){return{x:this._x-this._prevX,y:this._y-this._prevY}},o.getDeltaX=function(){return this._x-this._prevX},o.getDeltaY=function(){return this._y-this._prevY},o.setButton=function(t){this._button=t},o.getButton=function(){return this._button},o.getLocationX=function(){return this._x},o.getLocationY=function(){return this._y},r.NONE=0,r.DOWN=1,r.UP=2,r.MOVE=3,r.SCROLL=4,r.BUTTON_LEFT=0,r.BUTTON_RIGHT=2,r.BUTTON_MIDDLE=1,r.BUTTON_4=3,r.BUTTON_5=4,r.BUTTON_6=5,r.BUTTON_7=6,r.BUTTON_8=7;var s=function(t,e){cc.Event.call(this,cc.Event.TOUCH,e),this._eventCode=0,this._touches=t||[],this.touch=null,this.currentTouch=null};n.extend(s,cc.Event),(o=s.prototype).getEventCode=function(){return this._eventCode},o.getTouches=function(){return this._touches},o._setEventCode=function(t){this._eventCode=t},o._setTouches=function(t){this._touches=t},o.setLocation=function(t,e){this.touch&&this.touch.setTouchInfo(this.touch.getID(),t,e)},o.getLocation=function(){return this.touch?this.touch.getLocation():cc.v2()},o.getLocationInView=function(){return this.touch?this.touch.getLocationInView():cc.v2()},o.getPreviousLocation=function(){return this.touch?this.touch.getPreviousLocation():cc.v2()},o.getStartLocation=function(){return this.touch?this.touch.getStartLocation():cc.v2()},o.getID=function(){return this.touch?this.touch.getID():null},o.getDelta=function(){return this.touch?this.touch.getDelta():cc.v2()},o.getDeltaX=function(){return this.touch?this.touch.getDelta().x:0},o.getDeltaY=function(){return this.touch?this.touch.getDelta().y:0},o.getLocationX=function(){return this.touch?this.touch.getLocationX():0},o.getLocationY=function(){return this.touch?this.touch.getLocationY():0},s.MAX_TOUCHES=5,s.BEGAN=0,s.MOVED=1,s.ENDED=2,s.CANCELED=3;var a=function(t,e){cc.Event.call(this,cc.Event.ACCELERATION,e),this.acc=t};n.extend(a,cc.Event);var c=function(t,e,i){cc.Event.call(this,cc.Event.KEYBOARD,i),this.keyCode=t,this.isPressed=e};n.extend(c,cc.Event),cc.Event.EventMouse=r,cc.Event.EventTouch=s,cc.Event.EventAcceleration=a,cc.Event.EventKeyboard=c,e.exports=cc.Event},{"../event/event":86}],80:[function(t,e,i){cc.EventListener=cc._Class.extend({ctor:function(t,e,i){this._onEvent=i,this._type=t||0,this._listenerID=e||"",this._registered=!1,this._fixedPriority=0,this._node=null,this._target=null,this._paused=!0,this._isEnabled=!0},_setPaused:function(t){this._paused=t},_isPaused:function(){return this._paused},_setRegistered:function(t){this._registered=t},_isRegistered:function(){return this._registered},_getType:function(){return this._type},_getListenerID:function(){return this._listenerID},_setFixedPriority:function(t){this._fixedPriority=t},_getFixedPriority:function(){return this._fixedPriority},_setSceneGraphPriority:function(t){this._target=t,this._node=t},_getSceneGraphPriority:function(){return this._node},checkAvailable:function(){return null!==this._onEvent},clone:function(){return null},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},retain:function(){},release:function(){}}),cc.EventListener.UNKNOWN=0,cc.EventListener.TOUCH_ONE_BY_ONE=1,cc.EventListener.TOUCH_ALL_AT_ONCE=2,cc.EventListener.KEYBOARD=3,cc.EventListener.MOUSE=4,cc.EventListener.ACCELERATION=6,cc.EventListener.CUSTOM=8,cc._EventListenerCustom=cc.EventListener.extend({_onCustomEvent:null,ctor:function(t,e){this._onCustomEvent=e,cc.EventListener.prototype.ctor.call(this,cc.EventListener.CUSTOM,t,this._callback)},_callback:function(t){null!==this._onCustomEvent&&this._onCustomEvent(t)},checkAvailable:function(){return cc.EventListener.prototype.checkAvailable.call(this)&&null!==this._onCustomEvent},clone:function(){return new cc._EventListenerCustom(this._listenerID,this._onCustomEvent)}}),cc._EventListenerMouse=cc.EventListener.extend({onMouseDown:null,onMouseUp:null,onMouseMove:null,onMouseScroll:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.MOUSE,cc._EventListenerMouse.LISTENER_ID,this._callback)},_callback:function(t){var e=cc.Event.EventMouse;switch(t._eventType){case e.DOWN:this.onMouseDown&&this.onMouseDown(t);break;case e.UP:this.onMouseUp&&this.onMouseUp(t);break;case e.MOVE:this.onMouseMove&&this.onMouseMove(t);break;case e.SCROLL:this.onMouseScroll&&this.onMouseScroll(t)}},clone:function(){var t=new cc._EventListenerMouse;return t.onMouseDown=this.onMouseDown,t.onMouseUp=this.onMouseUp,t.onMouseMove=this.onMouseMove,t.onMouseScroll=this.onMouseScroll,t},checkAvailable:function(){return!0}}),cc._EventListenerMouse.LISTENER_ID="__cc_mouse",cc._EventListenerTouchOneByOne=cc.EventListener.extend({_claimedTouches:null,swallowTouches:!1,onTouchBegan:null,onTouchMoved:null,onTouchEnded:null,onTouchCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ONE_BY_ONE,cc._EventListenerTouchOneByOne.LISTENER_ID,null),this._claimedTouches=[]},setSwallowTouches:function(t){this.swallowTouches=t},isSwallowTouches:function(){return this.swallowTouches},clone:function(){var t=new cc._EventListenerTouchOneByOne;return t.onTouchBegan=this.onTouchBegan,t.onTouchMoved=this.onTouchMoved,t.onTouchEnded=this.onTouchEnded,t.onTouchCancelled=this.onTouchCancelled,t.swallowTouches=this.swallowTouches,t},checkAvailable:function(){return!!this.onTouchBegan||(cc.logID(1801),!1)}}),cc._EventListenerTouchOneByOne.LISTENER_ID="__cc_touch_one_by_one",cc._EventListenerTouchAllAtOnce=cc.EventListener.extend({onTouchesBegan:null,onTouchesMoved:null,onTouchesEnded:null,onTouchesCancelled:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.TOUCH_ALL_AT_ONCE,cc._EventListenerTouchAllAtOnce.LISTENER_ID,null)},clone:function(){var t=new cc._EventListenerTouchAllAtOnce;return t.onTouchesBegan=this.onTouchesBegan,t.onTouchesMoved=this.onTouchesMoved,t.onTouchesEnded=this.onTouchesEnded,t.onTouchesCancelled=this.onTouchesCancelled,t},checkAvailable:function(){return null!==this.onTouchesBegan||null!==this.onTouchesMoved||null!==this.onTouchesEnded||null!==this.onTouchesCancelled||(cc.logID(1802),!1)}}),cc._EventListenerTouchAllAtOnce.LISTENER_ID="__cc_touch_all_at_once",cc.EventListener.create=function(t){cc.assertID(t&&t.event,1900);var e=t.event;delete t.event;var i=null;for(var n in e===cc.EventListener.TOUCH_ONE_BY_ONE?i=new cc._EventListenerTouchOneByOne:e===cc.EventListener.TOUCH_ALL_AT_ONCE?i=new cc._EventListenerTouchAllAtOnce:e===cc.EventListener.MOUSE?i=new cc._EventListenerMouse:e===cc.EventListener.CUSTOM?(i=new cc._EventListenerCustom(t.eventName,t.callback),delete t.eventName,delete t.callback):e===cc.EventListener.KEYBOARD?i=new cc._EventListenerKeyboard:e===cc.EventListener.ACCELERATION&&(i=new cc._EventListenerAcceleration(t.callback),delete t.callback),t)i[n]=t[n];return i},cc._EventListenerAcceleration=cc.EventListener.extend({_onAccelerationEvent:null,ctor:function(t){this._onAccelerationEvent=t,cc.EventListener.prototype.ctor.call(this,cc.EventListener.ACCELERATION,cc._EventListenerAcceleration.LISTENER_ID,this._callback)},_callback:function(t){this._onAccelerationEvent(t.acc,t)},checkAvailable:function(){return cc.assertID(this._onAccelerationEvent,1803),!0},clone:function(){return new cc._EventListenerAcceleration(this._onAccelerationEvent)}}),cc._EventListenerAcceleration.LISTENER_ID="__cc_acceleration",cc._EventListenerKeyboard=cc.EventListener.extend({onKeyPressed:null,onKeyReleased:null,ctor:function(){cc.EventListener.prototype.ctor.call(this,cc.EventListener.KEYBOARD,cc._EventListenerKeyboard.LISTENER_ID,this._callback)},_callback:function(t){t.isPressed?this.onKeyPressed&&this.onKeyPressed(t.keyCode,t):this.onKeyReleased&&this.onKeyReleased(t.keyCode,t)},clone:function(){var t=new cc._EventListenerKeyboard;return t.onKeyPressed=this.onKeyPressed,t.onKeyReleased=this.onKeyReleased,t},checkAvailable:function(){return null!==this.onKeyPressed||null!==this.onKeyReleased||(cc.logID(1800),!1)}}),cc._EventListenerKeyboard.LISTENER_ID="__cc_keyboard"},{}],81:[function(t,e,i){var n=t("../platform/js"),r=cc._Class.extend({ctor:function(){this._fixedListeners=[],this._sceneGraphListeners=[],this.gt0Index=0},size:function(){return this._fixedListeners.length+this._sceneGraphListeners.length},empty:function(){return 0===this._fixedListeners.length&&0===this._sceneGraphListeners.length},push:function(t){0===t._getFixedPriority()?this._sceneGraphListeners.push(t):this._fixedListeners.push(t)},clearSceneGraphListeners:function(){this._sceneGraphListeners.length=0},clearFixedListeners:function(){this._fixedListeners.length=0},clear:function(){this._sceneGraphListeners.length=0,this._fixedListeners.length=0},getFixedPriorityListeners:function(){return this._fixedListeners},getSceneGraphPriorityListeners:function(){return this._sceneGraphListeners}}),c={DIRTY_NONE:0,DIRTY_FIXED_PRIORITY:1,DIRTY_SCENE_GRAPH_PRIORITY:2,DIRTY_ALL:3,_listenersMap:{},_priorityDirtyFlagMap:{},_nodeListenersMap:{},_nodePriorityMap:{},_globalZOrderNodeMap:{},_toAddedListeners:[],_toRemovedListeners:[],_dirtyNodes:[],_inDispatch:0,_isEnabled:!1,_nodePriorityIndex:0,_internalCustomListenerIDs:[],_setDirtyForNode:function(t){if(void 0!==this._nodeListenersMap[t.__instanceId]&&this._dirtyNodes.push(t),t.getChildren)for(var e=t.getChildren(),i=0,n=e?e.length:0;i<n;i++)this._setDirtyForNode(e[i])},pauseTarget:function(t,e){if(t instanceof cc._BaseNode||t instanceof _ccsg.Node){var i,n,r=this._nodeListenersMap[t.__instanceId];if(r)for(i=0,n=r.length;i<n;i++)r[i]._setPaused(!0);if(!0===e){var o=t.getChildren();for(i=0,n=o?o.length:0;i<n;i++)this.pauseTarget(o[i],!0)}}else cc.warnID(3506)},resumeTarget:function(t,e){if(t instanceof cc._BaseNode||t instanceof _ccsg.Node){var i,n,r=this._nodeListenersMap[t.__instanceId];if(r)for(i=0,n=r.length;i<n;i++)r[i]._setPaused(!1);if(this._setDirtyForNode(t),!0===e&&t.getChildren){var o=t.getChildren();for(i=0,n=o?o.length:0;i<n;i++)this.resumeTarget(o[i],!0)}}else cc.warnID(3506)},_addListener:function(t){0===this._inDispatch?this._forceAddEventListener(t):this._toAddedListeners.push(t)},_forceAddEventListener:function(t){var e=t._getListenerID(),i=this._listenersMap[e];if(i||(i=new r,this._listenersMap[e]=i),i.push(t),0===t._getFixedPriority()){this._setDirty(e,this.DIRTY_SCENE_GRAPH_PRIORITY);var n=t._getSceneGraphPriority();null===n&&cc.logID(3507),this._associateNodeAndEventListener(n,t),n.isRunning()&&this.resumeTarget(n)}else this._setDirty(e,this.DIRTY_FIXED_PRIORITY)},_getListeners:function(t){return this._listenersMap[t]},_updateDirtyFlagForSceneGraph:function(){if(0!==this._dirtyNodes.length){for(var t,e,i=this._dirtyNodes,n=this._nodeListenersMap,r=0,o=i.length;r<o;r++)if(t=n[i[r].__instanceId])for(var s=0,a=t.length;s<a;s++)(e=t[s])&&this._setDirty(e._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY);this._dirtyNodes.length=0}},_removeAllListenersInVector:function(t){if(t)for(var e,i=0;i<t.length;)(e=t[i])._setRegistered(!1),null!=e._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(e._getSceneGraphPriority(),e),e._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.remove(t,e):++i},_removeListenersForListenerID:function(t){var e,i=this._listenersMap[t];if(i){var n=i.getFixedPriorityListeners(),r=i.getSceneGraphPriorityListeners();this._removeAllListenersInVector(r),this._removeAllListenersInVector(n),delete this._priorityDirtyFlagMap[t],this._inDispatch||(i.clear(),delete this._listenersMap[t])}var o,s=this._toAddedListeners;for(e=0;e<s.length;)(o=s[e])&&o._getListenerID()===t?cc.js.array.remove(s,o):++e},_sortEventListeners:function(t){var e=this.DIRTY_NONE,i=this._priorityDirtyFlagMap;if(i[t]&&(e=i[t]),e!==this.DIRTY_NONE&&(i[t]=this.DIRTY_NONE,e&this.DIRTY_FIXED_PRIORITY&&this._sortListenersOfFixedPriority(t),e&this.DIRTY_SCENE_GRAPH_PRIORITY)){var n=cc.director.getScene();n&&this._sortListenersOfSceneGraphPriority(t,n)}},_sortListenersOfSceneGraphPriority:function(t,e){var i=this._getListeners(t);if(i){var n=i.getSceneGraphPriorityListeners();n&&0!==n.length&&(this._nodePriorityIndex=0,this._nodePriorityMap={},this._visitTarget(e,!0),i.getSceneGraphPriorityListeners().sort(this._sortEventListenersOfSceneGraphPriorityDes))}},_sortEventListenersOfSceneGraphPriorityDes:function(t,e){var i=c._nodePriorityMap,n=t._getSceneGraphPriority(),r=e._getSceneGraphPriority();return e&&r&&i[r.__instanceId]?t&&n&&i[n.__instanceId]?i[r.__instanceId]-i[n.__instanceId]:1:-1},_sortListenersOfFixedPriority:function(t){var e=this._listenersMap[t];if(e){var i=e.getFixedPriorityListeners();if(i&&0!==i.length){i.sort(this._sortListenersOfFixedPriorityAsc);for(var n=0,r=i.length;n<r&&!(0<=i[n]._getFixedPriority());)++n;e.gt0Index=n}}},_sortListenersOfFixedPriorityAsc:function(t,e){return t._getFixedPriority()-e._getFixedPriority()},_onUpdateListeners:function(t){var e,i,n,r=t.getFixedPriorityListeners(),o=t.getSceneGraphPriorityListeners(),s=this._toRemovedListeners;if(o)for(e=0;e<o.length;)(i=o[e])._isRegistered()?++e:(cc.js.array.remove(o,i),-1!==(n=s.indexOf(i))&&s.splice(n,1));if(r)for(e=0;e<r.length;)(i=r[e])._isRegistered()?++e:(cc.js.array.remove(r,i),-1!==(n=s.indexOf(i))&&s.splice(n,1));o&&0===o.length&&t.clearSceneGraphListeners(),r&&0===r.length&&t.clearFixedListeners()},frameUpdateListeners:function(){var t=this._listenersMap,e=this._priorityDirtyFlagMap;for(var i in t)t[i].empty()&&(delete e[i],delete t[i]);var n=this._toAddedListeners;if(0!==n.length){for(var r=0,o=n.length;r<o;r++)this._forceAddEventListener(n[r]);n.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()},_updateTouchListeners:function(t){var e=this._inDispatch;if(cc.assertID(0<e,3508),!(1<e)){var i;(i=this._listenersMap[cc._EventListenerTouchOneByOne.LISTENER_ID])&&this._onUpdateListeners(i),(i=this._listenersMap[cc._EventListenerTouchAllAtOnce.LISTENER_ID])&&this._onUpdateListeners(i),cc.assertID(1===e,3509);var n=this._toAddedListeners;if(0!==n.length){for(var r=0,o=n.length;r<o;r++)this._forceAddEventListener(n[r]);this._toAddedListeners.length=0}0!==this._toRemovedListeners.length&&this._cleanToRemovedListeners()}},_cleanToRemovedListeners:function(){for(var t=this._toRemovedListeners,e=0;e<t.length;e++){var i=t[e],n=this._listenersMap[i._getListenerID()];if(n){var r,o=n.getFixedPriorityListeners(),s=n.getSceneGraphPriorityListeners();s&&-1!==(r=s.indexOf(i))&&s.splice(r,1),o&&-1!==(r=o.indexOf(i))&&o.splice(r,1)}}t.length=0},_onTouchEventCallback:function(t,e){if(!t._isRegistered)return!1;var i=e.event,n=i.currentTouch;i.currentTarget=t._node;var r,o=!1,s=i.getEventCode(),a=cc.Event.EventTouch;return s===a.BEGAN?t.onTouchBegan&&(o=t.onTouchBegan(n,i))&&t._registered&&t._claimedTouches.push(n):0<t._claimedTouches.length&&-1!==(r=t._claimedTouches.indexOf(n))&&(o=!0,s===a.MOVED&&t.onTouchMoved?t.onTouchMoved(n,i):s===a.ENDED?(t.onTouchEnded&&t.onTouchEnded(n,i),t._registered&&t._claimedTouches.splice(r,1)):s===a.CANCELLED&&(t.onTouchCancelled&&t.onTouchCancelled(n,i),t._registered&&t._claimedTouches.splice(r,1))),i.isStopped()?(c._updateTouchListeners(i),!0):!!(o&&t._registered&&t.swallowTouches)&&(e.needsMutableSet&&e.touches.splice(n,1),!0)},_dispatchTouchEvent:function(t){this._sortEventListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),this._sortEventListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);var e=this._getListeners(cc._EventListenerTouchOneByOne.LISTENER_ID),i=this._getListeners(cc._EventListenerTouchAllAtOnce.LISTENER_ID);if(null!==e||null!==i){var n=t.getTouches(),r=cc.js.array.copy(n),o={event:t,needsMutableSet:e&&i,touches:r,selTouch:null};if(e)for(var s=0;s<n.length;s++)t.currentTouch=n[s],t._propagationStopped=t._propagationImmediateStopped=!1,this._dispatchEventToListeners(e,this._onTouchEventCallback,o);i&&0<r.length&&(this._dispatchEventToListeners(i,this._onTouchesEventCallback,{event:t,touches:r}),t.isStopped())||this._updateTouchListeners(t)}},_onTouchesEventCallback:function(t,e){if(!t._registered)return!1;var i=cc.Event.EventTouch,n=e.event,r=e.touches,o=n.getEventCode();return n.currentTarget=t._node,o===i.BEGAN&&t.onTouchesBegan?t.onTouchesBegan(r,n):o===i.MOVED&&t.onTouchesMoved?t.onTouchesMoved(r,n):o===i.ENDED&&t.onTouchesEnded?t.onTouchesEnded(r,n):o===i.CANCELLED&&t.onTouchesCancelled&&t.onTouchesCancelled(r,n),!!n.isStopped()&&(c._updateTouchListeners(n),!0)},_associateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];i||(i=[],this._nodeListenersMap[t.__instanceId]=i),i.push(e)},_dissociateNodeAndEventListener:function(t,e){var i=this._nodeListenersMap[t.__instanceId];i&&(cc.js.array.remove(i,e),0===i.length&&delete this._nodeListenersMap[t.__instanceId])},_dispatchEventToListeners:function(t,e,i){var n,r,o=!1,s=t.getFixedPriorityListeners(),a=t.getSceneGraphPriorityListeners(),c=0;if(s&&0!==s.length)for(;c<t.gt0Index;++c)if((r=s[c]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){o=!0;break}if(a&&!o)for(n=0;n<a.length;n++)if((r=a[n]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){o=!0;break}if(s&&!o)for(;c<s.length;++c)if((r=s[c]).isEnabled()&&!r._isPaused()&&r._isRegistered()&&e(r,i)){o=!0;break}},_setDirty:function(t,e){var i=this._priorityDirtyFlagMap;null==i[t]?i[t]=e:i[t]=e|i[t]},_visitTarget:function(t,e){t._reorderChildDirty&&t.sortAllChildren();var i=t.getChildren(),n=0,r=i.length,o=this._globalZOrderNodeMap,s=this._nodeListenersMap;if(0<r){for(var a;n<r&&(a=i[n])&&a.getLocalZOrder()<0;n++)this._visitTarget(a,!1);for(void 0!==s[t.__instanceId]&&(o[t.getGlobalZOrder()]||(o[t.getGlobalZOrder()]=[]),o[t.getGlobalZOrder()].push(t.__instanceId));n<r;n++)(a=i[n])&&this._visitTarget(a,!1)}else void 0!==s[t.__instanceId]&&(o[t.getGlobalZOrder()]||(o[t.getGlobalZOrder()]=[]),o[t.getGlobalZOrder()].push(t.__instanceId));if(e){var c=[];for(var h in o)c.push(h);c.sort(this._sortNumberAsc);var l,u,_=c.length,d=this._nodePriorityMap;for(n=0;n<_;n++)for(l=o[c[n]],u=0;u<l.length;u++)d[l[u]]=++this._nodePriorityIndex;this._globalZOrderNodeMap={}}},_sortNumberAsc:function(t,e){return t-e},hasEventListener:function(t){return!!this._getListeners(t)},addListener:function(t,e){if(cc.assertID(t&&e,3503),cc.js.isNumber(e)||e instanceof cc._BaseNode||e instanceof _ccsg.Node){if(t instanceof cc.EventListener){if(t._isRegistered())return void cc.logID(3505)}else cc.assertID(!cc.js.isNumber(e),3504),t=cc.EventListener.create(t);if(t.checkAvailable()){if(cc.js.isNumber(e)){if(0===e)return void cc.logID(3500);t._setSceneGraphPriority(null),t._setFixedPriority(e),t._setRegistered(!0),t._setPaused(!1),this._addListener(t)}else t._setSceneGraphPriority(e),t._setFixedPriority(0),t._setRegistered(!0),this._addListener(t);return t}}else cc.warnID(3506)},addCustomListener:function(t,e){var i=new cc._EventListenerCustom(t,e);return this.addListener(i,1),i},removeListener:function(t){if(null!=t){var e,i=this._listenersMap;for(var n in i){var r=i[n],o=r.getFixedPriorityListeners(),s=r.getSceneGraphPriorityListeners();if((e=this._removeListenerInVector(s,t))?this._setDirty(t._getListenerID(),this.DIRTY_SCENE_GRAPH_PRIORITY):(e=this._removeListenerInVector(o,t))&&this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY),r.empty()&&(delete this._priorityDirtyFlagMap[t._getListenerID()],delete i[n]),e)break}if(!e)for(var a=this._toAddedListeners,c=0,h=a.length;c<h;c++){var l=a[c];if(l===t){cc.js.array.remove(a,l),l._setRegistered(!1);break}}}},_removeListenerInCallback:function(t,e){if(null==t)return!1;for(var i=0,n=t.length;i<n;i++){var r=t[i];if(r._onCustomEvent===e||r._onEvent===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.remove(t,r):this._toRemovedListeners.push(r),!0}return!1},_removeListenerInVector:function(t,e){if(null==t)return!1;for(var i=0,n=t.length;i<n;i++){var r=t[i];if(r===e)return r._setRegistered(!1),null!=r._getSceneGraphPriority()&&(this._dissociateNodeAndEventListener(r._getSceneGraphPriority(),r),r._setSceneGraphPriority(null)),0===this._inDispatch?cc.js.array.remove(t,r):this._toRemovedListeners.push(r),!0}return!1},removeListeners:function(t,e){var i=this;if(cc.js.isNumber(t)||t instanceof cc._BaseNode||t instanceof _ccsg.Node)if(void 0!==t.__instanceId){delete i._nodePriorityMap[t.__instanceId],cc.js.array.remove(i._dirtyNodes,t);var n,r=i._nodeListenersMap[t.__instanceId];if(r){var o=cc.js.array.copy(r);for(n=0;n<o.length;n++)i.removeListener(o[n]);delete i._nodeListenersMap[t.__instanceId]}var s=i._toAddedListeners;for(n=0;n<s.length;){var a=s[n];a._getSceneGraphPriority()===t?(a._setSceneGraphPriority(null),a._setRegistered(!1),s.splice(n,1)):++n}if(!0===e){var c,h=t.getChildren();for(n=0,c=h.length;n<c;n++)i.removeListeners(h[n],!0)}}else t===cc.EventListener.TOUCH_ONE_BY_ONE?i._removeListenersForListenerID(cc._EventListenerTouchOneByOne.LISTENER_ID):t===cc.EventListener.TOUCH_ALL_AT_ONCE?i._removeListenersForListenerID(cc._EventListenerTouchAllAtOnce.LISTENER_ID):t===cc.EventListener.MOUSE?i._removeListenersForListenerID(cc._EventListenerMouse.LISTENER_ID):t===cc.EventListener.ACCELERATION?i._removeListenersForListenerID(cc._EventListenerAcceleration.LISTENER_ID):t===cc.EventListener.KEYBOARD?i._removeListenersForListenerID(cc._EventListenerKeyboard.LISTENER_ID):cc.logID(3501);else cc.warnID(3506)},removeCustomListeners:function(t){this._removeListenersForListenerID(t)},removeAllListeners:function(){var t=this._listenersMap,e=this._internalCustomListenerIDs;for(var i in t)-1===e.indexOf(i)&&this._removeListenersForListenerID(i)},setPriority:function(t,e){if(null!=t){var i=this._listenersMap;for(var n in i){var r=i[n].getFixedPriorityListeners();if(r&&-1!==r.indexOf(t))return null!=t._getSceneGraphPriority()&&cc.logID(3502),void(t._getFixedPriority()!==e&&(t._setFixedPriority(e),this._setDirty(t._getListenerID(),this.DIRTY_FIXED_PRIORITY)))}}},setEnabled:function(t){this._isEnabled=t},isEnabled:function(){return this._isEnabled},dispatchEvent:function(t){if(this._isEnabled){if(this._updateDirtyFlagForSceneGraph(),this._inDispatch++,!t||!t.getType)throw new Error("event is undefined");if(t.getType().startsWith(cc.Event.TOUCH))return this._dispatchTouchEvent(t),void this._inDispatch--;var e=(n=t,r=cc.Event,(o=n.type)===r.ACCELERATION?cc._EventListenerAcceleration.LISTENER_ID:o===r.KEYBOARD?cc._EventListenerKeyboard.LISTENER_ID:o.startsWith(r.MOUSE)?cc._EventListenerMouse.LISTENER_ID:(o.startsWith(r.TOUCH)&&cc.logID(2e3),""));this._sortEventListeners(e);var i=this._listenersMap[e];null!=i&&(this._dispatchEventToListeners(i,this._onListenerCallback,t),this._onUpdateListeners(i)),this._inDispatch--}var n,r,o},_onListenerCallback:function(t,e){return e.currentTarget=t._target,t._onEvent(e),e.isStopped()},dispatchCustomEvent:function(t,e){var i=new cc.Event.EventCustom(t);i.setUserData(e),this.dispatchEvent(i)}};n.get(cc,"eventManager",function(){return cc.warnID(1405,"cc.eventManager","cc.EventTarget or cc.systemEvent"),c}),e.exports=c},{"../platform/js":144}],82:[function(t,e,i){cc.Touch=cc._Class.extend({ctor:function(t,e,i){this._lastModified=0,this.setTouchInfo(i,t,e)},getLocation:function(){return{x:this._point.x,y:this._point.y}},getLocationX:function(){return this._point.x},getLocationY:function(){return this._point.y},getPreviousLocation:function(){return{x:this._prevPoint.x,y:this._prevPoint.y}},getStartLocation:function(){return{x:this._startPoint.x,y:this._startPoint.y}},getDelta:function(){return cc.pSub(this._point,this._prevPoint)},getLocationInView:function(){return{x:this._point.x,y:cc.view._designResolutionSize.height-this._point.y}},getPreviousLocationInView:function(){return{x:this._prevPoint.x,y:cc.view._designResolutionSize.height-this._prevPoint.y}},getStartLocationInView:function(){return{x:this._startPoint.x,y:cc.view._designResolutionSize.height-this._startPoint.y}},getID:function(){return this._id},setTouchInfo:function(t,e,i){this._prevPoint=this._point,this._point=cc.p(e||0,i||0),this._id=t,this._startPointCaptured||(this._startPoint=cc.p(this._point),cc.view._convertPointWithScale(this._startPoint),this._startPointCaptured=!0)},_setPoint:function(t,e){void 0===e?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t,this._point.y=e)},_setPrevPoint:function(t,e){this._prevPoint=void 0===e?cc.p(t.x,t.y):cc.p(t||0,e||0)}})},{}],83:[function(t,e,i){var n;t("./CCEvent"),t("./CCTouch"),t("./CCEventListener"),n=t("./CCEventManager"),e.exports=n},{"./CCEvent":79,"./CCEventListener":80,"./CCEventManager":81,"./CCTouch":82}],84:[function(t,e,i){var n=cc.js,r=t("../platform/callbacks-invoker").CallbacksHandler;function o(){r.call(this)}n.extend(o,r),o.prototype.invoke=function(t,e){var i=t.type,n=this._callbackTable[i];if(n){var r=!n.isInvoking;n.isInvoking=!0;for(var o=n.callbacks,s=n.targets,a=0,c=o.length;a<c;++a){var h=o[a];if(h){var l=s[a]||t.currentTarget;if(h.call(l,t,e),t._propagationImmediateStopped)break}}r&&(n.isInvoking=!1,n.containCanceled&&n.purgeCanceled())}},e.exports=o},{"../platform/callbacks-invoker":137}],85:[function(t,e,i){var o=t("./event-listeners");t("./event");var s=cc.js.array.fastRemove,r=new Array(16);function n(){this._capturingListeners=null,this._bubblingListeners=null,this._hasListenerCache=null}r.length=0;var a=n.prototype;a._addEventFlag=function(t,e,i){var n=this._hasListenerCache;n||(n=this._hasListenerCache=cc.js.createMap()),void 0===n[t]&&(n[t]=0);var r=i?2:4;n[t]|=r},a._purgeEventFlag=function(t,e,i){var n=this._hasListenerCache;if(n&&!e.has(t)){var r=i?2:4;n[t]&=~r,0===n[t]&&delete n[t]}},a._resetFlagForTarget=function(t,e,i){var n=this._hasListenerCache;if(n){var r=i?2:4;for(var o in n)e.has(o)||(n[o]&=~r,0===n[o]&&delete n[o])}},a.hasEventListener=function(t,e){var i=this._hasListenerCache;if(!i)return!1;var n=e?2:4;return 0<(i[t]&n)},a.on=function(t,e,i,n){if("boolean"==typeof i?(n=i,i=void 0):n=!!n,e){var r=null;return(r=n?this._capturingListeners=this._capturingListeners||new o:this._bubblingListeners=this._bubblingListeners||new o).has(t,e,i)||(r.add(t,e,i),i&&i.__eventTargets&&i.__eventTargets.push(this),this._addEventFlag(t,r,n)),e}cc.errorID(6800)},a.off=function(t,e,i,n){if("boolean"==typeof i?(n=i,i=void 0):n=!!n,e){var r=n?this._capturingListeners:this._bubblingListeners;r&&(r.remove(t,e,i),i&&i.__eventTargets&&s(i.__eventTargets,this),this._purgeEventFlag(t,r,n))}else this._capturingListeners&&this._capturingListeners.removeAll(t),this._bubblingListeners&&this._bubblingListeners.removeAll(t),this._hasListenerCache&&delete this._hasListenerCache[t]},a.targetOff=function(t){this._capturingListeners&&(this._capturingListeners.removeAll(t),this._resetFlagForTarget(t,this._capturingListeners,!0)),this._bubblingListeners&&(this._bubblingListeners.removeAll(t),this._resetFlagForTarget(t,this._bubblingListeners,!1))},a.once=function(e,i,n,r){var o="__ONCE_FLAG:"+e,s=r?this._capturingListeners:this._bubblingListeners;if(!s||!s.has(o,i,n)){var a=this,c=function(t){a.off(e,c,n,r),s.remove(o,i,n),i.call(this,t)};this.on(e,c,n,r),s||(s=r?this._capturingListeners:this._bubblingListeners),s.add(o,i,n)}},a.dispatchEvent=function(t){(function(t,e){var i,n;for(e.target=t,r.length=0,t._getCapturingTargets(e.type,r),e.eventPhase=1,n=r.length-1;0<=n;--n)if((i=r[n])._isTargetActive(e.type)&&i._capturingListeners&&((e.currentTarget=i)._capturingListeners.invoke(e,r),e._propagationStopped))return r.length=0;if(r.length=0,t._isTargetActive(e.type)&&(e.eventPhase=2,(e.currentTarget=t)._capturingListeners&&t._capturingListeners.invoke(e),!e._propagationImmediateStopped&&t._bubblingListeners&&t._bubblingListeners.invoke(e)),!e._propagationStopped&&e.bubbles)for(t._getBubblingTargets(e.type,r),e.eventPhase=3,n=0;n<r.length;++n)if((i=r[n])._isTargetActive(e.type)&&i._bubblingListeners&&((e.currentTarget=i)._bubblingListeners.invoke(e),e._propagationStopped))return r.length=0;r.length=0})(this,t),r.length=0},a.emit=function(t,e){var i=this._hasListenerCache;if(i){var n=i[t];if(n){var r=cc.Event.EventCustom.get(t);r.detail=e,r.eventPhase=2,r.target=r.currentTarget=this;var o=this._capturingListeners;o&&2&n&&o.invoke(r);var s=this._bubblingListeners;s&&4&n&&!r._propagationImmediateStopped&&s.invoke(r),r.detail=null,cc.Event.EventCustom.put(r)}}},a._isTargetActive=function(t){return!0},a._getCapturingTargets=function(t,e){},a._getBubblingTargets=function(t,e){},n.prototype._EventTargetOn=n.prototype.on,n.prototype._EventTargetOnce=n.prototype.once,n.prototype._EventTargetOff=n.prototype.off,n.prototype._EventTargetTargetOff=n.prototype.targetOff,cc.EventTarget=e.exports=n},{"./event":86,"./event-listeners":84}],86:[function(t,e,i){var n=t("../platform/js");cc.Event=function(t,e){this.type=t,this.bubbles=!!e,this.target=null,this.currentTarget=null,this.eventPhase=0,this._propagationStopped=!1,this._propagationImmediateStopped=!1},cc.Event.prototype={constructor:cc.Event,unuse:function(){this.type=cc.Event.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=cc.Event.NONE,this._propagationStopped=!1,this._propagationImmediateStopped=!1},reuse:function(t,e){this.type=t,this.bubbles=e||!1},stopPropagation:function(){this._propagationStopped=!0},stopPropagationImmediate:function(){this._propagationImmediateStopped=!0},isStopped:function(){return this._propagationStopped||this._propagationImmediateStopped},getCurrentTarget:function(){return this.currentTarget},getType:function(){return this.type}},cc.Event.NO_TYPE="no_type",cc.Event.TOUCH="touch",cc.Event.MOUSE="mouse",cc.Event.KEYBOARD="keyboard",cc.Event.ACCELERATION="acceleration",cc.Event.NONE=0,cc.Event.CAPTURING_PHASE=1,cc.Event.AT_TARGET=2,cc.Event.BUBBLING_PHASE=3;var r=function(t,e){cc.Event.call(this,t,e),this.detail=null};n.extend(r,cc.Event),(r.prototype.reset=r).prototype.setUserData=function(t){this.detail=t},r.prototype.getUserData=function(){return this.detail},r.prototype.getEventName=cc.Event.prototype.getType;var o=new n.Pool(10);r.put=function(t){o.put(t)},r.get=function(t,e){var i=o._get();return i?i.reset(t,e):i=new r(t,e),i},cc.Event.EventCustom=r,e.exports=cc.Event},{"../platform/js":144}],87:[function(t,e,i){t("./event"),t("./event-listeners"),t("./event-target"),t("./system-event")},{"./event":86,"./event-listeners":84,"./event-target":85,"./system-event":88}],88:[function(t,e,i){var n,r=t("../event/event-target"),s=t("../event-manager");n=t("../platform/CCInputManager");var a=cc.Enum({KEY_DOWN:"keydown",KEY_UP:"keyup",DEVICEMOTION:"devicemotion"}),c=null,h=null,o=0,l=cc.Class({name:"SystemEvent",extends:r,statics:{EventType:a},setAccelerometerEnabled:function(t){n.setAccelerometerEnabled(t)},setAccelerometerInterval:function(t){n.setAccelerometerInterval(t)},on:function(t,e,i,n){if(this._super(t,e,i,n),(t===a.KEY_DOWN||t===a.KEY_UP)&&(c||(c=cc.EventListener.create({event:cc.EventListener.KEYBOARD,onKeyPressed:function(t,e){e.type=a.KEY_DOWN,cc.systemEvent.dispatchEvent(e)},onKeyReleased:function(t,e){e.type=a.KEY_UP,cc.systemEvent.dispatchEvent(e)}})),!s.hasEventListener(cc._EventListenerKeyboard.LISTENER_ID))){var r=cc.director.getTotalFrames();r!==o&&(s.addListener(c,1),o=r)}t===a.DEVICEMOTION&&(h||(h=cc.EventListener.create({event:cc.EventListener.ACCELERATION,callback:function(t,e){e.type=a.DEVICEMOTION,cc.systemEvent.dispatchEvent(e)}})),s.hasEventListener(cc._EventListenerAcceleration.LISTENER_ID)||s.addListener(h,1))},off:function(t,e,i,n){if(this._super(t,e,i,n),c&&(t===a.KEY_DOWN||t===a.KEY_UP)){var r=this.hasEventListener(a.KEY_DOWN),o=this.hasEventListener(a.KEY_UP);r||o||s.removeListener(c)}h&&t===a.DEVICEMOTION&&s.removeListener(h)}});cc.SystemEvent=e.exports=l,cc.systemEvent=new cc.SystemEvent},{"../event-manager":83,"../event/event-target":85,"../platform/CCInputManager":127}],89:[function(t,e,i){"use strict";function n(t,e,i){i=i||2;var n,r,o,s,a,c,h,l=e&&e.length,u=l?e[0]*i:t.length,_=p(t,0,u,i,!0),d=[];if(!_)return d;if(l&&(_=function(t,e,i,n){var r,o,s,a=[];for(r=0,o=e.length;r<o;r++)(s=p(t,e[r]*n,r<o-1?e[r+1]*n:t.length,n,!1))===s.next&&(s.steiner=!0),a.push(C(s));for(a.sort(v),r=0;r<a.length;r++)y(a[r],i),i=g(i,i.next);return i}(t,e,_,i)),t.length>80*i){n=o=t[0],r=s=t[1];for(var f=i;f<u;f+=i)(a=t[f])<n&&(n=a),(c=t[f+1])<r&&(r=c),o<a&&(o=a),s<c&&(s=c);h=Math.max(o-n,s-r)}return m(_,d,i,n,r,h),d}function p(t,e,i,n,r){var o,s;if(r===0<A(t,e,i,n))for(o=e;o<i;o+=n)s=c(o,t[o],t[o+1],s);else for(o=i-n;e<=o;o-=n)s=c(o,t[o],t[o+1],s);return s&&a(s,s.next)&&(R(s),s=s.next),s}function g(t,e){if(!t)return t;e||(e=t);var i,n=t;do{if(i=!1,n.steiner||!a(n,n.next)&&0!==x(n.prev,n,n.next))n=n.next;else{if(R(n),(n=e=n.prev)===n.next)return null;i=!0}}while(i||n!==e);return e}function m(t,e,i,n,r,o,s){if(t){!s&&o&&function(t,e,i,n){for(var r=t;null===r.z&&(r.z=f(r.x,r.y,e,i,n)),r.prevZ=r.prev,r.nextZ=r.next,(r=r.next)!==t;);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,i,n,r,o,s,a,c,h=1;do{for(i=t,o=t=null,s=0;i;){for(s++,n=i,e=a=0;e<h&&(a++,n=n.nextZ);e++);for(c=h;0<a||0<c&&n;)0===a?(n=(r=n).nextZ,c--):0!==c&&n?i.z<=n.z?(i=(r=i).nextZ,a--):(n=(r=n).nextZ,c--):(i=(r=i).nextZ,a--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;i=n}o.nextZ=null,h*=2}while(1<s)}(r)}(t,n,r,o);for(var a,c,h=t;t.prev!==t.next;)if(a=t.prev,c=t.next,o?u(t,n,r,o):l(t))e.push(a.i/i),e.push(t.i/i),e.push(c.i/i),R(t),t=c.next,h=c.next;else if((t=c)===h){s?1===s?m(t=_(t,e,i),e,i,n,r,o,2):2===s&&d(t,e,i,n,r,o):m(g(t),e,i,n,r,o,1);break}}}function l(t){var e=t.prev,i=t,n=t.next;if(0<=x(e,i,n))return!1;for(var r=t.next.next;r!==t.prev;){if(T(e.x,e.y,i.x,i.y,n.x,n.y,r.x,r.y)&&0<=x(r.prev,r,r.next))return!1;r=r.next}return!0}function u(t,e,i,n){var r=t.prev,o=t,s=t.next;if(0<=x(r,o,s))return!1;for(var a=r.x<o.x?r.x<s.x?r.x:s.x:o.x<s.x?o.x:s.x,c=r.y<o.y?r.y<s.y?r.y:s.y:o.y<s.y?o.y:s.y,h=r.x>o.x?r.x>s.x?r.x:s.x:o.x>s.x?o.x:s.x,l=r.y>o.y?r.y>s.y?r.y:s.y:o.y>s.y?o.y:s.y,u=f(a,c,e,i,n),_=f(h,l,e,i,n),d=t.nextZ;d&&d.z<=_;){if(d!==t.prev&&d!==t.next&&T(r.x,r.y,o.x,o.y,s.x,s.y,d.x,d.y)&&0<=x(d.prev,d,d.next))return!1;d=d.nextZ}for(d=t.prevZ;d&&d.z>=u;){if(d!==t.prev&&d!==t.next&&T(r.x,r.y,o.x,o.y,s.x,s.y,d.x,d.y)&&0<=x(d.prev,d,d.next))return!1;d=d.prevZ}return!0}function _(t,e,i){var n=t;do{var r=n.prev,o=n.next.next;!a(r,o)&&E(r,n,n.next,o)&&S(r,o)&&S(o,r)&&(e.push(r.i/i),e.push(n.i/i),e.push(o.i/i),R(n),R(n.next),n=t=o),n=n.next}while(n!==t);return n}function d(t,e,i,n,r,o){var s,a,c=t;do{for(var h=c.next.next;h!==c.prev;){if(c.i!==h.i&&(a=h,(s=c).next.i!==a.i&&s.prev.i!==a.i&&!function(t,e){var i=t;do{if(i.i!==t.i&&i.next.i!==t.i&&i.i!==e.i&&i.next.i!==e.i&&E(i,i.next,t,e))return!0;i=i.next}while(i!==t);return!1}(s,a)&&S(s,a)&&S(a,s)&&function(t,e){for(var i=t,n=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;i.y>o!=i.next.y>o&&r<(i.next.x-i.x)*(o-i.y)/(i.next.y-i.y)+i.x&&(n=!n),(i=i.next)!==t;);return n}(s,a))){var l=b(c,h);return c=g(c,c.next),l=g(l,l.next),m(c,e,i,n,r,o),void m(l,e,i,n,r,o)}h=h.next}c=c.next}while(c!==t)}function v(t,e){return t.x-e.x}function y(t,e){if(e=function(t,e){var i,n=e,r=t.x,o=t.y,s=-1/0;do{if(o<=n.y&&o>=n.next.y){var a=n.x+(o-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(a<=r&&s<a){if((s=a)===r){if(o===n.y)return n;if(o===n.next.y)return n.next}i=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!i)return null;if(r===s)return i.prev;var c,h=i,l=i.x,u=i.y,_=1/0;for(n=i.next;n!==h;)r>=n.x&&n.x>=l&&T(o<u?r:s,o,l,u,o<u?s:r,o,n.x,n.y)&&((c=Math.abs(o-n.y)/(r-n.x))<_||c===_&&n.x>i.x)&&S(n,t)&&(i=n,_=c),n=n.next;return i}(t,e)){var i=b(e,t);g(i,i.next)}}function f(t,e,i,n,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)/r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)/r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function C(t){for(var e=t,i=t;e.x<i.x&&(i=e),(e=e.next)!==t;);return i}function T(t,e,i,n,r,o,s,a){return 0<=(r-s)*(e-a)-(t-s)*(o-a)&&0<=(t-s)*(n-a)-(i-s)*(e-a)&&0<=(i-s)*(o-a)-(r-s)*(n-a)}function x(t,e,i){return(e.y-t.y)*(i.x-e.x)-(e.x-t.x)*(i.y-e.y)}function a(t,e){return t.x===e.x&&t.y===e.y}function E(t,e,i,n){return!!(a(t,e)&&a(i,n)||a(t,n)&&a(i,e))||0<x(t,e,i)!=0<x(t,e,n)&&0<x(i,n,t)!=0<x(i,n,e)}function S(t,e){return x(t.prev,t,t.next)<0?0<=x(t,e,t.next)&&0<=x(t,t.prev,e):x(t,e,t.prev)<0||x(t,t.next,e)<0}function b(t,e){var i=new s(t.i,t.x,t.y),n=new s(e.i,e.x,e.y),r=t.next,o=e.prev;return(t.next=e).prev=t,(i.next=r).prev=i,(n.next=i).prev=n,(o.next=n).prev=o,n}function c(t,e,i,n){var r=new s(t,e,i);return n?(r.next=n.next,(r.prev=n).next.prev=r,n.next=r):(r.prev=r).next=r,r}function R(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function s(t,e,i){this.i=t,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function A(t,e,i,n){for(var r=0,o=e,s=i-n;o<i;o+=n)r+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return r}(e.exports=n).deviation=function(t,e,i,n){var r=e&&e.length,o=r?e[0]*i:t.length,s=Math.abs(A(t,0,o,i));if(r)for(var a=0,c=e.length;a<c;a++){var h=e[a]*i,l=a<c-1?e[a+1]*i:t.length;s-=Math.abs(A(t,h,l,i))}var u=0;for(a=0;a<n.length;a+=3){var _=n[a]*i,d=n[a+1]*i,f=n[a+2]*i;u+=Math.abs((t[_]-t[f])*(t[d+1]-t[_+1])-(t[_]-t[d])*(t[f+1]-t[_+1]))}return 0===s&&0===u?0:Math.abs((u-s)/s)},n.flatten=function(t){for(var e=t[0][0].length,i={vertices:[],holes:[],dimensions:e},n=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var s=0;s<e;s++)i.vertices.push(t[r][o][s]);0<r&&(n+=t[r-1].length,i.holes.push(n))}return i}},{}],90:[function(t,e,i){cc.js;var n=t("./types").LineCap,r=t("./types").LineJoin,s=t("./helper"),o=function(t){this._rootCtor(t),this._needDraw=!0,this.cmds=[],this.style={strokeStyle:"black",fillStyle:"white",lineCap:"butt",lineJoin:"miter",miterLimit:10}},a=o.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);a.constructor=o,a._updateCurrentRegions=function(){var t=this._currentRegion;this._currentRegion=this._oldRegion,this._oldRegion=t,this._currentRegion.setTo(0,0,cc.visibleRect.width,cc.visibleRect.height)},a.rendering=function(t,e,i){var n=t||cc._renderContext,r=n.getContext();n.setTransform(this._worldTransform,e,i),r.save(),r.scale(1,-1);var o=this.style;r.strokeStyle=o.strokeStyle,r.fillStyle=o.fillStyle,r.lineWidth=o.lineWidth,r.lineJoin=o.lineJoin,r.miterLimit=o.miterLimit;for(var s=!0,a=this.cmds,c=0,h=a.length;c<h;c++){var l=a[c],u=l[0],_=l[1];"moveTo"===u&&s?(r.beginPath(),s=!1):"fill"!==u&&"stroke"!==u&&"fillRect"!==u||(s=!0),"function"==typeof r[u]?r[u].apply(r,_):r[u]=_}r.restore()},a.setStrokeColor=function(t){var e="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+","+t.a/255+")";this.cmds.push(["strokeStyle",e]),this.style.strokeStyle=e},a.setFillColor=function(t){var e="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+","+t.a/255+")";this.cmds.push(["fillStyle",e]),this.style.fillStyle=e},a.setLineWidth=function(t){this.cmds.push(["lineWidth",t]),this.style.lineWidth=t},a.setLineCap=function(t){var e="butt";t===n.BUTT?e="butt":t===n.ROUND?e="round":t===n.SQUARE&&(e="square"),this.cmds.push(["lineCap",e]),this.style.lineCap=e},a.setLineJoin=function(t){var e="bevel";t===r.BEVEL?e="bevel":t===r.ROUND?e="round":t===r.MITER&&(e="miter"),this.cmds.push(["lineJoin",e]),this.style.lineJoin=e},a.setMiterLimit=function(t){this.cmds.push(["miterLimit",t]),this.style.miterLimit=t},a.beginPath=function(){},a.moveTo=function(t,e){this.cmds.push(["moveTo",[t,e]])},a.lineTo=function(t,e){this.cmds.push(["lineTo",[t,e]])},a.bezierCurveTo=function(t,e,i,n,r,o){this.cmds.push(["bezierCurveTo",[t,e,i,n,r,o]])},a.quadraticCurveTo=function(t,e,i,n){this.cmds.push(["quadraticCurveTo",[t,e,i,n]])},a.arc=function(t,e,i,n,r,o){s.arc(this,t,e,i,n,r,o)},a.ellipse=function(t,e,i,n){s.ellipse(this,t,e,i,n)},a.circle=function(t,e,i){s.ellipse(this,t,e,i,i)},a.rect=function(t,e,i,n){this.moveTo(t,e),this.lineTo(t+i,e),this.lineTo(t+i,e+n),this.lineTo(t,e+n),this.close()},a.roundRect=function(t,e,i,n,r){s.roundRect(this,t,e,i,n,r)},a.fillRect=function(t,e,i,n){this.cmds.push(["fillRect",[t,e,i,n]]),this.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},a.close=function(){this.cmds.push(["closePath",[]])},a.stroke=function(){this.cmds.push(["stroke",[]]),this.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},a.fill=function(){this.cmds.push(["fill",[]]),this.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},a.clear=function(){this.cmds.length=0,this.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},e.exports=o},{"./helper":94,"./types":96}],91:[function(t,e,i){var n=t("./graphics-canvas-cmd"),r=t("./graphics-webgl-cmd"),o=t("./types").LineCap,s=t("./types").LineJoin,a=(cc.js,_ccsg.Node.extend({ctor:function(){this._super(),this.strokeColor=cc.Color.BLACK,this.fillColor=cc.Color.WHITE},clear:function(t){this._renderCmd.clear(t)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new n(this):new r(this)}})),c=a.prototype;c._strokeColor=null,c._fillColor=null,c._lineWidth=1,c._lineCap=o.BUTT,c._lineJoin=s.MITER,c._miterLimit=10,c.setStrokeColor=function(t){this._strokeColor=t,this._renderCmd.setStrokeColor(t)},c.getStrokeColor=function(){return this._strokeColor},c.setFillColor=function(t){this._fillColor=t,this._renderCmd.setFillColor(t)},c.getFillColor=function(){return this._fillColor},c.setLineWidth=function(t){this._lineWidth=t,this._renderCmd.setLineWidth(t)},c.getLineWidth=function(){return this._lineWidth},c.setLineCap=function(t){this._lineCap=t,this._renderCmd.setLineCap(t)},c.getLineCap=function(){return this._lineCap},c.setLineJoin=function(t){this._lineJoin=t,this._renderCmd.setLineJoin(t)},c.getLineJoin=function(){return this._lineJoin},c.setMiterLimit=function(t){this._miterLimit=t,this._renderCmd.setMiterLimit(t)},c.getMiterLimit=function(){return this._miterLimit},c.beginPath=function(){this._renderCmd.beginPath()},c.moveTo=function(t,e){this._renderCmd.moveTo(t,e)},c.lineTo=function(t,e){this._renderCmd.lineTo(t,e)},c.bezierCurveTo=function(t,e,i,n,r,o){this._renderCmd.bezierCurveTo(t,e,i,n,r,o)},c.quadraticCurveTo=function(t,e,i,n){this._renderCmd.quadraticCurveTo(t,e,i,n)},c.arc=function(t,e,i,n,r,o){this._renderCmd.arc(t,e,i,n,r,o)},c.ellipse=function(t,e,i,n){this._renderCmd.ellipse(t,e,i,n)},c.circle=function(t,e,i){this._renderCmd.circle(t,e,i)},c.rect=function(t,e,i,n){this._renderCmd.rect(t,e,i,n)},c.roundRect=function(t,e,i,n,r){this._renderCmd.roundRect(t,e,i,n,r)},c.fillRect=function(t,e,i,n){this._renderCmd.fillRect(t,e,i,n)},c.close=function(){this._renderCmd.close()},c.stroke=function(){this._renderCmd.stroke()},c.fill=function(){this._renderCmd.fill()},e.exports=a},{"./graphics-canvas-cmd":90,"./graphics-webgl-cmd":92,"./types":96}],92:[function(t,e,i){var O=t("./types").LineCap,I=t("./types").LineJoin,y=t("./earcut"),s=t("./helper"),n=cc.Vec2,r=cc.js,w=Math.PI,C=Math.min,T=Math.max,L=Math.ceil,o=Math.acos,N=Math.cos,P=Math.sin,D=Math.atan2,R=Math.abs;function F(t,e,i){return t<e?e:i<t?i:t}var M=cc.Enum({PT_CORNER:1,PT_LEFT:2,PT_BEVEL:4,PT_INNERBEVEL:8});function a(t,e){n.call(this,t,e),this.reset()}function c(){this.reset()}function h(){this.vertsOffset=0,this.vertsVBO=gl.createBuffer(),this.vertsBuffer=null,this.uint32VertsBuffer=null,this.vertsDirty=!1,this.indicesOffset=0,this.indicesVBO=gl.createBuffer(),this.indicesBuffer=null,this.indicesDirty=!1}function l(t){this._rootCtor(t),this._needDraw=!0,cc._renderContext,this._buffers=[],this._buffer=null,this._allocBuffer(),this._matrix=new cc.math.Matrix4,this._matrix.identity(),this._paths=[],this._points=[],this._curColorValue=0,this._blendFunc=new cc.BlendFunc(cc.macro.BLEND_SRC,cc.macro.BLEND_DST);var e=new cc.GLProgram;e.initWithVertexShaderByteArray(cc.PresetShaders.POSITION_COLOR_VERT,cc.PresetShaders.POSITION_COLOR_FRAG),e.retain(),e.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION,cc.macro.VERTEX_ATTRIB_POSITION),e.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR,cc.macro.VERTEX_ATTRIB_COLOR),e.link(),e.updateUniforms(),this._shaderProgram=e,this._allocVerts(32)}r.extend(a,n),a.prototype.reset=function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0},c.prototype.reset=function(){this.closed=!1,this.nbevel=0,this.complex=!0,this.points?this.points.length=0:this.points=[]},h.prototype.clear=function(){this.vertsOffset=0,this.indicesOffset=0},h.prototype.alloc=function(t,e){var i=this.vertsOffset+t;if(65535<i)return!1;var n=this.vertsBuffer,r=n?n.length/3:0;if(r<i){for(0===r&&(r=32);r<i;)r*=2;var o=new Float32Array(3*r),s=new Uint32Array(o.buffer);if(n)for(var a=this.uint32VertsBuffer,c=0,h=n.length;c<h;c+=3)o[c]=n[c],o[c+1]=n[c+1],s[c+2]=a[c+2];this.vertsBuffer=o,this.uint32VertsBuffer=s}var l=this.indicesBuffer,u=this.indicesOffset+e,_=l?l.length:0;if(_<u){for(0===_&&(_=96);_<u;)_*=2;var d=new Uint16Array(_);if(l)for(c=0,h=l.length;c<h;c++)d[c]=l[c];this.indicesBuffer=d}return!0};var u=((l.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype)).constructor=l).prototype;u._tessTol=.25,u._distTol=.01,u.lineWidth=1,u.lineCap=O.BUTT,u.lineJoin=I.MITER,u.miterLimit=10,u.beginPath=function(){this._pathOffset=this._pathLength},u.moveTo=function(t,e){this._updatePathOffset&&(this._pathOffset=this._pathLength,this._updatePathOffset=!1),this._addPath(),this._addPoint(t,e,M.PT_CORNER),this._commandx=t,this._commandy=e},u.lineTo=function(t,e){this._addPoint(t,e,M.PT_CORNER),this._commandx=t,this._commandy=e},u.bezierCurveTo=function(t,e,i,n,r,o){var s=this._curPath,a=s.points[s.points.length-1];a.x!==t||a.y!==e||i!==r||n!==o?(this._tesselateBezier(a.x,a.y,t,e,i,n,r,o,0,M.PT_CORNER),this._commandx=r,this._commandy=o):this.lineTo(r,o)},u.quadraticCurveTo=function(t,e,i,n){var r=this._commandx,o=this._commandy;this.bezierCurveTo(r+2/3*(t-r),o+2/3*(e-o),i+2/3*(t-i),n+2/3*(e-n),i,n)},u.arc=function(t,e,i,n,r,o){s.arc(this,t,e,i,n,r,o)},u.ellipse=function(t,e,i,n){s.ellipse(this,t,e,i,n),this._curPath.complex=!1},u.circle=function(t,e,i){s.ellipse(this,t,e,i,i),this._curPath.complex=!1},u.rect=function(t,e,i,n){this.moveTo(t,e),this.lineTo(t,e+n),this.lineTo(t+i,e+n),this.lineTo(t+i,e),this.close(),this._curPath.complex=!1},u.roundRect=function(t,e,i,n,r){s.roundRect(this,t,e,i,n,r),this._curPath.complex=!1},u.fillRect=function(t,e,i,n){this.rect(t,e,i,n),this.fill()},u.close=function(){this._curPath.closed=!0},u.stroke=function(){this._flattenPaths();var t=this._strokeColor;this._curColorValue=(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,this._expandStroke(),this._updatePathOffset=!0},u.fill=function(){var t=this._fillColor;this._curColorValue=(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,this._expandFill(),this._updatePathOffset=!0,this._filling=!1},u._strokeColor=null,u._fillColor=null,u.setStrokeColor=function(t){this._strokeColor=t},u.getStrokeColor=function(){return this._strokeColor},u.setFillColor=function(t){this._fillColor=t},u.getFillColor=function(){return this._fillColor},u.setLineWidth=function(t){this.lineWidth=t},u.setLineJoin=function(t){this.lineJoin=t},u.setLineCap=function(t){this.lineCap=t},u.setMiterLimit=function(t){this.miterLimit=t},r.getset(u,"strokeColor",u.getStrokeColor,u.setStrokeColor),r.getset(u,"fillColor",u.getFillColor,u.setFillColor),u._render=function(){var t=this._buffers;if(0!==t.length)for(var e=cc._renderContext,i=0,n=t.length;i<n;i++){var r=t[i];e.bindBuffer(e.ARRAY_BUFFER,r.vertsVBO),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.indicesVBO),r.vertsDirty&&(e.bufferData(e.ARRAY_BUFFER,r.vertsBuffer,e.STREAM_DRAW),r.vertsDirty=!1),r.indicesDirty&&r.indicesBuffer&&(e.bufferData(e.ELEMENT_ARRAY_BUFFER,r.indicesBuffer,e.STREAM_DRAW),r.indicesDirty=!1),e.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),e.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_COLOR),e.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,2,e.FLOAT,!1,12,0),e.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,e.UNSIGNED_BYTE,!0,12,8),e.drawElements(e.TRIANGLES,r.indicesOffset,e.UNSIGNED_SHORT,0),cc.g_NumberOfDraws++}},u.rendering=function(){cc.gl.blendFunc(this._blendFunc.src,this._blendFunc.dst);var t=this._worldTransform,e=this._matrix.mat;e[0]=t.a,e[4]=t.c,e[12]=t.tx,e[1]=t.b,e[5]=t.d,e[13]=t.ty;var i=this._shaderProgram;i.use(),i._setUniformForMVPMatrixWithMat4(this._matrix),this._render()},u.clear=function(t){if(this._pathLength=0,this._pathOffset=0,this._pointsOffset=0,this._curPath=null,t)this._paths.length=0,this._points.length=0,this._buffer=null,this._buffers=[];else{for(var e=this._buffers,i=0;i<e.length;i++)e[i].clear();this._buffer=e[0]}},u._updatePathOffset=!1,u._paths=null,u._pathLength=0,u._pathOffset=0,u._points=null,u._pointsOffset=0,u._commandx=0,u._commandy=0,u._addPath=function(){var t=this._pathLength,e=this._paths[t];return e?e.reset():(e=new c,this._paths.push(e)),this._pathLength++,this._curPath=e},u._addPoint=function(t,e,i){var n=this._curPath;if(n){var r,o=this._points,s=n.points;(r=o[this._pointsOffset++])?(r.x=t,r.y=e):(r=new a(t,e),o.push(r)),r.flags=i,s.push(r)}},u._flattenPaths=function(){for(var t=this._paths,e=this._pathOffset,i=this._pathLength;e<i;e++){var n=t[e],r=n.points,o=r[r.length-1],s=r[0];o.equals(s)&&(n.closed=!0,r.pop(),o=r[r.length-1]);for(var a=0,c=r.length;a<c;a++){var h=s.sub(o);o.len=h.mag(),(h.x||h.y)&&h.normalizeSelf(),o.dx=h.x,o.dy=h.y,o=s,s=r[a+1]}}},u._allocBuffer=function(){if(this._buffer){var t=this._buffers.indexOf(this._buffer);if(t<this._buffers.length-1)return void(this._buffer=this._buffers[t+1])}var e=new h;this._buffers.push(e),this._buffer=e},u._allocVerts=function(t){this._buffer||this._allocBuffer();var e=3*(t-2*(this._pathLength-this._pathOffset));this._buffer.alloc(t,e)||(this._allocBuffer(),this._buffer.alloc(t,e)),this._buffer.vertsDirty=!0},u._expandStroke=function(){var t=.5*this.lineWidth,e=this.lineCap,i=this.lineJoin,n=this.miterLimit,r=this._curveDivs(t,w,this._tessTol),o=this._paths;this._calculateJoins(t,i,n);for(var s=0,a=this._pathOffset,c=this._pathLength;a<c;a++){var h=(u=o[a]).points.length;i===I.ROUND?s+=2*(h+u.nbevel*(r+2)+1):s+=2*(h+5*u.nbevel+1),u.closed||(e===O.ROUND?s+=2*(2*r+2):s+=12)}this._allocVerts(s);var l=this._buffer;for(a=this._pathOffset,c=this._pathLength;a<c;a++){var u,_,d,f,p,g,m=(u=o[a]).points;h=u.points.length,g=u.closed;var v=l.vertsOffset;if(g?(_=m[h-1],d=m[0],f=0,p=h):(_=m[0],d=m[1],p=h-(f=1)),!g){(E=d.sub(_)).normalizeSelf();var y=E.x,C=E.y;e===O.BUTT?this._buttCap(_,y,C,t,0):e===O.SQUARE?this._buttCap(_,y,C,t,t):e===O.ROUND&&this._roundCapStart(_,y,C,t,r)}for(var T=f;T<p;++T)i===I.ROUND?this._roundJoin(_,d,t,t,r):0!=(d.flags&(M.PT_BEVEL|M.PT_INNERBEVEL))?this._bevelJoin(_,d,t,t):(this._vset(d.x+d.dmx*t,d.y+d.dmy*t),this._vset(d.x-d.dmx*t,d.y-d.dmy*t)),_=d,d=m[T+1];if(g){var x=l.vertsBuffer;this._vset(x[3*v],x[3*v+1]),this._vset(x[3*(v+1)],x[3*(v+1)+1])}else{var E;(E=d.sub(_)).normalizeSelf(),y=E.x,C=E.y,e===O.BUTT?this._buttCap(d,y,C,t,0):e===O.BUTT||e===O.SQUARE?this._buttCap(d,y,C,t,t):e===O.ROUND&&this._roundCapEnd(d,y,C,t,r)}for(var S=l.indicesOffset,b=l.indicesBuffer,R=v+2,A=l.vertsOffset;R<A;R++)b[S++]=R-2,b[S++]=R-1,b[S++]=R;l.indicesOffset=S,l.indicesDirty=!0}},u._expandFill=function(){for(var t=this._paths,e=0,i=this._pathOffset,n=this._pathLength;i<n;i++)e+=s=(o=t[i]).points.length;this._allocVerts(e);var r=this._buffer;for(i=this._pathOffset,n=this._pathLength;i<n;i++){var o,s,a=(o=t[i]).points;if(0!==(s=a.length)){for(var c=r.vertsOffset,h=0;h<s;++h)this._vset(a[h].x,a[h].y,.5,1);var l=o.indicesOffset=r.indicesOffset,u=r.indicesBuffer,_=0;if(o.complex){var d=[],f=3*c,p=3*r.vertsOffset;for(h=f;h<p;h+=3)d.push(r.vertsBuffer[h]),d.push(r.vertsBuffer[h+1]);var g=y(d,null,2);if(!g||0===g.length)continue;h=0;for(var m=_=g.length;h<m;h++)u[l+h]=g[h]+c}else{var v=c;for(f=c+2,p=r.vertsOffset;f<p;f++)u[l++]=v,u[l++]=f-1,u[l++]=f;_=l-r.indicesOffset}r.indicesOffset+=_,r.indicesDirty=!0}}},u._curveDivs=function(t,e,i){var n=2*o(t/(t+i));return T(2,L(e/n))},u._calculateJoins=function(t,e,i){var n=0;0<t&&(n=1/t);for(var r=this._paths,o=this._pathOffset,s=this._pathLength;o<s;o++)for(var a=r[o],c=a.points,h=c.length,l=c[h-1],u=c[0],_=a.nbevel=0;_<h;_++){var d,f,p=l.dy,g=-l.dx,m=u.dy,v=-u.dx;if(u.dmx=.5*(p+m),u.dmy=.5*(g+v),1e-6<(d=u.dmx*u.dmx+u.dmy*u.dmy)){var y=1/d;600<y&&(y=600),u.dmx*=y,u.dmy*=y}0<u.dx*l.dy-l.dx*u.dy&&(u.flags|=M.PT_LEFT),d*(f=T(11,C(l.len,u.len)*n))*f<1&&(u.flags|=M.PT_INNERBEVEL),u.flags&M.PT_CORNER&&(d*i*i<1||e===I.BEVEL||e===I.ROUND)&&(u.flags|=M.PT_BEVEL),0!=(u.flags&(M.PT_BEVEL|M.PT_INNERBEVEL))&&a.nbevel++,l=u,u=c[_+1]}},u._vset=function(t,e){var i=this._buffer,n=3*i.vertsOffset,r=i.vertsBuffer;r[n]=t,r[n+1]=e,i.uint32VertsBuffer[n+2]=this._curColorValue,i.vertsOffset++},u._chooseBevel=function(t,e,i,n){var r,o,s,a,c=i.x,h=i.y;return 0!==t?(r=c+e.dy*n,o=h-e.dx*n,s=c+i.dy*n,a=h-i.dx*n):(r=s=c+i.dmx*n,o=a=h+i.dmy*n),[r,o,s,a]},u._buttCap=function(t,e,i,n,r){var o=t.x-e*r,s=t.y-i*r,a=i,c=-e;this._vset(o+a*n,s+c*n),this._vset(o-a*n,s-c*n)},u._roundCapStart=function(t,e,i,n,r){for(var o=t.x,s=t.y,a=i,c=-e,h=0;h<r;h++){var l=h/(r-1)*w,u=N(l)*n,_=P(l)*n;this._vset(o-a*u-e*_,s-c*u-i*_),this._vset(o,s)}this._vset(o+a*n,s+c*n),this._vset(o-a*n,s-c*n)},u._roundCapEnd=function(t,e,i,n,r){var o=t.x,s=t.y,a=i,c=-e;this._vset(o+a*n,s+c*n),this._vset(o-a*n,s-c*n);for(var h=0;h<r;h++){var l=h/(r-1)*w,u=N(l)*n,_=P(l)*n;this._vset(o,s),this._vset(o-a*u+e*_,s-c*u+i*_)}},u._roundJoin=function(t,e,i,n,r){var o=t.dy,s=-t.dx,a=e.dy,c=-e.dx,h=e.x,l=e.y;if(0!=(e.flags&M.PT_LEFT)){var u=(C=this._chooseBevel(e.flags&M.PT_INNERBEVEL,t,e,i))[0],_=C[1],d=C[2],f=C[3],p=D(-s,-o);(T=D(-c,-a))>p&&(T-=2*w),this._vset(u,_),this._vset(h-o*n,e.y-s*n);for(var g=F(L((p-T)/w)*r,2,r),m=0;m<g;m++){var v=h+N(R=p+m/(g-1)*(T-p))*n,y=l+P(R)*n;this._vset(h,l),this._vset(v,y)}this._vset(d,f),this._vset(h-a*n,l-c*n)}else{var C,T,x=(C=this._chooseBevel(e.flags&M.PT_INNERBEVEL,t,e,-n))[0],E=C[1],S=C[2],b=C[3];for(p=D(s,o),(T=D(c,a))<p&&(T+=2*w),this._vset(h+o*n,l+s*n),this._vset(x,E),g=F(L((T-p)/w)*r,2,r),m=0;m<g;m++){var R,A=h+N(R=p+m/(g-1)*(T-p))*i,O=l+P(R)*i;this._vset(A,O),this._vset(h,l)}this._vset(h+a*n,l+c*n),this._vset(S,b)}},u._bevelJoin=function(t,e,i,n){var r,o,s,a,c,h,l,u,_,d=t.dy,f=-t.dx,p=e.dy,g=-e.dx;e.flags&M.PT_LEFT?(c=(_=this._chooseBevel(e.flags&M.PT_INNERBEVEL,t,e,i))[0],h=_[1],l=_[2],u=_[3],this._vset(c,h),this._vset(e.x-d*n,e.y-f*n),this._vset(l,u),this._vset(e.x-p*n,e.y-g*n)):(r=(_=this._chooseBevel(e.flags&M.PT_INNERBEVEL,t,e,-n))[0],o=_[1],s=_[2],a=_[3],this._vset(e.x+d*i,e.y+f*i),this._vset(r,o),this._vset(e.x+p*i,e.y+g*i),this._vset(s,a))},u._tesselateBezier=function(t,e,i,n,r,o,s,a,c,h){var l,u,_,d,f,p,g,m,v,y,C,T,x,E,S,b;10<c||(f=.5*(r+s),p=.5*(o+a),g=.5*((l=.5*(t+i))+(_=.5*(i+r))),m=.5*((u=.5*(e+n))+(d=.5*(n+o))),((S=R((i-s)*(E=a-e)-(n-a)*(x=s-t)))+(b=R((r-s)*E-(o-a)*x)))*(S+b)<this._tessTol*(x*x+E*E)?this._addPoint(s,a,0===h?h|M.PT_BEVEL:h):(C=.5*(g+(v=.5*(_+f))),T=.5*(m+(y=.5*(d+p))),this._tesselateBezier(t,e,l,u,g,m,C,T,c+1,0),this._tesselateBezier(C,T,v,y,f,p,s,a,c+1,h)))},e.exports=l},{"./earcut":89,"./helper":94,"./types":96}],93:[function(t,e,i){var n=t("./types").LineCap,r=t("./types").LineJoin,o=cc.Class({name:"cc.Graphics",extends:cc._RendererUnderSG,editor:!1,properties:{_lineWidth:1,_strokeColor:cc.Color.BLACK,_lineJoin:r.MITER,_lineCap:n.BUTT,_fillColor:cc.Color.WHITE,_miterLimit:10,lineWidth:{get:function(){return this._lineWidth},set:function(t){this._sgNode.lineWidth=this._lineWidth=t}},lineJoin:{get:function(){return this._lineJoin},set:function(t){this._sgNode.lineJoin=this._lineJoin=t},type:r},lineCap:{get:function(){return this._lineCap},set:function(t){this._sgNode.lineCap=this._lineCap=t},type:n},strokeColor:{get:function(){return this._strokeColor},set:function(t){this._sgNode.strokeColor=this._strokeColor=t}},fillColor:{get:function(){return this._fillColor},set:function(t){this._sgNode.fillColor=this._fillColor=t}},miterLimit:{get:function(){return this._miterLimit},set:function(t){this._sgNode.miterLimit=this._miterLimit=t}}},statics:{LineJoin:r,LineCap:n},_createSgNode:function(){return new _ccsg.GraphicsNode},_initSgNode:function(){var t=this._sgNode;t.lineWidth=this._lineWidth,t.lineJoin=this._lineJoin,t.lineCap=this._lineCap,t.strokeColor=this._strokeColor,t.fillColor=this._fillColor,t.miterLimit=this._miterLimit,t.setContentSize(this.node.getContentSize(!0))},moveTo:function(t,e){this._sgNode.moveTo(t,e)},lineTo:function(t,e){this._sgNode.lineTo(t,e)},bezierCurveTo:function(t,e,i,n,r,o){this._sgNode.bezierCurveTo(t,e,i,n,r,o)},quadraticCurveTo:function(t,e,i,n){this._sgNode.quadraticCurveTo(t,e,i,n)},arc:function(t,e,i,n,r,o){o=o||!1,this._sgNode.arc(t,e,i,n,r,o)},ellipse:function(t,e,i,n){this._sgNode.ellipse(t,e,i,n)},circle:function(t,e,i){this._sgNode.circle(t,e,i)},rect:function(t,e,i,n){this._sgNode.rect(t,e,i,n)},roundRect:function(t,e,i,n,r){this._sgNode.roundRect(t,e,i,n,r)},fillRect:function(t,e,i,n){this._sgNode.fillRect(t,e,i,n)},clear:function(t){this._sgNode.clear(!!t)},close:function(){this._sgNode.close()},stroke:function(){this._sgNode.stroke()},fill:function(){this._sgNode.fill()}});cc.Graphics=e.exports=o},{"./types":96}],94:[function(t,e,i){var E=Math.PI,S=Math.min,b=Math.max,R=Math.cos,A=Math.sin,O=Math.abs,c=Math.sign,h=.5522847493;e.exports={arc:function(t,e,i,n,r,o,s){var a,c,h,l=0,u=0,_=0,d=0,f=0,p=0,g=0,m=0,v=0,y=0,C=0,T=0,x=0;if(u=o-r,s=s||!1)if(O(u)>=2*E)u=2*E;else for(;u<0;)u+=2*E;else if(O(u)>=2*E)u=2*-E;else for(;0<u;)u-=2*E;for(h=0|b(1,S(O(u)/(.5*E)+.5,5)),_=O(4/3*(1-R(a=u/h/2))/A(a)),s||(_=-_),c=0;c<=h;c++)p=e+(d=R(l=r+u*(c/h)))*n,g=i+(f=A(l))*n,m=-f*n*_,v=d*n*_,0===c?t.moveTo(p,g):t.bezierCurveTo(y+T,C+x,p-m,g-v,p,g),y=p,C=g,T=m,x=v},ellipse:function(t,e,i,n,r){t.moveTo(e-n,i),t.bezierCurveTo(e-n,i+r*h,e-n*h,i+r,e,i+r),t.bezierCurveTo(e+n*h,i+r,e+n,i+r*h,e+n,i),t.bezierCurveTo(e+n,i-r*h,e+n*h,i-r,e,i-r),t.bezierCurveTo(e-n*h,i-r,e-n,i-r*h,e-n,i),t.close()},roundRect:function(t,e,i,n,r,o){if(o<.1)t.rect(e,i,n,r);else{var s=S(o,.5*O(n))*c(n),a=S(o,.5*O(r))*c(r);t.moveTo(e,i+a),t.lineTo(e,i+r-a),t.bezierCurveTo(e,i+r-a*(1-h),e+s*(1-h),i+r,e+s,i+r),t.lineTo(e+n-s,i+r),t.bezierCurveTo(e+n-s*(1-h),i+r,e+n,i+r-a*(1-h),e+n,i+r-a),t.lineTo(e+n,i+a),t.bezierCurveTo(e+n,i+a*(1-h),e+n-s*(1-h),i,e+n-s,i),t.lineTo(e+s,i),t.bezierCurveTo(e+s*(1-h),i,e,i+a*(1-h),e,i+a),t.close()}}}},{}],95:[function(t,e,i){"use strict";var n;(n=_ccsg.GraphicsNode=t("./graphics-node"))&&t("../utils/misc").propertyDefine(n,["lineWidth","lineCap","lineJoin","miterLimit","strokeColor","fillColor"],{}),t("./graphics")},{"../utils/misc":173,"./graphics":93,"./graphics-node":91}],96:[function(t,e,i){"use strict";var n=cc.Enum({BUTT:0,ROUND:1,SQUARE:2}),r=cc.Enum({BEVEL:0,ROUND:1,MITER:2});e.exports={LineCap:n,LineJoin:r}},{}],97:[function(t,e,i){t("./platform"),t("./assets"),t("./CCNode"),t("./CCScene"),t("./components"),t("./graphics"),t("./collider"),t("./collider/CCIntersection"),t("./physics"),t("./camera/CCCamera"),t("./base-ui/CCWidgetManager")},{"./CCNode":29,"./CCScene":30,"./assets":43,"./base-ui/CCWidgetManager":48,"./camera/CCCamera":218,"./collider":218,"./collider/CCIntersection":218,"./components":76,"./graphics":95,"./physics":218,"./platform":141}],98:[function(t,e,i){var l=/^(click)(\s)*=/,_=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=/;cc.HtmlTextParser=function(){this._parsedObject={},this._specialSymbolArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])},cc.HtmlTextParser.prototype={constructor:cc.HtmlTextParser,parse:function(t){this._resultObjectArray=[],this._stack=[];for(var e=0,i=t.length;e<i;){var n=t.indexOf("<",e);if(n<0)this._stack.pop(),this._processResult(t.substring(e)),e=i;else{this._processResult(t.substring(e,n));var r=t.indexOf(">",e);-1===r?r=n:"/"===t.charAt(n+1)?this._stack.pop():this._addToStack(t.substring(n+1,r)),e=r+1}}return this._resultObjectArray},_attributeToObject:function(t){var e,i,n,r,o={},s=(t=t.trim()).match(/^(color|size)(\s)*=/);if(s){if(e=s[0],""===(t=t.substring(e.length).trim()))return o;switch(i=t.indexOf(" "),e[0]){case"c":o.color=-1<i?t.substring(0,i).trim():t;break;case"s":o.size=parseInt(t)}return-1<i&&(r=t.substring(i+1).trim(),n=this._processEventHandler(r),o.event=n),o}if((s=t.match(/^(br(\s)*\/)/))&&0<s[0].length&&(e=s[0].trim()).startsWith("br")&&"/"===e[e.length-1])return o.isNewLine=!0,this._resultObjectArray.push({text:"",style:{newline:!0}}),o;if((s=t.match(/^(img(\s)*src(\s)*=[^>]+\/)/))&&0<s[0].length&&(e=s[0].trim()).startsWith("img")&&"/"===e[e.length-1]){var a;s=t.match(_);for(var c=!1;s;)e=(t=t.substring(t.indexOf(s[0]))).substr(0,s[0].length),l=-1<(i=(a=t.substring(e.length).trim()).indexOf(" "))?a.substr(0,i):a,e=(e=e.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=a.substring(i).trim(),"src"===e?(o.isImage=!0,l.endsWith("/")&&(l=l.substring(0,l.length-1)),0===l.indexOf("'")?(c=!0,l=l.substring(1,l.length-1)):0===l.indexOf('"')&&(c=!0,l=l.substring(1,l.length-1)),o.src=l):"height"===e?o.imageHeight=parseInt(l):"width"===e?o.imageWidth=parseInt(l):"click"===e&&(o.event=this._processEventHandler(e+"="+l)),s=t.match(_);return c&&o.isImage&&this._resultObjectArray.push({text:"",style:o}),{}}if(s=t.match(/^(outline(\s)*[^>]*)/)){var h={color:"#ffffff",width:1};if(t=s[0].substring("outline".length).trim()){var l,u=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=/;for(s=t.match(u);s;)e=(t=t.substring(t.indexOf(s[0]))).substr(0,s[0].length),l=-1<(i=(a=t.substring(e.length).trim()).indexOf(" "))?a.substr(0,i):a,e=(e=e.replace(/[^a-zA-Z]/g,"").trim()).toLocaleLowerCase(),t=a.substring(i).trim(),"click"===e?o.event=this._processEventHandler(e+"="+l):"color"===e?h.color=l:"width"===e&&(h.width=parseInt(l)),s=t.match(u)}o.outline=h}if((s=t.match(/^(on|u|b|i)(\s)*/))&&0<s[0].length){switch(e=s[0],t=t.substring(e.length).trim(),e[0]){case"u":o.underline=!0;break;case"i":o.italic=!0;break;case"b":o.bold=!0}if(""===t)return o;n=this._processEventHandler(t),o.event=n}return o},_processEventHandler:function(t){for(var e=0,i={},n=t.match(l),r=!1;n;){var o=n[0],s="";if(r=!1,'"'===(t=t.substring(o.length).trim()).charAt(0))-1<(e=t.indexOf('"',1))&&(s=t.substring(1,e).trim(),r=!0),e++;else if("'"===t.charAt(0))-1<(e=t.indexOf("'",1))&&(s=t.substring(1,e).trim(),r=!0),e++;else{var a=t.match(/(\S)+/);e=(s=a?a[0]:"").length}if(r){o=o.substring(0,o.length-1).trim();var c=s.split("|");s=c[0];var h=c[1]||"";i[o]=s,i.eventType=h}n=(t=t.substring(e).trim()).match(l)}return i},_addToStack:function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;var i=this._stack[this._stack.length-1];for(var n in i)e[n]||(e[n]=i[n]);this._stack.push(e)}},_processResult:function(t){""!==t&&(t=this._escapeSpecialSymbol(t),0<this._stack.length?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},_escapeSpecialSymbol:function(t){for(var e=0;e<this._specialSymbolArray.length;++e){var i=this._specialSymbolArray[e][0],n=this._specialSymbolArray[e][1];t=t.replace(i,n)}return t}},cc.htmlTextParser=new cc.HtmlTextParser},{}],99:[function(t,e,i){t("./CCTextUtils");var r=t("../event/event-target"),n=t("../platform/js"),o=function(){this._u=0,this._v=0,this._width=0,this._height=0,this._offsetX=0,this._offsetY=0,this._textureID=0,this._validDefinition=!1,this._xAdvance=0};cc.FontAtlas=function(t){this._lineHeight=t.commonHeight,this._fontSize=t.fontSize,this._letterDefinitions={},this._fntConfig=t},cc.FontAtlas.prototype={constructor:cc.FontAtlas,setFontSize:function(t){this._fontSize=t},getOriginalFontSize:function(){return this._fntConfig.fontSize},addLetterDefinitions:function(t,e){this._letterDefinitions[t]=e},cloneLetterDefinition:function(){var t={};for(var e in this._letterDefinitions){var i=new o;cc.js.mixin(i,this._letterDefinitions[e]),t[e]=i}return t},assignLetterDefinitions:function(t){for(var e in this._letterDefinitions){var i=t[e],n=this._letterDefinitions[e];cc.js.mixin(n,i)}},scaleFontLetterDefinition:function(t){for(var e in this._letterDefinitions){var i=this._letterDefinitions[e];i._width*=t,i._height*=t,i._offsetX*=t,i._offsetY*=t,i._xAdvance*=t}},getLetterDefinitionForChar:function(t){return this._letterDefinitions.hasOwnProperty(t.charCodeAt(0))?this._letterDefinitions[t.charCodeAt(0)]:null}};var s=function(){this._char="",this._valid=!0,this._positionX=0,this._positionY=0,this._lineIndex=0};_ccsg.Label=_ccsg.Node.extend({_hAlign:cc.TextAlignment.LEFT,_vAlign:cc.VerticalTextAlignment.TOP,_string:"",_fontSize:24,_drawFontsize:24,_overFlow:0,_isWrapText:!0,_spacingX:0,_blendFunc:null,_labelType:0,_fontHandle:"",_lineSpacing:0,_maxLineWidth:0,_labelDimensions:cc.size(0,0),_labelWidth:0,_labelHeight:0,_lineHeight:28,_outlined:!1,_outlineColor:null,_outlineWidth:1,_gradientEnabled:!1,_gradientStartColor:cc.color(255,255,255,255),_gradientEndColor:cc.color(255,255,255,255),_gradientDirection:0,_className:"Label",_margin:0,_isBold:!1,_isItalic:!1,_isUnderline:!1,_fontAsset:null,ctor:function(t,e){r.call(this);var i=e instanceof cc.Font,n=i?e.rawUrl:"";this._fontHandle=n,"string"!=typeof t&&(t=""+t),this._string=t,_ccsg.Node.prototype.ctor.call(this),this.setAnchorPoint(.5,.5),_ccsg.Node.prototype.setContentSize.call(this,10,10),this._blendFunc=cc.BlendFunc._alphaNonPremultiplied(),this._imageOffset=cc.p(0,0),this._numberOfLines=0,this._lettersInfo=[],this._linesWidth=[],this._linesOffsetX=[],this._horizontalKernings=[],this._reusedRect=cc.rect(0,0,0,0),i?this.setFontAsset(e):this.setFontFamily(n),this.setString(this._string)},_resetBMFont:function(){this._imageOffset.x=this._imageOffset.y=0,this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this._fontAtlas=null,this._config=null,this._numberOfLines=0,this._lettersInfo.length=0,this._linesWidth.length=0,this._linesOffsetX.length=0,this._textDesiredHeight=0,this._letterOffsetY=0,this._tailoredTopY=0,this._tailoredBottomY=0,this._bmfontScale=1,this._horizontalKernings.length=0,this._lineBreakWithoutSpaces=!1,this._reusedRect.x=this._reusedRect.y=this._reusedRect.width=this._reusedRect.height=0,this._textureLoaded=!1,this._spriteBatchNode&&(this.removeChild(this._spriteBatchNode),this._spriteBatchNode=null)},setHorizontalAlign:function(t){this._hAlign!==t&&(this._hAlign=t,this._notifyLabelSkinDirty())},getHorizontalAlign:function(){return this._hAlign},setVerticalAlign:function(t){this._vAlign!==t&&(this._vAlign=t,this._notifyLabelSkinDirty())},getVerticalAlign:function(){return this._vAlign},setString:function(t){"string"!=typeof t&&(t=""+t),this._string!==t&&(this._string=t,this._notifyLabelSkinDirty())},setMargin:function(t){this._margin!==t&&(this._margin=t,this._notifyLabelSkinDirty())},getString:function(){return this._string},getStringLength:function(){return this._string.length},enableWrapText:function(t){this._isWrapText!==t&&this._overFlow!==_ccsg.Label.Overflow.RESIZE_HEIGHT&&this._overFlow!==_ccsg.Label.Overflow.NONE&&(this._isWrapText=t,this._rescaleWithOriginalFontSize(),this._notifyLabelSkinDirty())},enableItalics:function(t){(this._isItalic=t)?this.setSkewX(12):this.setSkewX(0)},enableBold:function(t){this._isBold!==t&&(this._isBold=t,this._notifyLabelSkinDirty())},enableUnderline:function(t){this._isUnderline!==t&&(this._isUnderline=t,this._notifyLabelSkinDirty())},isWrapTextEnabled:function(){return this._isWrapText},getFontName:function(){return this._fontHandle},setFontSize:function(t){this._fontSize!==t&&(this._fontSize=t,this._drawFontsize=t,this._notifyLabelSkinDirty())},getFontSize:function(){return this._fontSize},isOutlined:function(){return this._outlined},setOutlined:function(t){this._outlined!==t&&(this._outlined=!!t,this._notifyLabelSkinDirty())},setFillColorGradientEnabled:function(t){this._gradientEnabled!==t&&(this._gradientEnabled=!!t,this._notifyLabelSkinDirty())},getFillColorGradientEnabled:function(){return this._gradientEnabled},setGradientStartColor:function(t){this._gradientStartColor!==t&&(this._gradientStartColor=t,this._notifyLabelSkinDirty())},getGradientStartColor:function(){return this._gradientStartColor},setGradientEndColor:function(t){this._gradientEndColor!==t&&(this._gradientEndColor=t,this._notifyLabelSkinDirty())},getGradientEndColor:function(){return this._gradientEndColor},setFillColorGradientDirection:function(t){this._gradientDirection=t,this._notifyLabelSkinDirty()},getFillColorGradientDirection:function(){return this._gradientDirection},getOutlineColor:function(){return this._outlineColor},setOutlineColor:function(t){this._outlineColor!==t&&(this._outlineColor=cc.color(t),this._notifyLabelSkinDirty())},setOutlineWidth:function(t){this._outlineWidth!==t&&(this._outlineWidth=t,this._notifyLabelSkinDirty())},getOutlineWidth:function(){return this._outlineWidth},_updateWrapText:function(t){t===_ccsg.Label.Overflow.RESIZE_HEIGHT&&(this._isWrapText=!0),t===_ccsg.Label.Overflow.NONE&&(this._isWrapText=!1)},_setOverflowBMFont:function(){this._labelType===_ccsg.Label.Type.BMFont&&(this._overFlow===_ccsg.Label.Overflow.RESIZE_HEIGHT&&this._setDimensions(this._labelDimensions.width,0),this._overFlow===_ccsg.Label.Overflow.NONE&&this._setDimensions(0,0),this._rescaleWithOriginalFontSize())},setOverflow:function(t){this._overFlow!==t&&(this._overFlow=t,this._updateWrapText(this._overFlow),this._setOverflowBMFont(),this._notifyLabelSkinDirty())},getOverflow:function(){return this._overFlow},setSpacingX:function(t){this._spacingX!==t&&(this._spacingX=t,this._notifyLabelSkinDirty())},setLineHeight:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._notifyLabelSkinDirty())},setLineBreakWithoutSpace:function(t){this._lineBreakWithoutSpaces!==t&&(this._lineBreakWithoutSpaces=t,this._notifyLabelSkinDirty())},getSpacingX:function(){return this._spacingX},getLineHeight:function(){return this._lineHeight},getBMFontLineHeight:function(){if(this._fontAtlas)return this._fontAtlas._lineHeight},setFontFamily:function(t){this._resetBMFont(),this._fontHandle=t||"Arial",this._labelType=_ccsg.Label.Type.SystemFont,this._blendFunc=cc.BlendFunc._alphaPremultiplied(),this._renderCmd._needDraw=!0,this._notifyLabelSkinDirty(),this.emit("load")},setFontAsset:function(t){var e=(this._fontAsset=t)instanceof cc.Font;if(e){var i=e?t.rawUrl:"",n=cc.path.extname(i);this._resetBMFont(),".ttf"===n?(this._labelType=_ccsg.Label.Type.TTF,this._blendFunc=cc.BlendFunc._alphaPremultiplied(),this._renderCmd._needDraw=!0,this._fontHandle=this._loadTTFFont(i)):t.spriteFrame&&(this._labelType=_ccsg.Label.Type.BMFont,this._blendFunc=cc.BlendFunc._alphaNonPremultiplied(),this._renderCmd._needDraw=!1,this._initBMFontWithString(this._string,t)),this._notifyLabelSkinDirty()}else this.setFontFamily("")},_loadTTFFont:function(t){var e,i=this;return e=cc.CustomFontLoader._getFontFamily(t),cc.CustomFontLoader.loadTTF(t,function(){i._notifyLabelSkinDirty(),i.emit("load")}),e},setContentSize:function(t,e){this._overFlow!==_ccsg.Label.Overflow.NONE&&this._setDimensions(t,e)},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e)},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},_setupBMFontOverflowMetrics:function(t,e){this._overFlow===_ccsg.Label.Overflow.RESIZE_HEIGHT&&(e=0),this._overFlow===_ccsg.Label.Overflow.NONE&&(e=t=0),this._labelWidth=t,this._labelHeight=e,this._labelDimensions.width=t,this._labelDimensions.height=e,this._maxLineWidth=t},_updateLabel:function(){if(this._labelType===_ccsg.Label.Type.BMFont){var t=this._contentSize,e=t.width,i=t.height;this._setupBMFontOverflowMetrics(e,i),this._updateContent(),this.setColor(this.color)}else this._labelType!==_ccsg.Label.Type.TTF&&this._labelType!==_ccsg.Label.Type.SystemFont||this._renderCmd._bakeLabel()},_notifyLabelSkinDirty:function(){this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.textDirty|_ccsg.Node._dirtyFlags.contentDirty)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL?new _ccsg.Label.WebGLRenderCmd(this):new _ccsg.Label.CanvasRenderCmd(this)},getContentSize:function(){return this._renderCmd._dirtyFlag&_ccsg.Node._dirtyFlags.textDirty&&(this._updateLabel(),this._renderCmd._dirtyFlag&=~_ccsg.Node._dirtyFlags.textDirty),_ccsg.Node.prototype.getContentSize.call(this)},_getWidth:function(){return this._renderCmd._dirtyFlag&_ccsg.Node._dirtyFlags.textDirty&&(this._updateLabel(),this._renderCmd._dirtyFlag&=~_ccsg.Node._dirtyFlags.textDirty),_ccsg.Node.prototype._getWidth.call(this)},_getHeight:function(){return this._renderCmd._dirtyFlag&_ccsg.Node._dirtyFlags.textDirty&&(this._updateLabel(),this._renderCmd._dirtyFlag&=~_ccsg.Node._dirtyFlags.textDirty),_ccsg.Node.prototype._getHeight.call(this)},_alignText:function(){var t=!0;do{if(!this._spriteBatchNode)return!0;if(this._textDesiredHeight=0,this._linesWidth=[],this._lineBreakWithoutSpaces?this._multilineTextWrapByChar():this._multilineTextWrapByWord(),this._computeAlignmentOffset(),this._overFlow===_ccsg.Label.Overflow.SHRINK&&0<this.getFontSize()&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp.bind(this)),!this._updateQuads()){t=!1,this._overFlow===_ccsg.Label.Overflow.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp.bind(this));break}}while(0);return t},_isHorizontalClamped:function(t,e){var i=this._linesWidth[e],n=t>this._contentSize.width||t<0;return this._isWrapText?i>this._contentSize.width&&n:n},_updateQuads:function(){var t=!0;this._spriteBatchNode.removeAllChildren();for(var e=0;e<this._string.length;++e)if(this._lettersInfo[e]._valid){var i=this._fontAtlas._letterDefinitions[this._lettersInfo[e]._char];this._reusedRect.height=i._height,this._reusedRect.width=i._width,this._reusedRect.x=i._u,this._reusedRect.y=i._v;var n=this._lettersInfo[e]._positionY+this._letterOffsetY;if(0<this._labelHeight){if(n>this._tailoredTopY){var r=n-this._tailoredTopY;this._reusedRect.y+=r,this._reusedRect.height-=r,n-=r}n-i._height*this._bmfontScale<this._tailoredBottomY&&(this._reusedRect.height=n<this._tailoredBottomY?0:n-this._tailoredBottomY)}var o=this._lettersInfo[e]._lineIndex,s=this._lettersInfo[e]._positionX+i._width/2*this._bmfontScale+this._linesOffsetX[o];if(0<this._labelWidth&&this._isHorizontalClamped(s,o))if(this._overFlow===_ccsg.Label.Overflow.CLAMP)this._reusedRect.width=0;else if(this._overFlow===_ccsg.Label.Overflow.SHRINK){if(this._contentSize.width>i._width){t=!1;break}this._reusedRect.width=0}if(0<this._reusedRect.height&&0<this._reusedRect.width){var a=this.getChildByTag(e),c=this._spriteBatchNode._texture,h=this._spriteFrame,l=this._spriteFrame.isRotated(),u=h._originalSize,_=h._rect,d=h._offset,f=d.x+(u.width-_.width)/2,p=d.y-(u.height-_.height)/2;if(l){var g=this._reusedRect.x;this._reusedRect.x=_.x+_.height-this._reusedRect.y-this._reusedRect.height-p,this._reusedRect.y=g+_.y-f,this._reusedRect.y<0&&(this._reusedRect.height=this._reusedRect.height+p)}else this._reusedRect.x+=_.x-f,this._reusedRect.y+=_.y+p;a?a.setTextureRect(this._reusedRect,l):((a=new _ccsg.Sprite).initWithTexture(c,this._reusedRect,l),a.setAnchorPoint(cc.p(0,1)));var m=this._lettersInfo[e]._positionX+this._linesOffsetX[this._lettersInfo[e]._lineIndex];a.setPosition(m,n),this._updateLetterSpriteScale(a),this._spriteBatchNode.addChild(a)}}return t},_updateLetterSpriteScale:function(t){this._labelType===_ccsg.Label.Type.BMFont&&0<this._fontSize&&t.setScale(this._bmfontScale)},_recordPlaceholderInfo:function(t,e){if(t>=this._lettersInfo.length){var i=new s;this._lettersInfo.push(i)}this._lettersInfo[t]._char=e,this._lettersInfo[t]._valid=!1},_recordLetterInfo:function(t,e,i,n){if(i>=this._lettersInfo.length){var r=new s;this._lettersInfo.push(r)}e=e.charCodeAt(0),this._lettersInfo[i]._lineIndex=n,this._lettersInfo[i]._char=e,this._lettersInfo[i]._valid=this._fontAtlas._letterDefinitions[e]._validDefinition,this._lettersInfo[i]._positionX=t.x,this._lettersInfo[i]._positionY=t.y},_setDimensions:function(t,e){var i="number"==typeof t.width?t.width:t,n="number"==typeof t.height?t.height:e,r=this.getContentSize();_ccsg.Node.prototype.setContentSize.call(this,t,e),n===r.height&&i===r.width||(this._setupBMFontOverflowMetrics(i,n),0<this._drawFontsize&&this._restoreFontSize(),this._notifyLabelSkinDirty())},_restoreFontSize:function(){this._fontSize=this._drawFontsize},_multilineTextWrap:function(t){var e=this.getStringLength(),i=0,n=0,r=0,o=0,s=0,a=this._lineSpacing,c=0,h=0,l=null,u=cc.p(0,0);this._updateBMFontScale();for(var _=0;_<e;){var d=this._string.charAt(_);if("\n"!==d){for(var f=t(this._string,_,e),p=c,g=h,m=s,v=n,y=!1,C=0;C<f;++C){var T=_+C;if("\r"!==(d=this._string.charAt(T)))if(l=this._fontAtlas.getLetterDefinitionForChar(d)){var x=v+l._offsetX*this._bmfontScale;if(this._isWrapText&&0<this._maxLineWidth&&0<n&&x+l._width*this._bmfontScale>this._maxLineWidth&&!cc.TextUtils.isUnicodeSpace(d)){this._linesWidth.push(s),i++,n=s=0,r-=this._lineHeight*this._bmfontScale+a,y=!0;break}u.x=x,u.y=r-l._offsetY*this._bmfontScale,this._recordLetterInfo(u,d,T,i),T+1<this._horizontalKernings.length&&T<e-1&&(v+=this._horizontalKernings[T+1]),v+=l._xAdvance*this._bmfontScale+this._spacingX,m=u.x+l._width*this._bmfontScale,p<u.y&&(p=u.y),g>u.y-l._height*this._bmfontScale&&(g=u.y-l._height*this._bmfontScale)}else this._recordPlaceholderInfo(T,d),console.log("Can't find letter definition in texture atlas "+this._config.atlasName+" for letter:"+d);else this._recordPlaceholderInfo(T,d)}y||(n=v,c<p&&(c=p),g<h&&(h=g),o<(s=m)&&(o=s),_+=f)}else this._linesWidth.push(s),i++,n=s=0,r-=this._lineHeight*this._bmfontScale+a,this._recordPlaceholderInfo(_,d),_++}this._linesWidth.push(s),this._numberOfLines=i+1,this._textDesiredHeight=this._numberOfLines*this._lineHeight*this._bmfontScale,1<this._numberOfLines&&(this._textDesiredHeight+=(this._numberOfLines-1)*this._lineSpacing);var E=cc.size(this._labelWidth,this._labelHeight);return this._labelWidth<=0&&(E.width=parseFloat(o.toFixed(2))),this._labelHeight<=0&&(E.height=parseFloat(this._textDesiredHeight.toFixed(2))),_ccsg.Node.prototype.setContentSize.call(this,E),this._tailoredTopY=E.height,(this._tailoredBottomY=0)<c&&(this._tailoredTopY=E.height+c),h<-this._textDesiredHeight&&(this._tailoredBottomY=this._textDesiredHeight+h),!0},_multilineTextWrapByWord:function(){return this._multilineTextWrap(this._getFirstWordLen.bind(this))},_multilineTextWrapByChar:function(){return this._multilineTextWrap(this._getFirstCharLen.bind(this))},_isVerticalClamp:function(){return this._textDesiredHeight>this._contentSize.height},_isHorizontalClamp:function(){for(var t=!1,e=0;e<this.getStringLength();++e)if(this._lettersInfo[e]._valid){var i=this._fontAtlas._letterDefinitions[this._lettersInfo[e]._char],n=this._lettersInfo[e]._positionX+i._width/2*this._bmfontScale,r=this._lettersInfo[e]._lineIndex;if(0<this._labelWidth)if(this._isWrapText){if(this._linesWidth[r]>this._contentSize.width&&(n>this._contentSize.width||n<0)){t=!0;break}}else if(n>this._contentSize.width){t=!0;break}}return t},_shrinkLabelToContentSize:function(t){for(var e=this.getFontSize(),i=0,n=this._fontAtlas.cloneLetterDefinition(),r=this._lineHeight,o=!0;t();){var s=e-++i;if(o=!1,s<=0)break;var a=s/e;this._fontAtlas.assignLetterDefinitions(n),this._fontAtlas.scaleFontLetterDefinition(a),this._lineHeight=r*a,this._lineBreakWithoutSpaces?this._multilineTextWrapByChar():this._multilineTextWrapByWord(),this._computeAlignmentOffset()}this._lineHeight=r,this._fontAtlas.assignLetterDefinitions(n),o||0<=e-i&&this._scaleFontSizeDown(e-i)},_scaleFontSizeDown:function(t){var e=!0;this._labelType===_ccsg.Label.Type.BMFont&&(t||(e=!(t=.1)),this._fontSize=t,e&&this._updateContent())},_updateContent:function(){this._fontAtlas&&(this._computeHorizontalKerningForText(this._string),this._alignText())},_computeAlignmentOffset:function(){switch(this._linesOffsetX=[],this._hAlign){case cc.TextAlignment.LEFT:for(var t=0;t<this._numberOfLines;++t)this._linesOffsetX.push(0);break;case cc.TextAlignment.CENTER:this._linesWidth.forEach(function(t){this._linesOffsetX.push((this._contentSize.width-t)/2)}.bind(this));break;case cc.TextAlignment.RIGHT:this._linesWidth.forEach(function(t){this._linesOffsetX.push(this._contentSize.width-t)}.bind(this))}switch(this._vAlign){case cc.VerticalTextAlignment.TOP:this._letterOffsetY=this._contentSize.height;break;case cc.VerticalTextAlignment.CENTER:this._letterOffsetY=(this._contentSize.height+this._textDesiredHeight)/2;break;case cc.VerticalTextAlignment.BOTTOM:this._letterOffsetY=this._textDesiredHeight}},_getFirstCharLen:function(){return 1},_getFirstWordLen:function(t,e,i){var n=t.charAt(e);if(cc.TextUtils.isUnicodeCJK(n)||"\n"===n||cc.TextUtils.isUnicodeSpace(n))return 1;var r=1;if(!(o=this._fontAtlas.getLetterDefinitionForChar(n)))return r;for(var o,s=o._xAdvance*this._bmfontScale+this._spacingX,a=e+1;a<i&&(n=t.charAt(a),o=this._fontAtlas.getLetterDefinitionForChar(n));++a){if(s+o._offsetX*this._bmfontScale+o._width*this._bmfontScale>this._maxLineWidth&&!cc.TextUtils.isUnicodeSpace(n)&&0<this._maxLineWidth)return r;if(s+=o._xAdvance*this._bmfontScale+this._spacingX,"\n"===n||cc.TextUtils.isUnicodeSpace(n)||cc.TextUtils.isUnicodeCJK(n))break;r++}return r},_updateBMFontScale:function(){if(this._labelType===_ccsg.Label.Type.BMFont){var t=this._fontAtlas._fontSize;this._bmfontScale=this._fontSize/t}else this._bmfontScale=1},_initBMFontWithString:function(t,e){if(this._config)return cc.logID(4002),!1;this._string=t,this._setBMFontFile(e)},_createSpriteBatchNode:function(t){this._spriteBatchNode=new cc.SpriteBatchNode(t,this._string.length),this._spriteBatchNode.setCascadeColorEnabled(!0),this._spriteBatchNode.setCascadeOpacityEnabled(!0),this.addChild(this._spriteBatchNode),this._updateContent(),this.setColor(this.color)},_createFontChars:function(){if(this._config){this._fontAtlas=new cc.FontAtlas(this._config),this._lineHeight||(this._lineHeight=this._fontAtlas._lineHeight);var t=this._config.fontDefDictionary;for(var e in t){var i=new o,n=t[e].rect;i._offsetX=parseInt(t[e].xOffset),i._offsetY=parseInt(t[e].yOffset),i._width=parseInt(n.width),i._height=parseInt(n.height),i._u=parseInt(n.x)+this._imageOffset.x,i._v=parseInt(n.y)+this._imageOffset.y,i._textureID=0,i._validDefinition=!0,i._xAdvance=parseInt(t[e].xAdvance),this._fontAtlas.addLetterDefinitions(e,i)}}},_rescaleWithOriginalFontSize:function(){var t=this.getFontSize();1<=this._drawFontsize-t&&this._overFlow===_ccsg.Label.Overflow.SHRINK&&(this._labelType===_ccsg.Label.Type.BMFont?this._scaleFontSizeDown(this._drawFontsize):this._fontSize=this._drawFontsize)},_computeHorizontalKerningForText:function(){for(var t=this.getStringLength(),e=this._config.kerningDict,i=-1,n=0;n<t;++n){var r=this._string.charCodeAt(n),o=e[i<<16|65535&r]||0;this._horizontalKernings[n]=n<t-1?o:0,i=r}},_setBMFontFile:function(t){if(t&&this._labelType===_ccsg.Label.Type.BMFont){var e=this;this._resetBMFont();var i=this._fontAsset._fntConfig;i?e._config=i:cc.warn("Invalid BMFont Assets!");var n=t.spriteFrame;e._createFontChars();var r=function(){var t=n.getTexture();e._textureLoaded=t.loaded,e._createSpriteBatchNode(t),e.emit("load")};(e._spriteFrame=n).textureLoaded()?r():(n.once("load",r),n.ensureLoadTexture())}}}),_ccsg.Label.pool=new n.Pool(function(t){return t instanceof _ccsg.Label&&(t._string="",t._fontAsset=null,t._fontHandle="",t._labelType=0,t._resetBMFont(),t._renderCmd._texture.releaseTexture(),t._updateLabel(),!0)},120),_ccsg.Label.pool.get=function(t,e){var i=this._get();if(i){var n=e instanceof cc.Font,r=n?e.rawUrl:"";return i._fontHandle=r,"string"!=typeof t&&(t=""+t),i._string=t,i._position.x=0,i._position.y=0,i.setAnchorPoint(.5,.5),_ccsg.Node.prototype.setContentSize.call(i,10,10),n?i.setFontAsset(e):i.setFontFamily("Arial"),i.setString(t),i.setHorizontalAlign(cc.TextAlignment.LEFT),i.setVerticalAlign(cc.VerticalTextAlignment.TOP),i.setFontSize(24),i.setOverflow(0),i.enableWrapText(!0),i.setVisible(!0),i.setLineHeight(28),i.setOutlined(!1),i.enableBold(!1),i.enableItalics(!1),i.enableUnderline(!1),i}return new _ccsg.Label(t||"",e)};var a=_ccsg.Label.prototype;cc.js.addon(a,r.prototype),_ccsg.Label.Type=cc.Enum({TTF:0,BMFont:1,SystemFont:2}),_ccsg.Label.Overflow=cc.Enum({NONE:0,CLAMP:1,SHRINK:2,RESIZE_HEIGHT:3});var c=_ccsg.Label.prototype;Object.defineProperty(c,"width",{get:c._getWidth,set:_ccsg.Node.prototype._setWidth}),Object.defineProperty(c,"height",{get:c._getHeight,set:_ccsg.Node.prototype._setHeight})},{"../event/event-target":85,"../platform/js":144,"./CCTextUtils":102}],100:[function(t,e,i){(function(){_ccsg.Label.TTFLabelBaker=function(){};var t=_ccsg.Label.TTFLabelBaker.prototype=Object.create(Object.prototype);t.updateStatus=function(){var t=_ccsg.Node._dirtyFlags,e=this._dirtyFlag,i=e&t.colorDirty,n=e&t.opacityDirty;i&&this._updateDisplayColor(),n&&(this._updateDisplayOpacity(),this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty)),e&t.contentDirty&&(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._dirtyFlag&=~t.contentDirty),(i||e&t.textDirty)&&(this._notifyRegionStatus&&this._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty),this._rebuildLabelSkin()),this._dirtyFlag&t.transformDirty&&(this.transform(this.getParentRenderCmd(),!0),this._dirtyFlag&=~t.transformDirty)},t._syncStatus=function(t){var e=_ccsg.Node._dirtyFlags,i=this._dirtyFlag,n=t?t._node:null;n&&n._cascadeColorEnabled&&t._dirtyFlag&e.colorDirty&&(i|=e.colorDirty),n&&n._cascadeOpacityEnabled&&t._dirtyFlag&e.opacityDirty&&(i|=e.opacityDirty),t&&t._dirtyFlag&e.transformDirty&&(i|=e.transformDirty);var r=i&e.colorDirty,o=i&e.opacityDirty;this._dirtyFlag=i,r&&this._syncDisplayColor(),o&&this._syncDisplayOpacity(),(r||o||this._dirtyFlag&e.textDirty)&&this._rebuildLabelSkin(),this._dirtyFlag&e.transformDirty&&this.transform(t)},t._getLineHeight=function(){var t=this._node.getLineHeight(),e=this._node;return 0|(0===t?e._fontSize:t*e._fontSize/this._drawFontsize)},t._constructFontDesc=function(){var t=this._node,e=t._fontSize.toString()+"px ";return e+=0===t._fontHandle.length?"serif":t._fontHandle,t._isBold&&(e="bold "+e),e},t._measureText=function(e){return function(t){return e.measureText(t).width}},t._calculateLabelFont=function(){var t=this._node,e=t._string.split("\n");t._fontSize=t._drawFontsize;var i=this._constructFontDesc();this._labelContext.font=i;var n=this._calculateParagraphLength(e,this._labelContext);if(_ccsg.Label.Overflow.SHRINK===t._overFlow){this._splitedStrings=e;var r=0,o=0,s=0;if(t._isWrapText){var a=this._canvasSize.width-2*this._getMargin(),c=this._canvasSize.height-2*this._getMargin();if(a<0||c<0)return i=this._constructFontDesc(),this._labelContext.font=i;o=c+1,s=a+1;for(var h=this._drawFontsize+1,l="",u=!0,_=0|h;c<o||a<s;){if(u?h=_/2|0:_=h=_-1,h<=0){cc.logID(4003);break}for(t._fontSize=h,i=this._constructFontDesc(),this._labelContext.font=i,this._splitedStrings=[],r=o=0;r<e.length;++r){var d=0,f=this._labelContext.measureText(e[r]).width;for(l=cc.TextUtils.fragmentText(e[r],f,a,this._measureText(this._labelContext));d<l.length;)s=this._labelContext.measureText(l[d]).width,o+=this._getLineHeight(),++d;this._splitedStrings=this._splitedStrings.concat(l)}u&&(c<o?_=0|h:(u=!1,o=c+1))}}else{for(o=e.length*this._getLineHeight(),r=0;r<e.length;++r)s<n[r]&&(s=n[r]);var p=(this._canvasSize.width-2*this._getMargin())/s,g=this._canvasSize.height/o;t._fontSize=this._drawFontsize*Math.min(1,p,g)|0,i=this._constructFontDesc(),this._labelContext.font=i}}return i},t._getMargin=function(){return this._node&&this._node._margin||0},t._calculateParagraphLength=function(t,e){for(var i=[],n=0;n<t.length;++n){var r=e.measureText(t[n]);i.push(r.width)}return i},t._calculateCanvasSize=function(){var t=this._node,e=t._contentSize.width,i=t._contentSize.height;return e<=0&&(e=1),i<=0&&(i=1),cc.size(e,i)},t._calculateSplitedStrings=function(){var t,e=this._node,i=e._string.split("\n");if(e._isWrapText){this._splitedStrings=[];var n=this._canvasSize.width-2*this._getMargin();for(t=0;t<i.length;++t){var r=this._labelContext.measureText(i[t]).width,o=cc.TextUtils.fragmentText(i[t],r,n,this._measureText(this._labelContext));this._splitedStrings=this._splitedStrings.concat(o)}}else this._splitedStrings=i},t._updateLabelDimensions=function(){var t,e=this._node,i=e._string.split("\n"),n=this._labelContext;if(_ccsg.Label.Overflow.RESIZE_HEIGHT===e._overFlow)this._canvasSize.height=this._splitedStrings.length*this._getLineHeight(),_ccsg.Node.prototype.setContentSize.call(e,this._canvasSize);else if(_ccsg.Label.Overflow.NONE===e._overFlow){this._splitedStrings=i;var r=0,o=0;for(t=0;t<i.length;++t){var s=n.measureText(i[t]).width;r=s<r?r:s}o=this._splitedStrings.length*this._getLineHeight(),this._canvasSize.width=Math.round(r.toFixed(2))+2*this._getMargin(),this._canvasSize.height=Math.round(o.toFixed(2)),e._isItalic&&(this._canvasSize.width+=e._drawFontsize*Math.tan(.20943951)),_ccsg.Node.prototype.setContentSize.call(e,this._canvasSize)}this._labelCanvas.width=this._canvasSize.width,this._labelCanvas.height=this._canvasSize.height},t._calculateFillTextStartPosition=function(){var t,e,i=this._node,n=this._getLineHeight(),r=this._splitedStrings.length;return t=cc.TextAlignment.RIGHT===i._hAlign?this._canvasSize.width-this._getMargin():cc.TextAlignment.CENTER===i._hAlign?this._canvasSize.width/2:0+this._getMargin(),e=cc.VerticalTextAlignment.TOP===i._vAlign?0:cc.VerticalTextAlignment.CENTER===i._vAlign?this._canvasSize.height/2-n*(r-1)/2:this._canvasSize.height-n*(r-1),cc.p(t,e)},t._calculateTextBaseline=function(){var t,e,i=this._node;t=cc.TextAlignment.RIGHT===i._hAlign?"right":cc.TextAlignment.CENTER===i._hAlign?"center":"left",this._labelContext.textAlign=t,e=cc.VerticalTextAlignment.TOP===i._vAlign?"top":cc.VerticalTextAlignment.CENTER===i._vAlign?"middle":"bottom",this._labelContext.textBaseline=e},t._bakeLabel=function(){var t=this._node;this._drawFontsize=t._drawFontsize,this._canvasSize=this._calculateCanvasSize(),this._fontDesc=this._calculateLabelFont(),this._calculateSplitedStrings(),this._updateLabelDimensions(),this._calculateTextBaseline(),this._updateTexture()},t._calculateUnderlineStartPosition=function(){var t,e,i=this._node,n=this._getLineHeight(),r=this._splitedStrings.length;return t=0+this._getMargin(),e=cc.VerticalTextAlignment.TOP===i._vAlign?i._fontSize:cc.VerticalTextAlignment.CENTER===i._vAlign?this._canvasSize.height/2-n*(r-1)/2+i._fontSize/2:this._canvasSize.height-n*(r-1),cc.p(t,e)},t._updateTexture=function(){this._labelContext.clearRect(0,0,this._canvasSize.width,this._canvasSize.height),this._labelContext.font=this._fontDesc;var t=this._calculateFillTextStartPosition(),e=this._getLineHeight();this._labelContext.lineJoin="round";var i,n=this._displayedColor;this._labelContext.fillStyle="rgb("+n.r+","+n.g+","+n.b+")";for(var r=0;r<this._splitedStrings.length;++r){if(this._node.isOutlined()){var o=this._node.getOutlineColor()||cc.color(255,255,255,255);this._labelContext.globalCompositeOperation="source-over",this._labelContext.strokeStyle="rgb("+o.r+","+o.g+","+o.b+")",this._labelContext.lineWidth=2*this._node.getOutlineWidth(),this._labelContext.strokeText(this._splitedStrings[r],t.x,t.y+r*e)}this._labelContext.fillText(this._splitedStrings[r],t.x,t.y+r*e),this._node._isUnderline&&(i=this._calculateUnderlineStartPosition(),this._labelContext.save(),this._labelContext.beginPath(),this._labelContext.lineWidth=this._node._fontSize/8,this._labelContext.strokeStyle="rgb("+n.r+","+n.g+","+n.b+")",this._labelContext.moveTo(i.x,i.y+r*e-1),this._labelContext.lineTo(i.x+this._labelCanvas.width,i.y+r*e-1),this._labelContext.stroke(),this._labelContext.restore())}this._texture.loaded=!1,this._texture._image=this._labelCanvas,this._texture.handleLoadedTexture(!0,cc.Texture2D.PixelFormat.RGBA4444)},t._rebuildLabelSkin=function(){this._dirtyFlag&=~_ccsg.Node._dirtyFlags.textDirty,this._node._updateLabel()}})(),function(){_ccsg.Label.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._texture=new cc.Texture2D,this._labelCanvas=document.createElement("canvas"),this._labelCanvas.width=1,this._labelCanvas.height=1,this._labelContext=this._labelCanvas.getContext("2d"),this._texture.initWithElement(this._labelCanvas),this._splitedStrings=null};var t=_ccsg.Label.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);cc.js.mixin(t,_ccsg.Label.TTFLabelBaker.prototype),t.constructor=_ccsg.Label.CanvasRenderCmd,t._doCulling=function(){var t=cc.visibleRect,e=this._currentRegion,i=e._minX,n=e._maxX,r=e._minY,o=e._maxY,s=t.left.x,a=t.right.x,c=t.top.y,h=t.bottom.y;this._needDraw=!(n<s||a<i||o<h||c<r)},t.rendering=function(t,e,i){var n=this._node;if(n._labelType===_ccsg.Label.Type.TTF||n._labelType===_ccsg.Label.Type.SystemFont){var r=this._displayedOpacity,o=r/255;if(0===r)return;var s=t||cc._renderContext,a=s.getContext();if(s.setTransform(this._worldTransform,e,i),s.setCompositeOperation(_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(n._blendFunc)),s.setGlobalAlpha(o),this._texture){var c,h,l,u,_;l=-this._node._contentSize.height,u=this._node._contentSize.width,_=this._node._contentSize.height,c=this._texture.getPixelWidth(),h=this._texture.getPixelHeight();var d=this._texture._image;""!==this._texture._pattern?(s.setFillStyle(a.createPattern(d,this._texture._pattern)),a.fillRect(0,l,u,_)):0!==c&&0!==h&&0!==u&&0!==_&&a.drawImage(d,0,0,c,h,0,l,u,_)}cc.g_NumberOfDraws=cc.g_NumberOfDraws+1}}}()},{}],101:[function(t,e,i){var n;_ccsg.Label.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._texture=new cc.Texture2D,n=n||document.createElement("canvas"),this._labelCanvas=n,this._texture.initWithElement(this._labelCanvas),this._labelContext=this._labelCanvas.getContext("2d"),this._labelCanvas.width=1,this._labelCanvas.height=1,this._splitedStrings=null,this._drawFontsize=0,this._vertices=[{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:1},{x:0,y:0,u:1,v:0},{x:0,y:0,u:1,v:1}],this._color=new Uint32Array(1),this._dirty=!1,this._shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_SPRITE_POSITION_TEXTURECOLOR)};var r=_ccsg.Label.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);cc.js.mixin(r,_ccsg.Label.TTFLabelBaker.prototype),r.constructor=_ccsg.Label.WebGLRenderCmd,r.updateTransform=function(t){this.originUpdateTransform(t),this._node;var e=this._node.width,i=this._node.height,n=this._worldTransform,r=this._vertices;r[0].x=0*n.a+i*n.c+n.tx,r[0].y=0*n.b+i*n.d+n.ty,r[1].x=0*n.a+0*n.c+n.tx,r[1].y=0*n.b+0*n.d+n.ty,r[2].x=e*n.a+i*n.c+n.tx,r[2].y=e*n.b+i*n.d+n.ty,r[3].x=e*n.a+0*n.c+n.tx,r[3].y=e*n.b+0*n.d+n.ty},r._doCulling=function(){var t=this._node;if(t._string&&(t._labelType===_ccsg.Label.Type.TTF||t._labelType===_ccsg.Label.Type.SystemFont)){var e=cc.visibleRect;0<this._cameraFlag&&(e=cc.Camera.main.visibleRect);var i=e.left.x,n=e.right.x,r=e.top.y,o=e.bottom.y,s=this._vertices;(s[0].x-i&s[1].x-i&s[2].x-i&s[3].x-i)>>31||(n-s[0].x&n-s[1].x&n-s[2].x&n-s[3].x)>>31||(s[0].y-o&s[1].y-o&s[2].y-o&s[3].y-o)>>31||(r-s[0].y&r-s[1].y&r-s[2].y&r-s[3].y)>>31?this._needDraw=!1:this._needDraw=!0}},r.uploadData=function(t,e,i){var n=this._node;if(!n._string||n._labelType!==_ccsg.Label.Type.TTF&&n._labelType!==_ccsg.Label.Type.SystemFont)return 0;var r=this._displayedOpacity;this._color[0]=~~r<<24>>>0|~~r<<16|~~r<<8|~~r;var o,s,a=n._vertexZ,c=this._vertices,h=c.length,l=i;for(o=0;o<h;++o)s=c[o],t[l]=s.x,t[l+1]=s.y,t[l+2]=a,e[l+3]=this._color[0],t[l+4]=s.u,t[l+5]=s.v,l+=6;return h}},{}],102:[function(t,e,i){var d=function(){this._status="unloaded",this._observers=[],this._isLoadWithCSS=!1};d.prototype.onLoaded=function(){this._status="loaded",this._observers.forEach(function(t){t()})},d.prototype.isLoaded=function(){return"loaded"===this._status};var n={_fontCache:{},_fontWidthCache:{},_canvasContext:null,_testString:"BESbswy",_allFontsLoaded:!(d.prototype.addHandler=function(t){-1===this._observers.indexOf(t)&&this._observers.push(t)}),_intervalId:0,loadTTF:function(t,e){var i=this._getFontFamily(t),n=cc.loader.md5Pipe;n&&(t=n.transformURL(t));var r=cc.sys.browserType!==cc.sys.BROWSER_TYPE_BAIDU&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_BAIDU_APP&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_MOBILE_QQ;window.FontFace&&r?this._loadWithFontFace(i,t,e):this._loadWithCSS(i,t,e),0===this._intervalId&&(this._intervalId=setInterval(this._checkFontLoaded.bind(this),100))},_checkFontLoaded:function(){for(var t in this._allFontsLoaded=!0,this._fontCache){var e=this._fontCache[t];if(!e.isLoaded()&&e._isLoadWithCSS){var i=this._fontWidthCache[t];this._canvasContext.font="40px "+t,i!==this._canvasContext.measureText(this._testString).width?e.onLoaded():this._allFontsLoaded=!1}}this._allFontsLoaded&&(clearInterval(this._intervalId),this._intervalId=0)},_loadWithFontFace:function(t,e,i){var n=this._fontCache[t];if(n)n.isLoaded()||n.addHandler(i);else{var r=new FontFace(t,"url('"+e+"')");document.fonts.add(r),(n=new d).addHandler(i),this._fontCache[t]=n,r.loaded.then(function(){n.onLoaded()})}},_loadWithCSS:function(t,e,i){var n=this._fontCache[t];if(n)n.isLoaded()||n.addHandler(i);else{var r=document,o=document.createElement("style");o.type="text/css",r.body.appendChild(o);var s="";isNaN(t-0)?s+="@font-face { font-family:"+t+"; src:":s+="@font-face { font-family:'"+t+"'; src:",s+="url('"+e+"');",o.textContent=s+"}";var a=document.createElement("div"),c=a.style;if(c.fontFamily=t,a.innerHTML=".",c.position="absolute",c.left="-100px",c.top="-100px",r.body.appendChild(a),(n=new d).addHandler(i),(this._fontCache[t]=n)._isLoadWithCSS=!0,!this._canvasContext){var h=document.createElement("canvas");h.width=100,h.height=100,this._canvasContext=h.getContext("2d")}var l="40px "+t;this._canvasContext.font=l;var u=this._canvasContext.measureText(this._testString).width;this._fontWidthCache[t]=u;var _=this;o.onload=function(){setTimeout(function(){_._allFontsLoaded||(cc.logID(4004),n.onLoaded(),cc.director.getScheduler().unschedule(this._checkFontLoaded,this))},2e4)}}},_getFontFamily:function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var i=t.lastIndexOf("/");return-1===i?t.substring(0,e)+"_LABEL":t.substring(i+1,e)+"_LABEL"}};cc.TextUtils=e.exports={label_wordRex:/([a-zA-Z0-9--]+|\S)/,label_symbolRex:/^[!,.:;'}\]%\?>]/,label_lastWordRex:/([a-zA-Z0-9--]+|\S)$/,label_lastEnglish:/[a-zA-Z0-9--]+$/,label_firstEnglish:/^[a-zA-Z0-9--]/,label_wrapinspection:!0,isUnicodeCJK:function(t){return/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/.test(t)||/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g.test(t)||/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/.test(t)},isUnicodeSpace:function(t){return 9<=(t=t.charCodeAt(0))&&t<=13||32===t||133===t||160===t||5760===t||8192<=t&&t<=8202||8232===t||8233===t||8239===t||8287===t||12288===t},fragmentText:function(t,e,i,n){var r=[];if(0===t.length||i<0)return r.push(""),r;for(var o=t;i<e&&1<o.length;){for(var s=o.length*(i/e)|0,a=o.substr(s),c=e-n(a),h=a,l=0,u=0;i<c&&u++<10;)s*=i/c,s|=0,c=e-n(a=o.substr(s));for(u=0;c<=i&&u++<10;){if(a){var _=this.label_wordRex.exec(a);l=_?_[0].length:1,h=a}s+=l,c=e-n(a=o.substr(s))}0==(s-=l)&&(s=1,h=h.substr(1));var d,f=o.substr(0,s);this.label_wrapinspection&&this.label_symbolRex.test(h||a)&&(0==(s-=(d=this.label_lastWordRex.exec(f))?d[0].length:0)&&(s=1),h=o.substr(s),f=o.substr(0,s)),this.label_firstEnglish.test(h)&&(d=this.label_lastEnglish.exec(f))&&f!==d[0]&&(s-=d[0].length,h=o.substr(s),f=o.substr(0,s)),0===r.length?r.push(f):0<(f=f.trim()).length&&r.push(f),e=n(o=h||a)}return 0===r.length?r.push(o):0<(o=o.trim()).length&&r.push(o),r}},cc.CustomFontLoader=e.exports=n},{}],103:[function(t,e,i){var r=t("../platform/js"),n=t("./pipeline"),l=t("./loading-items"),o=t("./asset-loader"),s=t("./downloader"),a=t("./loader"),c=t("./asset-table"),_=t("../platform/utils").callInNextTick,h=t("./auto-release-utils"),u=new c,d=["mp3","ogg","wav","m4a"],f={url:null,raw:!1};function p(t){var e,i,n;if("object"==typeof t){if((i=t).url)return i;e=t.uuid}else i={},e=t;return n=i.type?"uuid"===i.type:cc.AssetLibrary._getAssetUrl(e),cc.AssetLibrary._getAssetInfoInRuntime(e,f),i.url=n?f.url:e,f.url&&"uuid"===i.type&&f.raw?(i.type=null,i.isRawAsset=!0):n||(i.isRawAsset=!0),i}var g=[],m=[];function v(){var t=new o,e=new s,i=new a;n.call(this,[t,e,i]),this.assetLoader=t,this.downloader=e,this.loader=i,this.onProgress=null,this._autoReleaseSetting={}}r.extend(v,n);var y=v.prototype;y.init=function(t){},y.getXMLHttpRequest=function(){return window.XMLHttpRequest?new window.XMLHttpRequest:new ActiveXObject("MSXML2.XMLHTTP")},y.addDownloadHandlers=function(t){this.downloader.addHandlers(t)},y.addLoadHandlers=function(t){this.loader.addHandlers(t)},y.load=function(t,e,n){void 0===n&&(n=e,e=this.onProgress||null);var r=this,o=!1;t instanceof Array||(o=!0,t=t?[t]:[]);for(var i=g.length=0;i<t.length;++i){var s=t[i];s&&s.id&&(cc.warnID(4920,s.id),s.uuid||s.url||(s.url=s.id));var a=p(s);if(a.url||a.uuid){var c=this._cache[a.url];g.push(c||a)}}var h=l.create(this,e,function(e,i){_(function(){if(n){if(o){var t=a.url;n.call(r,i.getError(t),i.getContent(t))}else n.call(r,e,i);n=null}i.destroy()})});l.initQueueDeps(h),h.append(g),g.length=0},y.flowInDeps=function(i,t,n){for(var e=m.length=0;e<t.length;++e){var r=p(t[e]);if(r.url||r.uuid){var o=this._cache[r.url];o?m.push(o):m.push(r)}}var s=l.create(this,i?function(t,e,i){this._ownerQueue&&this._ownerQueue.onProgress&&this._ownerQueue._childOnProgress(i)}:null,function(t,e){n(t,e),i&&i.deps&&(i.deps.length=0),e.destroy()});if(i){var a=l.getQueue(i);s._ownerQueue=a._ownerQueue||a}var c=s.append(m,i);return m.length=0,c},y._resources=u,y._getResUuid=function(t,e,i){if(!t)return null;var n=t.indexOf("?");-1!==n&&(t=t.substr(0,n));var r=u.getUuid(t,e);if(!r){var o=cc.path.extname(t);o&&(t=t.slice(0,-o.length),(r=u.getUuid(t,e))&&!i&&cc.warnID(4901,t,o))}return r},y._getReferenceKey=function(t){var e;return"object"==typeof t?e=t._uuid||null:"string"==typeof t&&(e=this._getResUuid(t,null,!0)||t),e?(cc.AssetLibrary._getAssetInfoInRuntime(e,f),this._cache[f.url]?f.url:e):(cc.warnID(4800,t),e)},y._urlNotFound=function(e,i,n){_(function(){e=cc.url.normalize(e);var t=(i?r.getClassName(i):"Asset")+' in "resources/'+e+'" does not exist.';n&&n(new Error(t),[])})},y._parseLoadResArgs=function(t,e,i){if(void 0===i){var n=cc.isChildClassOf(t,cc.RawAsset);e?(i=e,n&&(e=this.onProgress||null)):void 0!==e||n||(i=t,e=this.onProgress||null,t=null),void 0===e||n||(e=t,t=null)}return{type:t,onProgress:e,onComplete:i}},y.loadRes=function(t,e,i,n){var r=this._parseLoadResArgs(e,i,n);e=r.type,i=r.onProgress,n=r.onComplete;var o=this,s=o._getResUuid(t,e);s?this.load({type:"uuid",uuid:s},i,function(t,e){e&&o.setAutoReleaseRecursively(s,!1),n&&n(t,e)}):o._urlNotFound(t,e,n)},y._loadResUuids=function(t,e,c,h){if(0<t.length){var l=this,u=t.map(function(t){return{type:"uuid",uuid:t}});this.load(u,e,function(t,e){if(c){for(var i=[],n=h&&[],r=0;r<u.length;++r){var o=u[r].uuid,s=this._getReferenceKey(o),a=e.getContent(s);a&&(l.setAutoReleaseRecursively(o,!1),i.push(a),n&&n.push(h[r]))}h?c(t,i,n):c(t,i)}})}else c&&_(function(){h?c(null,[],[]):c(null,[])})},y.loadResArray=function(t,e,i,n){var r=this._parseLoadResArgs(e,i,n);e=r.type,i=r.onProgress,n=r.onComplete;for(var o=[],s=0;s<t.length;s++){var a=t[s],c=this._getResUuid(a,e);if(!c)return void this._urlNotFound(a,e,n);o.push(c)}this._loadResUuids(o,i,n)},y.loadResDir=function(t,e,i,n){var r=this._parseLoadResArgs(e,i,n);e=r.type,i=r.onProgress,n=r.onComplete;var o=[],s=u.getUuidArray(t,e,o);this._loadResUuids(s,i,n,o)},y.getRes=function(t,e){var i=this._cache[t];if(!i){var n=this._getResUuid(t,e,!0);if(!n)return null;var r=this._getReferenceKey(n);i=this._cache[r]}return i&&i.alias&&(i=i.alias),i&&i.complete?i.content:null},y.getResCount=function(){return Object.keys(this._cache).length},y.getDependsRecursively=function(t){if(t){var e=this._getReferenceKey(t),i=h.getDependsRecursively(e);return i.push(e),i}return[]},y.release=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++){var i=t[e];this.release(i)}else if(t){var n=this._getReferenceKey(t),r=this.getItem(n);if(r)if(this.removeItem(n),(t=r.content)instanceof cc.Asset)for(var o=t.rawUrls,s=0;s<o.length;s++)this.release(o[s]);else t instanceof cc.Texture2D?cc.textureCache.removeTextureForKey(r.rawUrl||r.url):-1!==d.indexOf(r.type)&&cc.audioEngine.uncache(r.rawUrl||r.url)}},y.releaseAsset=function(t){var e=t._uuid;e&&this.release(e)},y.releaseRes=function(t,e){var i=this._getResUuid(t,e);i?this.release(i):cc.errorID(4914,t)},y.releaseResDir=function(t,e){for(var i=u.getUuidArray(t,e),n=0;n<i.length;n++){var r=i[n];this.release(r)}},y.releaseAll=function(){for(var t in this._cache)this.release(t)},y.removeItem=function(t){var e=n.prototype.removeItem.call(this,t);return delete this._autoReleaseSetting[t],e},y.setAutoRelease=function(t,e){var i=this._getReferenceKey(t);i&&(this._autoReleaseSetting[i]=!!e)},y.setAutoReleaseRecursively=function(t,e){e=!!e;var i=this._getReferenceKey(t);if(i){this._autoReleaseSetting[i]=e;for(var n=h.getDependsRecursively(i),r=0;r<n.length;r++){var o=n[r];this._autoReleaseSetting[o]=e}}},y.isAutoRelease=function(t){var e=this._getReferenceKey(t);return!!e&&!!this._autoReleaseSetting[e]},cc.loader=new v,e.exports=cc.loader},{"../platform/js":144,"../platform/utils":148,"./asset-loader":104,"./asset-table":105,"./auto-release-utils":107,"./downloader":108,"./loader":111,"./loading-items":112,"./pipeline":115,"./released-asset-checker":116}],104:[function(t,e,i){var c=t("../utils/CCPath"),n=t("./pipeline"),h=t("./loading-items"),r="AssetLoader",o=function(t){this.id=r,this.async=!0,this.pipeline=null};o.ID=r;var l=[];o.prototype.handle=function(o,s){var a=o.uuid;if(!a)return o.content?o.content:null;cc.AssetLibrary.queryAssetInfo(a,function(t,e,i){if(t)s(t);else if(o.url=o.rawUrl=e,o.isRawAsset=i){var n=c.extname(e).toLowerCase();if(!n)return void s(new Error("Download Uuid: can not find type of raw asset["+a+"]: "+e));n=n.substr(1);var r=h.getQueue(o);l[0]={queueId:o.queueId,id:e,url:e,type:n,error:null,alias:o,complete:!0},r.append(l),o.type=n,s(null,o.content)}else o.type="uuid",s(null,o.content)})},n.AssetLoader=e.exports=o},{"../utils/CCPath":166,"./loading-items":112,"./pipeline":115}],105:[function(t,e,i){var o=t("../utils/misc").pushToMap;function n(){this._pathToUuid={},this._uuidToPath={}}function l(t,e){if(t.length>e.length){var i=t.charCodeAt(e.length);return 46===i||47===i}return!0}var r=n.prototype;r.getUuid=function(t,e){t=cc.url.normalize(t);var i=this._pathToUuid[t];if(i)if(Array.isArray(i)){if(!e)return i[0].uuid;for(var n=0;n<i.length;n++){var r=i[n];if(cc.isChildClassOf(r.type,e))return r.uuid}}else if(!e||cc.isChildClassOf(i.type,e))return i.uuid;return""},r.getPath=function(t){var e=this._uuidToPath[t];return e?e.path:""},r.getUuidArray=function(t,e,i){"/"===(t=cc.url.normalize(t))[t.length-1]&&(t=t.slice(0,-1));var n=this._pathToUuid,r=[],o=cc.isChildClassOf;for(var s in n)if(s.startsWith(t)&&l(s,t)||!t){var a=n[s];if(Array.isArray(a))for(var c=0;c<a.length;c++){var h=a[c];e&&!o(h.type,e)||(r.push(h.uuid),i&&i.push(s))}else e&&!o(a.type,e)||(r.push(a.uuid),i&&i.push(s))}return r},r.add=function(t,e,i,n){var r=new function(t,e,i){this.uuid=t,this.type=e,this.path=i}(e,i,t=t.substring(0,t.length-cc.path.extname(t).length));o(this._pathToUuid,t,r,n),o(this._uuidToPath,e,r,n)},r._getInfo_DEBUG=!1,r.reset=function(){this._pathToUuid={},this._uuidToPath={}},e.exports=n},{"../utils/misc":173}],106:[function(t,e,i){t("../utils/CCPath");var a=t("../platform/CCSys"),c=(t("./pipeline"),t("../../audio/CCAudioEngine"),a.__audioSupport),n=c.format,r=c.context;e.exports=function(t,e){if(0===n.length)return new Error("Audio Downloader: audio not supported on this browser!");t.content=t.url,!c.WEB_AUDIO||t.urlParam&&t.urlParam.useDom?function(e,i){var t=document.createElement("audio");if(t.src=e.url,a.platform===a.WECHAT_GAME)return e.element=t,i(null,e.url);var n=function(){clearTimeout(r),t.removeEventListener("canplaythrough",o,!1),t.removeEventListener("error",s,!1),c.USE_LOADER_EVENT&&t.removeEventListener(c.USE_LOADER_EVENT,o,!1)},r=setTimeout(function(){0===t.readyState?s():o()},8e3),o=function(){n(),e.element=t,i(null,e.url)},s=function(){n();var t="load audio failure - "+e.url;cc.log(t),i(t,e.url)};t.addEventListener("canplaythrough",o,!1),t.addEventListener("error",s,!1),c.USE_LOADER_EVENT&&t.addEventListener(c.USE_LOADER_EVENT,o,!1)}(t,e):function(e,i){r||i(new Error("Audio Downloader: no web audio context."));var t=cc.loader.getXMLHttpRequest();t.open("GET",e.url,!0),t.responseType="arraybuffer",t.onload=function(){r.decodeAudioData(t.response,function(t){e.buffer=t,i(null,e.id)},function(){i("decode error - "+e.id,null)})},t.onerror=function(){i("request error - "+e.id,null)},t.send()}(t,e)}},{"../../audio/CCAudioEngine":16,"../platform/CCSys":132,"../utils/CCPath":166,"./pipeline":115}],107:[function(t,e,i){var _=t("../platform/js");function s(t,e){var i=cc.loader.getItem(t);if(i){var n=i.dependKeys;if(n)for(var r=0;r<n.length;r++){var o=n[r];e[o]||(e[o]=!0,s(o,e))}}}function l(t,e){var i=cc.loader._getReferenceKey(t);e[i]||(e[i]=!0,s(i,e))}function r(t,e){for(var i=Object.getOwnPropertyNames(t),n=0;n<i.length;n++){var r=t[i[n]];if("object"==typeof r&&r)if(Array.isArray(r))for(var o=0;o<r.length;o++){var s=r[o];s instanceof cc.RawAsset&&l(s,e)}else if(r.constructor&&r.constructor!==Object)r instanceof cc.RawAsset&&l(r,e);else for(var a=Object.getOwnPropertyNames(r),c=0;c<a.length;c++){var h=r[a[c]];h instanceof cc.RawAsset&&l(h,e)}}}function d(t,e){for(var i=0;i<t._components.length;i++)r(t._components[i],e);for(var n=0;n<t._children.length;n++)d(t._children[n],e)}e.exports={autoRelease:function(t,e,i){var n=cc.loader._autoReleaseSetting,r=_.createMap();if(e)for(var o=0;o<e.length;o++)r[e[o]]=!0;for(var s=0;s<i.length;s++)d(i[s],r);if(t)for(var a=0;a<t.length;a++){var c=t[a];!1===n[c]||r[c]||cc.loader.release(c)}for(var h=Object.keys(n),l=0;l<h.length;l++){var u=h[l];!0!==n[u]||r[u]||cc.loader.release(u)}},getDependsRecursively:function(t){var e={};return s(t,e),Object.keys(e)}}},{"../platform/js":144}],108:[function(c,t,e){var i,n=c("../platform/js"),h=c("../platform/CCSys"),u=c("../utils/CCPath"),s=c("../utils/misc"),r=c("./pipeline"),o=c("./pack-downloader"),a=c("./text-downloader"),l=c("./utils").urlAppendTimestamp;function _(i,n,t,r){void 0===t&&(t=!0);var o=l(i.url);if(r=r||s.imagePool.get(),t&&"file:"!==window.location.protocol?r.crossOrigin="anonymous":r.crossOrigin=null,r.complete&&0<r.naturalWidth&&r.src===o)return r;!function(){function t(){r.removeEventListener("load",t),r.removeEventListener("error",e),n(null,r)}function e(){r.removeEventListener("load",t),r.removeEventListener("error",e),"https:"!==window.location.protocol&&r.crossOrigin&&"anonymous"===r.crossOrigin.toLowerCase()?_(i,n,!1,r):n(new Error("Load image ("+o+") failed"))}r.addEventListener("load",t),r.addEventListener("error",e),r.src=o}()}var d={".eot":"embedded-opentype",".ttf":"truetype",".ttc":"truetype",".woff":"woff",".svg":"svg"};function f(t,e,i){var n=document,r=document.createElement("style");r.type="text/css",n.body.appendChild(r);var o="";if(isNaN(t-0)?o+="@font-face { font-family:"+t+"; src:":o+="@font-face { font-family:'"+t+"'; src:",e instanceof Array)for(var s=0,a=e.length;s<a;s++){var c=e[s];i=u.extname(c).toLowerCase(),o+="url('"+e[s]+"') format('"+d[i]+"')",o+=s===a-1?";":","}else i=i.toLowerCase(),o+="url('"+e+"') format('"+d[i]+"');";r.textContent+=o+"}";var h=document.createElement("div"),l=h.style;l.fontFamily=t,h.innerHTML=".",l.position="absolute",l.left="-100px",l.top="-100px",n.body.appendChild(h)}function p(t,e){var i=t.url,n=t.type,r=t.name,o=t.srcs;if(r&&o?(-1===o.indexOf(i)&&o.push(i),f(r,o)):(n=u.extname(i),f(r=u.basename(i,n),i,n)),!document.fonts)return null;document.fonts.load("1em "+r).then(function(){e(null,null)},function(t){e(t)})}var g={js:function(t,e,i){if(h.platform===h.WECHAT_GAME)return c(t.url),void e(null,t.url);var n=t.url,r=document,o=document.createElement("script");function s(){o.parentNode.removeChild(o),o.removeEventListener("load",s,!1),o.removeEventListener("error",a,!1),e(null,n)}function a(){o.parentNode.removeChild(o),o.removeEventListener("load",s,!1),o.removeEventListener("error",a,!1),e(new Error("Load "+n+" failed!"),n)}o.async=i,o.src=l(n),o.addEventListener("load",s,!1),o.addEventListener("error",a,!1),r.body.appendChild(o)},png:_,jpg:_,bmp:_,jpeg:_,gif:_,ico:_,tiff:_,webp:function(t,e,i,n){return cc.sys.capabilities.webp?_(t,e,i,n):new Error("Load Webp ( "+t.url+" ) failed")},image:_,btf:_,img:_,mp3:i=c("./audio-downloader"),ogg:i,wav:i,m4a:i,txt:a,xml:a,vsh:a,fsh:a,atlas:a,tmx:a,tsx:a,json:a,ExportJson:a,plist:a,fnt:a,font:p,eot:p,ttf:p,woff:p,svg:p,ttc:p,uuid:function(t,e){var i=o.load(t,e);return void 0===i?this.extMap.json(t,e):i||void 0},default:a},m="Downloader",v=function(t){this.id=m,this.async=!0,this.pipeline=null,this._curConcurrent=0,this._loadQueue=[],this.extMap=n.mixin(t,g)};v.ID=m,v.PackDownloader=o,v.prototype.addHandlers=function(t){n.mixin(this.extMap,t)},v.prototype._handleLoadQueue=function(){for(;this._curConcurrent<cc.macro.DOWNLOAD_MAX_CONCURRENT;){var t=this._loadQueue.shift();if(!t)break;var e=this.handle(t.item,t.callback);void 0!==e&&(e instanceof Error?t.callback(e):t.callback(null,e))}},v.prototype.handle=function(t,i){var n=this,e=this.extMap[t.type]||this.extMap.default,r=void 0;if(this._curConcurrent<cc.macro.DOWNLOAD_MAX_CONCURRENT){if(this._curConcurrent++,void 0!==(r=e.call(this,t,function(t,e){n._curConcurrent=Math.max(0,n._curConcurrent-1),n._handleLoadQueue(),i&&i(t,e)})))return this._curConcurrent=Math.max(0,this._curConcurrent-1),this._handleLoadQueue(),r}else if(t.ignoreMaxConcurrency){if(void 0!==(r=e.call(this,t,i)))return r}else this._loadQueue.push({item:t,callback:i})},r.Downloader=t.exports=v},{"../platform/CCSys":132,"../platform/js":144,"../utils/CCPath":166,"../utils/misc":173,"./audio-downloader":106,"./pack-downloader":114,"./pipeline":115,"./text-downloader":117,"./utils":118}],109:[function(t,e,i){t("./downloader"),t("./loader"),t("./json-unpacker"),t("./loading-items"),t("./pipeline"),t("./CCLoader")},{"./CCLoader":103,"./downloader":108,"./json-unpacker":110,"./loader":111,"./loading-items":112,"./pipeline":115}],110:[function(t,e,i){function n(){this.jsons={},this.state=-1}n.prototype.read=function(t,e){var i="string"==typeof e?JSON.parse(e):e;i.length!==t.length&&cc.errorID(4915);for(var n=0;n<t.length;n++){var r=t[n],o=i[n];this.jsons[r]=o}},n.prototype.retrieve=function(t){return this.jsons[t]||null},e.exports=n},{}],111:[function(t,e,i){var n=t("../platform/js"),r=t("../platform/CCSys"),o=t("./pipeline"),s=t("../textures/CCTexture2D"),a=t("./uuid-loader");function c(t,e){if("string"!=typeof t.content)return new Error("JSON Loader: Input item doesn't contain string content");try{return JSON.parse(t.content)}catch(e){return new Error("JSON Loader: Parse json ["+t.id+"] failed : "+e)}}function h(t,e){if(r.platform!==r.WECHAT_GAME&&r.platform!==r.QQ_PLAY&&!(t.content instanceof Image))return new Error("Image Loader: Input item doesn't contain Image content");var i=t.rawUrl,n=cc.textureCache.getTextureForKey(i)||new s;return n.url=i,n.initWithElement(t.content),n.handleLoadedTexture(),cc.textureCache.cacheImage(i,n),n}t("../utils/misc");var l={png:h,jpg:h,bmp:h,jpeg:h,gif:h,ico:h,tiff:h,webp:h,image:h,btf:h,img:h,json:c,ExportJson:c,plist:function(t,e){return"string"!=typeof t.content?new Error("Plist Loader: Input item doesn't contain string content"):cc.plistParser.parse(t.content)||new Error("Plist Loader: Parse ["+t.id+"] failed")},uuid:a,prefab:a,fire:a,scene:a,default:function(t,e){return null}},u=function(t){this.id="Loader",this.async=!0,this.pipeline=null,this.extMap=n.mixin(t,l)};u.ID="Loader",u.prototype.addHandlers=function(t){this.extMap=n.mixin(this.extMap,t)},u.prototype.handle=function(t,e){return(this.extMap[t.type]||this.extMap.default).call(this,t,e)},o.Loader=e.exports=u},{"../platform/CCSys":132,"../platform/js":144,"../textures/CCTexture2D":163,"../utils/misc":173,"./pipeline":115,"./uuid-loader":119}],112:[function(t,e,i){var r=t("../platform/callbacks-invoker"),s=t("../utils/CCPath"),a=t("../platform/js"),o=0|998*Math.random(),l={},c=[],h={WORKING:1,COMPLETE:2,ERROR:3},u={};function _(t,e){var n="object"==typeof t?t.url:t,i={queueId:e,id:n,url:n,rawUrl:void 0,urlParam:function(t){if(n){var e=n.split("?");if(e&&e[0]&&e[1]){var i={};return e[1].split("&").forEach(function(t){var e=t.split("=");i[e[0]]=e[1]}),i}}}(),type:"",error:null,content:null,complete:!1,states:{},deps:null};if("object"==typeof t&&(a.mixin(i,t),t.skips))for(var r=0;r<t.skips.length;r++){var o=t.skips[r];i.states[o]=h.COMPLETE}return i.rawUrl=i.url,n&&!i.type&&(i.type=s.extname(n).toLowerCase().substr(1)),i}var d=[];function f(t,e,i){if(!t||!e)return!1;var n=!1;if(d.push(e.id),e.deps){var r,o,s=e.deps;for(r=0;r<s.length;r++){if((o=s[r]).id===t.id){n=!0;break}if(!(0<=d.indexOf(o.id))&&o.deps&&f(t,o,!0)){n=!0;break}}}return i||(d.length=0),n}var p=function(t,e,i,n){r.call(this),this._id=++o,(l[this._id]=this)._pipeline=t,this._errorUrls=[],this._appending=!1,this._ownerQueue=null,this.onProgress=i,this.onComplete=n,this.map={},this.completed={},this.totalCount=0,this.completedCount=0,this._pipeline?this.active=!0:this.active=!1,e&&(0<e.length?this.append(e):this.allComplete())};p.ItemState=new cc.Enum(h),p.create=function(t,e,i,n){void 0===i?"function"==typeof e&&(n=e,e=i=null):void 0===n&&("function"==typeof e?(n=i,i=e,e=null):(n=i,i=null));var r=c.pop();return r?(r._pipeline=t,r.onProgress=i,r.onComplete=n,(l[r._id]=r)._pipeline&&(r.active=!0),e&&r.append(e)):r=new p(t,e,i,n),r},p.getQueue=function(t){return t.queueId?l[t.queueId]:null},p.itemComplete=function(t){var e=l[t.queueId];e&&e.itemComplete(t.id)},p.initQueueDeps=function(t){var e=u[t._id];e?(e.completed.length=0,e.deps.length=0):e=u[t._id]={completed:[],deps:[]}},p.registerQueueDep=function(t,e){var i=t.queueId||t;if(!i)return!1;var n=u[i];if(n)-1===n.deps.indexOf(e)&&n.deps.push(e);else if(t.id)for(var r in u){var o=u[r];-1!==o.deps.indexOf(t.id)&&-1===o.deps.indexOf(e)&&o.deps.push(e)}},p.finishDep=function(t){for(var e in u){var i=u[e];-1!==i.deps.indexOf(t)&&-1===i.completed.indexOf(t)&&i.completed.push(t)}};var n=p.prototype;a.mixin(n,r.prototype),n.append=function(t,e){if(!this.active)return[];e&&!e.deps&&(e.deps=[]),this._appending=!0;var i,n,r,o,s=[];for(i=0;i<t.length;++i)if(!(n=t[i]).queueId||this.map[n.id]){if("string"==typeof((o=n).url||o)){var a=(r=_(n,this._id)).id;this.map[a]||(this.map[a]=r,this.totalCount++,e&&e.deps.push(r),p.registerQueueDep(e||this._id,a),s.push(r))}}else{if(this.map[n.id]=n,e&&e.deps.push(n),n.complete||f(e,n)){this.totalCount++,this.itemComplete(n.id);continue}var c=this,h=l[n.queueId];h&&(this.totalCount++,p.registerQueueDep(e||this._id,n.id),h.addListener(n.id,function(t){c.itemComplete(t.id)}))}return this._appending=!1,this.completedCount===this.totalCount?this.allComplete():this._pipeline.flowIn(s),s},n._childOnProgress=function(t){if(this.onProgress){var e=u[this._id];this.onProgress(e?e.completed.length:this.completedCount,e?e.deps.length:this.totalCount,t)}},n.allComplete=function(){var t=0===this._errorUrls.length?null:this._errorUrls;this.onComplete&&this.onComplete(t,this)},n.isCompleted=function(){return this.completedCount>=this.totalCount},n.isItemCompleted=function(t){return!!this.completed[t]},n.exists=function(t){return!!this.map[t]},n.getContent=function(t){var e=this.map[t],i=null;return e&&(e.content?i=e.content:e.alias&&(i=e.alias.content)),i},n.getError=function(t){var e=this.map[t],i=null;return e&&(e.error?i=e.error:e.alias&&(i=e.alias.error)),i},n.addListener=r.prototype.add,n.hasListener=r.prototype.has,n.removeListener=r.prototype.remove,n.removeAllListeners=r.prototype.removeAll,n.removeItem=function(t){var e=this.map[t];e&&this.completed[e.alias||t]&&(delete this.completed[t],delete this.map[t],e.alias&&(delete this.completed[e.alias.id],delete this.map[e.alias.id]),this.completedCount--,this.totalCount--)},n.itemComplete=function(t){var e=this.map[t];if(e){var i=this._errorUrls.indexOf(t);if(e.error&&-1===i?this._errorUrls.push(t):e.error||-1===i||this._errorUrls.splice(i,1),this.completed[t]=e,this.completedCount++,p.finishDep(e.id),this.onProgress){var n=u[this._id];this.onProgress(n?n.completed.length:this.completedCount,n?n.deps.length:this.totalCount,e)}this.invoke(t,e),this.removeAll(t),!this._appending&&this.completedCount>=this.totalCount&&this.allComplete()}},n.destroy=function(){this.active=!1,this._appending=!1,this._pipeline=null,this._ownerQueue=null,this._errorUrls.length=0,this.onProgress=null,this.onComplete=null,this.map={},this.completed={},this.totalCount=0,this.completedCount=0,r.call(this),l[this._id]=null,u[this._id]&&(u[this._id].completed.length=0,u[this._id].deps.length=0),-1===c.indexOf(this)&&c.length<10&&c.push(this)},cc.LoadingItems=e.exports=p},{"../platform/callbacks-invoker":137,"../platform/js":144,"../utils/CCPath":166}],113:[function(t,e,i){var n=t("./pipeline"),o=/(\.[^.\n\\/]*)$/,r=function(t,e,i){this.id="MD5Pipe",this.async=!1,this.pipeline=null,this.md5AssetsMap=t,this.libraryBase=e,this.rawAssetsBase=i};r.ID="MD5Pipe",r.prototype.handle=function(t){return t.url=this.transformURL(t.url),t},r.prototype.transformURL=function(t){var e=t.indexOf("?"),i=t;if(-1!==e&&(i=t.substr(0,e)),i.startsWith(this.libraryBase))i=i.slice(this.libraryBase.length);else{if(!i.startsWith(this.rawAssetsBase))return t;i=i.slice(this.rawAssetsBase.length)}var n=this.md5AssetsMap[i];if(n){var r=!1;t=t.replace(o,function(t,e){return r=!0,"."+n+e}),r||(t=t+"."+n)}return t},n.MD5Pipe=e.exports=r},{"./pipeline":115}],114:[function(t,e,i){var o=t("./json-unpacker"),s=t("../utils/misc").pushToMap,a={},c={},h={},l={Invalid:0,Removed:1,Downloading:2,Loaded:3};function u(t,e){return new Error("Can not retrieve "+t+" from packer "+e)}e.exports={uuidToPack:a,getPackIndices:function(){return c},globalUnpackers:h,PackState:l,JsonUnpacker:o,initPacks:function(t){for(var e in c=t)for(var i=t[e],n=0;n<i.length;n++){var r=i[n],o=1===i.length;s(a,r,e,o)}},_loadNewPack:function(n,r,o){var s=this,t=cc.AssetLibrary.getLibUrlNoExt(r)+".json";cc.loader.load({url:t,ignoreMaxConcurrency:!0},function(t,e){if(t)return cc.errorID(4916,n),o(t);var i=s._doLoadNewPack(n,r,e);i?o(null,i):o(u(n,r))})},_doPreload:function(t,e){var i=h[t];i||(i=h[t]=new o),i.state!==l.Loaded&&(i.read(c[t],e),i.state=l.Loaded)},_doLoadNewPack:function(t,e,i){var n=h[e];return n.state!==l.Loaded&&(n.read(c[e],i),n.state=l.Loaded),n.retrieve(t)},_selectLoadedPack:function(t){for(var e=l.Invalid,i="",n=0;n<t.length;n++){var r=t[n],o=h[r];if(o){var s=o.state;if(s===l.Loaded)return r;e<s&&(e=s,i=r)}}return e!==l.Invalid?i:t[0]},load:function(t,e){var i=t.uuid,n=a[i];if(n){Array.isArray(n)&&(n=this._selectLoadedPack(n));var r=h[n];return r&&r.state===l.Loaded?r.retrieve(i)||u(i,n):(r||((r=h[n]=new o).state=l.Downloading),this._loadNewPack(i,n,e),null)}}}},{"../utils/misc":173,"./json-unpacker":110}],115:[function(t,e,i){t("../platform/js");var n=t("./loading-items"),a=n.ItemState;function c(t,i){var n=t.id,e=i.states[n],r=t.next,o=t.pipeline;if(!i.error&&e!==a.WORKING&&e!==a.ERROR)if(e===a.COMPLETE)r?c(r,i):o.flowOut(i);else{i.states[n]=a.WORKING;var s=t.handle(i,function(t,e){t?(i.error=t,i.states[n]=a.ERROR,o.flowOut(i)):(e&&(i.content=e),i.states[n]=a.COMPLETE,r?c(r,i):o.flowOut(i))});s instanceof Error?(i.error=s,i.states[n]=a.ERROR,o.flowOut(i)):void 0!==s&&(null!==s&&(i.content=s),i.states[n]=a.COMPLETE,r?c(r,i):o.flowOut(i))}}var r=function(t){this._pipes=t,this._cache={};for(var e=0;e<t.length;++e){var i=t[e];i.handle&&i.id&&(i.pipeline=this,i.next=e<t.length-1?t[e+1]:null)}};r.ItemState=a;var o=r.prototype;o.insertPipe=function(t,e){if(!t.handle||!t.id||e>this._pipes.length)cc.warnID(4921);else if(0<this._pipes.indexOf(t))cc.warnID(4922);else{var i=null;e<(t.pipeline=this)._pipes.length&&(i=this._pipes[e]);var n=null;0<e&&(n=this._pipes[e-1]),n&&(n.next=t),t.next=i,this._pipes.splice(e,0,t)}},o.insertPipeAfter=function(t,e){var i=this._pipes.indexOf(t);i<0||this.insertPipe(e,i+1)},o.appendPipe=function(t){t.handle&&t.id&&(t.pipeline=this,t.next=null,0<this._pipes.length&&(this._pipes[this._pipes.length-1].next=t),this._pipes.push(t))},o.flowIn=function(t){var e,i,n=this._pipes[0];if(n){for(e=0;e<t.length;e++)i=t[e],this._cache[i.id]=i;for(e=0;e<t.length;e++)c(n,i=t[e])}else for(e=0;e<t.length;e++)this.flowOut(t[e])},o.flowInDeps=function(t,e,i){return n.create(this,function(t,e){i(t,e),e.destroy()}).append(e,t)},o.flowOut=function(t){t.error?delete this._cache[t.id]:this._cache[t.id]||(this._cache[t.id]=t),t.complete=!0,n.itemComplete(t)},o.copyItemStates=function(t,e){if(e instanceof Array)for(var i=0;i<e.length;++i)e[i].states=t.states;else e.states=t.states},o.isFlowing=function(){return!0},o.getItems=function(){return null},o.getItem=function(t){var e=this._cache[t];return e&&e.alias&&(e=e.alias),e},o.removeItem=function(t){var e=this._cache[t];return e&&e.complete&&delete this._cache[t],e},o.clear=function(){for(var t in this._cache){var e=this._cache[t];delete this._cache[t],e.complete||(e.error=new Error("Canceled manually"),this.flowOut(e))}},cc.Pipeline=e.exports=r},{"../platform/js":144,"./loading-items":112}],116:[function(t,e,i){},{"../platform/js":144}],117:[function(t,e,i){t("../platform/CCSys");var s=t("./utils").urlAppendTimestamp;e.exports=function(t,e){var i=t.url;i=s(i);var n=cc.loader.getXMLHttpRequest(),r="Load "+i+" failed!",o=window.navigator;n.open("GET",i,!0),/msie/i.test(o.userAgent)&&!/opera/i.test(o.userAgent)?(n.setRequestHeader("Accept-Charset","utf-8"),n.onreadystatechange=function(){4===n.readyState&&(200===n.status||0===n.status?e(null,n.responseText):e({status:n.status,errorMessage:r}),"undefined"!=typeof engine&&engine.Logger.res(i,n))}):(n.overrideMimeType&&n.overrideMimeType("text/plain; charset=utf-8"),n.onload=function(){4===n.readyState&&(200===n.status||0===n.status?e(null,n.responseText):e({status:n.status,errorMessage:r}),"undefined"!=typeof engine&&engine.Logger.res(i,n))},n.onerror=function(){e({status:n.status,errorMessage:r}),"undefined"!=typeof engine&&engine.Logger.res(i,n)}),n.send(null)}},{"../platform/CCSys":132,"./utils":118}],118:[function(t,e,i){var n=/\?/;e.exports={urlAppendTimestamp:function(t){return cc.game.config.noCache&&"string"==typeof t&&(n.test(t)?t+="&_t="+(new Date-0):t+="?_t="+(new Date-0)),t}}},{}],119:[function(t,e,i){var l=t("../platform/js");t("../platform/deserialize");var C=t("./loading-items");function u(t){return t&&(t[0]&&"cc.Scene"===t[0].__type__||t[1]&&"cc.Scene"===t[1].__type__||t[0]&&"cc.Prefab"===t[0].__type__)}function n(t,e){var i,n;if("string"==typeof t.content)try{i=JSON.parse(t.content)}catch(e){return new Error("Uuid Loader: Parse asset ["+t.id+"] failed : "+e.stack)}else{if("object"!=typeof t.content)return new Error("JSON Loader: Input item doesn't contain string content");i=t.content}n=u(i)?cc._MissingScript.safeFindClass:function(t){return l._getClassById(t)||(cc.warnID(4903,t),Object)};var r,o=cc.deserialize.Details.pool.get();try{r=cc.deserialize(i,o,{classFinder:n,target:t.existingAsset,customEnv:t})}catch(e){cc.deserialize.Details.pool.put(o);var s=e.stack;return new Error("Uuid Loader: Deserialize asset ["+t.id+"] failed : "+s)}r._uuid=t.uuid;var a,c,h=(a=r,(c=!0)&&a instanceof cc.Asset&&a.constructor.preventDeferredLoadDependents&&(c=!1),c);!function(t,e,d,f,i,p){var g,m,v,n,r,o=f.uuidList,y=e.dependKeys=[];if(i)for(g=[],m=[],v=[],n=0;n<o.length;n++){r=o[n];var s=f.uuidObjList[n],a=f.uuidPropList[n],c=cc.AssetLibrary._getAssetInfoInRuntime(r);if(c.raw){var h=c.url;s[a]=h,y.push(h)}else g.push(s),m.push(a),v.push({type:"uuid",uuid:r,deferredLoadRaw:!0})}else for(g=f.uuidObjList,m=f.uuidPropList,v=new Array(o.length),n=0;n<o.length;n++)r=o[n],v[n]={type:"uuid",uuid:r};if(f.rawProp&&(g.push(d),m.push(f.rawProp),v.push(e.url)),d._preloadRawFiles){var l=p;p=function(){d._preloadRawFiles(function(t){l(t||null,d)})}}if(0===v.length)return cc.deserialize.Details.pool.put(f),p(null,d);e.content=d,t.flowInDeps(e,v,function(t,e){var i;for(var n in e.map)(i=e.map[n]).uuid&&i.content&&(i.content._uuid=i.uuid);for(var r=0;r<v.length;r++){var o=v[r].uuid,s=v[r].url,a=g[r],c=m[r];if(i=e.map[s]){var h={obj:a,prop:c};function l(t){var e=t.isRawAsset?t.rawUrl:t.content;this.obj[this.prop]=e,t.uuid!==d._uuid&&y.indexOf(t.id)<0&&y.push(t.id)}if(i.complete||i.content)i.error?cc._throw(i.error):l.call(h,i);else{var u=C.getQueue(i),_=u._callbackTable[o];_?_.unshift(l,h):u.addListener(o,l,h)}}}cc.deserialize.Details.pool.put(f),p(null,d)})}(this.pipeline,t,r,o,h,e)}(e.exports=n).isSceneObj=u},{"../platform/deserialize":139,"../platform/js":144,"./loading-items":112}],120:[function(t,e,i){var n=t("./component-scheduler"),r=t("./platform/CCObject").Flags,d=t("./platform/js"),s=r.IsPreloadStarted,a=r.IsOnLoadStarted,o=r.IsOnLoadCalled,f=r.Deactivating,c="c.onLoad();c._objFlags|="+o,h=cc.Class({extends:n.LifeCycleInvoker,add:function(t){this._zero.array.push(t)},remove:function(t){this._zero.fastRemove(t)},cancelInactive:function(t){n.LifeCycleInvoker.stableRemoveInactive(this._zero,t)},invoke:function(){this._invoke(this._zero),this._zero.array.length=0}}),l=n.createInvokeImpl("c.__preload();"),u=n.createInvokeImpl(c),_=new d.Pool(4);function p(){this._activatingStack=[]}_.get=function(){var t=this._get()||{preload:new h(l),onLoad:new n.OneOffInvoker(u),onEnable:new n.OneOffInvoker(n.invokeOnEnable)};t.preload._zero.i=-1;var e=t.onLoad;return e._zero.i=-1,e._neg.i=-1,e._pos.i=-1,(e=t.onEnable)._zero.i=-1,e._neg.i=-1,e._pos.i=-1,t};var g=cc.Class({ctor:p,reset:p,_activateNodeRecursively:function(t,e,i,n){if(t._objFlags&f)cc.errorID(3816,t.name);else{t._activeInHierarchy=!0;for(var r=t._components.length,o=0;o<r;++o){var s=t._components[o];s instanceof cc.Component?this.activateComp(s,e,i,n):(l=t,_=o,(u=s)?l._removeComponent(u):d.array.removeAt(l._components,_),--o,--r)}for(var a=0,c=t._children.length;a<c;++a){var h=t._children[a];h._active&&this._activateNodeRecursively(h,e,i,n)}t._onPostActivated(!0),t.onActiveInHierarchy&&t.onActiveInHierarchy(!0)}var l,u,_},_deactivateNodeRecursively:function(t){t._objFlags|=f,t._activeInHierarchy=!1;for(var e=t._components.length,i=0;i<e;++i){var n=t._components[i];if(n._enabled&&(cc.director._compScheduler.disableComp(n),t._activeInHierarchy))return void(t._objFlags&=~f)}for(var r=t._children.length-1;0<=r;r--){var o=t._children[r];if(o._activeInHierarchy&&(this._deactivateNodeRecursively(o),t._activeInHierarchy))return void(t._objFlags&=~f)}t._onPostActivated(!1),t._objFlags&=~f,t.onActiveInHierarchy&&t.onActiveInHierarchy(!1)},activateNode:function(t,e){if(e){var i=_.get();this._activatingStack.push(i),this._activateNodeRecursively(t,i.preload,i.onLoad,i.onEnable),i.preload.invoke(),i.onLoad.invoke(),i.onEnable.invoke(),this._activatingStack.pop(),_.put(i)}else{this._deactivateNodeRecursively(t);for(var n=this._activatingStack,r=0;r<n.length;r++){var o=n[r];o.preload.cancelInactive(s),o.onLoad.cancelInactive(a),o.onEnable.cancelInactive()}}t.emit("active-in-hierarchy-changed",t)},activateComp:function(t,e,i,n){if(t._objFlags&s||(t._objFlags|=s,"function"==typeof t.__preload&&(e?e.add(t):t.__preload())),t._objFlags&a||(t._objFlags|=a,t.onLoad?i?i.add(t):(t.onLoad(),t._objFlags|=o):t._objFlags|=o),t._enabled){if(!t.node._activeInHierarchy)return;cc.director._compScheduler.enableComp(t,n)}},destroyComp:function(t){cc.director._compScheduler.disableComp(t),t.onDestroy&&t._objFlags&o&&t.onDestroy()},resetComp:!1});e.exports=g},{"./component-scheduler":49,"./platform/CCObject":129,"./platform/js":144,"./utils/misc":173}],121:[function(t,e,i){if(CC_QQPLAY){t("../platform/js");var n=t("./CCMacro"),u=t("./CCSys"),_=t("../event-manager"),r=n.TOUCH_TIMEOUT,o={_isRegisterEvent:!1,_preTouchPoint:cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_getUnUsedIndex:function(){for(var t=this._indexBitsUsed,e=cc.sys.now(),i=0;i<this._maxTouches;i++){if(!(1&t))return this._indexBitsUsed|=1<<i,i;var n=this._touches[i];if(e-n._lastModified>r)return this._removeUsedIndexBit(i),delete this._touchesIntegerDict[n.getID()],i;t>>=1}return-1},_removeUsedIndexBit:function(t){if(!(t<0||t>=this._maxTouches)){var e=1<<t;e=~e,this._indexBitsUsed&=e}},_glView:null,handleTouchesBegin:function(t){for(var e,i,n,r=[],o=this._touchesIntegerDict,s=u.now(),a=0,c=t.length;a<c;a++)if(null==o[n=(e=t[a]).getID()]){var h=this._getUnUsedIndex();if(-1===h){cc.logID(2300,h);continue}(i=this._touches[h]=new cc.Touch(e._point.x,e._point.y,e.getID()))._lastModified=s,i._setPrevPoint(e._prevPoint),o[n]=h,r.push(i)}if(0<r.length){this._glView._convertTouchesWithScale(r);var l=new cc.Event.EventTouch(r);l._eventCode=cc.Event.EventTouch.BEGAN,_.dispatchEvent(l)}},handleTouchesMove:function(t){for(var e,i,n,r=[],o=this._touches,s=u.now(),a=0,c=t.length;a<c;a++)n=(e=t[a]).getID(),null!=(i=this._touchesIntegerDict[n])&&o[i]&&(o[i]._setPoint(e._point),o[i]._setPrevPoint(e._prevPoint),o[i]._lastModified=s,r.push(o[i]));if(0<r.length){this._glView._convertTouchesWithScale(r);var h=new cc.Event.EventTouch(r);h._eventCode=cc.Event.EventTouch.MOVED,_.dispatchEvent(h)}},handleTouchesEnd:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(0<e.length){this._glView._convertTouchesWithScale(e);var i=new cc.Event.EventTouch(e);i._eventCode=cc.Event.EventTouch.ENDED,_.dispatchEvent(i)}},handleTouchesCancel:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(0<e.length){this._glView._convertTouchesWithScale(e);var i=new cc.Event.EventTouch(e);i._eventCode=cc.Event.EventTouch.CANCELLED,_.dispatchEvent(i)}},getSetOfTouchesEndOrCancel:function(t){for(var e,i,n,r=[],o=this._touches,s=this._touchesIntegerDict,a=0,c=t.length;a<c;a++)null!=(i=s[n=(e=t[a]).getID()])&&o[i]&&(o[i]._setPoint(e._point),o[i]._setPrevPoint(e._prevPoint),r.push(o[i]),this._removeUsedIndexBit(i),delete s[n]);return r},getHTMLElementPosition:function(t){var e=document.documentElement,i=window.pageXOffset-e.clientLeft,n=window.pageYOffset-e.clientTop;if("function"==typeof t.getBoundingClientRect){var r=t.getBoundingClientRect();return{left:r.left+i,top:r.top+n,width:r.width,height:r.height}}return t instanceof HTMLCanvasElement?{left:i,top:n,width:t.width,height:t.height}:{left:i,top:n,width:parseInt(t.style.width),height:parseInt(t.style.height)}},getPreTouch:function(t){for(var e=null,i=this._preTouchPool,n=t.getID(),r=i.length-1;0<=r;r--)if(i[r].getID()===n){e=i[r];break}return e||(e=t),e},setPreTouch:function(t){for(var e=!1,i=this._preTouchPool,n=t.getID(),r=i.length-1;0<=r;r--)if(i[r].getID()===n){i[r]=t,e=!0;break}e||(i.length<=50?i.push(t):(i[this._preTouchPoolPointer]=t,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(t,e,i){var n=this._preTouchPoint,r=this._glView.convertToLocationInView(t,e,i),o=new cc.Touch(r.x,r.y);return o._setPrevPoint(n.x,n.y),n.x=r.x,n.y=r.y,o},getPointByEvent:function(t,e){return null!=t.pageX?{x:t.pageX,y:t.pageY}:(e.left-=document.body.scrollLeft,e.top-=document.body.scrollTop,{x:t.clientX,y:t.clientY})},getTouchesByEvent:function(t){for(var e,i,n,r=[],o=this._glView,s=this._preTouchPoint,a=t.length,c=0;c<a;c++)if(e=t[c]){var h=o.convertToLocationInView(e.x,e.y,this._relatedPos);h.y=cc.game.canvas.height-h.y,null!=e.id?(i=new cc.Touch(h.x,h.y,e.id),n=this.getPreTouch(i).getLocation(),i._setPrevPoint(n.x,n.y),this.setPreTouch(i)):(i=new cc.Touch(h.x,h.y))._setPrevPoint(s.x,s.y),s.x=h.x,s.y=h.y,r.push(i)}return r},detectGesture:function(){var t=BK.TouchEvent.getAllTouchEvent();if(t)for(var e=[],i=[],n=[],r=t,o=0;o<r.length;o++){e.length=0,i.length=0;for(var s=n.length=0;s<r[o].length;++s){var a=r[o][s];2===a.status?e.push(a):3===a.status?i.push(a):1===a.status&&n.push(a)}0<e.length&&this.handleTouchesBegin(this.getTouchesByEvent(e)),0<i.length&&this.handleTouchesMove(this.getTouchesByEvent(i)),0<n.length&&this.handleTouchesEnd(this.getTouchesByEvent(n))}},registerSystemEvent:function(t){this._glView=cc.view,this._relatedPos={left:0,top:0,width:t.width,height:t.height},BK.Script.getTouchModeAll=1},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){}};e.exports=BK.inputManager=o}},{"../event-manager":83,"../platform/js":144,"./CCMacro":128,"./CCSys":132}],122:[function(t,e,i){var g=t("../assets/CCAsset"),n=t("./utils").callInNextTick,m=t("../load-pipeline/CCLoader"),v=t("../load-pipeline/pack-downloader"),s=t("../load-pipeline/auto-release-utils"),r=t("../utils/decode-uuid"),y=t("../load-pipeline/md5-pipe"),C="",T="",x={};function a(t){return t&&(t.constructor===cc.SceneAsset||t instanceof cc.Scene)}function E(t,e){this.url=t,this.type=e}var o={decodeUuid:r,loadAsset:function(r,o,t){if("string"!=typeof r)return n(o,new Error("[AssetLibrary] uuid must be string"),null);var e={uuid:r,type:"uuid"};t&&t.existingAsset&&(e.existingAsset=t.existingAsset),m.load(e,function(t,e){if(t||!e)t=new Error("[AssetLibrary] loading JSON or dependencies failed: "+(t?t.message:"Unknown error"));else{if(e.constructor===cc.SceneAsset){var i=cc.loader._getReferenceKey(r);e.scene.dependAssets=s.getDependsRecursively(i)}if(a(e)){var n=cc.loader._getReferenceKey(r);m.removeItem(n)}}o&&o(t,e)})},getLibUrlNoExt:function(t){return t=r(t),C+t.slice(0,2)+"/"+t},_queryAssetInfoInEditor:function(t,e){},_getAssetInfoInRuntime:function(t,e){e=e||{url:null,raw:!1};var i=x[t];return i&&!cc.isChildClassOf(i.type,cc.Asset)?(e.url=T+i.url,e.raw=!0):(e.url=this.getLibUrlNoExt(t)+".json",e.raw=!1),e},_getAssetUrl:function(t){var e=x[t];return e?T+e.url:null},queryAssetInfo:function(t,e){var i=this._getAssetInfoInRuntime(t);e(null,i.url,i.raw)},parseUuidInEditor:function(t){},loadJson:function(t,r){var o=""+((new Date).getTime()+Math.random()),e={uuid:o,type:"uuid",content:t,skips:[m.assetLoader.id,m.downloader.id]};m.load(e,function(t,e){if(t)t=new Error("[AssetLibrary] loading JSON or dependencies failed: "+t.message);else{if(e.constructor===cc.SceneAsset){var i=cc.loader._getReferenceKey(o);e.scene.dependAssets=s.getDependsRecursively(i)}if(a(e)){var n=cc.loader._getReferenceKey(o);m.removeItem(n)}}e._uuid="",r&&r(t,e)})},getAssetByUuid:function(t){return o._uuidToAsset[t]||null},init:function(t){var e=t.libraryPath;e=e.replace(/\\/g,"/"),C=cc.path.stripSep(e)+"/",T=t.rawAssetsBase;var i=t.md5AssetsMap;if(i){var n=new y(i,C,T);cc.loader.insertPipeAfter(cc.loader.assetLoader,n),cc.loader.md5Pipe=n}var r=m._resources;r.reset();var o=t.rawAssets;if(o)for(var s in o){var a=o[s];for(var c in a){var h=a[c],l=h[0],u=h[1],_=cc.js._getClassById(u);if(_){if(x[c]=new E(s+"/"+l,_),"assets"===s&&l.startsWith("resources/")){if(cc.isChildClassOf(_,g)){var d=cc.path.extname(l);l=d?l.slice("resources/".length,-d.length):l.slice("resources/".length)}else l=l.slice("resources/".length);var f=1===h[2];r.add(l,c,_,!f)}}else cc.error("Cannot get",u)}}t.packedAssets&&v.initPacks(t.packedAssets);var p=t.mountPaths;p||(p={assets:T+"assets",internal:T+"internal"}),cc.url._init(p)},_uuidToAsset:{}};e.exports=cc.AssetLibrary=o},{"../assets/CCAsset":32,"../load-pipeline/CCLoader":103,"../load-pipeline/auto-release-utils":107,"../load-pipeline/md5-pipe":113,"../load-pipeline/pack-downloader":114,"../utils/decode-uuid":170,"./utils":148}],123:[function(t,e,i){var d=t("./js"),f=t("./CCEnum"),n=t("./utils"),p=(n.isPlainEmptyObj_DEV,n.cloneable_DEV,t("./attribute")),g=p.DELIMETER,m=p.getTypeChecker,u=t("./preprocess-class");t("./requiring-frame");var _=["name","extends","mixins","ctor","__ctor__","properties","statics","editor","__ES6__"];function v(t,e){t.indexOf(e)<0&&t.push(e)}var y={datas:null,push:function(t){if(this.datas)this.datas.push(t);else{this.datas=[t];var e=this;setTimeout(function(){e.init()},0)}},init:function(){var t=this.datas;if(t){for(var e=0;e<t.length;++e){var i=t[e],n=i.cls,r=i.props;"function"==typeof r&&(r=r());var o=d.getClassName(n);r?O(n,o,r,n.$super,i.mixins):cc.errorID(3633,o)}this.datas=null}}};var C=[];function l(t,e,i,n,r){var o,s=n.default;p.setClassAttr(t,i,"default",s),o=i,v(t.__props__,o);var a=N(t,n,e,i,!1);if(a){for(var c=C,h=0;h<a.length;h++){var l=a[h];p.attr(t,i,l),l._onAfterProp&&c.push(l._onAfterProp)}for(var u=0;u<c.length;u++)c[u](t,i);C.length=0,a.length=0}}function T(t,e,i,n,r){var o=n.get,s=n.set,a=t.prototype,c=!Object.getOwnPropertyDescriptor(a,i);if(o){for(var h=N(t,n,e,i,!0),l=0;l<h.length;l++)p.attr(t,i,h[l]);h.length=0,p.setClassAttr(t,i,"serializable",!1),r||d.get(a,i,o,c,c)}s&&(r||d.set(a,i,s,c,c))}function r(t){return"function"==typeof t?t():t}function x(t,e,i){for(var n in e)t.hasOwnProperty(n)||i&&!i(n)||Object.defineProperty(t,n,d.getPropertyDescriptor(e,n))}function E(t){for(var e=d.getClassName(t),i=t.constructor,n="new "+e+"(",r=0;r<i.__props__.length;r++){var o=t[i.__props__[r]];if("object"==typeof o)return cc.errorID(3641,e),"new "+e+"()";n+=o,r<i.__props__.length-1&&(n+=",")}return n+")"}function S(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}var b=/^[$A-Za-z_][0-9A-Za-z_$]*$/;function R(t){var e=p.getClassAttrs(t),i=t.__props__;null===i&&(y.init(),i=t.__props__);var n=function(t,e){for(var i=[],n="",r=0;r<e.length;r++){var o=e[r],s=o+g+"default";if(s in t){var a,c;a=b.test(o)?"this."+o+"=":"this["+S(o)+"]=";var h=t[s];if("object"==typeof h&&h)c=h instanceof cc.ValueType?E(h):Array.isArray(h)?"[]":"{}";else if("function"==typeof h){var l=i.length;i.push(h),c="F["+l+"]()"}else c="string"==typeof h?S(h):h;n+=a=a+c+";\n"}}return 0===i.length?Function(n):Function("F","return (function(){\n"+n+"})")(i)}(e,i);(t.prototype.__initProps__=n).call(this)}var A=function(t,e,i,n){var r="return function CCClass(){\n";e&&function(t,e,i){var n=!1;for(var r in e)if(!(0<=_.indexOf(r))){var o=e[r];if("function"==typeof o){var s=d.getPropertyDescriptor(t.prototype,r);if(s){var a=s.value;if("function"==typeof a){h.test(o)&&(n=!0,e[r]=function(i,n){return function(){var t=this._super;this._super=i;var e=n.apply(this,arguments);return this._super=t,e}}(a,o));continue}}}}return n}(e,n)&&(r+="this._super=null;\n"),r+="this.__initProps__(CCClass);\n";var o=t.length;if(0<o){var s=!(i&&i.startsWith("cc."));s&&(r+="try{\n");var a="].apply(this,arguments);\n";if(1===o)r+="CCClass.__ctors__[0"+a;else{r+="var cs=CCClass.__ctors__;\n";for(var c=0;c<o;c++)r+="cs["+c+a}s&&(r+="}catch(e){\ncc._throw(e);\n}\n")}return r+="}",Function(r)()},h=/xyz/.test(function(){xyz})?/\b\._super\b/:/.*/;function O(e,t,i,n,r,o){if(e.__props__=[],n&&n.__props__&&(e.__props__=n.__props__.slice()),r)for(var s=0;s<r.length;++s){var a=r[s];a.__props__&&(e.__props__=e.__props__.concat(a.__props__.filter(function(t){return e.__props__.indexOf(t)<0})))}if(i)for(var c in u.preprocessAttrs(i,t,e,o),i){var h=i[c];"default"in h?l(e,t,c,h):T(e,t,c,h,o)}}function I(t){var e=(t=t||{}).name,i=t.extends,n=t.mixins,r=function(t,e,i,n){var r=cc.Component,o=cc._RF.peek();if(o&&cc.isChildClassOf(e,r)){if(cc.isChildClassOf(o.cls,r))return cc.errorID(3615),null;t=t||o.script}var s=function(t,u,_,e){var i,n,r=e.__ctor__,o=e.ctor,s=e.__ES6__;s?(i=[o],n=o):(i=r?[r]:function(t,e,i){for(var n=[],r=[u].concat(_),o=0;o<r.length;o++){var s=r[o];if(s)for(var a=I._isCCClass(h=s)?h.__ctors__||[]:[h],c=0;c<a.length;c++)v(n,a[c])}var h,l=i.ctor;return l&&n.push(l),n}(0,0,e),n=A(i,u,t,e),d.value(n,"extend",function(t){return t.extends=this,I(t)},!0)),d.value(n,"__ctors__",0<i.length?i:null,!0);var a=n.prototype;if(u&&(s||(d.extend(n,u),a=n.prototype),d.value(n,"$super",u)),_){for(var c=_.length-1;0<=c;c--){var h=_[c];x(a,h.prototype),x(n,h,function(t){return h.hasOwnProperty(t)&&!0}),I._isCCClass(h)&&x(p.getClassAttrs(n).constructor.prototype,p.getClassAttrs(h).constructor.prototype)}a.constructor=n}return s||(a.__initProps__=R),d.setClassName(t,n),n}(t,e,i,n);if(o)if(cc.isChildClassOf(e,r)){var a=o.uuid;a&&d._setClassId(a,s),o.cls=s}else cc.isChildClassOf(o.cls,r)||(o.cls=s);return s}(e,i,n,t);e||(e=cc.js.getClassName(r)),r._sealed=!0,i&&(i._sealed=!1);var o=t.properties;"function"==typeof o||i&&null===i.__props__||n&&n.some(function(t){return null===t.__props__})?(y.push({cls:r,props:o,mixins:n}),r.__props__=null):O(r,e,o,i,t.mixins,t.__ES6__);var s,a=t.statics;if(a)for(s in a)r[s]=a[s];for(var c in t)if(!(0<=_.indexOf(c))){var h=t[c];u.validateMethodWithProps(h,c,e,r,i)&&d.value(r.prototype,c,h,!0,!0)}var l=t.editor;return l&&cc.isChildClassOf(i,cc.Component)&&cc.Component._registerEditorProps(r,l),r}/xyz/.test(function(){xyz}),I._isCCClass=function(t){return t&&t.hasOwnProperty("__ctors__")},I._fastDefine=function(t,e,i){d.setClassName(t,e);for(var n=e.__props__=Object.keys(i),r=p.getClassAttrsProto(e),o=0;o<n.length;o++){var s=n[o];r[s+g+"visible"]=!1,r[s+g+"default"]=i[s]}},I.Attr=p,I.attr=p.attr,cc.isChildClassOf=function(t,e){if(t&&e){if("function"!=typeof t)return!1;if("function"!=typeof e)return!1;if(t===e)return!0;for(;;){if(!(t=d.getSuper(t)))return!1;if(t===e)return!0}}return!1},I.getInheritanceChain=function(t){for(var e=[];t=d.getSuper(t);)t!==Object&&e.push(t);return e};var w={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"},L=[];function N(t,n,e,i,r){var o=null,s="";function a(){return s=i+g,o=p.getClassAttrsProto(t)}L.length=0;var c=L,h=n.type;if(h){var l=w[h];if(l)c.push({type:h,_onAfterProp:m(l,"cc."+h)});else if("Object"===h);else if(h===p.ScriptUuid){var u=p.ObjectType(cc.ScriptAsset);u.type="Script",c.push(u)}else"object"==typeof h?f.isEnum(h)&&c.push({type:"Enum",enumList:f.getList(h)}):"function"==typeof h&&(n.url?c.push({type:"Object",ctor:h,_onAfterProp:m("String","cc.String")}):c.push(n._short?{type:"Object",ctor:h}:p.ObjectType(h)))}function _(t,e){if(t in n){var i=n[t];typeof i===e&&((o||a())[s+t]=i)}}n.editorOnly&&((o||a())[s+"editorOnly"]=!0),n.url&&((o||a())[s+"saveUrlAsAsset"]=!0),!1===n.serializable&&((o||a())[s+"serializable"]=!1),_("formerlySerializedAs","string");var d=n.range;return d&&Array.isArray(d)&&2<=d.length&&((o||a())[s+"min"]=d[0],o[s+"max"]=d[1],2<d.length&&(o[s+"step"]=d[2])),_("min","number"),_("max","number"),_("step","number"),c}cc.Class=I,e.exports={isArray:function(t){return t=r(t),Array.isArray(t)},fastDefine:I._fastDefine,getNewValueTypeCode:E,IDENTIFIER_RE:b,escapeForJS:S,getDefault:r}},{"./CCEnum":125,"./attribute":136,"./js":144,"./preprocess-class":145,"./requiring-frame":146,"./utils":148}],124:[function(t,e,i){t("./CCClass");var u=t("./preprocess-class"),_=t("./js"),s="__ccclassCache__";function n(t){return t}function a(t,e){return t[e]||(t[e]={})}function r(i){return function(e){return"function"==typeof e?i(e):function(t){return i(t,e)}}}function o(t,i,e){return function(e){return function(t){return i(t,e)}}}var c=o.bind(null,!1);function h(t){return o.bind(null,!1)}var l=h(),d=h();function f(t,e){return a(t,s)}var p=r(function(t,e){var i=_.getSuper(t);i===Object&&(i=null);var n={name:e,extends:i,ctor:t,__ES6__:!0},r=t[s];if(r){var o=r.proto;o&&_.mixin(n,o),t[s]=void 0}return cc.Class(n)});function g(t,r,o){return t(function(t,e){var i=f(t);if(i){var n=void 0!==o?o:e;a(a(i,"proto"),"editor")[r]=n}},r)}function m(t){return t(n)}var v=m(r),y=g(c,"requireComponent"),C=m(l),T=g(d,"executionOrder"),x=m(r),E=m(r),S=m(l),b=m(l),R=m(l);cc._decorator=e.exports={ccclass:p,property:function(t,e,i){var o=null;function n(t,e,i){var n=f(t.constructor);if(n){var r=a(a(n,"proto"),"properties");!function(t,e,i,n,r,o){var s=n&&(u.getFullFormOfProperty(n)||n),a=e[i],c=_.mixin(a||{},s||{});if(r&&(r.get||r.set))r.get&&(c.get=r.get),r.set&&(c.set=r.set);else{var h=void 0;if(r)r.initializer&&(h=function(t){var e;try{e=t()}catch(e){return t}return"object"!=typeof e||null===e?e:t}(r.initializer));else{var l=o.default||(o.default=function(t){var e;try{e=new t}catch(t){return{}}return e}(t));l.hasOwnProperty(i)&&(h=l[i])}c.default=h}e[i]=c}(t.constructor,r,e,o,i,n)}}if(void 0===e)return o=t,n;n(t,e,i)},executeInEditMode:v,requireComponent:y,menu:C,executionOrder:T,disallowMultiple:x,playOnFocus:E,inspector:S,icon:b,help:R,mixins:function(){for(var i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];return function(t){var e=f(t);e&&(a(e,"proto").mixins=i)}}}},{"./CCClass":123,"./js":144,"./preprocess-class":145,"./utils":148}],125:[function(t,e,i){var a=t("./js");function n(t){if("__enums__"in t)return t;a.value(t,"__enums__",null,!0);for(var e=-1,i=Object.keys(t),n=0;n<i.length;n++){var r=i[n],o=t[r];if(-1===o)o=++e,t[r]=o;else if("number"==typeof o)e=o;else if("string"==typeof o&&Number.isInteger(parseFloat(r)))continue;var s=""+o;r!==s&&a.value(t,s,r)}return t}n.isEnum=function(t){return t&&t.hasOwnProperty("__enums__")},n.getList=function(t){if(t.__enums__)return t.__enums__;var e=t.__enums__=[];for(var i in t){var n=t[i];Number.isInteger(n)&&e.push({name:i,value:n})}return e.sort(function(t,e){return t.value-e.value}),e},e.exports=cc.Enum=n},{"./js":144}],126:[function(t,e,i){cc.ClassManager||t("./_CCClass");var n=t("../event-manager"),r=t("./CCInputManager");r.__instanceId=cc.ClassManager.getNewInstanceId(),r.setAccelerometerEnabled=function(t){if(this._accelEnabled!==t){this._accelEnabled=t;var e=cc.director.getScheduler();this._accelEnabled,this._accelCurTime=0,e.scheduleUpdate(this)}},r.setAccelerometerInterval=function(t){this._accelInterval!==t&&(this._accelInterval=t)},r._registerKeyboardEvent=function(){cc.game.canvas.addEventListener("keydown",function(t){n.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!0)),t.stopPropagation(),t.preventDefault()},!1),cc.game.canvas.addEventListener("keyup",function(t){n.dispatchEvent(new cc.Event.EventKeyboard(t.keyCode,!1)),t.stopPropagation(),t.preventDefault()},!1)},r._registerAccelerometerEvent=function(){var t=window;this._acceleration=new cc.Acceleration,this._accelDeviceEvent=t.DeviceMotionEvent||t.DeviceOrientationEvent,cc.sys.browserType===cc.sys.BROWSER_TYPE_MOBILE_QQ&&(this._accelDeviceEvent=window.DeviceOrientationEvent);var e=this._accelDeviceEvent===t.DeviceMotionEvent?"devicemotion":"deviceorientation",i=navigator.userAgent;(/Android/.test(i)||/Adr/.test(i)&&cc.sys.browserType===cc.BROWSER_TYPE_UC)&&(this._minus=-1),t.addEventListener(e,this.didAccelerate.bind(this),!1)},r.didAccelerate=function(t){var e=window;if(this._accelEnabled){var i,n,r,o=this._acceleration;if(this._accelDeviceEvent===window.DeviceMotionEvent){var s=t.accelerationIncludingGravity;i=this._accelMinus*s.x*.1,n=this._accelMinus*s.y*.1,r=.1*s.z}else i=t.gamma/90*.981,n=-t.beta/90*.981,r=t.alpha/90*.981;o.x=i,o.y=n,o.z=r,o.timestamp=t.timeStamp||Date.now();var a=o.x;e.orientation===cc.macro.WEB_ORIENTATION_LANDSCAPE_RIGHT?(o.x=-o.y,o.y=a):e.orientation===cc.macro.WEB_ORIENTATION_LANDSCAPE_LEFT?(o.x=o.y,o.y=-a):e.orientation===cc.macro.WEB_ORIENTATION_PORTRAIT_UPSIDE_DOWN&&(o.x=-o.x,o.y=-o.y),cc.sys.os===cc.sys.OS_ANDROID&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_MOBILE_QQ&&(o.x=-o.x,o.y=-o.y)}}},{"../event-manager":83,"./CCInputManager":127,"./_CCClass":135}],127:[function(t,e,i){var n=t("../platform/js"),r=t("./CCMacro"),p=t("./CCSys"),g=t("../event-manager"),o=r.TOUCH_TIMEOUT,s={_mousePressed:!1,_isRegisterEvent:!1,_preTouchPoint:cc.p(0,0),_prevMousePoint:cc.p(0,0),_preTouchPool:[],_preTouchPoolPointer:0,_touches:[],_touchesIntegerDict:{},_indexBitsUsed:0,_maxTouches:5,_accelEnabled:!1,_accelInterval:1/30,_accelMinus:1,_accelCurTime:0,_acceleration:null,_accelDeviceEvent:null,_getUnUsedIndex:function(){for(var t=this._indexBitsUsed,e=cc.sys.now(),i=0;i<this._maxTouches;i++){if(!(1&t))return this._indexBitsUsed|=1<<i,i;var n=this._touches[i];if(e-n._lastModified>o)return this._removeUsedIndexBit(i),delete this._touchesIntegerDict[n.getID()],i;t>>=1}return-1},_removeUsedIndexBit:function(t){if(!(t<0||t>=this._maxTouches)){var e=1<<t;e=~e,this._indexBitsUsed&=e}},_glView:null,handleTouchesBegin:function(t){for(var e,i,n,r=[],o=this._touchesIntegerDict,s=p.now(),a=0,c=t.length;a<c;a++)if(null==o[n=(e=t[a]).getID()]){var h=this._getUnUsedIndex();if(-1===h){cc.logID(2300,h);continue}(i=this._touches[h]=new cc.Touch(e._point.x,e._point.y,e.getID()))._lastModified=s,i._setPrevPoint(e._prevPoint),o[n]=h,r.push(i)}if(0<r.length){this._glView._convertTouchesWithScale(r);var l=new cc.Event.EventTouch(r);l._eventCode=cc.Event.EventTouch.BEGAN,g.dispatchEvent(l)}},handleTouchesMove:function(t){for(var e,i,n,r=[],o=this._touches,s=p.now(),a=0,c=t.length;a<c;a++)n=(e=t[a]).getID(),null!=(i=this._touchesIntegerDict[n])&&o[i]&&(o[i]._setPoint(e._point),o[i]._setPrevPoint(e._prevPoint),o[i]._lastModified=s,r.push(o[i]));if(0<r.length){this._glView._convertTouchesWithScale(r);var h=new cc.Event.EventTouch(r);h._eventCode=cc.Event.EventTouch.MOVED,g.dispatchEvent(h)}},handleTouchesEnd:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(0<e.length){this._glView._convertTouchesWithScale(e);var i=new cc.Event.EventTouch(e);i._eventCode=cc.Event.EventTouch.ENDED,g.dispatchEvent(i)}},handleTouchesCancel:function(t){var e=this.getSetOfTouchesEndOrCancel(t);if(0<e.length){this._glView._convertTouchesWithScale(e);var i=new cc.Event.EventTouch(e);i._eventCode=cc.Event.EventTouch.CANCELLED,g.dispatchEvent(i)}},getSetOfTouchesEndOrCancel:function(t){for(var e,i,n,r=[],o=this._touches,s=this._touchesIntegerDict,a=0,c=t.length;a<c;a++)null!=(i=s[n=(e=t[a]).getID()])&&o[i]&&(o[i]._setPoint(e._point),o[i]._setPrevPoint(e._prevPoint),r.push(o[i]),this._removeUsedIndexBit(i),delete s[n]);return r},getHTMLElementPosition:function(t){if(p.platform===p.WECHAT_GAME)return{left:0,top:0,width:window.innerWidth,height:window.innerHeight};var e=document.documentElement,i=window.pageXOffset-e.clientLeft,n=window.pageYOffset-e.clientTop;if("function"==typeof t.getBoundingClientRect){var r=t.getBoundingClientRect();return{left:r.left+i,top:r.top+n,width:r.width,height:r.height}}return t instanceof HTMLCanvasElement?{left:i,top:n,width:t.width,height:t.height}:{left:i,top:n,width:parseInt(t.style.width),height:parseInt(t.style.height)}},getPreTouch:function(t){for(var e=null,i=this._preTouchPool,n=t.getID(),r=i.length-1;0<=r;r--)if(i[r].getID()===n){e=i[r];break}return e||(e=t),e},setPreTouch:function(t){for(var e=!1,i=this._preTouchPool,n=t.getID(),r=i.length-1;0<=r;r--)if(i[r].getID()===n){i[r]=t,e=!0;break}e||(i.length<=50?i.push(t):(i[this._preTouchPoolPointer]=t,this._preTouchPoolPointer=(this._preTouchPoolPointer+1)%50))},getTouchByXY:function(t,e,i){var n=this._preTouchPoint,r=this._glView.convertToLocationInView(t,e,i),o=new cc.Touch(r.x,r.y);return o._setPrevPoint(n.x,n.y),n.x=r.x,n.y=r.y,o},getMouseEvent:function(t,e,i){var n=this._prevMousePoint,r=new cc.Event.EventMouse(i);return r._setPrevCursor(n.x,n.y),n.x=t.x,n.y=t.y,this._glView._convertMouseToLocationInView(n,e),r.setLocation(n.x,n.y),r},getPointByEvent:function(t,e){return null!=t.pageX?{x:t.pageX,y:t.pageY}:(p.platform===p.WECHAT_GAME?(e.left=0,e.top=0):(e.left-=document.body.scrollLeft,e.top-=document.body.scrollTop),{x:t.clientX,y:t.clientY})},getTouchesByEvent:function(t,e){for(var i,n,r,o=[],s=this._glView,a=this._preTouchPoint,c=t.changedTouches.length,h=0;h<c;h++){var l;(i=t.changedTouches[h])&&(l=p.BROWSER_TYPE_FIREFOX===p.browserType?s.convertToLocationInView(i.pageX,i.pageY,e):s.convertToLocationInView(i.clientX,i.clientY,e),null!=i.identifier?(n=new cc.Touch(l.x,l.y,i.identifier),r=this.getPreTouch(n).getLocation(),n._setPrevPoint(r.x,r.y),this.setPreTouch(n)):(n=new cc.Touch(l.x,l.y))._setPrevPoint(a.x,a.y),a.x=l.x,a.y=l.y,o.push(n))}return o},registerSystemEvent:function(s){if(!this._isRegisterEvent){this._glView=cc.view;var a=this,t=p.isMobile,e="mouse"in p.capabilities,i="touches"in p.capabilities;if(p.platform===p.WECHAT_GAME&&(e=!(i=!(t=!1))),e){t||(window.addEventListener("mousedown",function(){a._mousePressed=!0},!1),window.addEventListener("mouseup",function(t){if(a._mousePressed){a._mousePressed=!1;var e=a.getHTMLElementPosition(s),i=a.getPointByEvent(t,e);if(!cc.rectContainsPoint(new cc.Rect(e.left,e.top,e.width,e.height),i)){a.handleTouchesEnd([a.getTouchByXY(i.x,i.y,e)]);var n=a.getMouseEvent(i,e,cc.Event.EventMouse.UP);n.setButton(t.button),g.dispatchEvent(n)}}},!1));for(var n=cc.Event.EventMouse,r=[!t&&["mousedown",n.DOWN,function(t,e,i,n){a._mousePressed=!0,a.handleTouchesBegin([a.getTouchByXY(i.x,i.y,n)]),s.focus()}],!t&&["mouseup",n.UP,function(t,e,i,n){a._mousePressed=!1,a.handleTouchesEnd([a.getTouchByXY(i.x,i.y,n)])}],!t&&["mousemove",n.MOVE,function(t,e,i,n){a.handleTouchesMove([a.getTouchByXY(i.x,i.y,n)]),a._mousePressed||e.setButton(null)}],["mousewheel",n.SCROLL,function(t,e){e.setScrollData(0,t.wheelDelta)}],["DOMMouseScroll",n.SCROLL,function(t,e){e.setScrollData(0,-120*t.detail)}]],o=0;o<r.length;++o){var c=r[o];c&&function(){var t=c[0],r=c[1],o=c[2];s.addEventListener(t,function(t){var e=a.getHTMLElementPosition(s),i=a.getPointByEvent(t,e),n=a.getMouseEvent(i,e,r);n.setButton(t.button),o(t,n,i,e),g.dispatchEvent(n),"undefined"!=typeof engine&&engine.macro.IS_ENGINE_EDITOR||t.stopPropagation(),t.preventDefault()},!1)}()}}if(window.navigator.msPointerEnabled){var h={MSPointerDown:a.handleTouchesBegin,MSPointerMove:a.handleTouchesMove,MSPointerUp:a.handleTouchesEnd,MSPointerCancel:a.handleTouchesCancel},l=function(t){var i=h[t];s.addEventListener(t,function(t){var e=a.getHTMLElementPosition(s);e.left-=document.documentElement.scrollLeft,e.top-=document.documentElement.scrollTop,i.call(a,[a.getTouchByXY(t.clientX,t.clientY,e)]),t.stopPropagation()},!1)};for(var u in h)l(u)}if(i){var _,d={touchstart:function(t){a.handleTouchesBegin(t),p.platform!==p.WECHAT_GAME&&s.focus()},touchmove:function(t){a.handleTouchesMove(t)},touchend:function(t){a.handleTouchesEnd(t)},touchcancel:function(t){a.handleTouchesCancel(t)}};for(var f in cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB?(d={onTouchStart:d.touchstart,onTouchMove:d.touchmove,onTouchEnd:d.touchend,onTouchCancel:d.touchcancel},_=function(t){var n=d[t];wx[t](function(t){if(t.changedTouches){var e=a.getHTMLElementPosition(s),i=document.body;e.left-=i.scrollLeft||0,e.top-=i.scrollTop||0,n(a.getTouchesByEvent(t,e))}})}):_=function(t){var n=d[t];s.addEventListener(t,function(t){if(t.changedTouches){var e=a.getHTMLElementPosition(s),i=document.body;e.left-=i.scrollLeft||0,e.top-=i.scrollTop||0,n(a.getTouchesByEvent(t,e)),t.stopPropagation(),t.preventDefault()}},!1)},d)_(f)}cc.sys.browserType!==cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB&&(this._registerKeyboardEvent(),this._registerAccelerometerEvent()),this._isRegisterEvent=!0}},_registerKeyboardEvent:function(){},_registerAccelerometerEvent:function(){},update:function(t){this._accelCurTime>this._accelInterval&&(this._accelCurTime-=this._accelInterval,g.dispatchEvent(new cc.Event.EventAcceleration(this._acceleration))),this._accelCurTime+=t}};n.get(cc,"inputManager",function(){return cc.warnID(1405,"cc.inputManager","cc.systemEvent"),s}),e.exports=s},{"../event-manager":83,"../platform/js":144,"./CCMacro":128,"./CCSys":132}],128:[function(t,e,i){t("./_CCClass"),cc.KEY={none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},cc.ImageFormat=cc.Enum({JPG:0,PNG:1,TIFF:2,WEBP:3,PVR:4,ETC:5,S3TC:6,ATITC:7,TGA:8,RAWDATA:9,UNKNOWN:10}),cc.getImageFormatByData=function(t){return 8<t.length&&137===t[0]&&80===t[1]&&78===t[2]&&71===t[3]&&13===t[4]&&10===t[5]&&26===t[6]&&10===t[7]?cc.ImageFormat.PNG:2<t.length&&(73===t[0]&&73===t[1]||77===t[0]&&77===t[1]||255===t[0]&&216===t[1])?cc.ImageFormat.TIFF:cc.ImageFormat.UNKNOWN},cc.macro={INVALID_INDEX:-1,NODE_TAG_INVALID:-1,PI:Math.PI,PI2:2*Math.PI,FLT_MAX:parseFloat("3.402823466e+38F"),FLT_MIN:parseFloat("1.175494351e-38F"),RAD:Math.PI/180,DEG:180/Math.PI,UINT_MAX:4294967295,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,ONE:1,ZERO:0,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,LINEAR:9729,BLEND_DST:771,WEB_ORIENTATION_PORTRAIT:0,WEB_ORIENTATION_LANDSCAPE_LEFT:-90,WEB_ORIENTATION_PORTRAIT_UPSIDE_DOWN:180,WEB_ORIENTATION_LANDSCAPE_RIGHT:90,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,DENSITYDPI_DEVICE:"device-dpi",DENSITYDPI_HIGH:"high-dpi",DENSITYDPI_MEDIUM:"medium-dpi",DENSITYDPI_LOW:"low-dpi",VERTEX_ATTRIB_FLAG_NONE:0,VERTEX_ATTRIB_FLAG_POSITION:1,VERTEX_ATTRIB_FLAG_COLOR:2,VERTEX_ATTRIB_FLAG_TEX_COORDS:4,VERTEX_ATTRIB_FLAG_POS_COLOR_TEX:7,GL_ALL:0,VERTEX_ATTRIB_POSITION:0,VERTEX_ATTRIB_COLOR:1,VERTEX_ATTRIB_TEX_COORDS:2,VERTEX_ATTRIB_MAX:3,UNIFORM_PMATRIX:0,UNIFORM_MVMATRIX:1,UNIFORM_MVPMATRIX:2,UNIFORM_TIME:3,UNIFORM_SINTIME:4,UNIFORM_COSTIME:5,UNIFORM_RANDOM01:6,UNIFORM_SAMPLER:7,UNIFORM_MAX:8,SHADER_POSITION_TEXTURECOLOR:"ShaderPositionTextureColor",SHADER_SPRITE_POSITION_TEXTURECOLOR:"ShaderSpritePositionTextureColor",SHADER_POSITION_TEXTURECOLORALPHATEST:"ShaderPositionTextureColorAlphaTest",SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST:"ShaderSpritePositionTextureColorAlphaTest",SHADER_POSITION_COLOR:"ShaderPositionColor",SHADER_SPRITE_POSITION_COLOR:"ShaderSpritePositionColor",SHADER_POSITION_TEXTURE:"ShaderPositionTexture",SHADER_POSITION_TEXTURE_UCOLOR:"ShaderPositionTexture_uColor",SHADER_POSITION_TEXTUREA8COLOR:"ShaderPositionTextureA8Color",SHADER_POSITION_UCOLOR:"ShaderPosition_uColor",SHADER_POSITION_LENGTHTEXTURECOLOR:"ShaderPositionLengthTextureColor",UNIFORM_PMATRIX_S:"CC_PMatrix",UNIFORM_MVMATRIX_S:"CC_MVMatrix",UNIFORM_MVPMATRIX_S:"CC_MVPMatrix",UNIFORM_TIME_S:"CC_Time",UNIFORM_SINTIME_S:"CC_SinTime",UNIFORM_COSTIME_S:"CC_CosTime",UNIFORM_RANDOM01_S:"CC_Random01",UNIFORM_SAMPLER_S:"CC_Texture0",UNIFORM_ALPHA_TEST_VALUE_S:"CC_alpha_value",ATTRIBUTE_NAME_COLOR:"a_color",ATTRIBUTE_NAME_POSITION:"a_position",ATTRIBUTE_NAME_TEX_COORD:"a_texCoord",ITEM_SIZE:32,CURRENT_ITEM:3233828865,ZOOM_ACTION_TAG:3233828866,NORMAL_TAG:8801,SELECTED_TAG:8802,DISABLE_TAG:8803,FIX_ARTIFACTS_BY_STRECHING_TEXEL:0,FIX_ARTIFACTS_BY_STRECHING_TEXEL_TMX:1,DIRECTOR_STATS_POSITION:cc.p(0,0),DIRECTOR_FPS_INTERVAL:.5,COCOSNODE_RENDER_SUBPIXEL:1,SPRITEBATCHNODE_RENDER_SUBPIXEL:1,AUTO_PREMULTIPLIED_ALPHA_FOR_PNG:0,OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA:0,TEXTURE_NPOT_SUPPORT:0,USE_LA88_LABELS:1,SPRITE_DEBUG_DRAW:0,LABELBMFONT_DEBUG_DRAW:0,LABELATLAS_DEBUG_DRAW:0,ENABLE_STACKABLE_ACTIONS:1,ENABLE_GL_STATE_CACHE:1,TOUCH_TIMEOUT:5e3,BATCH_VERTEX_COUNT:2e4,ENABLE_GC_FOR_NATIVE_OBJECTS:!0,ENABLE_TILEDMAP_CULLING:!0,DOWNLOAD_MAX_CONCURRENT:64,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!1};var n=!0;cc.defineGetterSetter(cc.macro,"ENABLE_CULLING",function(){return n},function(t){n=t;var e=cc.director.getScene();e&&(e._sgNode._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.cullingDirty),cc.renderer.childrenOrderDirty=!0)}),cc.defineGetterSetter(cc.macro,"BLEND_SRC",function(){return cc._renderType===cc.game.RENDER_TYPE_WEBGL&&cc.macro.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA?cc.macro.ONE:cc.macro.SRC_ALPHA}),cc.lerp=function(t,e,i){return t+(e-t)*i},cc.rand=function(){return 16777215*Math.random()},cc.randomMinus1To1=function(){return 2*(Math.random()-.5)},cc.random0To1=Math.random,cc.degreesToRadians=function(t){return t*cc.macro.RAD},cc.radiansToDegrees=function(t){return t*cc.macro.DEG},cc.nodeDrawSetup=function(t){t._shaderProgram&&(t._shaderProgram.use(),t._shaderProgram.setUniformForModelViewAndProjectionMatrixWithMat4())},cc.incrementGLDraws=function(t){cc.g_NumberOfDraws+=t},cc.checkGLErrorDebug=function(){if(cc._renderType===cc.game.RENDER_TYPE_WEBGL){var t=cc._renderContext.getError();t&&cc.logID(2400,t)}},e.exports=cc.macro},{"./_CCClass":135}],129:[function(t,e,i){var n=t("./js"),_=t("./CCClass");function r(){this._name="",this._objFlags=0}_.fastDefine("cc.Object",r,{_name:"",_objFlags:0}),n.value(r,"Flags",{Destroyed:1,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20});var o=[];n.value(r,"_deferredDestroy",function(){for(var t=o.length,e=0;e<t;++e){var i=o[e];1&i._objFlags||i._destroyImmediate()}t===o.length?o.length=0:o.splice(0,t)});var s=r.prototype;n.getset(s,"name",function(){return this._name},function(t){this._name=t}),n.get(s,"isValid",function(){return!(1&this._objFlags)}),s.destroy=function(){return 1&this._objFlags?(cc.warnID(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,o.push(this),0))},s._destruct=function(){var t=this.constructor,e=t.__destruct__;e||(e=function(t,e){var i,n={};for(i in t)if(t.hasOwnProperty(i))switch(typeof t[i]){case"string":n[i]="";break;case"object":case"function":n[i]=null}if(cc.Class._isCCClass(e))for(var r=cc.Class.Attr.getClassAttrs(e),o=e.__props__,s=0;s<o.length;s++){var a=(i=o[s])+cc.Class.Attr.DELIMETER+"default";if(a in r)switch(typeof r[a]){case"string":n[i]="";break;case"object":case"function":n[i]=null;break;case"undefined":n[i]=void 0}}var c=t instanceof cc._BaseNode||t instanceof cc.Component,h="";for(i in n)if(!c||"_id"!==i){var l;l=_.IDENTIFIER_RE.test(i)?"o."+i+"=":"o["+_.escapeForJS(i)+"]=";var u=n[i];""===u&&(u='""'),h+=l+u+";\n"}return Function("o",h)}(this,t),n.value(t,"__destruct__",e,!0)),e(this)},s._onPreDestroy=null,s._destroyImmediate=function(){1&this._objFlags?cc.errorID(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=1)},s._deserialize=null,cc.isValid=function(t,e){return"object"==typeof t?!(!t||t._objFlags&(e?5:1)):void 0!==t},cc.Object=e.exports=r},{"./CCClass":123,"./js":144}],130:[function(t,e,i){cc.SAXParser=cc._Class.extend({ctor:function(){window.DOMParser?(this._isSupportDOMParser=!0,this._parser=new DOMParser):(this._isSupportDOMParser=!1,this._parser=null)},parse:function(t){return this._parseXML(t)},_parseXML:function(t){var e;return this._isSupportDOMParser?e=this._parser.parseFromString(t,"text/xml"):((e=new ActiveXObject("Microsoft.XMLDOM")).async="false",e.loadXML(t)),e}}),cc.PlistParser=cc.SAXParser.extend({parse:function(t){var e=this._parseXML(t),i=e.documentElement;if("plist"!==i.tagName)return cc.warnID(5100),{};for(var n=null,r=0,o=i.childNodes.length;r<o&&1!==(n=i.childNodes[r]).nodeType;r++);return e=null,this._parseNode(n)},_parseNode:function(t){var e=null,i=t.tagName;if("dict"===i)e=this._parseDict(t);else if("array"===i)e=this._parseArray(t);else if("string"===i)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else{e="";for(var n=0;n<t.childNodes.length;n++)e+=t.childNodes[n].nodeValue}else"false"===i?e=!1:"true"===i?e=!0:"real"===i?e=parseFloat(t.firstChild.nodeValue):"integer"===i&&(e=parseInt(t.firstChild.nodeValue,10));return e},_parseArray:function(t){for(var e=[],i=0,n=t.childNodes.length;i<n;i++){var r=t.childNodes[i];1===r.nodeType&&e.push(this._parseNode(r))}return e},_parseDict:function(t){for(var e={},i=null,n=0,r=t.childNodes.length;n<r;n++){var o=t.childNodes[n];1===o.nodeType&&("key"===o.tagName?i=o.firstChild.nodeValue:e[i]=this._parseNode(o))}return e}}),cc.saxParser=new cc.SAXParser,cc.plistParser=new cc.PlistParser},{}],131:[function(t,e,i){cc.screen={_supportsFullScreen:!1,_preOnFullScreenChange:null,_touchEvent:"",_fn:null,_fnMap:[["requestFullscreen","exitFullscreen","fullscreenchange","fullscreenEnabled","fullscreenElement"],["requestFullScreen","exitFullScreen","fullScreenchange","fullScreenEnabled","fullScreenElement"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitfullscreenchange","webkitIsFullScreen","webkitCurrentFullScreenElement"],["mozRequestFullScreen","mozCancelFullScreen","mozfullscreenchange","mozFullScreen","mozFullScreenElement"],["msRequestFullscreen","msExitFullscreen","MSFullscreenChange","msFullscreenEnabled","msFullscreenElement"]],init:function(){this._fn={};var t,e,i,n,r=this._fnMap;for(t=0,e=r.length;t<e;t++)if((i=r[t])&&i[1]in document){for(t=0,n=i.length;t<n;t++)this._fn[r[0][t]]=i[t];break}this._supportsFullScreen=void 0!==this._fn.requestFullscreen,this._touchEvent="ontouchstart"in window?"touchstart":"mousedown"},fullScreen:function(){return!!this._supportsFullScreen&&void 0!==document[this._fn.fullscreenElement]&&null!==document[this._fn.fullscreenElement]},requestFullScreen:function(t,e){if(this._supportsFullScreen){if(t=t||document.documentElement,e){var i=this._fn.fullscreenchange;this._preOnFullScreenChange&&document.removeEventListener(i,this._preOnFullScreenChange),this._preOnFullScreenChange=e,document.addEventListener(i,e,!1)}return t[this._fn.requestFullscreen]()}},exitFullScreen:function(){return!this._supportsFullScreen||document[this._fn.exitFullscreen]()},autoFullScreen:function(e,i){e=e||document.body;var n=cc.game.canvas||e,r=this;this.requestFullScreen(e,i),n.addEventListener(this._touchEvent,function t(){n.removeEventListener(r._touchEvent,t),r.requestFullScreen(e,i)})}},cc.screen.init()},{}],132:[function(t,e,i){if(!cc.sys){cc.sys={};var n,r,o,s=cc.sys;if(s.LANGUAGE_ENGLISH="en",s.LANGUAGE_CHINESE="zh",s.LANGUAGE_FRENCH="fr",s.LANGUAGE_ITALIAN="it",s.LANGUAGE_GERMAN="de",s.LANGUAGE_SPANISH="es",s.LANGUAGE_DUTCH="du",s.LANGUAGE_RUSSIAN="ru",s.LANGUAGE_KOREAN="ko",s.LANGUAGE_JAPANESE="ja",s.LANGUAGE_HUNGARIAN="hu",s.LANGUAGE_PORTUGUESE="pt",s.LANGUAGE_ARABIC="ar",s.LANGUAGE_NORWEGIAN="no",s.LANGUAGE_POLISH="pl",s.LANGUAGE_TURKISH="tr",s.LANGUAGE_UKRAINIAN="uk",s.LANGUAGE_ROMANIAN="ro",s.LANGUAGE_BULGARIAN="bg",s.LANGUAGE_UNKNOWN="unknown",s.OS_IOS="iOS",s.OS_ANDROID="Android",s.OS_WINDOWS="Windows",s.OS_MARMALADE="Marmalade",s.OS_LINUX="Linux",s.OS_BADA="Bada",s.OS_BLACKBERRY="Blackberry",s.OS_OSX="OS X",s.OS_WP8="WP8",s.OS_WINRT="WINRT",s.OS_UNKNOWN="Unknown",s.UNKNOWN=-1,s.WIN32=0,s.LINUX=1,s.MACOS=2,s.ANDROID=3,s.IPHONE=4,s.IPAD=5,s.BLACKBERRY=6,s.NACL=7,s.EMSCRIPTEN=8,s.TIZEN=9,s.WINRT=10,s.WP8=11,s.MOBILE_BROWSER=100,s.DESKTOP_BROWSER=101,s.EDITOR_PAGE=102,s.EDITOR_CORE=103,s.WECHAT_GAME=104,s.QQ_PLAY=105,s.BROWSER_TYPE_WECHAT="wechat",s.BROWSER_TYPE_WECHAT_GAME="wechatgame",s.BROWSER_TYPE_WECHAT_GAME_SUB="wechatgamesub",s.BROWSER_TYPE_QQ_PLAY="qqplay",s.BROWSER_TYPE_ANDROID="androidbrowser",s.BROWSER_TYPE_IE="ie",s.BROWSER_TYPE_QQ="qqbrowser",s.BROWSER_TYPE_MOBILE_QQ="mqqbrowser",s.BROWSER_TYPE_UC="ucbrowser",s.BROWSER_TYPE_360="360browser",s.BROWSER_TYPE_BAIDU_APP="baiduboxapp",s.BROWSER_TYPE_BAIDU="baidubrowser",s.BROWSER_TYPE_MAXTHON="maxthon",s.BROWSER_TYPE_OPERA="opera",s.BROWSER_TYPE_OUPENG="oupeng",s.BROWSER_TYPE_MIUI="miuibrowser",s.BROWSER_TYPE_FIREFOX="firefox",s.BROWSER_TYPE_SAFARI="safari",s.BROWSER_TYPE_CHROME="chrome",s.BROWSER_TYPE_LIEBAO="liebao",s.BROWSER_TYPE_QZONE="qzone",s.BROWSER_TYPE_SOUGOU="sogou",s.BROWSER_TYPE_UNKNOWN="unknown",s.isNative=!1,s.isBrowser="object"==typeof window&&"object"==typeof document&&!CC_QQPLAY,cc.create3DContext=function(t,e,i){if(!i)return cc.create3DContext(t,e,"webgl")||cc.create3DContext(t,e,"experimental-webgl")||cc.create3DContext(t,e,"webkit-3d")||cc.create3DContext(t,e,"moz-webgl")||null;try{return t.getContext(i,e)}catch(t){return null}},CC_QQPLAY){var a=window.BK.Director.queryDeviceInfo();s.isMobile=!0,s.platform=s.QQ_PLAY,s.language=s.LANGUAGE_UNKNOWN,"android"===a.platform?s.os=s.OS_ANDROID:"ios"===a.platform?s.os=s.OS_IOS:s.os=s.OS_UNKNOWN;var c=/[\d\.]+/.exec(a.version);s.osVersion=c[0],s.osMainVersion=parseInt(s.osVersion.split(".")[0]),s.browserType=s.BROWSER_TYPE_QQ_PLAY,s.browserVersion=0,s.noABSupport=s.os===s.OS_IOS&&s.osMainVersion<10;var h=a.screenWidth,l=a.screenHeight,u=a.pixelRatio||1;s.windowPixelResolution={width:u*h,height:u*l},s.localStorage=window.localStorage,s.capabilities={canvas:!1,opengl:!0,webp:!1},s.__audioSupport={ONLY_ONE:!1,WEB_AUDIO:!1,DELAY_CREATE_CTX:!1,format:[".mp3"]}}else{var _=window,d=_.navigator,f=document,p=f.documentElement,g=d.userAgent.toLowerCase();s.isMobile=/mobile|android|iphone|ipad/.test(g),s.platform=s.isMobile?s.MOBILE_BROWSER:s.DESKTOP_BROWSER;var m=d.language;m=(m=m||d.browserLanguage)?m.split("-")[0]:s.LANGUAGE_ENGLISH,s.language=m;var v=!1,y=!1,C="",T=0,x=/android (\d+(?:\.\d+)+)/i.exec(g)||/android (\d+(?:\.\d+)+)/i.exec(d.platform);x&&(v=!0,C=x[1]||"",T=parseInt(C)||0),(x=/(iPad|iPhone|iPod).*OS ((\d+_?){2,3})/i.exec(g))?(y=!0,C=x[2]||"",T=parseInt(C)||0):/(iPhone|iPad|iPod)/.exec(d.platform)&&(y=!0,C="",T=0);var E=s.OS_UNKNOWN;-1!==d.appVersion.indexOf("Win")?E=s.OS_WINDOWS:y?E=s.OS_IOS:-1!==d.appVersion.indexOf("Mac")?E=s.OS_OSX:-1!==d.appVersion.indexOf("X11")&&-1===d.appVersion.indexOf("Linux")?E=s.OS_UNIX:v?E=s.OS_ANDROID:-1===d.appVersion.indexOf("Linux")&&-1===g.indexOf("ubuntu")||(E=s.OS_LINUX),s.os=E,s.osVersion=C,s.osMainVersion=T,s.browserType=s.BROWSER_TYPE_UNKNOWN,function(){var t=/mqqbrowser|micromessenger|qq|sogou|qzone|liebao|maxthon|ucbrowser|360 aphone|360browser|baiduboxapp|baidubrowser|maxthon|mxbrowser|miuibrowser/i.exec(g);t||(t=/qqbrowser|chrome|safari|firefox|trident|opera|opr\/|oupeng/i.exec(g));var e=t?t[0].toLowerCase():s.BROWSER_TYPE_UNKNOWN;CC_QQPLAY?e=s.BROWSER_TYPE_QQ_PLAY:"micromessenger"===e?e=s.BROWSER_TYPE_WECHAT:"safari"===e&&v?e=s.BROWSER_TYPE_ANDROID:"qq"===e&&g.match(/android.*applewebkit/i)?e=s.BROWSER_TYPE_ANDROID:"trident"===e?e=s.BROWSER_TYPE_IE:"360 aphone"===e?e=s.BROWSER_TYPE_360:"mxbrowser"===e?e=s.BROWSER_TYPE_MAXTHON:"opr/"===e&&(e=s.BROWSER_TYPE_OPERA),s.browserType=e}(),s.browserVersion="",(o=g.match(/(mqqbrowser|micromessenger|qq|sogou|qzone|liebao|maxthon|uc|360 aphone|360|baiduboxapp|baidu|maxthon|mxbrowser|miui)(mobile)?(browser)?\/?([\d.]+)/i))||(o=g.match(/(qqbrowser|chrome|safari|firefox|trident|opera|opr\/|oupeng)(mobile)?(browser)?\/?([\d.]+)/i)),s.browserVersion=o?o[4]:"",h=window.innerWidth||document.documentElement.clientWidth,l=window.innerHeight||document.documentElement.clientHeight,u=window.devicePixelRatio||1,s.windowPixelResolution={width:u*h,height:u*l},s._checkWebGLRenderMode=function(){if(cc._renderType!==cc.game.RENDER_TYPE_WEBGL)throw new Error("This feature supports WebGL render mode only.")};var S=document.createElement("canvas"),b=document.createElement("canvas");if(s._supportCanvasNewBlendModes=function(){var t=S;t.width=1,t.height=1;var e=t.getContext("2d");e.fillStyle="#000",e.fillRect(0,0,1,1),e.globalCompositeOperation="multiply";var i=b;i.width=1,i.height=1;var n=i.getContext("2d");return n.fillStyle="#fff",n.fillRect(0,0,1,1),e.drawImage(i,0,0,1,1),0===e.getImageData(0,0,1,1).data[0]}(),cc.sys.isMobile){var R=document.createElement("style");R.type="text/css",document.body.appendChild(R),R.textContent="body,canvas,div{ -moz-user-select: none;-webkit-user-select: text;-ms-user-select: none;-khtml-user-select: none;-webkit-tap-highlight-color:rgba(0,0,0,0);}"}try{var A=s.localStorage=_.localStorage;A.setItem("storage",""),A.removeItem("storage"),A=null}catch(t){var O=function(){cc.warnID(5200)};s.localStorage={getItem:O,setItem:O,removeItem:O,clear:O}}var I=S.toDataURL("image/webp").startsWith("data:image/webp"),w=!!S.getContext("2d"),L=!1;if(_.WebGLRenderingContext&&(cc.create3DContext(document.createElement("CANVAS"))&&(L=!0),L&&s.os===s.OS_ANDROID)){var N=parseFloat(s.browserVersion);switch(s.browserType){case s.BROWSER_TYPE_MOBILE_QQ:case s.BROWSER_TYPE_BAIDU:case s.BROWSER_TYPE_BAIDU_APP:L=6.2<=N;break;case s.BROWSER_TYPE_ANDROID:s.osMainVersion&&5<=s.osMainVersion&&(L=!0);break;case s.BROWSER_TYPE_CHROME:L=30<=N;break;case s.BROWSER_TYPE_UC:L=11<N;case s.BROWSER_TYPE_360:L=!1}}var P,D=s.capabilities={canvas:w,opengl:L,webp:I};(void 0!==p.ontouchstart||void 0!==f.ontouchstart||d.msPointerEnabled)&&(D.touches=!0),void 0!==p.onmouseup&&(D.mouse=!0),void 0!==p.onkeyup&&(D.keyboard=!0),(_.DeviceMotionEvent||_.DeviceOrientationEvent)&&(D.accelerometer=!0),function(){s.browserVersion;var t=!!(window.AudioContext||window.webkitAudioContext||window.mozAudioContext);P={ONLY_ONE:!1,WEB_AUDIO:t,DELAY_CREATE_CTX:!1},s.os===s.OS_IOS&&(P.USE_LOADER_EVENT="loadedmetadata"),s.browserType===s.BROWSER_TYPE_FIREFOX&&(P.DELAY_CREATE_CTX=!0,P.USE_LOADER_EVENT="canplay"),s.os===s.OS_ANDROID&&s.browserType===s.BROWSER_TYPE_UC&&(P.ONE_SOURCE=!0)}();try{P.WEB_AUDIO&&(P.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext),P.DELAY_CREATE_CTX&&setTimeout(function(){P.context=new(window.AudioContext||window.webkitAudioContext||window.mozAudioContext)},0))}catch(t){P.WEB_AUDIO=!1,cc.logID(5201)}P.format=(n=[],(r=document.createElement("audio")).canPlayType&&(r.canPlayType('audio/ogg; codecs="vorbis"')&&n.push(".ogg"),r.canPlayType("audio/mpeg")&&n.push(".mp3"),r.canPlayType('audio/wav; codecs="1"')&&n.push(".wav"),r.canPlayType("audio/mp4")&&n.push(".mp4"),r.canPlayType("audio/x-m4a")&&n.push(".m4a")),n),s.__audioSupport=P}s.garbageCollect=function(){},s.dumpRoot=function(){},s.restartVM=function(){},s.cleanScript=function(t){},s.isObjectValid=function(t){return!!t},s.dump=function(){var t="";t+="isMobile : "+this.isMobile+"\r\n",t+="language : "+this.language+"\r\n",t+="browserType : "+this.browserType+"\r\n",t+="browserVersion : "+this.browserVersion+"\r\n",t+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n",t+="os : "+this.os+"\r\n",t+="osVersion : "+this.osVersion+"\r\n",t+="platform : "+this.platform+"\r\n",t+="Using "+(cc._renderType===cc.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n",cc.log(t)},s.openURL=function(t){window.open(t)},s.now=function(){return Date.now?Date.now():+new Date},e.exports=s}},{}],133:[function(t,e,i){var c=t("../event-manager"),s={init:function(){CC_QQPLAY||(this.html=document.getElementsByTagName("html")[0])},availWidth:function(t){return t&&t!==this.html?t.clientWidth:window.innerWidth},availHeight:function(t){return t&&t!==this.html?t.clientHeight:window.innerHeight},meta:{width:"device-width"},adaptationType:cc.sys.browserType};switch(cc.sys.os===cc.sys.OS_IOS&&(s.adaptationType=cc.sys.BROWSER_TYPE_SAFARI),CC_QQPLAY&&(s.adaptationType=cc.sys.BROWSER_TYPE_QQ_PLAY),s.adaptationType){case cc.sys.BROWSER_TYPE_SAFARI:s.meta["minimal-ui"]="true",s.availWidth=function(t){return t.clientWidth},s.availHeight=function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_CHROME:s.__defineGetter__("target-densitydpi",function(){return cc.view._targetDensityDPI});break;case cc.sys.BROWSER_TYPE_SOUGOU:case cc.sys.BROWSER_TYPE_UC:s.availWidth=function(t){return t.clientWidth},s.availHeight=function(t){return t.clientHeight};break;case cc.sys.BROWSER_TYPE_MIUI:s.init=function(t){if(!t.__resizeWithBrowserSize){var e=function(){t.setDesignResolutionSize(t._designResolutionSize.width,t._designResolutionSize.height,t._resolutionPolicy),window.removeEventListener("resize",e,!1)};window.addEventListener("resize",e,!1)}};break;case cc.sys.BROWSER_TYPE_WECHAT_GAME:s.availWidth=function(){return window.innerWidth},s.availHeight=function(){return window.innerHeight};break;case cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB:var n=wx.getSharedCanvas();s.availWidth=function(){return n.width},s.availHeight=function(){return n.height}}var _=null,r=cc._Class.extend({ctor:function(){var t=this,e=cc.ContainerStrategy,i=cc.ContentStrategy;s.init(this),t._frameSize=cc.size(0,0),t._initFrameSize();var n=cc.game.canvas.width,r=cc.game.canvas.height;t._designResolutionSize=cc.size(n,r),t._originalDesignResolutionSize=cc.size(n,r),t._viewPortRect=cc.rect(0,0,n,r),t._visibleRect=cc.rect(0,0,n,r),t._contentTranslateLeftTop={left:0,top:0},t._autoFullScreen=!1,t._devicePixelRatio=1,t._viewName="Cocos2dHTML5",t._resizeCallback=null,t._orientationChanging=!0,t._resizing=!1,t._scaleX=1,t._originalScaleX=1,t._scaleY=1,t._originalScaleY=1,t._isRotated=!1,t._orientation=3;var o=cc.sys;t.enableRetina(o.os===o.OS_IOS||o.os===o.OS_OSX),cc.visibleRect&&cc.visibleRect.init(t._visibleRect),t._resolutionPolicy=null,t._rpExactFit=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.EXACT_FIT),t._rpShowAll=new cc.ResolutionPolicy(e.PROPORTION_TO_FRAME,i.SHOW_ALL),t._rpNoBorder=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.NO_BORDER),t._rpFixedHeight=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.FIXED_HEIGHT),t._rpFixedWidth=new cc.ResolutionPolicy(e.EQUAL_TO_FRAME,i.FIXED_WIDTH),t._initialized=!1,t._contentTranslateLeftTop=null,t._frameZoomFactor=1,t.__resizeWithBrowserSize=!1,t._isAdjustViewPort=!0,t._targetDensityDPI=cc.macro.DENSITYDPI_HIGH,t.enableAntiAlias(!0)},_resizeEvent:function(){var t,e=(t=this.setDesignResolutionSize?this:cc.view)._frameSize.width,i=t._frameSize.height,n=t._isRotated;if(cc.sys.isMobile){var r=cc.game.container.style,o=r.margin;r.margin="0",r.display="none",t._initFrameSize(),r.margin=o,r.display="block"}else t._initFrameSize();if(t._isRotated!==n||t._frameSize.width!==e||t._frameSize.height!==i){var s=t._originalDesignResolutionSize.width,a=t._originalDesignResolutionSize.height;t._resizing=!0,0<s&&t.setDesignResolutionSize(s,a,t._resolutionPolicy),t._resizing=!1,c.dispatchCustomEvent("canvas-resize"),t._resizeCallback&&t._resizeCallback.call()}},_orientationChange:function(){cc.view._orientationChanging=!0,cc.view._resizeEvent()},setTargetDensityDPI:function(t){this._targetDensityDPI=t,this._adjustViewportMeta()},getTargetDensityDPI:function(){return this._targetDensityDPI},resizeWithBrowserSize:function(t){t?this.__resizeWithBrowserSize||(this.__resizeWithBrowserSize=!0,window.addEventListener("resize",this._resizeEvent),window.addEventListener("orientationchange",this._orientationChange)):this.__resizeWithBrowserSize&&(this.__resizeWithBrowserSize=!1,window.removeEventListener("resize",this._resizeEvent),window.removeEventListener("orientationchange",this._orientationChange))},setResizeCallback:function(t){"function"!=typeof t&&null!=t||(this._resizeCallback=t)},setOrientation:function(t){if((t&=cc.macro.ORIENTATION_AUTO)&&this._orientation!==t){this._orientation=t;var e=this._originalDesignResolutionSize.width,i=this._originalDesignResolutionSize.height;this.setDesignResolutionSize(e,i,this._resolutionPolicy)}},_initFrameSize:function(){var t=this._frameSize,e=s.availWidth(cc.game.frame),i=s.availHeight(cc.game.frame),n=i<=e;!cc.sys.isMobile||n&&this._orientation&cc.macro.ORIENTATION_LANDSCAPE||!n&&this._orientation&cc.macro.ORIENTATION_PORTRAIT?"undefined"!=typeof engine&&engine.transformContainer&&(this._isRotated=engine.transformContainer(!1)):"undefined"!=typeof engine&&engine.transformContainer&&(this._isRotated=engine.transformContainer(!0)),this._isRotated?(t.width=i,t.height=e):(t.width=e,t.height=i),this._orientationChanging&&setTimeout(function(){cc.view._orientationChanging=!1},1e3)},_adjustSizeKeepCanvasSize:function(){var t=this._originalDesignResolutionSize.width,e=this._originalDesignResolutionSize.height;0<t&&this.setDesignResolutionSize(t,e,this._resolutionPolicy)},_setViewportMeta:function(t,e){var i=document.getElementById("cocosMetaElement");i&&e&&document.head.removeChild(i);var n,r,o,s=document.getElementsByName("viewport"),a=s?s[0]:null;for(r in n=a?a.content:"",(i=i||document.createElement("meta")).id="cocosMetaElement",i.name="viewport",i.content="",t)-1==n.indexOf(r)?n+=","+r+"="+t[r]:e&&(o=new RegExp(r+"s*=s*[^,]+"),n.replace(o,r+"="+t[r]));/^,/.test(n)&&(n=n.substr(1)),i.content=n,a&&(a.content=n),document.head.appendChild(i)},_adjustViewportMeta:function(){this._isAdjustViewPort&&!CC_QQPLAY&&(this._setViewportMeta(s.meta,!1),this._isAdjustViewPort=!1)},_resetScale:function(){this._scaleX=this._originalScaleX,this._scaleY=this._originalScaleY},_adjustSizeToBrowser:function(){},initialize:function(){this._initialized=!0},adjustViewPort:function(t){this._isAdjustViewPort=t},enableRetina:function(t){this._retinaEnabled=!!t},isRetinaEnabled:function(){return this._retinaEnabled},enableAntiAlias:function(t){if(this._antiAliasEnabled!==t)if(this._antiAliasEnabled=t,cc._renderType===cc.game.RENDER_TYPE_WEBGL){var e=cc.loader._cache;for(var i in e){var n=e[i],r=n&&n.content instanceof cc.Texture2D?n.content:null;r&&(t?r.setAntiAliasTexParameters():r.setAliasTexParameters())}}else if(cc._renderType===cc.game.RENDER_TYPE_CANVAS){var o=cc._canvas.getContext("2d");o.imageSmoothingEnabled=t,o.mozImageSmoothingEnabled=t;var s=cc.rendererCanvas._dirtyRegion;if(s){var a=new cc.Region;a.setTo(0,0,cc.visibleRect.width,cc.visibleRect.height),s.addRegion(a)}}},isAntiAliasEnabled:function(){return this._antiAliasEnabled},enableAutoFullScreen:function(t){t&&t!==this._autoFullScreen&&cc.sys.isMobile&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_WECHAT?(this._autoFullScreen=!0,cc.screen.autoFullScreen(cc.game.frame)):this._autoFullScreen=!1},isAutoFullScreenEnabled:function(){return this._autoFullScreen},isViewReady:function(){return cc.game.canvas&&cc._renderContext},setFrameZoomFactor:function(t){this._frameZoomFactor=t,cc.director.setProjection(cc.director.getProjection())},setContentTranslateLeftTop:function(t,e){this._contentTranslateLeftTop={left:t,top:e}},getContentTranslateLeftTop:function(){return this._contentTranslateLeftTop},setCanvasSize:function(t,e){var i=cc.game.canvas,n=cc.game.container;i.width=t*this._devicePixelRatio,i.height=e*this._devicePixelRatio,i.style.width=t+"px",i.style.height=e+"px",n.style.width=t+"px",n.style.height=e+"px",this._resizeEvent()},getCanvasSize:function(){return cc.size(cc.game.canvas.width,cc.game.canvas.height)},getFrameSize:function(){return cc.size(this._frameSize.width,this._frameSize.height)},setFrameSize:function(t,e){this._frameSize.width=t,this._frameSize.height=e,cc.game.frame.style.width=t+"px",cc.game.frame.style.height=e+"px",this._resizeEvent(),cc.director.setProjection(cc.director.getProjection())},getVisibleSize:function(){return cc.size(this._visibleRect.width,this._visibleRect.height)},getVisibleSizeInPixel:function(){return cc.size(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},getVisibleOrigin:function(){return cc.p(this._visibleRect.x,this._visibleRect.y)},getVisibleOriginInPixel:function(){return cc.p(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},canSetContentScaleFactor:function(){return!0},getResolutionPolicy:function(){return this._resolutionPolicy},setResolutionPolicy:function(t){var e=this;if(t instanceof cc.ResolutionPolicy)e._resolutionPolicy=t;else{var i=cc.ResolutionPolicy;t===i.EXACT_FIT&&(e._resolutionPolicy=e._rpExactFit),t===i.SHOW_ALL&&(e._resolutionPolicy=e._rpShowAll),t===i.NO_BORDER&&(e._resolutionPolicy=e._rpNoBorder),t===i.FIXED_HEIGHT&&(e._resolutionPolicy=e._rpFixedHeight),t===i.FIXED_WIDTH&&(e._resolutionPolicy=e._rpFixedWidth)}},setDesignResolutionSize:function(t,e,i){if(0<t||0<e){this.setResolutionPolicy(i);var n=this._resolutionPolicy;if(n&&n.preApply(this),cc.sys.isMobile&&this._adjustViewportMeta(),this._orientationChanging=!0,this._resizing||this._initFrameSize(),n){this._originalDesignResolutionSize.width=this._designResolutionSize.width=t,this._originalDesignResolutionSize.height=this._designResolutionSize.height=e;var r=n.apply(this,this._designResolutionSize);if(r.scale&&2===r.scale.length&&(this._scaleX=r.scale[0],this._scaleY=r.scale[1]),r.viewport){var o=this._viewPortRect,s=this._visibleRect,a=r.viewport;o.x=a.x,o.y=a.y,o.width=a.width,o.height=a.height,s.x=-o.x/this._scaleX,s.y=-o.y/this._scaleY,s.width=cc.game.canvas.width/this._scaleX,s.height=cc.game.canvas.height/this._scaleY,cc._renderContext.setOffset&&cc._renderContext.setOffset(o.x,-o.y)}var c=cc.director;c._winSizeInPoints.width=this._designResolutionSize.width,c._winSizeInPoints.height=this._designResolutionSize.height,n.postApply(this),cc.winSize.width=c._winSizeInPoints.width,cc.winSize.height=c._winSizeInPoints.height,cc._renderType===cc.game.RENDER_TYPE_WEBGL?c.setGLDefaultValues():cc._renderType===cc.game.RENDER_TYPE_CANVAS&&(cc.renderer._allNeedDraw=!0),this._originalScaleX=this._scaleX,this._originalScaleY=this._scaleY,cc.visibleRect&&cc.visibleRect.init(this._visibleRect)}else cc.logID(2201)}else cc.logID(2200)},getDesignResolutionSize:function(){return cc.size(this._designResolutionSize.width,this._designResolutionSize.height)},setRealPixelResolution:function(t,e,i){CC_QQPLAY||(this._setViewportMeta({width:t},!0),document.documentElement.style.width=t+"px",document.body.style.width=t+"px",document.body.style.left="0px",document.body.style.top="0px"),this.setDesignResolutionSize(t,e,i)},setViewPortInPoints:function(t,e,i,n){var r=this._frameZoomFactor,o=this._scaleX,s=this._scaleY;cc._renderContext.viewport(t*o*r+this._viewPortRect.x*r,e*s*r+this._viewPortRect.y*r,i*o*r,n*s*r)},setScissorInPoints:function(t,e,i,n){var r=this._frameZoomFactor,o=this._scaleX,s=this._scaleY,a=Math.ceil(t*o*r+this._viewPortRect.x*r),c=Math.ceil(e*s*r+this._viewPortRect.y*r),h=Math.ceil(i*o*r),l=Math.ceil(n*s*r);if(!_){var u=gl.getParameter(gl.SCISSOR_BOX);_=cc.rect(u[0],u[1],u[2],u[3])}_.x===a&&_.y===c&&_.width===h&&_.height===l||(_.x=a,_.y=c,_.width=h,_.height=l,cc._renderContext.scissor(a,c,h,l))},isScissorEnabled:function(){return cc._renderContext.isEnabled(gl.SCISSOR_TEST)},getScissorRect:function(){if(!_){var t=gl.getParameter(gl.SCISSOR_BOX);_=cc.rect(t[0],t[1],t[2],t[3])}var e=1/this._scaleX,i=1/this._scaleY;return cc.rect((_.x-this._viewPortRect.x)*e,(_.y-this._viewPortRect.y)*i,_.width*e,_.height*i)},setViewName:function(t){null!=t&&0<t.length&&(this._viewName=t)},getViewName:function(){return this._viewName},getViewPortRect:function(){return this._viewPortRect},getScaleX:function(){return this._scaleX},getScaleY:function(){return this._scaleY},getDevicePixelRatio:function(){return this._devicePixelRatio},convertToLocationInView:function(t,e,i){return"undefined"!=typeof engine&&engine.convertToLocationInView?engine.convertToLocationInView(t,e,i):{x:0,y:0}},_convertMouseToLocationInView:function(t,e){var i=this._viewPortRect;t.x=(this._devicePixelRatio*(t.x-e.left)-i.x)/this._scaleX,t.y=(this._devicePixelRatio*(e.top+e.height-t.y)-i.y)/this._scaleY},_convertPointWithScale:function(t){var e=this._viewPortRect;t.x=(t.x-e.x)/this._scaleX,t.y=(t.y-e.y)/this._scaleY},_convertTouchesWithScale:function(t){for(var e,i,n,r=this._viewPortRect,o=this._scaleX,s=this._scaleY,a=0;a<t.length;a++)i=(e=t[a])._point,n=e._prevPoint,i.x=(i.x-r.x)/o,i.y=(i.y-r.y)/s,n.x=(n.x-r.x)/o,n.y=(n.y-r.y)/s}});r._getInstance=function(){return this._instance||(this._instance=this._instance||new r,this._instance.initialize()),this._instance},cc.ContainerStrategy=cc._Class.extend({preApply:function(t){},apply:function(t,e){},postApply:function(t){},_setupContainer:function(t,e,i){var n=cc.game.canvas,r=cc.game.container;cc.sys.platform!==cc.sys.WECHAT_GAME&&(cc.sys.os===cc.sys.OS_ANDROID&&(document.body.style.width=(t._isRotated?i:e)+"px",document.body.style.height=(t._isRotated?e:i)+"px"),r.style.width=n.style.width=e+"px",r.style.height=n.style.height=i+"px");var o=t._devicePixelRatio=1;if(t.isRetinaEnabled()&&(o=t._devicePixelRatio=Math.min(2,window.devicePixelRatio||1)),n.width=e*o,n.height=i*o,cc.sys.browserType===cc.sys.BROWSER_TYPE_WECHAT_GAME&&wx&&wx.getOpenDataContext){var s=wx.getOpenDataContext().canvas;s&&(s.width=n.width,s.height=n.height)}cc._renderContext.resetCache&&cc._renderContext.resetCache()},_fixContainer:function(){document.body.insertBefore(cc.container,document.body.firstChild);var t=document.body.style;t.width=window.innerWidth+"px",t.height=window.innerHeight+"px",t.overflow="hidden";var e=cc.container.style;e.position="fixed",e.left=e.top="0px",document.body.scrollTop=0}}),cc.ContentStrategy=cc._Class.extend({_result:{scale:[1,1],viewport:null},_buildResult:function(t,e,i,n,r,o){Math.abs(t-i)<2&&(i=t),Math.abs(e-n)<2&&(n=e);var s=cc.rect(Math.round((t-i)/2),Math.round((e-n)/2),i,n);return cc._renderType,cc.game.RENDER_TYPE_CANVAS,this._result.scale=[r,o],this._result.viewport=s,this._result},preApply:function(t){},apply:function(t,e){return{scale:[1,1]}},postApply:function(t){}}),function(){var t=cc.ContainerStrategy.extend({apply:function(t){t._frameSize.height,cc.container.style,this._setupContainer(t,t._frameSize.width,t._frameSize.height)}}),e=cc.ContainerStrategy.extend({apply:function(t,e){var i,n,r=t._frameSize.width,o=t._frameSize.height,s=cc.container.style,a=e.width,c=e.height,h=r/a,l=o/c;h<l?(i=r,n=c*h):(i=a*l,n=o);var u=Math.round((r-i)/2),_=Math.round((o-n)/2);i=r-2*u,n=o-2*_,this._setupContainer(t,i,n),s.paddingLeft=u+"px",s.paddingRight=u+"px",s.paddingTop=_+"px",s.paddingBottom=_+"px"}}),i=(t.extend({preApply:function(t){this._super(t),cc.game.frame=document.documentElement},apply:function(t){this._super(t),this._fixContainer()}}),e.extend({preApply:function(t){this._super(t),cc.game.frame=document.documentElement},apply:function(t,e){this._super(t,e),this._fixContainer()}}),cc.ContainerStrategy.extend({apply:function(t){this._setupContainer(t,cc.game.canvas.width,cc.game.canvas.height)}}));cc.ContainerStrategy.EQUAL_TO_FRAME=new t,cc.ContainerStrategy.PROPORTION_TO_FRAME=new e,cc.ContainerStrategy.ORIGINAL_CONTAINER=new i;var n=cc.ContentStrategy.extend({apply:function(t,e){var i=cc.game.canvas.width,n=cc.game.canvas.height,r=i/e.width,o=n/e.height;return this._buildResult(i,n,i,n,r,o)}}),r=cc.ContentStrategy.extend({apply:function(t,e){var i,n,r=cc.game.canvas.width,o=cc.game.canvas.height,s=e.width,a=e.height,c=r/s,h=o/a,l=0;return c<h?(i=r,n=a*(l=c)):(i=s*(l=h),n=o),this._buildResult(r,o,i,n,l,l)}}),o=cc.ContentStrategy.extend({apply:function(t,e){var i,n,r,o=cc.game.canvas.width,s=cc.game.canvas.height,a=e.width,c=e.height,h=o/a,l=s/c;return h<l?(n=a*(i=l),r=s):(n=o,r=c*(i=h)),this._buildResult(o,s,n,r,i,i)}}),s=cc.ContentStrategy.extend({apply:function(t,e){var i=cc.game.canvas.width,n=cc.game.canvas.height,r=n/e.height,o=i,s=n;return this._buildResult(i,n,o,s,r,r)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}}),a=cc.ContentStrategy.extend({apply:function(t,e){var i=cc.game.canvas.width,n=cc.game.canvas.height,r=i/e.width,o=i,s=n;return this._buildResult(i,n,o,s,r,r)},postApply:function(t){cc.director._winSizeInPoints=t.getVisibleSize()}});cc.ContentStrategy.EXACT_FIT=new n,cc.ContentStrategy.SHOW_ALL=new r,cc.ContentStrategy.NO_BORDER=new o,cc.ContentStrategy.FIXED_HEIGHT=new s,cc.ContentStrategy.FIXED_WIDTH=new a}(),cc.ResolutionPolicy=cc._Class.extend({_containerStrategy:null,_contentStrategy:null,ctor:function(t,e){this.setContainerStrategy(t),this.setContentStrategy(e)},preApply:function(t){this._containerStrategy.preApply(t),this._contentStrategy.preApply(t)},apply:function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},postApply:function(t){this._containerStrategy.postApply(t),this._contentStrategy.postApply(t)},setContainerStrategy:function(t){t instanceof cc.ContainerStrategy&&(this._containerStrategy=t)},setContentStrategy:function(t){t instanceof cc.ContentStrategy&&(this._contentStrategy=t)}}),cc.js.get(cc.ResolutionPolicy.prototype,"canvasSize",function(){return cc.v2(cc.game.canvas.width,cc.game.canvas.height)}),cc.ResolutionPolicy.EXACT_FIT=0,cc.ResolutionPolicy.NO_BORDER=1,cc.ResolutionPolicy.SHOW_ALL=2,cc.ResolutionPolicy.FIXED_HEIGHT=3,cc.ResolutionPolicy.FIXED_WIDTH=4,cc.ResolutionPolicy.UNKNOWN=5,e.exports=r},{"../event-manager":83}],134:[function(t,e,i){cc.visibleRect={topLeft:cc.p(0,0),topRight:cc.p(0,0),top:cc.p(0,0),bottomLeft:cc.p(0,0),bottomRight:cc.p(0,0),bottom:cc.p(0,0),center:cc.p(0,0),left:cc.p(0,0),right:cc.p(0,0),width:0,height:0,init:function(t){var e=this.width=t.width,i=this.height=t.height,n=t.x,r=t.y,o=r+i,s=n+e;this.topLeft.x=n,this.topLeft.y=o,this.topRight.x=s,this.topRight.y=o,this.top.x=n+e/2,this.top.y=o,this.bottomLeft.x=n,this.bottomLeft.y=r,this.bottomRight.x=s,this.bottomRight.y=r,this.bottom.x=n+e/2,this.bottom.y=r,this.center.x=n+e/2,this.center.y=r+i/2,this.left.x=n,this.left.y=r+i/2,this.right.x=s,this.right.y=r+i/2}}},{}],135:[function(t,e,i){var c=cc.ClassManager={instanceId:0|998*Math.random(),getNewInstanceId:function(){return this.instanceId++}},h=/\b_super\b/,l=function(){};l.extend=function(t){var e,r=this.prototype,i=Object.create(r),n={writable:!0,enumerable:!1,configurable:!0};if(cc.game&&cc.game.config&&cc.game.config[cc.game.CONFIG_KEY.exposeClassName]){var o="return (function "+(t._className||"Class")+"(arg0,arg1,arg2,arg3,arg4) {\nthis.__instanceId = cc.ClassManager.getNewInstanceId();\nif (this.ctor) {\nswitch (arguments.length) {\ncase 0: this.ctor(); break;\ncase 1: this.ctor(arg0); break;\ncase 2: this.ctor(arg0,arg1); break;\ncase 3: this.ctor(arg0,arg1,arg2); break;\ncase 4: this.ctor(arg0,arg1,arg2,arg3); break;\ncase 5: this.ctor(arg0,arg1,arg2,arg3,arg4); break;\ndefault: this.ctor.apply(this, arguments);\n}\n}\n});";e=Function(o)()}else e=function(t,e,i,n,r){if(this.__instanceId=c.getNewInstanceId(),this.ctor)switch(arguments.length){case 0:this.ctor();break;case 1:this.ctor(t);break;case 2:this.ctor(t,e);break;case 3:this.ctor(t,e,i);break;case 4:this.ctor(t,e,i,n);break;case 5:this.ctor(t,e,i,n,r);break;default:this.ctor.apply(this,arguments)}};for(var s in e.prototype=i,n.value=e,Object.defineProperty(i,"constructor",n),t){var a="function"==typeof t[s];a&&"function"==typeof r[s]&&h.test(t[s])?(n.value=function(i,n){return function(){var t=this._super;this._super=r[i];var e=n.apply(this,arguments);return this._super=t,e}}(s,t[s]),Object.defineProperty(i,s,n)):a?(n.value=t[s],Object.defineProperty(i,s,n)):i[s]=t[s]}return e.extend=l.extend,e.implement=function(t){for(var e in t)i[e]=t[e]},e},cc.defineGetterSetter=function(t,e,i,n,r,o){if(t.__defineGetter__)i&&t.__defineGetter__(e,i),n&&t.__defineSetter__(e,n);else{if(!Object.defineProperty)throw new Error("browser does not support getters");var s={configurable:!0};i&&(s.get=i),n&&(s.set=n),Object.defineProperty(t,e,s)}},cc.clone=function(t){var e=t.constructor?new t.constructor:{};for(var i in t){var n=t[i];"object"!=typeof n||!n||n instanceof _ccsg.Node||n instanceof HTMLElement?e[i]=n:e[i]=cc.clone(n)}return e},cc._Class=e.exports=l},{}],136:[function(t,e,i){var o=t("./js"),h=(t("./utils").isPlainEmptyObj_DEV,"$_$");function l(t,e,i){var n;n=function(){},i&&o.extend(n,i.constructor);var r=new n;return o.value(t,"__attrs__",r),r}function u(t){return t.hasOwnProperty("__attrs__")&&t.__attrs__||function(t){for(var e,i=cc.Class.getInheritanceChain(t),n=i.length-1;0<=n;n--){var r=i[n];r.hasOwnProperty("__attrs__")&&r.__attrs__||l(r,0,(e=i[n+1])&&e.__attrs__)}return l(t,0,(e=i[0])&&e.__attrs__),t.__attrs__}(t)}function r(t){return u(t).constructor.prototype}cc.Integer="Integer",cc.Float="Float",cc.Boolean="Boolean",cc.String="String",e.exports={attr:function(t,e,i){var n,r,o;if("function"==typeof t)r=(n=u(t)).constructor.prototype;else{var s=t;(n=s.__attrs__)||(n=l(s,0,u(t=s.constructor))),r=n}if(void 0===i){var a=e+h,c={};for(o in n)o.startsWith(a)&&(c[o.slice(a.length)]=n[o]);return c}if("object"==typeof i)for(o in i)95!==o.charCodeAt(0)&&(r[e+h+o]=i[o])},getClassAttrs:u,getClassAttrsProto:r,setClassAttr:function(t,e,i,n){r(t)[e+h+i]=n},DELIMETER:h,getTypeChecker:function(t,e){},ObjectType:function(t){return{type:"Object",ctor:t,_onAfterProp:!1}},ScriptUuid:{}}},{"./CCClass":123,"./js":144,"./utils":148}],137:[function(t,e,i){var n=t("./js"),a=n.array.fastRemoveAt;function r(){this.callbacks=[],this.targets=[],this.isInvoking=!1,this.containCanceled=!1}var o=r.prototype;o.removeBy=function(t,e){for(var i=this.callbacks,n=this.targets,r=0;r<t.length;++r)t[r]===e&&(a(i,r),a(n,r),--r)},o.cancel=function(t){this.callbacks[t]=this.targets[t]=null,this.containCanceled=!0},o.cancelAll=function(){for(var t=this.callbacks,e=this.targets,i=0;i<t.length;i++)t[i]=e[i]=null;this.containCanceled=!0},o.purgeCanceled=function(){this.removeBy(this.callbacks,null),this.containCanceled=!1};var s=new n.Pool(function(t){t.callbacks.length=0,t.targets.length=0,t.isInvoking=!1,t.containCanceled=!1},16);function c(){this._callbackTable=n.createMap(!0)}s.get=function(){return this._get()||new r},(o=c.prototype).add=function(t,e,i){var n=this._callbackTable[t];n||(n=this._callbackTable[t]=s.get()),n.callbacks.push(e),n.targets.push(i||null)},o.has=function(t,e,i){var n=this._callbackTable[t];if(!n)return!1;var r=n.callbacks;if(!e){for(var o=0;o<r.length;o++)if(r[o])return!0;return!1}i=i||null;for(var s=n.targets,a=0;a<r.length;++a)if(r[a]===e&&s[a]===i)return!0;return!1},o.removeAll=function(t){if("string"==typeof t){var e=this._callbackTable[t];e&&(e.isInvoking?e.cancelAll():(s.put(e),delete this._callbackTable[t]))}else if(t)for(var i in this._callbackTable){var n=this._callbackTable[i];if(n.isInvoking)for(var r=n.targets,o=0;o<r.length;++o)r[o]===t&&n.cancel(o);else n.removeBy(n.targets,t)}},o.remove=function(t,e,i){var n=this._callbackTable[t];if(n){i=i||null;for(var r=n.callbacks,o=n.targets,s=0;s<r.length;++s)if(r[s]===e&&o[s]===i){n.isInvoking?n.cancel(s):(a(r,s),a(o,s));break}}};var h=function(){c.call(this)};n.extend(h,c),h.prototype.invoke=function(t,e,i,n,r,o){var s=this._callbackTable[t];if(s){var a=!s.isInvoking;s.isInvoking=!0;for(var c=s.callbacks,h=s.targets,l=0,u=c.length;l<u;++l){var _=c[l];if(_){var d=h[l];d?_.call(d,e,i,n,r,o):_(e,i,n,r,o)}}a&&(s.isInvoking=!1,s.containCanceled&&s.purgeCanceled())}},h.CallbacksHandler=c,e.exports=h},{"./js":144}],138:[function(t,e,i){e.exports={flattenCodeArray:function(t){var e=[];return function t(e,i){for(var n=0;n<i.length;n++){var r=i[n];Array.isArray(r)?t(e,r):e.push(r)}}(e,t),e.join("")}}},{}],139:[function(t,e,i){var E=t("./js"),S=(t("./CCObject"),t("./attribute")),b=t("./CCClass"),R=t("../utils/misc"),l=function(){this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.rawProp=""};l.prototype.reset=function(){this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.rawProp=""},l.prototype.getUuidOf=function(t,e){for(var i=0;i<this.uuidObjList.length;i++)if(this.uuidObjList[i]===t&&this.uuidPropList[i]===e)return this.uuidList[i];return""},l.prototype.push=function(t,e,i){this.uuidList.push(i),this.uuidObjList.push(t),this.uuidPropList.push(e)},(l.pool=new E.Pool(function(t){t.reset()},10)).get=function(){return this._get()||new l};var u=function(){function s(t,e,i,n,r){this.result=t,this.customEnv=n,this.deserializedList=[],this.deserializedData=null,this._classFinder=i,this._idList=[],this._idObjList=[],this._idPropList=[]}var t=s.prototype;t.deserialize=function(t){if(Array.isArray(t)){var e=t,i=e.length;this.deserializedList.length=i;for(var n=0;n<i;n++)e[n]&&(this.deserializedList[n]=this._deserializeObject(e[n]));this.deserializedData=0<i?this.deserializedList[0]:[]}else this.deserializedList.length=1,this.deserializedData=t?this._deserializeObject(t):null,this.deserializedList[0]=this.deserializedData;return function(t){var e,i,n,r=t.deserializedList,o=t._idPropList,s=t._idList,a=t._idObjList;for(t._classFinder&&t._classFinder.onDereferenced,e=0;e<s.length;e++)i=o[e],n=s[e],a[e][i]=r[n]}(this),this.deserializedData},t._deserializeObject=function(t,e,i,n){var r,o,s,a,c,h,l,u=null,_=null,d=t.__type__;if(d){if(!(_=this._classFinder(d,t,i,n)))return this._classFinder===E._getClassById&&cc.deserialize.reportMissingClass(d),null;if((u=new _)._deserialize)return u._deserialize(t.content,this),u;cc.Class._isCCClass(_)?(o=this,s=u,a=t,h=e,(c=_).hasOwnProperty("__deserialize__")?l=c.__deserialize__:(l=p(o,c),E.value(c,"__deserialize__",l,!0)),l(o,s,a,c,h)):this._deserializeTypedObject(u,t,_)}else if(Array.isArray(t)){u=new Array(t.length);for(var f=0;f<t.length;f++)"object"==typeof(r=t[f])&&r?this._deserializeObjField(u,r,""+f):u[f]=r}else u={},this._deserializePrimitiveObject(u,t);return u},t._deserializeObjField=function(t,e,i,n){var r=e.__id__;if(void 0===r){var o=e.__uuid__;o?(this.result.uuidList.push(o),this.result.uuidObjList.push(t),this.result.uuidPropList.push(i)):t[i]=this._deserializeObject(e)}else{var s=this.deserializedList[r];s?t[i]=s:(this._idList.push(r),this._idObjList.push(t),this._idPropList.push(i))}},t._deserializePrimitiveObject=function(t,e){for(var i in e)if(e.hasOwnProperty(i)){var n=e[i];"object"!=typeof n?"__type__"!==i&&(t[i]=n):n?this._deserializeObjField(t,n,i):t[i]=null}},t._deserializeTypedObject=function(t,e,i){if(i===cc.Vec2)return t.x=e.x||0,void(t.y=e.y||0);if(i!==cc.Color){if(i===cc.Size)return t.width=e.width||0,void(t.height=e.height||0);var n=i.__props__;n||(n=Object.keys(t));for(var r=0;r<n.length;r++){var o=n[r],s=e[o];void 0!==s&&e.hasOwnProperty(o)&&("object"!=typeof s?t[o]=s:s?this._deserializeObjField(t,s,o):t[o]=null)}}else{t.r=e.r||0,t.g=e.g||0,t.b=e.b||0;var a=e.a;t.a=void 0===a?255:a}};var x=function(t,e,i,n,r){if(e instanceof cc.ValueType){r||t.push("if(prop){");var o=E.getClassName(e);t.push("s._deserializeTypedObject(o"+i+",prop,"+o+");"),r||t.push("}else o"+i+"=null;")}else t.push("if(prop){"),t.push("s._deserializeObjField(o,prop,"+n+");"),t.push("}else o"+i+"=null;")},p=function(t,e){for(var i=S.DELIMETER+"type",n=S.DELIMETER+"rawType",r=(S.DELIMETER,S.DELIMETER+"serializable"),o=S.DELIMETER+"default",s=S.DELIMETER+"saveUrlAsAsset",a=S.DELIMETER+"formerlySerializedAs",c=S.getClassAttrs(e),h=e.__props__,l=["var prop;"],u=R.BUILTIN_CLASSID_RE.test(E._getClassId(e)),_=0;_<h.length;_++){var d,f=h[_];if(c[f+n])d=b.IDENTIFIER_RE.test(f)?'"'+f+'"':b.escapeForJS(f),l.push('if(s.result.rawProp)\ncc.error("not support multi raw object in a file");'),l.push("s.result.rawProp="+d+";");else{var p;if(!1===c[f+r])continue;b.IDENTIFIER_RE.test(f)?(d='"'+f+'"',p="."+f):p="["+(d=b.escapeForJS(f))+"]";var g=p;if(c[f+a]){var m=c[f+a];g=b.IDENTIFIER_RE.test(m)?"."+m:"["+b.escapeForJS(m)+"]"}l.push("prop=d"+g+";"),l.push('if(typeof prop!=="undefined"){');var v=b.getDefault(c[f+o]);if(u){var y,C=c[f+i];if(void 0===v&&C)y=C===cc.String||C===cc.Integer||C===cc.Float||C===cc.Boolean;else{var T=typeof v;y="string"===T&&!c[f+s]||"number"===T||"boolean"===T}y?l.push("o"+p+"=prop;"):x(l,v,p,d,!0)}else l.push('if(typeof prop!=="object"){o'+p+"=prop;}else{"),x(l,v,p,d,!1),l.push("}");l.push("}")}}return"_$erialized"===h[h.length-1]&&(l.push("o._$erialized=JSON.parse(JSON.stringify(d));"),l.push("s._deserializePrimitiveObject(o._$erialized,d);")),Function("s","o","d","k","t",l.join(""))};return(s.pool=new E.Pool(function(t){t.result=null,t.customEnv=null,t.deserializedList.length=0,t.deserializedData=null,t._classFinder=null,t._idList.length=0,t._idObjList.length=0,t._idPropList.length=0},1)).get=function(t,e,i,n,r){var o=this._get();return o?(o.result=t,o.customEnv=n,o._classFinder=i,o):new s(t,e,i,n,r)},s}();cc.deserialize=function(t,e,i){var n=(i=i||{}).classFinder||E._getClassById,r=i.createAssetRefs||cc.sys.platform===cc.sys.EDITOR_CORE,o=i.customEnv,s=i.ignoreEditorOnly;"string"==typeof t&&(t=JSON.parse(t));var a=!e;e=e||l.pool.get();var c=u.pool.get(e,!1,n,o,s);cc.game._isCloning=!0;var h=c.deserialize(t);return cc.game._isCloning=!1,u.pool.put(c),r&&e.assignAssetsBy(Editor.serialize.asAsset),a&&l.pool.put(e),h},cc.deserialize.Details=l,cc.deserialize.reportMissingClass=function(t){cc.warnID(5302,t)}},{"../utils/misc":173,"./CCClass":123,"./CCObject":129,"./attribute":136,"./js":144}],140:[function(t,e,i){function n(t){this.id=0|998*Math.random(),this.prefix=t?t+".":""}n.prototype.getNewId=function(){return this.prefix+ ++this.id},n.global=new n("global"),e.exports=n},{}],141:[function(t,e,i){t("./js"),t("./CCClass"),t("./CCClassDecorator"),t("./CCEnum"),t("./CCObject"),t("./callbacks-invoker"),t("./url"),t("./deserialize"),t("./instantiate"),t("./instantiate-jit"),t("./requiring-frame"),t("./CCSys"),t("./CCMacro"),t("./CCAssetLibrary"),t("./CCVisibleRect")},{"./CCAssetLibrary":122,"./CCClass":123,"./CCClassDecorator":124,"./CCEnum":125,"./CCMacro":128,"./CCObject":129,"./CCSys":132,"./CCVisibleRect":134,"./callbacks-invoker":137,"./deserialize":139,"./instantiate":143,"./instantiate-jit":142,"./js":144,"./requiring-frame":146,"./url":147}],142:[function(t,e,i){var s=t("./CCObject"),r=s.Flags.Destroyed,a=s.Flags.PersistentMask,l=t("./attribute"),c=t("./js"),u=t("./CCClass"),h=t("./compiler"),_=l.DELIMETER+"serializable",d=l.DELIMETER+"default",n=u.IDENTIFIER_RE,f=u.escapeForJS,p={"cc.Node":"cc.Node","cc.Sprite":"cc.Sprite","cc.Label":"cc.Label","cc.Button":"cc.Button","cc.Widget":"cc.Widget","cc.Animation":"cc.Animation","cc.ClickEvent":!1,"cc.PrefabInfo":!1};function o(t,e){this.varName=t,this.expression=e}function g(t,e){return e instanceof o?new o(e.varName,t+e.expression):t+e}function m(t,e,i){Array.isArray(i)?(i[0]=g(e,i[0]),t.push(i)):t.push(g(e,i)+";")}function v(t){this._exps=[],this._targetExp=t}function y(t,e){if("function"==typeof t)try{t=t()}catch(t){return!1}if(t===e)return!0;if(t&&e){if(t instanceof cc.ValueType&&t.equals(e))return!0;if(Array.isArray(t)&&Array.isArray(e)||t.constructor===Object&&e.constructor===Object)try{return JSON.stringify(t)===JSON.stringify(e)}catch(t){}}return!1}function C(t){return n.test(t)?"."+t:"["+f(t)+"]"}function T(t,e){var i;this.parent=e,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=c.createMap(),c.mixin(this.funcModuleCache,p),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(t.constructor,!0)+"();","}"),t._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(t),this.enumerateObject(this.codeArray,t),0<this.globalVariables.length&&(i="var "+this.globalVariables.join(",")+";");var n=h.flattenCodeArray(["return (function(R){",i||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",n)(this.objs,this.funcs);for(var r=0,o=this.objsToClear_iN$t.length;r<o;++r)this.objsToClear_iN$t[r]._iN$t=null;this.objsToClear_iN$t.length=0}o.prototype.toString=function(){return"var "+this.varName+"="+this.expression+";"},v.prototype.append=function(t,e){this._exps.push([t,e])},v.prototype.writeCode=function(t){var e;if(1<this._exps.length)t.push("t="+this._targetExp+";"),e="t";else{if(1!==this._exps.length)return;e=this._targetExp}for(var i=0;i<this._exps.length;i++){var n=this._exps[i];m(t,e+C(n[0])+"=",n[1])}},(v.pool=new c.Pool(function(t){t._exps.length=0,t._targetExp=null},1)).get=function(t){var e=this._get()||new v;return e._targetExp=t,e};var x=T.prototype;x.getFuncModule=function(t,e){var i=c.getClassName(t);if(i){var n=this.funcModuleCache[i];if(n)return n;if(void 0===n){var r=-1!==i.indexOf(".");if(r)try{if(r=t===Function("return "+i)())return this.funcModuleCache[i]=i}catch(t){}}}var o=this.funcs.indexOf(t);o<0&&(o=this.funcs.length,this.funcs.push(t));var s="F["+o+"]";return e&&(s="("+s+")"),this.funcModuleCache[i]=s},x.getObjRef=function(t){var e=this.objs.indexOf(t);return e<0&&(e=this.objs.length,this.objs.push(t)),"O["+e+"]"},x.setValueType=function(t,e,i,n){var r=v.pool.get(n),o=e.constructor.__props__;o||(o=Object.keys(e));for(var s=0;s<o.length;s++){var a=o[s],c=i[a];if(e[a]!==c){var h=this.enumerateField(i,a,c);r.append(a,h)}}r.writeCode(t),v.pool.put(r)},x.enumerateCCClass=function(t,e,i){for(var n=i.__props__,r=l.getClassAttrs(i),o=0;o<n.length;o++){var s=n[o];if(!1!==r[s+_]){var a,c=e[s];if(y(a=r[s+d],c))continue;if("object"==typeof c&&c instanceof cc.ValueType&&((a=u.getDefault(a))&&a.constructor)===c.constructor){var h="o"+C(s);this.setValueType(t,a,c,h);continue}this.setObjProp(t,e,s,c)}}},x.instantiateArray=function(t){if(0===t.length)return"[]";var e="a"+ ++this.localVariableId,i=[new o(e,"new Array("+t.length+")")];t._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(t);for(var n=0;n<t.length;++n)m(i,e+"["+n+"]=",this.enumerateField(t,n,t[n]));return i},x.enumerateField=function(t,e,i){if("object"==typeof i&&i){var n=i._iN$t;if(n){var r=n.globalVar;if(!r){r=n.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(r);var o=n.source[0];n.source[0]=g(r+"=",o)}return r}return Array.isArray(i)?this.instantiateArray(i):this.instantiateObj(i)}return"function"==typeof i?this.getFuncModule(i):"string"==typeof i?f(i):("_objFlags"===e&&t instanceof s&&(i&=a),i)},x.setObjProp=function(t,e,i,n){m(t,"o"+C(i)+"=",this.enumerateField(e,i,n))},x.enumerateObject=function(t,e){var i=e.constructor;if(cc.Class._isCCClass(i))this.enumerateCCClass(t,e,i);else for(var n in e)if(e.hasOwnProperty(n)&&(95!==n.charCodeAt(0)||95!==n.charCodeAt(1)||"__type__"===n)){var r=e[n];"object"==typeof r&&r&&r===e._iN$t||this.setObjProp(t,e,n,r)}},x.instantiateObj=function(t){if(t instanceof cc.ValueType)return u.getNewValueTypeCode(t);if(t instanceof cc.Asset)return this.getObjRef(t);if(t._objFlags&r)return null;var e,i=t.constructor;if(cc.Class._isCCClass(i)){if(this.parent)if(this.parent instanceof cc.Component){if(t instanceof cc._BaseNode||t instanceof cc.Component)return this.getObjRef(t)}else if(this.parent instanceof cc._BaseNode)if(t instanceof cc._BaseNode){if(!t.isChildOf(this.parent))return this.getObjRef(t)}else if(t instanceof cc.Component&&!t.node.isChildOf(this.parent))return this.getObjRef(t);e=new o("o","new "+this.getFuncModule(i,!0)+"()")}else if(i===Object)e=new o("o","{}");else{if(i)return this.getObjRef(t);e=new o("o","Object.create(null)")}var n=[e];return t._iN$t={globalVar:"",source:n},this.objsToClear_iN$t.push(t),this.enumerateObject(n,t),["(function(){",n,"return o;})();"]},e.exports={compile:function(t){return new T(t,t instanceof cc._BaseNode&&t).result},equalsToDefault:y}},{"./CCClass":123,"./CCObject":129,"./attribute":136,"./compiler":138,"./js":144}],143:[function(t,e,i){var s=t("./CCObject"),a=s.Flags.Destroyed,c=s.Flags.PersistentMask,h=t("./attribute"),o=t("./utils").isDomNode;function n(t,e){if(!e){if("object"!=typeof t||Array.isArray(t))return null;if(!t)return null;if(!cc.isValid(t))return null}var i;if(t instanceof s){if(t._instantiate)return cc.game._isCloning=!0,i=t._instantiate(),cc.game._isCloning=!1,i;if(t instanceof cc.Asset)return null}return cc.game._isCloning=!0,i=r(t),cc.game._isCloning=!1,i}var l=[];function r(t,e){if(Array.isArray(t))return null;if(o&&o(t))return null;var i;_(t,i=t._iN$t?t._iN$t:t.constructor?new t.constructor:Object.create(null),e);for(var n=0,r=l.length;n<r;++n)l[n]._iN$t=null;return l.length=0,i}var u=h.DELIMETER+"serializable";function _(t,e,i){t._iN$t=e,l.push(t);var n=t.constructor;if(cc.Class._isCCClass(n))!function(t,e,i,n){for(var r=t.__props__,o=h.getClassAttrs(t),s=0;s<r.length;s++){var a=r[s];if(!1!==o[a+u]){var c=e[a];i[a]="object"==typeof c&&c?c._iN$t||d(c,n):c}}}(n,t,e,i);else for(var r in t)if(t.hasOwnProperty(r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)||"__type__"===r)){var o=t[r];if("object"==typeof o&&o){if(o===e)continue;e[r]=o._iN$t||d(o,i)}else e[r]=o}t instanceof s&&(e._objFlags&=c)}function d(t,e){if(t instanceof cc.ValueType)return t.clone();if(t instanceof cc.Asset)return t;var i;if(Array.isArray(t)){var n=t.length;i=new Array(n),t._iN$t=i;for(var r=0;r<n;++r){var o=t[r];i[r]="object"==typeof o&&o?o._iN$t||d(o,e):o}return l.push(t),i}if(t._objFlags&a)return null;var s=t.constructor;if(cc.Class._isCCClass(s)){if(e)if(e instanceof cc.Component){if(t instanceof cc._BaseNode||t instanceof cc.Component)return t}else if(e instanceof cc._BaseNode)if(t instanceof cc._BaseNode){if(!t.isChildOf(e))return t}else if(t instanceof cc.Component&&!t.node.isChildOf(e))return t;i=new s}else if(s===Object)i={};else{if(s)return t;i=Object.create(null)}return _(t,i,e),i}n._clone=r,cc.instantiate=n,e.exports=n},{"./CCObject":129,"./attribute":136,"./utils":148}],144:[function(t,e,i){var s=new(t("./id-generater"))("TmpCId.");function r(t,e){for(;t;){var i=Object.getOwnPropertyDescriptor(t,e);if(i)return i;t=Object.getPrototypeOf(t)}return null}function o(t,e,i){var n=r(e,t);Object.defineProperty(i,t,n)}var a={isNumber:function(t){return"number"==typeof t||t instanceof Number},isString:function(t){return"string"==typeof t||t instanceof String},addon:function(t){"use strict";t=t||{};for(var e=1,i=arguments.length;e<i;e++){var n=arguments[e];if(n){if("object"!=typeof n){cc.errorID(5402,n);continue}for(var r in n)r in t||o(r,n,t)}}return t},mixin:function(t){"use strict";t=t||{};for(var e=1,i=arguments.length;e<i;e++){var n=arguments[e];if(n){if("object"!=typeof n){cc.errorID(5403,n);continue}for(var r in n)o(r,n,t)}}return t},extend:function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return t.prototype=Object.create(e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),t},getSuper:function(t){var e=t.prototype,i=e&&Object.getPrototypeOf(e);return i&&i.constructor},clear:function(t){for(var e=Object.keys(t),i=0;i<e.length;i++)delete t[e[i]]},getPropertyDescriptor:r},c={value:void 0,enumerable:!1,writable:!1,configurable:!0},h={get:null,set:null,enumerable:!(a.value=function(t,e,i,n,r){c.value=i,c.writable=n,c.enumerable=r,Object.defineProperty(t,e,c),c.value=void 0})},l={get:null,enumerable:!(a.getset=function(t,e,i,n,r){"function"!=typeof n&&(r=n,n=void 0),h.get=i,h.set=n,h.enumerable=r,Object.defineProperty(t,e,h),h.get=null,h.set=null}),configurable:!1},u={set:null,enumerable:!(a.get=function(t,e,i,n,r){l.get=i,l.enumerable=n,l.configurable=r,Object.defineProperty(t,e,l),l.get=null}),configurable:!1};a.set=function(t,e,i,n,r){u.set=i,u.enumerable=n,u.configurable=r,Object.defineProperty(t,e,u),u.set=null},a.getClassName=function(t){if("function"==typeof t){var e=t.prototype;if(e&&e.hasOwnProperty("__classname__")&&e.__classname__)return e.__classname__;var i="";if(t.name&&(i=t.name),t.toString){var n,r=t.toString();(n="["===r.charAt(0)?r.match(/\[\w+\s*(\w+)\]/):r.match(/function\s*(\w+)/))&&2===n.length&&(i=n[1])}return"Object"!==i?i:""}return t&&t.constructor?a.getClassName(t.constructor):""},function(){var r={},o={};function t(r,o){return function(t,e){if(e.prototype.hasOwnProperty(r)&&delete o[e.prototype[r]],a.value(e.prototype,r,t),t){var i=o[t];if(i&&i!==e){var n="A Class already exists with the same "+r+' : "'+t+'".';cc.error(n)}else o[t]=e}}}a._setClassId=t("__cid__",r);var n=t("__classname__",o);a.setClassName=function(t,e){if(n(t,e),!e.prototype.hasOwnProperty("__cid__")){var i=t||s.getNewId();i&&a._setClassId(i,e)}},a.unregisterClass=function(){for(var t=0;t<arguments.length;t++){var e=arguments[t].prototype,i=e.__cid__;i&&delete r[i];var n=e.__classname__;n&&delete o[n]}},a._getClassById=function(t){return r[t]},a.getClassByName=function(t){return o[t]},a._getClassId=function(t,e){if(e=void 0===e||e,"function"==typeof t&&t.prototype.hasOwnProperty("__cid__"))return t.prototype.__cid__;if(t&&t.constructor){var i=t.constructor.prototype;if(i&&i.hasOwnProperty("__cid__"))return t.__cid__}return""}}(),a.obsolete=function(t,e,i,n){var r=/([^.]+)$/.exec(e)[0];function o(){return this[i]}n?a.getset(t,r,o,function(t){this[i]=t}):a.get(t,r,o)},a.obsoletes=function(t,e,i,n){for(var r in i){var o=i[r];a.obsolete(t,e+"."+r,o,n)}};var _=/(%d)|(%s)/,d=/%s/;function n(t,e){t.splice(e,1)}function f(t,e){var i=t.indexOf(e);return 0<=i&&(n(t,i),!0)}a.formatStr=function(){var t=arguments.length;if(0===t)return"";var e=arguments[0];if(1===t)return""+e;if("string"==typeof e&&_.test(e))for(var i=1;i<t;++i){var n=arguments[i],r="number"==typeof n?_:d;r.test(e)?e=e.replace(r,n):e+=" "+n}else for(var o=1;o<t;++o)e+=" "+arguments[o];return e},a.shiftArguments=function(){for(var t=arguments.length-1,e=new Array(t),i=0;i<t;++i)e[i]=arguments[i+1];return e},a.createMap=function(t){var e=Object.create(null);return t&&(e["."]=!0,e["/"]=!0,delete e["."],delete e["/"]),e};var p=Array.prototype.indexOf;function g(t,e){"number"==typeof t&&(e=t,t=null),this.get=null,this.count=0,this._pool=new Array(e),this._cleanup=t}a.array={remove:f,fastRemove:function(t,e){var i=t.indexOf(e);0<=i&&(t[i]=t[t.length-1],--t.length)},removeAt:n,fastRemoveAt:function(t,e){var i=t.length;e<0||i<=e||(t[e]=t[i-1],t.length=i-1)},contains:function(t,e){return 0<=t.indexOf(e)},verifyType:function(t,e){if(t&&0<t.length)for(var i=0;i<t.length;i++)if(!(t[i]instanceof e))return cc.logID(1300),!1;return!0},removeArray:function(t,e){for(var i=0,n=e.length;i<n;i++)f(t,e[i])},appendObjectsAt:function(t,e,i){return t.splice.apply(t,[i,0].concat(e)),t},copy:function(t){var e,i=t.length,n=new Array(i);for(e=0;e<i;e+=1)n[e]=t[e];return n},indexOf:p,MutableForwardIterator:t("../utils/mutable-forward-iterator")},g.prototype._get=function(){if(0<this.count){--this.count;var t=this._pool[this.count];return this._pool[this.count]=null,t}return null},g.prototype.put=function(t){var e=this._pool;if(this.count<e.length){if(this._cleanup&&!1===this._cleanup(t))return;e[this.count]=t,++this.count}},g.prototype.resize=function(t){0<=t&&(this._pool.length=t,this.count>t&&(this.count=t))},a.Pool=g,cc.js=a,e.exports=a},{"../utils/mutable-forward-iterator":174,"./id-generater":140}],145:[function(t,e,l){var c={url:{canUsedInGet:!0},default:{},serializable:{},editorOnly:{},rawType:{},formerlySerializedAs:{}};function u(t,e,i,n){if(!t.get&&!t.set&&t.hasOwnProperty("default")){var r="_N$"+e;t.get=function(){return this[r]},t.set=function(t){var e=this[r];this[r]=t,i.call(this,e)};var o={};for(var s in n[r]=o,c){var a=c[s];t.hasOwnProperty(s)&&(o[s]=t[s],a.canUsedInGet||delete t[s])}}}function _(t,e,i,n){if(Array.isArray(e)){if(!(0<e.length))return cc.errorID(5508,i,n);if(cc.RawAsset.isRawAssetType(e[0]))return t.url=e[0],void delete t.type;t.type=e=e[0]}}l.getFullFormOfProperty=function(t){if(!t||t.constructor!==Object){if(Array.isArray(t)&&0<t.length)return{default:[],type:t,_short:!0};if("function"==typeof t){var e=t;return cc.RawAsset.isRawAssetType(e)?{default:"",url:e,_short:!0}:{default:cc.isChildClassOf(e,cc.ValueType)?new e:null,type:e,_short:!0}}return{default:t,_short:!0}}return null},l.preprocessAttrs=function(t,e,i,n){for(var r in t){var o=t[r],s=l.getFullFormOfProperty(o);if(s&&(o=t[r]=s),o){var a=o.notify;a&&u(o,r,a,t),"type"in o&&_(o,o.type,e,r),"url"in o&&(h=(c=o).url,Array.isArray(h)&&0<h.length&&(h=h[0]),c.type=h),"type"in o&&o.type}}var c,h},l.validateMethodWithProps=function(t,e,i,n,r){return"function"==typeof t||null===t}},{"./CCClass":123}],146:[function(t,e,i){var r=[];cc._RF={push:function(t,e,i){void 0===i&&(i=e,e=""),r.push({uuid:e,script:i,module:t,exports:t.exports,beh:null})},pop:function(){var t=r.pop(),e=t.module,i=e.exports;if(i===t.exports){for(var n in i)return;e.exports=i=t.cls}},peek:function(){return r[r.length-1]}}},{}],147:[function(t,e,i){var n={};cc.url={_rawAssets:"",_builtinRawAssets:"",normalize:function(t){return 46===t.charCodeAt(0)&&47===t.charCodeAt(1)?t=t.slice(2):47===t.charCodeAt(0)&&(t=t.slice(1)),t},raw:function(t){return(t=this.normalize(t)).startsWith("resources/")||cc.errorID(7002,t),this._rawAssets+t},builtinRaw:!1,_init:function(t){for(var e in t){var i=t[e];i=cc.path.stripSep(i)+"/",n[e]=i}this._rawAssets=n.assets,this._builtinRawAssets=n.internal}},e.exports=cc.url},{}],148:[function(t,e,i){e.exports={contains:function(t,e){if("function"==typeof t.contains)return t.contains(e);if("function"==typeof t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(e));var i=e.parentNode;if(i)do{if(i===t)return!0;i=i.parentNode}while(null!==i);return!1},isDomNode:"object"==typeof window&&("function"==typeof Node?function(t){return t instanceof Node}:function(t){return t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName}),callInNextTick:function(t,e,i){t&&setTimeout(function(){t(e,i)},0)}}},{}],149:[function(t,e,i){t("./platform/js"),t("./value-types"),t("./utils"),t("./platform/CCInputManager"),t("./platform/CCInputExtension"),t("./event"),t("./platform/CCSys"),t("./platform/CCMacro"),t("./load-pipeline"),t("./textures"),t("./CCDirector"),t("./CCDirectorWebGL"),t("./CCDirectorCanvas"),t("./platform/CCSAXParser"),t("./platform/CCView"),t("./platform/CCScreen"),t("./CCScheduler"),t("./event-manager"),t("./renderer")},{"./CCDirector":22,"./CCDirectorCanvas":23,"./CCDirectorWebGL":24,"./CCScheduler":31,"./event":87,"./event-manager":83,"./load-pipeline":109,"./platform/CCInputExtension":126,"./platform/CCInputManager":127,"./platform/CCMacro":128,"./platform/CCSAXParser":130,"./platform/CCScreen":131,"./platform/CCSys":132,"./platform/CCView":133,"./platform/js":144,"./renderer":153,"./textures":165,"./utils":172,"./value-types":186}],150:[function(t,e,i){var n=function(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this._width=0,this._height=0,this._area=0},r=n.prototype,o=[];function a(){var t=o.pop();return t||(t=new n),t}function m(t){o.push(t)}r.setTo=function(t,e,i,n){return this._minX=t,this._minY=e,this._maxX=i,this._maxY=n,this.updateArea(),this},r.intValues=function(){this._minX=Math.floor(this._minX),this._minY=Math.floor(this._minY),this._maxX=Math.ceil(this._maxX),this._maxY=Math.ceil(this._maxY),this.updateArea()},r.updateArea=function(){this._width=this._maxX-this._minX,this._height=this._maxY-this._minY,this._area=this._width*this._height},r.union=function(t){this.isEmpty()?this.setTo(t._minX,t._minY,t._maxX,t._maxY):(this._minX>t._minX&&(this._minX=t._minX),this._minY>t._minY&&(this._minY=t._minY),this._maxX<t._maxX&&(this._maxX=t._maxX),this._maxY<t._maxY&&(this._maxY=t._maxY),this.updateArea())},r.setEmpty=function(){this._minX=0,this._minY=0,this._maxX=0,this._maxY=0,this._width=0,this._height=0,this._area=0},r.isEmpty=function(){return this._width<=0||this._height<=0},r.intersects=function(t){if(this.isEmpty()||t.isEmpty())return!1;var e=this._minX>t._minX?this._minX:t._minX,i=this._maxX<t._maxX?this._maxX:t._maxX;return!(i<e)&&(e=this._minY>t._minY?this._minY:t._minY)<=(this._maxY<t._maxY?this._maxY:t._maxY)},r.updateRegion=function(t,e){if(0!==t.width&&0!==t.height){var i,n,r,o,s=e,a=s.a,c=s.b,h=s.c,l=s.d,u=s.tx,_=s.ty,d=t.x,f=t.y,p=d+t.width,g=f+t.height;if(1===a&&0===c&&0===h&&1===l)i=d+u-1,n=f+_-1,r=p+u+1,o=g+_+1;else{var m=a*d+h*f+u,v=c*d+l*f+_,y=a*p+h*f+u,C=c*p+l*f+_,T=a*p+h*g+u,x=c*p+l*g+_,E=a*d+h*g+u,S=c*d+l*g+_,b=0;y<m&&(b=m,m=y,y=b),E<T&&(b=T,T=E,E=b),i=(m<T?m:T)-1,r=(E<y?y:E)+1,C<v&&(b=v,v=C,C=b),S<x&&(b=x,x=S,S=b),n=(v<x?v:x)-1,o=(S<C?C:S)+1}this._minX=i,this._minY=n,this._maxX=r,this._maxY=o,this._width=r-i,this._height=o-n,this._area=this._width*this._height}else this.setEmpty()};var s=function(){this.dirtyList=[],this.hasClipRect=!1,this.clipWidth=0,this.clipHeight=0,this.clipArea=0,this.clipRectChanged=!1},c=s.prototype;c.setClipRect=function(t,e){this.hasClipRect=!0,this.clipRectChanged=!0,this.clipWidth=Math.ceil(t),this.clipHeight=Math.ceil(e),this.clipArea=this.clipWidth*this.clipHeight},c.addRegion=function(t){var e=t._minX,i=t._minY,n=t._maxX,r=t._maxY;if(this.hasClipRect&&(e<0&&(e=0),i<0&&(i=0),n>this.clipWidth&&(n=this.clipWidth),r>this.clipHeight&&(r=this.clipHeight)),n<=e||r<=i)return!1;if(this.clipRectChanged)return!0;var o=this.dirtyList,s=a();return o.push(s.setTo(e,i,n,r)),this.mergeDirtyList(o),!0},c.clear=function(){for(var t=this.dirtyList,e=t.length,i=0;i<e;i++)m(t[i]);t.length=0},c.getDirtyRegions=function(){var t=this.dirtyList;if(this.clipRectChanged){this.clipRectChanged=!1,this.clear();var e=a();t.push(e.setTo(0,0,this.clipWidth,this.clipHeight))}else for(;this.mergeDirtyList(t););var i=this.dirtyList.length;if(0<i)for(var n=0;n<i;n++)this.dirtyList[n].intValues();return this.dirtyList},c.mergeDirtyList=function(t){var e=t.length;if(e<2)return!1;for(var i,n,r,o,s=this.hasClipRect,a=3<e?Number.POSITIVE_INFINITY:0,c=0,h=0,l=0,u=0;u<e-1;u++){var _=t[u];s&&(l+=_.area);for(var d=u+1;d<e;d++){var f=t[d],p=(n=f,r=(i=_)._minX<n._minX?i._minX:n._minX,o=i._minY<n._minY?i._minY:n._minY,((i._maxX>n._maxX?i._maxX:n._maxX)-r)*((i._maxY>n._maxY?i._maxY:n._maxY)-o)-_.area-f.area);p<a&&(c=u,h=d,a=p)}}if(s&&.95<l/this.clipArea&&(this.clipRectChanged=!0),c!==h){var g=t[h];return t[c].union(g),m(g),t.splice(h,1),!0}return!1},cc.Region=n,cc.DirtyRegion=s},{}],151:[function(t,e,i){cc.rendererCanvas={childrenOrderDirty:!0,assignedZ:0,assignedZStep:1e-4,_transformNodePool:[],_renderCmds:[],_isCacheToCanvasOn:!1,_cacheToCanvasCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:cc.color(),_clearFillStyle:"rgb(0, 0, 0)",_dirtyRegion:null,_allNeedDraw:!0,_enableDirtyRegion:!1,_debugDirtyRegion:!1,_dirtyRegionCountThreshold:10,init:function(){cc.sys.browserType!==cc.sys.BROWSER_TYPE_IE&&cc.sys.browserType!==cc.sys.BROWSER_TYPE_UC||this.enableDirtyRegion(!1)},getRenderCmd:function(t){return t._createRenderCmd()},enableDirtyRegion:function(t){this._enableDirtyRegion=t},isDirtyRegionEnabled:function(){return this._enableDirtyRegion},setDirtyRegionCountThreshold:function(t){this._dirtyRegionCountThreshold=t},_collectDirtyRegion:function(){var t,e,i=this._renderCmds,n=this._dirtyRegion,r=_ccsg.Node.CanvasRenderCmd.RegionStatus,o=0,s=!0;for(t=0,e=i.length;t<e;t++){var a=i[t],c=a._regionFlag,h=a._oldRegion,l=a._currentRegion;c>r.NotDirty&&(++o>this._dirtyRegionCountThreshold&&(s=!1),s&&(!l.isEmpty()&&n.addRegion(l),a._regionFlag>r.Dirty&&!h.isEmpty()&&n.addRegion(h)),a._regionFlag=r.NotDirty)}return s},_beginDrawDirtyRegion:function(t){var e=t.getContext(),i=this._dirtyRegion.getDirtyRegions();e.save(),t.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},1,1),e.beginPath();for(var n=0,r=0,o=0,s=0,a=t._scaleX,c=t._scaleY,h=0,l=i.length;h<l;++h){var u=i[h];n=(u._minX*a|0)-1,r=(-u._maxY*a|0)-1,o=2+(u._width*a|0),s=2+(u._height*c|0),e.rect(n,r,o,s)}e.clip()},_endDrawDirtyRegion:function(t){t.restore()},_debugDrawDirtyRegion:function(t){if(this._debugDirtyRegion){var e=t.getContext(),i=this._dirtyRegion.getDirtyRegions();t.setTransform({a:1,b:0,c:0,d:1,tx:0,ty:0},1,1),e.beginPath();for(var n=0,r=0,o=0,s=0,a=t._scaleX,c=t._scaleY,h=0,l=i.length;h<l;++h){var u=i[h];n=(u._minX*a|0)-1,r=(-u._maxY*a|0)-1,o=2+(u._width*a|0),s=2+(u._height*c|0),e.rect(n,r,o,s)}var _=e.fillStyle;e.fillStyle="green",e.fill(),e.fillStyle=_}},rendering:function(t){var e=this._dirtyRegion=this._dirtyRegion||new cc.DirtyRegion,i=cc._canvas,n=t||cc._renderContext,r=n.getContext(),o=cc.view.getScaleX(),s=cc.view.getScaleY();n.setViewScale(o,s),n.computeRealOffsetY();var a,c,h=this._dirtyRegion.getDirtyRegions(),l=this._renderCmds,u=this._allNeedDraw||!this._enableDirtyRegion;for(u||(u=u||!this._collectDirtyRegion()),u||this._beginDrawDirtyRegion(n),r.setTransform(1,0,0,1,0,0),r.clearRect(0,0,i.width,i.height),0===this._clearColor.r&&0===this._clearColor.g&&0===this._clearColor.b||(n.setFillStyle(this._clearFillStyle),n.setGlobalAlpha(this._clearColor.a),r.fillRect(0,0,i.width,i.height)),a=0,c=l.length;a<c;a++){var _=l[a];if(_._needDraw){var d=!1,f=_._currentRegion;if(!f||u)d=!0;else for(var p=0,g=h.length;p<g;++p)if(h[p].intersects(f)){d=!0;break}d&&_.rendering(n,o,s)}}u||(this._debugDrawDirtyRegion(n),this._endDrawDirtyRegion(r)),e.clear(),this._allNeedDraw=!1},_renderingToCacheCanvas:function(t,e,i,n){t||cc.logID(7600),i=void 0===i?1:i,n=void 0===n?1:n,e=e||this._currentID;var r,o,s=this._cacheToCanvasCmds[e];for(t.computeRealOffsetY(),r=0,o=s.length;r<o;r++)s[r].rendering(t,i,n);this._removeCache(e);var a=this._cacheInstanceIds;0===a.length?this._isCacheToCanvasOn=!1:this._currentID=a[a.length-1]},_turnToCacheMode:function(t){this._isCacheToCanvasOn=!0,t=t||0,this._cacheToCanvasCmds[t]=[],-1===this._cacheInstanceIds.indexOf(t)&&this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToCanvasOn=!1},_removeCache:function(t){t=t||this._currentID;var e=this._cacheToCanvasCmds[t];e&&(e.length=0,delete this._cacheToCanvasCmds[t]);var i=this._cacheInstanceIds;cc.js.array.remove(i,t)},resetFlag:function(){this.childrenOrderDirty=!1,this._transformNodePool.length=0},transform:function(){var t=this._transformNodePool;t.sort(this._sortNodeByLevelAsc);for(var e=0,i=t.length;e<i;e++)t[e].updateStatus();t.length=0},transformDirty:function(){return 0<this._transformNodePool.length},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clear:function(){},clearRenderCommands:function(){this._renderCmds.length=0,this._cacheInstanceIds.length=0,this._isCacheToCanvasOn=!1,this._allNeedDraw=!0},pushRenderCommand:function(t){if(t.rendering)if(this._isCacheToCanvasOn){var e=this._currentID,i=this._cacheToCanvasCmds[e];-1===i.indexOf(t)&&i.push(t)}else-1===this._renderCmds.indexOf(t)&&this._renderCmds.push(t)}},function(){cc.CanvasContextWrapper=function(t){this._context=t,this._saveCount=0,this._currentAlpha=t.globalAlpha,this._currentCompositeOperation=t.globalCompositeOperation,this._currentFillStyle=t.fillStyle,this._currentStrokeStyle=t.strokeStyle,this._offsetX=0,this._offsetY=0,this._realOffsetY=this.height,this._armatureMode=0};var t=cc.CanvasContextWrapper.prototype;t.resetCache=function(){var t=this._context;this._currentAlpha=t.globalAlpha,this._currentCompositeOperation=t.globalCompositeOperation,this._currentFillStyle=t.fillStyle,this._currentStrokeStyle=t.strokeStyle,this._realOffsetY=this._context.canvas.height+this._offsetY},t.setOffset=function(t,e){this._offsetX=t,this._offsetY=e,this._realOffsetY=this._context.canvas.height+this._offsetY},t.computeRealOffsetY=function(){this._realOffsetY=this._context.canvas.height+this._offsetY},t.setViewScale=function(t,e){this._scaleX=t,this._scaleY=e},t.getContext=function(){return this._context},t.save=function(){this._context.save(),this._saveCount++},t.restore=function(){this._context.restore(),this._currentAlpha=this._context.globalAlpha,this._saveCount--},t.setGlobalAlpha=function(t){0<this._saveCount?this._context.globalAlpha=t:this._currentAlpha!==t&&(this._currentAlpha=t,this._context.globalAlpha=t)},t.setCompositeOperation=function(t){0<this._saveCount?this._context.globalCompositeOperation=t:this._currentCompositeOperation!==t&&(this._currentCompositeOperation=t,this._context.globalCompositeOperation=t)},t.setFillStyle=function(t){this._context.fillStyle=t},t.setStrokeStyle=function(t){0<this._saveCount?this._context.strokeStyle=t:this._currentStrokeStyle!==t&&(this._currentStrokeStyle=t,this._context.strokeStyle=t)},t.setTransform=function(t,e,i){0<this._armatureMode?(this.restore(),this.save(),this._context.transform(t.a,-t.b,-t.c,t.d,t.tx*e,-t.ty*i)):this._context.setTransform(t.a*e,-t.b*i,-t.c*e,t.d*i,this._offsetX+t.tx*e,this._realOffsetY-t.ty*i)},t._switchToArmatureMode=function(t,e,i,n){t?(this._armatureMode++,this._context.setTransform(e.a,e.c,e.b,e.d,this._offsetX+e.tx*i,this._realOffsetY-e.ty*n),this.save()):(this._armatureMode--,this.restore())}}()},{}],152:[function(t,e,i){var h={texture:null,blendSrc:null,blendDst:null,shader:null},l=!1,s=null,a=null,u=0,_=0,d=0,c=null,f=null,p=null,g=null,m=0,v=!0;var y=cc.Enum({QUAD:0,TRIANGLE:1,CUSTOM:2});cc.rendererWebGL={mat4Identity:null,childrenOrderDirty:!0,assignedZ:0,assignedZStep:.01,VertexType:y,_transformNodePool:[],_renderCmds:[],_isCacheToBufferOn:!1,_cacheToBufferCmds:{},_cacheInstanceIds:[],_currentID:0,_clearColor:{r:0,g:0,b:0,a:1},init:function(){var t,e,i=cc._renderContext;i.disable(i.CULL_FACE),i.disable(i.DEPTH_TEST),this._initExtensions(["OES_element_index_uint"]),this.mat4Identity=new cc.math.Matrix4,this.mat4Identity.identity(),t=cc.macro.BATCH_VERTEX_COUNT,e=cc._renderContext,null===s&&(a=e.createBuffer(),s=e.createBuffer()),function(t){var e=cc._renderContext;if(s){var i=6*Math.ceil(t/4);e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,s),g=new Uint16Array(i);for(var n=0,r=0,o=i;r<o;r+=6)g[r]=n+0,g[r+1]=n+1,g[r+2]=n+2,g[r+3]=n+1,g[r+4]=n+2,g[r+5]=n+3,n+=4;e.bufferData(e.ELEMENT_ARRAY_BUFFER,g,e.DYNAMIC_DRAW)}a&&(c=new ArrayBuffer(6*t*4),f=new Float32Array(c),p=new Uint32Array(c),e.bindBuffer(e.ARRAY_BUFFER,a),e.bufferData(e.ARRAY_BUFFER,f,e.DYNAMIC_DRAW)),u=t-200}(t),cc.sys.os,cc.sys.OS_IOS},_initExtensions:function(t){this._extensions=this._extensions||{};for(var e=0;e<t.length;++e){var i=t[e];try{var n=gl.getExtension(i);n&&(this._extensions[i]=n)}catch(t){cc.error(t)}}},getVertexSize:function(){return u},getRenderCmd:function(t){return t._createRenderCmd()},_turnToCacheMode:function(t){this._isCacheToBufferOn=!0,t=t||0,this._cacheToBufferCmds[t]?this._cacheToBufferCmds[t].length=0:this._cacheToBufferCmds[t]=[],-1===this._cacheInstanceIds.indexOf(t)&&this._cacheInstanceIds.push(t),this._currentID=t},_turnToNormalMode:function(){this._isCacheToBufferOn=!1},_removeCache:function(t){t=t||this._currentID;var e=this._cacheToBufferCmds[t];e&&(e.length=0,delete this._cacheToBufferCmds[t]);var i=this._cacheInstanceIds;cc.js.array.remove(i,t)},_renderingToBuffer:function(t){t=t||this._currentID;var e=this._cacheToBufferCmds[t],i=cc._renderContext;this.rendering(i,e),this._removeCache(t);var n=this._cacheInstanceIds;0===n.length?this._isCacheToBufferOn=!1:this._currentID=n[n.length-1]},resetFlag:function(){this.childrenOrderDirty&&(this.childrenOrderDirty=!1),this._transformNodePool.length=0},transform:function(){var t,e,i=this._transformNodePool;for(i.sort(this._sortNodeByLevelAsc),t=0,e=i.length;t<e;t++)i[t].updateStatus();i.length=0},transformDirty:function(){return 0<this._transformNodePool.length},_sortNodeByLevelAsc:function(t,e){return t._curLevel-e._curLevel},pushDirtyNode:function(t){this._transformNodePool.push(t)},clearRenderCommands:function(){this._renderCmds.length=0},clear:function(){var t=cc._renderContext;t.clearColor(this._clearColor.r,this._clearColor.g,this._clearColor.b,this._clearColor.a),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)},setDepthTest:function(t){var e=cc._renderContext;t?(e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL)):e.disable(e.DEPTH_TEST)},pushRenderCommand:function(t){if(t.rendering||t.uploadData)if(this._isCacheToBufferOn){var e=this._currentID,i=this._cacheToBufferCmds[e];-1===i.indexOf(t)&&i.push(t)}else this._renderCmds.push(t)},_increaseBatchingSize:function(t,e,i){var n,r;switch(e=e||y.QUAD){case y.QUAD:for(n=0;n<t;n+=4)r=_+n,g[d++]=r+0,g[d++]=r+1,g[d++]=r+2,g[d++]=r+1,g[d++]=r+2,g[d++]=r+3;break;case y.TRIANGLE:for(v=!1,n=0;n<t;n+=3)r=_+n,g[d++]=r+0,g[d++]=r+1,g[d++]=r+2;break;case y.CUSTOM:v=!1;var o=i.length;for(n=0;n<o;n++)g[d++]=_+i[n];break;default:return}_+=t},_updateBatchedInfo:function(t,e,i){return(t!==h.texture||e.src!==h.blendSrc||e.dst!==h.blendDst||i!==h.shader)&&(this._batchRendering(),h.texture=t,h.blendSrc=e.src,h.blendDst=e.dst,h.shader=i,!0)},_breakBatch:function(){l=!0},_uploadBufferData:function(t){u<=_&&this._batchRendering();var e=t._node,i=t._texture||e._texture||e._spriteFrame&&e._spriteFrame._texture,n=e._blendFunc.src,r=e._blendFunc.dst,o=t._shaderProgram;(l||h.texture!==i||h.blendSrc!==n||h.blendDst!==r||h.shader!==o)&&(this._batchRendering(),h.texture=i,h.blendSrc=n,h.blendDst=r,h.shader=o,l=!1);var s=t.uploadData(f,p,6*_);if(0<s){var a,c;switch(t.vertexType||y.QUAD){case y.QUAD:for(a=0;a<s;a+=4)c=_+a,g[d++]=c+0,g[d++]=c+1,g[d++]=c+2,g[d++]=c+1,g[d++]=c+2,g[d++]=c+3;break;case y.TRIANGLE:for(v=!1,a=0;a<s;a+=3)c=_+a,g[d++]=c+0,g[d++]=c+1,g[d++]=c+2;break;case y.CUSTOM:v=!1,t.uploadIndexData&&(d+=t.uploadIndexData(g,d,_));break;default:return}_+=s}},_batchRendering:function(){if(0!==_&&h.texture){var t=cc._renderContext,e=h.texture,i=h.shader,n=.5*u<_;if(i&&(i.use(),i._updateProjectionUniform()),cc.gl.blendFunc(h.blendSrc,h.blendDst),cc.gl.bindTexture2DN(0,e),t.bindBuffer(t.ARRAY_BUFFER,a),n)CC_QQPLAY&&cc.sys.noABSupport?t.bufferDataOldIOS(t.ARRAY_BUFFER,f,p,t.DYNAMIC_DRAW):t.bufferData(t.ARRAY_BUFFER,f,t.DYNAMIC_DRAW);else{var r=f.subarray(0,6*_);if(CC_QQPLAY&&cc.sys.noABSupport){var o=p.subarray(0,6*_);t.bufferDataOldIOS(t.ARRAY_BUFFER,r,o,t.DYNAMIC_DRAW)}else t.bufferData(t.ARRAY_BUFFER,r,t.DYNAMIC_DRAW)}t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_TEX_COORDS),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,3,t.FLOAT,!1,24,0),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,24,12),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,24,16),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,s),(!m||!v||m<d)&&(n?t.bufferData(t.ELEMENT_ARRAY_BUFFER,g,t.DYNAMIC_DRAW):t.bufferData(t.ELEMENT_ARRAY_BUFFER,g.subarray(0,d),t.DYNAMIC_DRAW)),t.drawElements(t.TRIANGLES,d,t.UNSIGNED_SHORT,0),cc.g_NumberOfDraws++,v?m=d:v=!(m=0),d=_=0}},rendering:function(t,e){var i,n,r,o=e||this._renderCmds,s=t||cc._renderContext;for(s.bindBuffer(s.ARRAY_BUFFER,null),cc.gl.bindTexture2DN(0,null),i=0,n=o.length;i<n;++i)(r=o[i])._needDraw&&(r.uploadData?this._uploadBufferData(r):(0<_&&this._batchRendering(),r.rendering(s)));this._batchRendering(),h.texture=null}}},{}],153:[function(t,e,i){t("./RendererCanvas"),t("./RendererWebGL"),t("./DirtyRegion")},{"./DirtyRegion":150,"./RendererCanvas":151,"./RendererWebGL":152}],154:[function(t,e,i){_ccsg.Scene=_ccsg.Node.extend({_className:"Scene",ctor:function(){_ccsg.Node.prototype.ctor.call(this),this._ignoreAnchorPointForPosition=!0,this.setAnchorPoint(.5,.5),this.setContentSize(cc.director.getWinSize())}})},{}],155:[function(t,e,i){var n=t("../event/event-target"),r=t("../utils/misc");_ccsg.Sprite=_ccsg.Node.extend({dirty:!1,_recursiveDirty:null,_shouldBeHidden:!1,_transformToBatch:null,_blendFunc:null,_texture:null,_rect:null,_rectRotated:!1,_offsetPosition:null,_unflippedOffsetPositionFromCenter:null,_opacityModifyRGB:!1,_flippedX:!1,_flippedY:!1,_textureLoaded:!1,_className:"Sprite",ctor:function(t,e,i){_ccsg.Node.prototype.ctor.call(this),n.call(this),this._shouldBeHidden=!1,this._offsetPosition=cc.p(0,0),this._unflippedOffsetPositionFromCenter=cc.p(0,0),this._blendFunc={src:cc.macro.BLEND_SRC,dst:cc.macro.BLEND_DST},this._rect=cc.rect(0,0,0,0),this._softInit(t,e,i)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.once("load",t,e)},isDirty:function(){return this.dirty},setDirty:function(t){this.dirty=t},isTextureRectRotated:function(){return this._rectRotated},getTextureRect:function(){return cc.rect(this._rect)},getOffsetPosition:function(){return cc.p(this._offsetPosition)},_getOffsetX:function(){return this._offsetPosition.x},_getOffsetY:function(){return this._offsetPosition.y},getBlendFunc:function(){return this._blendFunc},initWithSpriteFrame:function(t){cc.assertID(t,2606),t.textureLoaded()||(this._textureLoaded=!1,t.once("load",this._renderCmd._spriteFrameLoadedCallback,this._renderCmd));var e=cc._renderType!==cc.game.RENDER_TYPE_CANVAS&&t._rotated,i=this.initWithTexture(t.getTexture(),t.getRect(),e);return this.setSpriteFrame(t),i},initWithSpriteFrameName:function(){cc.warnID(2608)},setVertexRect:function(t){var e=this._rect;e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height},setFlippedX:function(t){this._flippedX!==t&&(this._flippedX=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},setFlippedY:function(t){this._flippedY!==t&&(this._flippedY=t,this.setTextureRect(this._rect,this._rectRotated,this._contentSize),this.setNodeDirty(!0))},isFlippedX:function(){return this._flippedX},isFlippedY:function(){return this._flippedY},setOpacityModifyRGB:function(t){this._opacityModifyRGB!==t&&(this._opacityModifyRGB=t,this._renderCmd._setColorDirty())},isOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrameWithAnimationName:function(t,e){cc.assertID(t,2610);var i=cc.spriteFrameAnimationCache.getAnimation(t);if(i){var n=i.getFrames()[e];n?this.setSpriteFrame(n.getSpriteFrame()):cc.logID(2603)}else cc.logID(2602)},getTexture:function(){return this._texture},_softInit:function(t,e,i){if(void 0===t)_ccsg.Sprite.prototype.init.call(this);else if(cc.js.isString(t))"#"===t[0]?cc.logID(2728,t):_ccsg.Sprite.prototype.init.call(this,t,e);else if("object"==typeof t)if(t instanceof cc.Texture2D)this.initWithTexture(t,e,i);else if(t instanceof cc.SpriteFrame)this.initWithSpriteFrame(t);else if(t instanceof HTMLImageElement||t instanceof HTMLCanvasElement){var n=new cc.Texture2D;n.initWithElement(t),n.handleLoadedTexture(),this.initWithTexture(n)}},getQuad:function(){return null},setBlendFunc:function(t,e){var i=this._blendFunc;void 0===e?(i.src=t.src,i.dst=t.dst):(i.src=t,i.dst=e),this._renderCmd.updateBlendFunc(i)},init:function(){var t=this;return 0<arguments.length?t.initWithFile(arguments[0],arguments[1]):(t.dirty=t._recursiveDirty=!1,t._blendFunc.src=cc.macro.BLEND_SRC,t._blendFunc.dst=cc.macro.BLEND_DST,t.texture=null,t._flippedX=t._flippedY=!1,t.anchorX=.5,t.anchorY=.5,t._offsetPosition.x=0,t._offsetPosition.y=0,t.setTextureRect(cc.rect(0,0,0,0),!1,cc.size(0,0)),!0)},initWithFile:function(t,e){cc.assertID(t,2609);var i=cc.textureCache.getTextureForKey(t);if(i){if(!e){var n=i.getContentSize();e=cc.rect(0,0,n.width,n.height)}return this.initWithTexture(i,e)}return i=cc.textureCache.addImage(t),this.initWithTexture(i,e||cc.rect(0,0,i.width,i.height))},initWithTexture:function(t,e,i,n){var r=this;cc.assertID(0!==arguments.length,2710),i=i||!1,t=this._renderCmd._handleTextureForRotatedTexture(t,e,i,n),r._recursiveDirty=!1,r.dirty=!1,r._opacityModifyRGB=!0,r._blendFunc.src=cc.macro.BLEND_SRC,r._blendFunc.dst=cc.macro.BLEND_DST,r._flippedX=r._flippedY=!1,r.setAnchorPoint(.5,.5),r._offsetPosition.x=0,r._offsetPosition.y=0;var o=t.loaded;return(r._textureLoaded=o)?(e||(e=cc.rect(0,0,t.width,t.height)),this._renderCmd._checkTextureBoundary(t,e,i),r.setTexture(t),r.setTextureRect(e,i),this.emit("load")):(r._rectRotated=i,e&&(r._rect.x=e.x,r._rect.y=e.y,r._rect.width=e.width,r._rect.height=e.height),r.texture&&r.texture.off("load",r._renderCmd._textureLoadedCallback,r._renderCmd),t.once("load",r._renderCmd._textureLoadedCallback,r._renderCmd),r.setTexture(t)),!0},setTextureRect:function(t,e,i,n){var r=this;r._rectRotated=e||!1,r.setContentSize(i||t),r.setVertexRect(t),r._renderCmd._setTextureCoords(t,n);var o=r._unflippedOffsetPositionFromCenter.x,s=r._unflippedOffsetPositionFromCenter.y;r._flippedX&&(o=-o),r._flippedY&&(s=-s);var a=r._rect;r._offsetPosition.x=o+(r._contentSize.width-a.width)/2,r._offsetPosition.y=s+(r._contentSize.height-a.height)/2},setSpriteFrame:function(t){var n=this;cc.assertID(t,2712),this.setNodeDirty(!0);var e=t.getOffset();n._unflippedOffsetPositionFromCenter.x=e.x,n._unflippedOffsetPositionFromCenter.y=e.y;var i=t.getTexture();t.textureLoaded()?(n._textureLoaded=!0,i!==n._texture&&(n._setTexture(i),n.setColor(n._realColor)),n.setTextureRect(t.getRect(),t.isRotated(),t.getOriginalSize())):(n._textureLoaded=!1,t.once("load",function(t){var e=t.currentTarget;n._textureLoaded=!0;var i=e.getTexture();i!==n._texture&&n._setTexture(i),n.setTextureRect(e.getRect(),e.isRotated(),e.getOriginalSize()),n.emit("load"),n.setColor(n._realColor)},n)),this._renderCmd._updateForSetSpriteFrame(i)},setDisplayFrame:function(t){cc.logID(2604),this.setSpriteFrame(t)},isFrameDisplayed:function(t){return this._renderCmd.isFrameDisplayed(t)},displayFrame:function(){return this.getSpriteFrame()},getSpriteFrame:function(){return new cc.SpriteFrame(this._texture,this._rect,this._rectRotated,this._unflippedOffsetPositionFromCenter,this._contentSize)},setTexture:function(e){if(!e)return this._renderCmd._setTexture(null);var i=cc.js.isString(e);i&&(e=cc.textureCache.addImage(e)),e.loaded?(this._setTexture(e,i),this.setColor(this._realColor),this._textureLoaded=!0,this.emit("load")):(this._renderCmd._setTexture(e),e.once("load",function(t){this._setTexture(e,i),this.setColor(this._realColor),this._textureLoaded=!0,this.emit("load")},this))},_setTexture:function(t,e){this._renderCmd._setTexture(t),e&&this._changeRectWithTexture(t)},_changeRectWithTexture:function(t){var e=cc.rect(0,0,t.width,t.height);this.setTextureRect(e)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new _ccsg.Sprite.CanvasRenderCmd(this):new _ccsg.Sprite.WebGLRenderCmd(this)}}),cc.js.addon(_ccsg.Sprite.prototype,n.prototype),r.propertyDefine(_ccsg.Sprite,["opacity","color","texture","quad"],{opacityModifyRGB:["isOpacityModifyRGB","setOpacityModifyRGB"],flippedX:["isFlippedX","setFlippedX"],flippedY:["isFlippedY","setFlippedY"],offsetX:["_getOffsetX"],offsetY:["_getOffsetY"],textureRectRotated:["isTextureRectRotated"]})},{"../event/event-target":85,"../utils/misc":173}],156:[function(t,e,i){_ccsg.Sprite.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._textureCoord={renderX:0,renderY:0,x:0,y:0,width:0,height:0,validRect:!1},this._blendFuncStr="source-over",this._colorized=!1,this._textureToRender=null};var n=_ccsg.Sprite.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);n.constructor=_ccsg.Sprite.CanvasRenderCmd,n.setDirtyRecursively=function(t){},n._setTexture=function(t){var e=this._node;if(e._texture!==t){e._textureLoaded=!!t&&t.loaded,e._texture=t;var i=cc.rect(0,0,t.width,t.height);e.setTextureRect(i),this._updateColor()}},n._setColorDirty=function(){this.setDirtyFlag(_ccsg.Node._dirtyFlags.colorDirty|_ccsg.Node._dirtyFlags.opacityDirty)},n.isFrameDisplayed=function(t){var e=this._node;return t.getTexture()===e._texture&&cc.rectEqualToRect(t.getRect(),e._rect)},n.updateBlendFunc=function(t){this._blendFuncStr=_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(t)},n._handleTextureForRotatedTexture=function(t,e,i,n){if(i&&t.isLoaded()){var r=t.getHtmlElementObj();r=_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(r,e,n);var o=new cc.Texture2D;o.initWithElement(r),o.handleLoadedTexture(),t=o,e.x=e.y=0,this._node._rect=cc.rect(0,0,e.width,e.height)}return t},n._checkTextureBoundary=function(t,e,i){if(t&&t.url){var n=e.x+e.width,r=e.y+e.height;n>t.width&&cc.errorID(3300,t.url),r>t.height&&cc.errorID(3400,t.url)}},n.rendering=function(t,e,i){var n=this._node,r=this._textureCoord,o=this._displayedOpacity/255,s=this._textureToRender||n._texture;if((!s||0!==r.width&&0!==r.height&&s.loaded)&&0!==o){var a,c,h,l,u,_,d,f,p,g=t||cc._renderContext,m=g.getContext(),v=n._offsetPosition.x,y=n._rect.height,C=n._rect.width,T=-n._offsetPosition.y-y;if(g.setTransform(this._worldTransform,e,i),g.setCompositeOperation(this._blendFuncStr),g.setGlobalAlpha(o),(n._flippedX||n._flippedY)&&g.save(),n._flippedX&&(v=-v-C,m.scale(-1,1)),n._flippedY&&(T=n._offsetPosition.y,m.scale(1,-1)),this._colorized?h=c=0:(c=r.renderX,h=r.renderY),l=r.width,u=r.height,_=v,d=T,f=C,p=y,s&&s._image)a=s._image,""!==s._pattern?(g.setFillStyle(m.createPattern(a,s._pattern)),m.fillRect(_,d,f,p)):m.drawImage(a,c,h,l,u,_,d,f,p);else{var x=n._contentSize;if(r.validRect){var E=this._displayedColor;g.setFillStyle("rgba("+E.r+","+E.g+","+E.b+",1)"),m.fillRect(_,d,x.width,x.height)}}(n._flippedX||n._flippedY)&&g.restore(),cc.g_NumberOfDraws++}},n._updateColor=function(){var t=this._node._texture,e=this._textureCoord,i=this._displayedColor;t&&(255!==i.r||255!==i.g||255!==i.b?(this._textureToRender=t._generateColorTexture(i.r,i.g,i.b,e),this._colorized=!0):t&&(this._textureToRender=t,this._colorized=!1))},n._updateForSetSpriteFrame=function(t,e){if(this._colorized=!1,this._textureCoord.renderX=this._textureCoord.x,this._textureCoord.renderY=this._textureCoord.y,e=e||t.loaded){var i=this._node.getColor();255===i.r&&255===i.g&&255===i.b||this._updateColor()}},n._spriteFrameLoadedCallback=function(t){var e=this._node,i=t.currentTarget;e.setTextureRect(i.getRect(),i.isRotated(),i.getOriginalSize()),this._updateColor(),e.emit("load")},n._textureLoadedCallback=function(t){var e=this._node,i=t.currentTarget;if(!e._textureLoaded){e._textureLoaded=!0;var n=e._rect;n?cc._rectEqualToZero(n)&&(n.width=i.width,n.height=i.height):n=cc.rect(0,0,i.width,i.height),e.texture=i,e.setTextureRect(n,e._rectRotated);var r=this._displayedColor;255===r.r&&255===r.g&&255===r.b||this._updateColor(),e.emit("load")}},n._setTextureCoords=function(t){var e=this._textureCoord;e.renderX=e.x=0|t.x,e.renderY=e.y=0|t.y,e.width=0|t.width,e.height=0|t.height,e.validRect=!(0===e.width||0===e.height||e.x<0||e.y<0)},_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas=function(t,e,i){if(!t)return null;if(!e)return t;i=null==i||i;var n=document.createElement("canvas");n.width=e.width,n.height=e.height;var r=n.getContext("2d");return r.translate(n.width/2,n.height/2),i?r.rotate(-1.5707963267948966):r.rotate(1.5707963267948966),r.drawImage(t,e.x,e.y,e.height,e.width,-e.height/2,-e.width/2,e.height,e.width),n}},{}],157:[function(t,e,i){var u=cc.macro;_ccsg.Sprite.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._vertices=[{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0},{x:0,y:0,u:0,v:0}],this._dirty=!1,this._recursiveDirty=!1,this._shaderProgram=cc.shaderCache.programForKey(u.SHADER_SPRITE_POSITION_TEXTURECOLOR)};var n=_ccsg.Sprite.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);n.constructor=_ccsg.Sprite.WebGLRenderCmd,n.updateBlendFunc=function(t){},n.setDirtyFlag=function(t){_ccsg.Node.WebGLRenderCmd.prototype.setDirtyFlag.call(this,t),this._dirty=!0},n.setDirtyRecursively=function(t){this._recursiveDirty=t,this._dirty=t;for(var e,i=this._node._children,n=i?i.length:0,r=0;r<n;r++)(e=i[r])instanceof _ccsg.Sprite&&e._renderCmd.setDirtyRecursively(t)},n._handleTextureForRotatedTexture=function(t){return t},n.isFrameDisplayed=function(t){var e=this._node;return cc.rectEqualToRect(t.getRect(),e._rect)&&t.getTexture().url===e._texture.url&&cc.pointEqualToPoint(t.getOffset(),e._unflippedOffsetPositionFromCenter)},n._updateForSetSpriteFrame=function(){},n._spriteFrameLoadedCallback=function(t){var e=t.currentTarget;this._node.setTextureRect(e.getRect(),e.isRotated(),e.getOriginalSize()),this._node.emit("load")},n._textureLoadedCallback=function(t){var e=this._node,i=t.currentTarget;if(!e._textureLoaded){e._textureLoaded=!0;var n=e._rect;n?cc._rectEqualToZero(n)&&(n.width=i.width,n.height=i.height):n=cc.rect(0,0,i.width,i.height),e.texture=i,e.setTextureRect(n,e._rectRotated),e.emit("load"),cc.renderer.childrenOrderDirty=!0}},n._setTextureCoords=function(t){var e=this._node,i=e._texture,n=this._vertices;if(i){var r,o,s,a,c,h=i.pixelWidth,l=i.pixelHeight;e._rectRotated?(u.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(o=(r=(2*t.x+1)/(2*h))+(2*t.height-2)/(2*h),a=(s=(2*t.y+1)/(2*l))+(2*t.width-2)/(2*l)):(r=t.x/h,o=(t.x+t.height)/h,s=t.y/l,a=(t.y+t.width)/l),e._flippedX&&(c=s,s=a,a=c),e._flippedY&&(c=r,r=o,o=c),n[0].u=o,n[0].v=s,n[1].u=r,n[1].v=s,n[2].u=o,n[2].v=a,n[3].u=r):(u.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(o=(r=(2*t.x+1)/(2*h))+(2*t.width-2)/(2*h),a=(s=(2*t.y+1)/(2*l))+(2*t.height-2)/(2*l)):(r=t.x/h,o=(t.x+t.width)/h,s=t.y/l,a=(t.y+t.height)/l),e._flippedX&&(c=r,r=o,o=c),e._flippedY&&(c=s,s=a,a=c),n[0].u=r,n[0].v=s,n[1].u=r,n[1].v=a,n[2].u=o,n[2].v=s,n[3].u=o),n[3].v=a}},n._setColorDirty=function(){},n._updateBlendFunc=function(){var t=this._node;t._texture&&t._texture.hasPremultipliedAlpha()?(t._blendFunc.src=u.BLEND_SRC,t._blendFunc.dst=u.BLEND_DST,t.opacityModifyRGB=!0):(t._blendFunc.src=u.SRC_ALPHA,t._blendFunc.dst=u.ONE_MINUS_SRC_ALPHA,t.opacityModifyRGB=!1)},n._setTexture=function(t){var e=this._node;e._texture!==t&&(e._textureLoaded=!!t&&t.loaded,e._texture=t,this._updateBlendFunc(),e._textureLoaded&&(cc.renderer.childrenOrderDirty=!0))},n._checkTextureBoundary=function(t,e,i){var n,r;t&&t.url&&(i?(n=e.x+e.height,r=e.y+e.width):(n=e.x+e.width,r=e.y+e.height),n>t.width&&cc.errorID(3300,t.url),r>t.height&&cc.errorID(3400,t.url))},n.transform=function(t,e){this.originTransform(t,e);var i=this._node,n=i._offsetPosition.x,r=n+i._rect.width,o=i._offsetPosition.y,s=o+i._rect.height,a=this._worldTransform,c=this._vertices;c[0].x=n*a.a+s*a.c+a.tx,c[0].y=n*a.b+s*a.d+a.ty,c[1].x=n*a.a+o*a.c+a.tx,c[1].y=n*a.b+o*a.d+a.ty,c[2].x=r*a.a+s*a.c+a.tx,c[2].y=r*a.b+s*a.d+a.ty,c[3].x=r*a.a+o*a.c+a.tx,c[3].y=r*a.b+o*a.d+a.ty},n.needDraw=function(){var t=this._node._texture;return this._needDraw&&t},n.uploadData=function(t,e,i){var n=this._node,r=n._texture;if(!(r&&r.loaded&&n._rect.width&&n._rect.height&&this._displayedOpacity))return 0;var o,s=this._displayedOpacity,a=this._displayedColor._val;if(n._opacityModifyRGB){var c=s/255,h=this._displayedColor.r*c,l=this._displayedColor.g*c;o=(s<<24>>>0)+(this._displayedColor.b*c<<16)+(l<<8)+h}else o=(s<<24>>>0)+((65280&a)<<8)+((16711680&a)>>8)+(a>>>24);var u,_,d=n._vertexZ,f=this._vertices,p=f.length,g=i;for(u=0;u<p;++u)_=f[u],t[g]=_.x,t[g+1]=_.y,t[g+2]=d,e[g+3]=o,t[g+4]=_.u,t[g+5]=_.v,g+=6;return p}},{}],158:[function(t,e,i){var n=t("../event/event-target");function r(t,e){return t-e}var z,U={_pool:{},_lengths:[],put:function(t){var e=t.length;this._pool[e]?this._pool[e].push(t):(this._pool[e]=[t],this._lengths.push(e),this._lengths.sort(r))},get:function(t){for(var e,i=0;i<this._lengths.length;i++)if(this._lengths[i]>=t){e=this._lengths[i];break}return e?this._pool[e].pop():void 0}},B=cc.macro,o={_rebuildQuads_base:function(t){var e,i,n,r,o=t._spriteFrame,s=t._contentSize,a=t._isTrimmedContentSize,c=t._vertices,h=t._corner;if(a)i=e=0,n=s.width,r=s.height;else{var l=o._originalSize,u=o._rect,_=o._offset,d=s.width,f=s.height,p=l.width,g=l.height,m=u.width,v=u.height,y=d/p,C=f/g,T=_.x+(p-m)/2,x=_.x-(p-m)/2;e=T*y,i=(_.y+(g-v)/2)*C,n=d+x*y,r=f+(_.y-(g-v)/2)*C}if(c.length<8&&(U.put(c),c=U.get(8)||new Float32Array(8),t._vertices=c),z){var E=t._renderCmd._worldTransform,S=E.a,b=E.b,R=E.c,A=E.d,O=E.tx,I=E.ty,w=e*S,L=e*b,N=n*S,P=n*b,D=r*R+O,F=r*A+I,M=i*R+O,B=i*A+I;c[0]=w+M,c[1]=L+B,c[2]=N+M,c[3]=P+B,c[4]=w+D,c[5]=L+F,c[6]=N+D,c[7]=P+F}else c[0]=e,c[1]=i,c[2]=n,c[3]=i,c[4]=e,c[5]=r,c[6]=n,c[7]=r;h[0]=0,h[1]=2,h[2]=4,h[3]=6,t._uvsDirty&&this._calculateUVs(t,o),t._vertCount=4},_calculateUVs:function(t,e){var i,n,r,o,s=t._uvs,a=e._texture.width,c=e._texture.height,h=e._rect;s.length<8&&(U.put(s),s=U.get(8)||new Float32Array(8),t._uvs=s);var l=B.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0;e._rotated?(i=(h.x+l)/a,n=(h.y+h.width-l)/c,r=(h.x+h.height-l)/a,o=(h.y+l)/c,s[0]=i,s[1]=o,s[2]=i,s[3]=n,s[4]=r,s[5]=o,s[6]=r,s[7]=n):(i=(h.x+l)/a,n=(h.y+h.height-l)/c,r=(h.x+h.width-l)/a,o=(h.y+l)/c,s[0]=i,s[1]=n,s[2]=r,s[3]=n,s[4]=i,s[5]=o,s[6]=r,s[7]=o)}},s={x:new Array(4),y:new Array(4),_rebuildQuads_base:function(t){var e,i,n,r,o=t._spriteFrame,s=t._contentSize,a=t._insetLeft,c=t._insetRight,h=t._insetTop,l=t._insetBottom,u=t._vertices,_=t._renderCmd._worldTransform,d=o._rect,f=t._corner;e=a,i=c,d.width,n=h,r=l,d.height;var p=s,g=p.width-e-i,m=p.height-n-r,v=p.width/(e+i),y=p.height/(n+r);v=isNaN(v)||1<v?1:v,y=isNaN(y)||1<y?1:y,g=g<0?0:g,m=m<0?0:m;var C=this.x,T=this.y;C[0]=0,C[1]=e*v,C[2]=C[1]+g,C[3]=p.width,T[0]=0,T[1]=r*y,T[2]=T[1]+m,T[3]=p.height,u.length<32&&(U.put(u),u=U.get(32)||new Float32Array(32),t._vertices=u);var x,E,S=0;if(z)for(x=0;x<4;x++)for(E=0;E<4;E++)u[S]=C[E]*_.a+T[x]*_.c+_.tx,u[S+1]=C[E]*_.b+T[x]*_.d+_.ty,S+=2;else for(x=0;x<4;x++)for(E=0;E<4;E++)u[S]=C[E],u[S+1]=T[x],S+=2;f[0]=0,f[1]=6,f[2]=24,f[3]=30,t._uvsDirty&&this._calculateUVs(t,o,a,c,h,l)},_calculateUVs:function(t,e,i,n,r,o){var s,a,c,h,l,u,_=t._uvs,d=e._rect,f=e._texture.width,p=e._texture.height,g=e._rect;s=i,c=n,a=d.width-s-c,h=r,u=o,l=d.height-h-u,_.length<32&&(U.put(_),_=U.get(32)||new Float32Array(32),t._uvs=_);var m,v,y=this.x,C=this.y,T=B.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0,x=0;if(e._rotated)for(y[0]=(g.x+T)/f,y[1]=(u+g.x)/f,y[2]=(u+l+g.x)/f,y[3]=(g.x+g.height-T)/f,C[3]=(g.y+T)/p,C[2]=(s+g.y)/p,C[1]=(s+a+g.y)/p,C[0]=(g.y+g.width-T)/p,m=0;m<4;m++)for(v=0;v<4;v++)_[x]=y[m],_[x+1]=C[3-v],x+=2;else for(y[0]=(g.x+T)/f,y[1]=(s+g.x)/f,y[2]=(s+a+g.x)/f,y[3]=(g.x+g.width-T)/f,C[3]=(g.y+T)/p,C[2]=(h+g.y)/p,C[1]=(h+l+g.y)/p,C[0]=(g.y+g.height-T)/p,m=0;m<4;m++)for(v=0;v<4;v++)_[x]=y[v],_[x+1]=C[m],x+=2}},a={_rebuildQuads_base:function(t,e,i){e=t._spriteFrame,i=t._contentSize;var n,r,o,s,a=t._vertices,c=t._corner,h=t._renderCmd._worldTransform,l=t._uvs,u=e._texture.width,_=e._texture.height,d=e._rect,f=B.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0;e._rotated?(n=(d.x+f)/u,o=(d.x+d.height-f)/u,r=(d.y+d.width-f)/_):(n=(d.x+f)/u,o=(d.x+d.width-f)/u,r=(d.y+d.height-f)/_),s=(d.y+f)/_;var p=d.width,g=d.height,m=i.width/p,v=i.height/g,y=Math.ceil(v),C=Math.ceil(m);16384<y*C&&cc.errorID(2625);var T=y*C*4*2;a.length<T&&(U.put(a),a=U.get(T)||new Float32Array(T),t._vertices=a),l.length<T&&(U.put(l),l=U.get(T)||new Float32Array(T),t._uvs=l);for(var x,E,S,b,R=0,A=t._vertCount=0;A<y;++A)for(var O=0;O<C;++O){if(x=p*O,E=g*A,S=p*Math.min(O+1,m),b=g*Math.min(A+1,v),z){var I=x*h.a,w=x*h.b,L=S*h.a,N=S*h.b,P=b*h.c+h.tx,D=b*h.d+h.ty,F=E*h.c+h.tx,M=E*h.d+h.ty;a[R]=I+F,a[R+1]=w+M,a[R+2]=L+F,a[R+3]=N+M,a[R+4]=I+P,a[R+5]=w+D,a[R+6]=L+P,a[R+7]=N+D}else a[R]=x,a[R+1]=E,a[R+2]=S,a[R+3]=E,a[R+4]=x,a[R+5]=b,a[R+6]=S,a[R+7]=b;if(e._rotated?(l[R]=n,l[R+1]=s,l[R+2]=n,l[R+3]=b=s+(r-s)*Math.min(1,m-O),l[R+4]=S=n+(o-n)*Math.min(1,v-A),l[R+5]=s):(l[R]=n,l[R+1]=r,l[R+2]=S=n+(o-n)*Math.min(1,m-O),l[R+3]=r,l[R+4]=n,l[R+5]=b=r+(s-r)*Math.min(1,v-A)),l[R+6]=S,l[R+7]=b,R+=8,t._vertCount+=4,T<R)return}c[0]=0,c[1]=8*(C-1)+2,c[2]=(y-1)*C*8+4,c[3]=T-2}},c={_rebuildQuads_base:function(t){var e=t._spriteFrame,i=t._contentSize,n=t._fillStart,r=t._fillRange;r<0&&(n+=r,r=-r),r=(r=1<(r=n+r)?1:r)<0?0:r,r-=n=(n=1<n?1:n)<0?0:n;var o,s,a,c,h,l=t._fillType,u=t._vertices,_=t._corner,d=t._renderCmd._worldTransform,f=t._uvs,p=0,g=0,m=i.width,v=i.height,y=e._texture.width,C=e._texture.height,T=e._rect,x=B.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0;e._rotated?(s=(T.x+x)/y,a=(T.y+T.width-x)/C,c=(T.x+T.height-x)/y):(s=(T.x+x)/y,a=(T.y+T.height-x)/C,c=(T.x+T.width-x)/y),h=(T.y+x)/C,u.length<8&&(U.put(u),u=U.get(8)||new Float32Array(8),t._vertices=u),f.length<8&&(U.put(f),f=U.get(8)||new Float32Array(8),t._uvs=f);var E,S=new Array(8);switch(e._rotated?(S[0]=S[2]=s,S[4]=S[6]=c,S[3]=S[7]=a,S[1]=S[5]=h):(S[0]=S[4]=s,S[2]=S[6]=c,S[1]=S[3]=a,S[5]=S[7]=h),o=1<(o=(n=(n=1<n?1:n)<0?0:n)+(r=r<0?0:r))?1:o,l){case P.HORIZONTAL:E=p+(m-p)*o,p+=(m-p)*n,m=E,f[0]=S[0]+(S[2]-S[0])*n,f[1]=S[1],f[2]=S[0]+(S[2]-S[0])*o,f[3]=S[3],f[4]=S[4]+(S[6]-S[4])*n,f[5]=S[5],f[6]=S[4]+(S[6]-S[4])*o,f[7]=S[7];break;case P.VERTICAL:E=g+(v-g)*o,g+=(v-g)*n,v=E,f[0]=S[0],f[1]=S[1]+(S[5]-S[1])*n,f[2]=S[2],f[3]=S[3]+(S[7]-S[3])*n,f[4]=S[4],f[5]=S[1]+(S[5]-S[1])*o,f[6]=S[6],f[7]=S[3]+(S[7]-S[3])*o;break;default:cc.errorID(2626)}if(z){var b=p*d.a,R=p*d.b,A=m*d.a,O=m*d.b,I=v*d.c+d.tx,w=v*d.d+d.ty,L=g*d.c+d.tx,N=g*d.d+d.ty;u[0]=b+L,u[1]=R+N,u[2]=A+L,u[3]=O+N,u[4]=b+I,u[5]=R+w,u[6]=A+I,u[7]=O+w}else u[0]=p,u[1]=g,u[2]=m,u[3]=g,u[4]=p,u[5]=v,u[6]=m,u[7]=v;t._vertCount=4,_[0]=0,_[1]=2,_[2]=4,_[3]=6}},h={_vertPos:[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],_vertices:[cc.v2(0,0),cc.v2(0,0)],_uvs:[cc.v2(0,0),cc.v2(0,0)],_intersectPoint_1:[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],_intersectPoint_2:[cc.v2(0,0),cc.v2(0,0),cc.v2(0,0),cc.v2(0,0)],outVerts:null,outUvs:null,rawVerts:null,rawUvs:null,_rebuildQuads_base:function(t){var e=t._spriteFrame,i=t._contentSize,n=t._fillStart,r=t._fillRange;r<0&&(n+=r,r=-r),t._isTriangle=!0,t._rawVerts||(t._rawVerts=U.get(8)||new Float32Array(8),t._rawUvs=U.get(8)||new Float32Array(8));for(var o=t._fillCenter,s=t._vertices,a=t._corner,c=t._uvs,h=t._rawVerts,l=t._rawUvs,u=t._renderCmd._worldTransform;1<=n;)n-=1;for(;n<0;)n+=1;var _=o.x*i.width,d=o.y*i.height,f=cc.v2(_,d),p=(n*=2*Math.PI)+(r*=2*Math.PI);this.outVerts=s,this.outUvs=c,this.rawVerts=h,this.rawUvs=l,this._calculateVertices(u,e,i),this._calculateUVs(e);var g=this._vertPos,m=this._vertices;g[0].x=g[3].x=m[0].x,g[1].x=g[2].x=m[1].x,g[0].y=g[1].y=m[0].y,g[2].y=g[3].y=m[1].y,f.x>m[1].x&&(f.x=m[1].x),f.x<m[0].x&&(f.x=m[0].x),f.y<m[0].y&&(f.y=m[0].y),f.y>m[1].y&&(f.y=m[1].y),h[0]=h[4]=this._vertices[0].x,h[2]=h[6]=this._vertices[1].x,h[1]=h[3]=this._vertices[0].y,h[5]=h[7]=this._vertices[1].y,e._rotated?(l[0]=l[2]=this._uvs[0].x,l[4]=l[6]=this._uvs[1].x,l[3]=l[7]=this._uvs[0].y,l[1]=l[5]=this._uvs[1].y):(l[0]=l[4]=this._uvs[0].x,l[2]=l[6]=this._uvs[1].x,l[1]=l[3]=this._uvs[0].y,l[5]=l[7]=this._uvs[1].y);var v=[null,null,null,null];f.x!==this._vertices[0].x&&(v[0]=[3,0]),f.x!==this._vertices[1].x&&(v[2]=[1,2]),f.y!==this._vertices[0].y&&(v[1]=[0,1]),f.y!==this._vertices[1].y&&(v[3]=[2,3]),this._getInsectedPoints(this._vertices[0].x,this._vertices[1].x,this._vertices[0].y,this._vertices[1].y,f,n,this._intersectPoint_1),this._getInsectedPoints(this._vertices[0].x,this._vertices[1].x,this._vertices[0].y,this._vertices[1].y,f,n+r,this._intersectPoint_2),s.length<30&&(U.put(s),s=U.get(30)||new Float32Array(30),this.outVerts=t._vertices=s),c.length<30&&(U.put(c),c=U.get(30)||new Float32Array(30),this.outUvs=t._uvs=c);for(var y=0,C=0,T=0;T<4;++T){var x=v[T];if(null!==x)if(r>=2*Math.PI)this._generateTriangle(u,y,f,this._vertPos[x[0]],this._vertPos[x[1]]),y+=6,C+=3;else{var E=this._getVertAngle(f,this._vertPos[x[0]]),S=this._getVertAngle(f,this._vertPos[x[1]]);S<E&&(S+=2*Math.PI),E-=2*Math.PI,S-=2*Math.PI;for(var b=0;b<3;++b)p<=E||(n<=E?(p<=S?this._generateTriangle(u,y,f,this._vertPos[x[0]],this._intersectPoint_2[T]):this._generateTriangle(u,y,f,this._vertPos[x[0]],this._vertPos[x[1]]),y+=6,C+=3):S<=n||(S<=p?this._generateTriangle(u,y,f,this._intersectPoint_1[T],this._vertPos[x[1]]):this._generateTriangle(u,y,f,this._intersectPoint_1[T],this._intersectPoint_2[T]),y+=6,C+=3)),E+=2*Math.PI,S+=2*Math.PI}}t._vertCount=C;for(var R,A,O=1/0,I=1/0,w=-1/0,L=-1/0,N=0,P=y;N<P;N+=2)R=s[N],A=s[N+1],R<=O?(O=R,a[0]=N):w<=R&&(w=R,a[1]=N),A<=I?(I=A,a[2]=N):L<=A&&(L=A,a[3]=N)},_generateTriangle:function(t,e,i,n,r){var o,s,a=this.rawVerts,c=this.rawUvs,h=this.outVerts,l=a[0],u=a[1],_=a[6],d=a[7];z?(h[e]=i.x*t.a+i.y*t.c+t.tx,h[e+1]=i.x*t.b+i.y*t.d+t.ty,h[e+2]=n.x*t.a+n.y*t.c+t.tx,h[e+3]=n.x*t.b+n.y*t.d+t.ty,h[e+4]=r.x*t.a+r.y*t.c+t.tx,h[e+5]=r.x*t.b+r.y*t.d+t.ty):(h[e]=i.x,h[e+1]=i.y,h[e+2]=n.x,h[e+3]=n.y,h[e+4]=r.x,h[e+5]=r.y),o=(i.x-l)/(_-l),s=(i.y-u)/(d-u),this._generateUV(o,s,c,e),o=(n.x-l)/(_-l),s=(n.y-u)/(d-u),this._generateUV(o,s,c,e+2),o=(r.x-l)/(_-l),s=(r.y-u)/(d-u),this._generateUV(o,s,c,e+4)},_generateUV:function(t,e,i,n){var r=this.outUvs,o=i[0]+(i[2]-i[0])*t,s=i[4]+(i[6]-i[4])*t,a=i[1]+(i[3]-i[1])*t,c=i[5]+(i[7]-i[5])*t;r[n]=o+(s-o)*e,r[n+1]=a+(c-a)*e},_isAngleIn:function(t,e,i){for(var n=2*Math.PI;t<e||e+n<=t;)t<e&&(t+=n),e+n<=t&&(t-=n);return t<=e+i},_getVertAngle:function(t,e){var i,n;if(i=e.x-t.x,n=e.y-t.y,0!==i||0!==n){if(0===i)return 0<n?.5*Math.PI:1.5*Math.PI;var r=Math.atan(n/i);return i<0&&(r+=Math.PI),r}},_getInsectedPoints:function(t,e,i,n,r,o,s){var a,c,h=Math.sin(o),l=Math.cos(o);if(0!==Math.cos(o)){if(a=h/l,0<(t-r.x)*l){var u=r.y+a*(t-r.x);s[0].x=t,s[0].y=u}if(0<(e-r.x)*l){var _=r.y+a*(e-r.x);s[2].x=e,s[2].y=_}}if(0!==Math.sin(o)){if(c=l/h,0<(n-r.y)*h){var d=r.x+c*(n-r.y);s[3].x=d,s[3].y=n}if(0<(i-r.y)*h){var f=r.x+c*(i-r.y);s[1].x=f,s[1].y=i}}return[null,null,null,null]},_calculateVertices:function(t,e,i){var n,r;n=i.width,r=i.height,this._vertices[0].x=0,this._vertices[0].y=0,this._vertices[1].x=n,this._vertices[1].y=r},_calculateUVs:function(t){var e,i,n,r,o=t._texture.width,s=t._texture.height,a=t._rect,c=B.FIX_ARTIFACTS_BY_STRECHING_TEXEL?.5:0;t._rotated?(e=(a.x+c)/o,i=(a.x+a.height-c)/o,n=(a.y+c)/s,r=(a.y+a.width-c)/s):(e=(a.x+c)/o,i=(a.x+a.width-c)/o,n=(a.y+c)/s,r=(a.y+a.height-c)/s),this._uvs[0].x=e,this._uvs[0].y=r,this._uvs[1].x=i,this._uvs[1].y=n}},l={_rebuildQuads_base:function(t,e,i){if(cc._renderType!==cc.game.RENDER_TYPE_CANVAS&&(t._spriteFrame,i=t._meshPolygonInfo)){var n=t._renderCmd._worldTransform,r=i.triangles.verts,o=t._vertices,s=t._uvs,a=r.length,c=t._corner,h=2*a;o.length<h&&(U.put(o),o=U.get(h)||new Float32Array(h),t._vertices=o),s.length<h&&(U.put(s),s=U.get(h)||new Float32Array(h),t._uvs=s);for(var l=1/0,u=1/0,_=-1/0,d=-1/0,f=0;f<a;f++){var p=r[f].x*n.a+r[f].y*n.c+n.tx,g=r[f].x*n.b+r[f].y*n.d+n.ty;o[2*f]=p,o[2*f+1]=g,s[2*f]=r[f].u,s[2*f+1]=r[f].v,p<l&&(l=p,c[0]=2*f),_<p&&(_=p,c[1]=2*f),g<u&&(u=g,c[2]=2*f),d<g&&(d=g,c[3]=2*f)}t._vertCount=a}}};cc.Scale9Sprite=_ccsg.Node.extend({_spriteFrame:null,_insetLeft:0,_insetRight:0,_insetTop:0,_insetBottom:0,_blendFunc:null,_renderingType:1,_brightState:0,_rawVerts:null,_rawUvs:null,_vertices:null,_uvs:null,_vertCount:0,_quadsDirty:!0,_uvsDirty:!0,_isTriangle:!1,_isTrimmedContentSize:!0,_fillType:0,_fillCenter:null,_fillStart:0,_fillRange:2*Math.PI,_distortionOffset:null,_distortionTiling:null,_meshPolygonInfo:null,ctor:function(t){_ccsg.Node.prototype.ctor.call(this),this._renderCmd.setState(this._brightState),this._blendFunc=cc.BlendFunc._alphaNonPremultiplied(),this._fillCenter=cc.v2(0,0),this.setAnchorPoint(cc.p(.5,.5)),this._rawVerts=null,this._rawUvs=null,this._vertices=U.get(8)||new Float32Array(8),this._uvs=U.get(8)||new Float32Array(8),"string"==typeof t||t instanceof cc.Texture2D?this.initWithTexture(t):t instanceof cc.SpriteFrame&&this.initWithSpriteFrame(t),void 0===z&&(z=cc._renderType===cc.game.RENDER_TYPE_WEBGL),this._corner=[]},loaded:function(){return null!==this._spriteFrame&&this._spriteFrame.textureLoaded()},initWithTexture:function(t){this.setTexture(t)},initWithSpriteFrame:function(t){this.setSpriteFrame(t)},setTexture:function(t){var e=new cc.SpriteFrame(t);this.setSpriteFrame(e)},setSpriteFrame:function(t){if(t){this._spriteFrame=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd._needDraw=!1;var e=this,i=function(){e._spriteFrame&&cc.sizeEqualToSize(e._contentSize,cc.size(0,0))&&e.setContentSize(e._spriteFrame._rect),e._renderCmd._needDraw=!0,e._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)};t.textureLoaded()?i():t.once("load",i,this)}},setBlendFunc:function(t,e){void 0===e?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.dst=e),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},setContentSize:function(t,e){void 0===e&&(e=t.height,t=t.width),t===this._contentSize.width&&e===this._contentSize.height||(_ccsg.Node.prototype.setContentSize.call(this,t,e),this._quadsDirty=!0)},enableTrimmedContentSize:function(t){this._isTrimmedContentSize!==t&&(this._isTrimmedContentSize=t,this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty))},isTrimmedContentSizeEnabled:function(){return this._isTrimmedContentSize},setState:function(t){this._brightState=t,this._renderCmd.setState(t),this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getState:function(){return this._brightState},setRenderingType:function(t){this._renderingType!==t&&(this._renderingType=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty))},getRenderingType:function(){return this._renderingType},setInsetLeft:function(t){this._insetLeft=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetLeft:function(){return this._insetLeft},setInsetTop:function(t){this._insetTop=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetTop:function(){return this._insetTop},setInsetRight:function(t){this._insetRight=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetRight:function(){return this._insetRight},setInsetBottom:function(t){this._insetBottom=t,this._quadsDirty=!0,this._uvsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)},getInsetBottom:function(){return this._insetBottom},setFillType:function(t){this._fillType!==t&&(this._fillType=t,this._renderingType===_.FILLED&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)))},getFillType:function(){return this._fillType},setFillCenter:function(t,e){this._fillCenter=cc.v2(t,e),this._renderingType===_.FILLED&&this._fillType===P.RADIAL&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty))},setDistortionTiling:function(t,e){void 0===e&&(e=t.y,t=t.x),this._distortionTiling=this._distortionTiling||cc.v2(0,0),this._distortionTiling.x=t,this._distortionTiling.y=e},setDistortionOffset:function(t,e){void 0===e&&(e=t.y,t=t.x),this._distortionOffset=this._distortionOffset||cc.v2(0,0),this._distortionOffset.x=t,this._distortionOffset.y=e},getFillCenter:function(){return cc.v2(this._fillCenter)},setFillStart:function(t){this._fillStart!==t&&(this._fillStart=t,this._renderingType===_.FILLED&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)))},getFillStart:function(){return this._fillStart},setFillRange:function(t){this._fillRange!==t&&(this._fillRange=t,this._renderingType===_.FILLED&&(this._quadsDirty=!0,this._renderCmd.setDirtyFlag(_ccsg.Node._dirtyFlags.contentDirty)))},getFillRange:function(){return this._fillRange},_rebuildQuads:function(){if(this._spriteFrame&&this._spriteFrame._textureLoaded){var t;switch(this._isTriangle=!1,this._renderingType){case _.SIMPLE:t=o;break;case _.SLICED:t=s;break;case _.TILED:t=a;break;case _.FILLED:t=this._fillType===P.RADIAL?h:c;break;case _.MESH:t=l}t?t._rebuildQuads_base(this):(this._quadsDirty=!1,this._uvsDirty=!1,this._renderCmd._needDraw=!1,cc.errorID(2627)),this._quadsDirty=!1,this._uvsDirty=!1}else this._renderCmd._needDraw=!1},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.Scale9Sprite.CanvasRenderCmd(this):new cc.Scale9Sprite.WebGLRenderCmd(this)},setMeshPolygonInfo:function(t){this.setRenderingType(_.MESH),this._meshPolygonInfo=t,this._quadsDirty=!0,this._uvsDirty=!0},getMeshPolygonInfo:function(){return this._meshPolygonInfo}});var u=cc.Scale9Sprite.prototype;cc.js.addon(u,n.prototype),cc.defineGetterSetter(u,"insetLeft",u.getInsetLeft,u.setInsetLeft),cc.defineGetterSetter(u,"insetTop",u.getInsetTop,u.setInsetTop),cc.defineGetterSetter(u,"insetRight",u.getInsetRight,u.setInsetRight),cc.defineGetterSetter(u,"insetBottom",u.getInsetBottom,u.setInsetBottom),cc.Scale9Sprite.state={NORMAL:0,GRAY:1,DISTORTION:2};var _=cc.Scale9Sprite.RenderingType=cc.Enum({SIMPLE:0,SLICED:1,TILED:2,FILLED:3,MESH:4}),P=cc.Scale9Sprite.FillType=cc.Enum({HORIZONTAL:0,VERTICAL:1,RADIAL:2})},{"../event/event-target":85}],159:[function(t,e,i){cc.Scale9Sprite.CanvasRenderCmd=function(t){this._rootCtor(t),this._node.loaded()?this._needDraw=!0:this._needDraw=!1,this._state=cc.Scale9Sprite.state.NORMAL,this._originalTexture=this._textureToRender=null};var n=cc.Scale9Sprite.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);n.constructor=cc.Scale9Sprite.CanvasRenderCmd,n.updateTransform=function(t){this.originUpdateTransform(t),this._node._rebuildQuads()},n._doCulling=function(){var t=cc.visibleRect,e=this._currentRegion,i=e._minX,n=e._maxX,r=e._minY,o=e._maxY,s=t.left.x,a=t.right.x,c=t.top.y,h=t.bottom.y;this._needDraw=!(n<s||a<i||o<h||c<r)},n._updateDisplayColor=function(t){_ccsg.Node.WebGLRenderCmd.prototype._updateDisplayColor.call(this,t),this._originalTexture=this._textureToRender=null},n._syncDisplayColor=function(t){_ccsg.Node.WebGLRenderCmd.prototype._syncDisplayColor.call(this,t),this._originalTexture=this._textureToRender=null},n.setState=function(t){this._state!==t&&(this._state=t,this._originalTexture=this._textureToRender=null)},n.rendering=function(t,e,i){var n=this._node,r=this._displayedOpacity,o=r/255,s=null;if(n._spriteFrame&&(s=n._spriteFrame._texture),n.loaded()&&0!==r){if((null===this._textureToRender||this._originalTexture!==s)&&(this._textureToRender=this._originalTexture=s,cc.Scale9Sprite.state.GRAY===this._state&&(this._textureToRender=this._textureToRender._generateGrayTexture()),cc.sys.browserType!==cc.sys.BROWSER_TYPE_WECHAT_GAME_SUB)){var a=n.getDisplayedColor();!s||255===a.r&&255===a.g&&255===a.b||(this._textureToRender=this._textureToRender._generateColorTexture(a.r,a.g,a.b))}var c=t||cc._renderContext,h=c.getContext();if(c.setTransform(this._worldTransform,e,i),c.setCompositeOperation(_ccsg.Node.CanvasRenderCmd._getCompositeOperationByBlendFunc(n._blendFunc)),c.setGlobalAlpha(o),this._textureToRender){var l,u,_,d,f,p,g,m;n._quadsDirty&&n._rebuildQuads();var v=this._textureToRender.width,y=this._textureToRender.height,C=this._textureToRender._image,T=n._vertices,x=n._uvs,E=0,S=0;if(n._isTriangle){var b=n._rawVerts,R=n._rawUvs;f=b[0],p=b[1],g=b[6]-f,p=-p-(m=b[7]-p),l=R[4]*v,u=R[5]*y,_=(R[6]-R[0])*v,d=(R[1]-R[7])*y,c.save(),h.beginPath();var A=Math.floor(n._vertCount/3);for(S=E=0;E<A;E++)h.moveTo(T[S++],-T[S++]),h.lineTo(T[S++],-T[S++]),h.lineTo(T[S++],-T[S++]);h.clip(),""!==this._textureToRender._pattern?(c.setFillStyle(h.createPattern(C,this._textureToRender._pattern)),h.fillRect(f,p,g,m)):0<_&&0<d&&0<g&&0<m&&h.drawImage(C,l,u,_,d,f,p,g,m),c.restore(),cc.g_NumberOfDraws+=A}else if(n._renderingType===cc.Scale9Sprite.RenderingType.SLICED){for(var O=0;O<3;++O)for(var I=0;I<3;++I)f=T[S=8*O+2*I],p=T[S+1],g=T[S+10]-f,p=-p-(m=T[S+11]-p),l=x[S]*v,u=x[S+11]*y,_=(x[S+10]-x[S])*v,d=(x[S+1]-x[S+11])*y,0<_&&0<d&&0<g&&0<m&&h.drawImage(C,l,u,_,d,f,p,g,m);cc.g_NumberOfDraws+=9}else{var w=Math.floor(n._vertCount/4);for(S=E=0;E<w;E++)f=T[S],p=T[S+1],g=T[S+6]-f,p=-p-(m=T[S+7]-p),l=x[S]*v,u=x[S+7]*y,_=(x[S+6]-x[S])*v,d=(x[S+1]-x[S+7])*y,""!==this._textureToRender._pattern?(c.setFillStyle(h.createPattern(C,this._textureToRender._pattern)),h.fillRect(f,p,g,m)):0<_&&0<d&&0<g&&0<m&&h.drawImage(C,l,u,_,d,f,p,g,m),S+=8;cc.g_NumberOfDraws+=w}}}}},{}],160:[function(t,e,i){cc.gl,cc.Scale9Sprite.WebGLRenderCmd=function(t){this._rootCtor(t),this._node.loaded()?this._needDraw=!0:this._needDraw=!1,this.vertexType=cc.renderer.VertexType.QUAD,this._dirty=!1,this._shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_SPRITE_POSITION_TEXTURECOLOR)};var v=cc.Scale9Sprite,n=v.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);n.constructor=v.WebGLRenderCmd,n._uploadSliced=function(t,e,i,n,r,o,s){for(var a,c=0;c<3;++c)for(var h=0;h<3;++h)a=8*c+2*h,r[s]=t[a],r[s+1]=t[a+1],r[s+2]=n,o[s+3]=i,r[s+4]=e[a],r[s+5]=e[a+1],r[s+=6]=t[a+2],r[s+1]=t[a+3],r[s+2]=n,o[s+3]=i,r[s+4]=e[a+2],r[s+5]=e[a+3],r[s+=6]=t[a+8],r[s+1]=t[a+9],r[s+2]=n,o[s+3]=i,r[s+4]=e[a+8],r[s+5]=e[a+9],r[s+=6]=t[a+10],r[s+1]=t[a+11],r[s+2]=n,o[s+3]=i,r[s+4]=e[a+10],r[s+5]=e[a+11],s+=6;return 36},n.updateTransform=function(t){this.originUpdateTransform(t),this._node._rebuildQuads()},n._doCulling=function(){var t=this._node,e=cc.visibleRect;0<this._cameraFlag&&(e=cc.Camera.main.visibleRect);var i=e.left.x,n=e.right.x,r=e.top.y,o=e.bottom.y,s=t._vertices,a=t._corner,c=a[0],h=a[1],l=a[2],u=a[3],_=s[c],d=s[h],f=s[l],p=s[u],g=s[c+1],m=s[h+1],v=s[l+1],y=s[u+1];this._needDraw=!((_-i&d-i&f-i&p-i)>>31||(n-_&n-d&n-f&n-p)>>31||(g-o&m-o&v-o&y-o)>>31||(r-g&r-m&r-v&r-y)>>31)},n.uploadData=function(t,e,i){var n=this._node;if(0===this._displayedOpacity)return 0;n._quadsDirty&&n._rebuildQuads(),n._distortionOffset&&this._shaderProgram===v.WebGLRenderCmd._distortionProgram&&(this._shaderProgram.use(),this._shaderProgram.setUniformLocationWith2f(v.WebGLRenderCmd._distortionOffset,n._distortionOffset.x,n._distortionOffset.y),this._shaderProgram.setUniformLocationWith2f(v.WebGLRenderCmd._distortionTiling,n._distortionTiling.x,n._distortionTiling.y),cc.renderer._breakBatch());var r,o=this._displayedOpacity,s=this._displayedColor._val;if(n._opacityModifyRGB){var a=o/255,c=this._displayedColor.r*a,h=this._displayedColor.g*a;r=(o<<24>>>0)+(this._displayedColor.b*a<<16)+(h<<8)+c}else r=(o<<24>>>0)+((65280&s)<<8)+((16711680&s)>>8)+(s>>>24);var l=n._vertexZ,u=n._vertices,_=n._uvs,d=v.RenderingType,f=i,p=0;switch(n._renderingType){case d.SIMPLE:case d.TILED:case d.FILLED:case d.MESH:p=this._node._vertCount;for(var g=0,m=0;g<p;g++,m+=2)t[f]=u[m],t[f+1]=u[m+1],t[f+2]=l,e[f+3]=r,t[f+4]=_[m],t[f+5]=_[m+1],f+=6;break;case d.SLICED:p=this._uploadSliced(u,_,r,l,t,e,f)}return n._renderingType===d.MESH?this.vertexType=cc.renderer.VertexType.CUSTOM:n._renderingType===d.FILLED&&n._fillType===v.FillType.RADIAL?this.vertexType=cc.renderer.VertexType.TRIANGLE:this.vertexType=cc.renderer.VertexType.QUAD,p},n.uploadIndexData=function(t,e,i){var n=this._node._meshPolygonInfo;if(!n)return 0;for(var r=n.triangles.indices,o=r.length,s=0;s<o;s++)t[e+s]=i+r[s];return o},n.setState=function(t){t===v.state.NORMAL?this._shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_SPRITE_POSITION_TEXTURECOLOR):t===v.state.GRAY?this._shaderProgram=cc.Scale9Sprite.WebGLRenderCmd._getGrayShaderProgram():t===v.state.DISTORTION&&(this._shaderProgram=cc.Scale9Sprite.WebGLRenderCmd._getDistortionProgram())},v.WebGLRenderCmd._grayShaderProgram=null,v.WebGLRenderCmd._getGrayShaderProgram=function(){var t=v.WebGLRenderCmd._grayShaderProgram;return t||((t=new cc.GLProgram).initWithVertexShaderByteArray(cc.PresetShaders.SPRITE_POSITION_TEXTURE_COLOR_VERT,cc.Scale9Sprite.WebGLRenderCmd._grayShaderFragment),t.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION,cc.macro.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR,cc.macro.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD,cc.macro.VERTEX_ATTRIB_TEX_COORDS),t.link(),t.updateUniforms(),v.WebGLRenderCmd._grayShaderProgram=t)},v.WebGLRenderCmd._grayShaderFragment="precision lowp float;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nvoid main()\n{\nvec4 c = v_fragmentColor * texture2D(CC_Texture0, v_texCoord);\nfloat gray = 0.2126*c.r + 0.7152*c.g + 0.0722*c.b;\ngl_FragColor = vec4(gray, gray, gray, c.a);\n}",v.WebGLRenderCmd._distortionProgram=null,v.WebGLRenderCmd._getDistortionProgram=function(){var t=v.WebGLRenderCmd._distortionProgram;return t||((t=new cc.GLProgram).initWithVertexShaderByteArray(cc.PresetShaders.SPRITE_POSITION_TEXTURE_COLOR_VERT,r.fShader),t.addAttribute(cc.macro.ATTRIBUTE_NAME_POSITION,cc.macro.VERTEX_ATTRIB_POSITION),t.addAttribute(cc.macro.ATTRIBUTE_NAME_COLOR,cc.macro.VERTEX_ATTRIB_COLOR),t.addAttribute(cc.macro.ATTRIBUTE_NAME_TEX_COORD,cc.macro.VERTEX_ATTRIB_TEX_COORDS),t.link(),t.updateUniforms(),v.WebGLRenderCmd._distortionProgram=t,v.WebGLRenderCmd._distortionOffset=t.getUniformLocationForName("u_offset"),v.WebGLRenderCmd._distortionTiling=t.getUniformLocationForName("u_offset_tiling"),t)};var r={shaderKey:"cc.Sprite.Shader.Distortion",fShader:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nuniform vec2 u_offset;\nuniform vec2 u_offset_tiling;\nconst float PI = 3.14159265359;\nvoid main()\n{\nfloat halfPI = 0.5 * PI;\nfloat maxFactor = sin(halfPI);\nvec2 uv = v_texCoord;\nvec2 xy = 2.0 * uv.xy - 1.0;\nfloat d = length(xy);\nif (d < (2.0-maxFactor)) {\nd = length(xy * maxFactor);\nfloat z = sqrt(1.0 - d * d);\nfloat r = atan(d, z) / PI;\nfloat phi = atan(xy.y, xy.x);\nuv.x = r * cos(phi) + 0.5;\nuv.y = r * sin(phi) + 0.5;\n} else {\ndiscard;\n}\nuv = uv * u_offset_tiling + u_offset;\nuv = fract(uv);\ngl_FragColor = v_fragmentColor * texture2D(CC_Texture0, uv);\n}"}},{}],161:[function(t,e,i){cc.SpriteBatchNode=_ccsg.Node.extend({_blendFunc:null,_texture:null,_className:"SpriteBatchNode",ctor:function(t){var e;_ccsg.Node.prototype.ctor.call(this),this._blendFunc=new cc.BlendFunc(cc.macro.BLEND_SRC,cc.macro.BLEND_DST),cc.js.isString(t)?(e=cc.textureCache.getTextureForKey(t))||(e=cc.textureCache.addImage(t)):t instanceof cc.Texture2D&&(e=t),e&&this.initWithTexture(e)},initWithFile:function(t){var e=cc.textureCache.getTextureForKey(t)||cc.textureCache.addImage(t);return this.initWithTexture(e)},removeChildAtIndex:function(t,e){this.removeChild(this._children[t],e)},setBlendFunc:function(t,e){this._blendFunc=void 0===e?t:{src:t,dst:e}},getBlendFunc:function(){return new cc.BlendFunc(this._blendFunc.src,this._blendFunc.dst)},updateQuadFromSprite:function(t,e){cc.assertID(t,2623),t instanceof _ccsg.Sprite?(t.dirty=!0,t._renderCmd.transform(this._renderCmd,!0)):cc.log(2616)},appendChild:function(t){this.sortAllChildren();var e=this._children[this._children.length-1]._localZOrder;this.addChild(t,e+1)},initWithTexture:function(t){return this.setTexture(t),!0},getTexture:function(){return this._texture},setTexture:function(n){if((this._texture=n).loaded){var t,e=this._children,i=e.length;for(t=0;t<i;++t)e[t].setTexture(n)}else n.addEventListener("load",function(){var t,e=this._children,i=e.length;for(t=0;t<i;++t)e[t].setTexture(n)},this)},setShaderProgram:function(t){this._renderCmd.setShaderProgram(t);var e,i=this._children,n=i.length;for(e=0;e<n;++e)i[e].setShaderProgram(t)},addChild:function(t,e,i){cc.assertID(void 0!==t,2614),this._isValidChild(t)&&(e=void 0===e?t.zIndex:e,i=void 0===i?t.tag:i,_ccsg.Node.prototype.addChild.call(this,t,e,i),this._renderCmd._shaderProgram&&(t.shaderProgram=this._renderCmd._shaderProgram))},_isValidChild:function(t){return t instanceof _ccsg.Sprite?t.texture===this._texture||(cc.logID(2619),!1):(cc.logID(2618),!1)}});var n=cc.SpriteBatchNode.prototype;cc.defineGetterSetter(n,"texture",n.getTexture,n.setTexture),cc.defineGetterSetter(n,"shaderProgram",n.getShaderProgram,n.setShaderProgram)},{}],162:[function(t,e,i){var n=t("../event/event-target");cc.SpriteFrame=cc.Class({name:"cc.SpriteFrame",extends:t("../assets/CCAsset"),mixins:[n],properties:{_textureFilenameSetter:{set:function(t){(this._textureFilename=t)&&this._loadTexture()}}},ctor:function(){var t=arguments[0],e=arguments[1],i=arguments[2],n=arguments[3],r=arguments[4];this._rect=null,this._offset=null,this._originalSize=null,this._rotated=!1,this.insetTop=0,this.insetBottom=0,this.insetLeft=0,this.insetRight=0,this._texture=null,this._textureFilename="",this._textureLoaded=!1,void 0!==t&&this.initWithTexture(t,e,i,n,r)},textureLoaded:function(){return this._textureLoaded},addLoadedEventListener:function(t,e){this.once("load",t,e)},isRotated:function(){return this._rotated},setRotated:function(t){this._rotated=t},getRect:function(){return cc.rect(this._rect)},setRect:function(t){this._rect=t},getOriginalSize:function(){return cc.size(this._originalSize)},setOriginalSize:function(t){this._originalSize?(this._originalSize.width=t.width,this._originalSize.height=t.height):this._originalSize=cc.size(t)},getTexture:function(){return this._texture},_refreshTexture:function(r){var o=this;if(o._texture!==r){var t=r.loaded;function e(){if(o._texture){o._textureLoaded=!0;var t=r.width,e=r.height;if(o._rotated&&cc._renderType===cc.game.RENDER_TYPE_CANVAS){var i=r.getHtmlElementObj();i=_ccsg.Sprite.CanvasRenderCmd._cutRotateImageToCanvas(i,o.getRect());var n=new cc.Texture2D;n.initWithElement(i),n.handleLoadedTexture(),o._texture=n,o._rotated=!1,t=o._texture.width,e=o._texture.height,o.setRect(cc.rect(0,0,t,e))}o._rect?o._checkRect(o._texture):o.setRect(cc.rect(0,0,t,e)),o._originalSize||o.setOriginalSize(cc.size(t,e)),o._offset||o.setOffset(cc.v2(0,0)),o.emit("load")}}this._textureLoaded=t,this._texture=r,t?e():r.once("load",e)}},getOffset:function(){return cc.v2(this._offset)},setOffset:function(t){this._offset=cc.v2(t)},clone:function(){return new cc.SpriteFrame(this._texture||this._textureFilename,this._rect,this._rotated,this._offset,this._originalSize)},setTexture:function(t,e,i,n,r){e?this.setRect(e):this._rect=null,n?this.setOffset(n):this._offset=null,r?this.setOriginalSize(r):this._originalSize=null,this._rotated=i||!1;var o=t;return cc.js.isString(o)?(this._textureFilename=o,this._loadTexture()):o instanceof cc.Texture2D&&this._refreshTexture(o),!0},_loadTexture:function(){if(this._textureFilename){var t=cc.textureCache.addImage(this._textureFilename);this._refreshTexture(t)}},ensureLoadTexture:function(){this._texture||this._loadTexture()},clearTexture:function(){this._textureLoaded=!1,this._texture=null},_checkRect:function(t){var e=this._rect,i=e.x,n=e.y;this._rotated?(i+=e.height,n+=e.width):(i+=e.width,n+=e.height),i>t.getPixelWidth()&&cc.errorID(3300,t.url+"/"+this.name),n>t.getPixelHeight()&&cc.errorID(3400,t.url+"/"+this.name)},_serialize:!1,_deserialize:function(t,e){var i=t.rect;i&&this.setRect(new cc.Rect(i[0],i[1],i[2],i[3])),t.offset&&this.setOffset(new cc.Vec2(t.offset[0],t.offset[1])),t.originalSize&&this.setOriginalSize(new cc.Size(t.originalSize[0],t.originalSize[1])),this._rotated=1===t.rotated,this._name=t.name;var n=t.capInsets;n&&(this.insetLeft=n[0],this.insetTop=n[1],this.insetRight=n[2],this.insetBottom=n[3]);var r=t.texture;if(r){var o=e.customEnv&&e.customEnv.deferredLoadRaw?"_textureFilename":"_textureFilenameSetter";e.result.push(this,o,r)}}});var r=cc.SpriteFrame.prototype;r.copyWithZone=r.clone,r.copy=r.clone,r.initWithTexture=r.setTexture},{"../assets/CCAsset":32,"../event/event-target":85}],163:[function(t,e,i){var n=t("../event/event-target"),c=t("../platform/CCSys"),r=(t("../platform/js"),t("../utils/misc"),t("../CCGame"));t("../platform/_CCClass"),t("../platform/CCClass");var h=[{format:6407,internalFormat:6407,pixelType:33635},{format:6408,internalFormat:6408,pixelType:32820},{format:6408,internalFormat:6408,pixelType:32819},{format:6407,internalFormat:6407,pixelType:5121},{format:6408,internalFormat:6408,pixelType:5121},{format:6406,internalFormat:6406,pixelType:5121},{format:6409,internalFormat:6409,pixelType:5121},{format:6410,internalFormat:6410,pixelType:5121}],o=cc.Enum({RGB565:0,RGB5A1:1,RGBA4444:2,RGB888:3,RGBA8888:4,A8:5,I8:6,AI8:7}),l=cc.Enum({REPEAT:10497,CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648}),u=cc.Enum({LINEAR:9729,NEAREST:9728}),_=cc.Class({name:"cc.Texture2D",extends:t("../assets/CCRawAsset"),mixins:[n],properties:{_hasMipmap:!1,_format:o.RGBA8888,_compressed:!1,_premultiplyAlpha:!1,_minFilter:u.LINEAR,_magFilter:u.LINEAR,_wrapS:l.CLAMP_TO_EDGE,_wrapT:l.CLAMP_TO_EDGE},statics:{PixelFormat:o,WrapMode:l,Filter:u},ctor:function(t){this.url=null,this.loaded=!1,this.width=0,this.height=0,this._image=null,cc._renderType===r.RENDER_TYPE_CANVAS?(this._pattern="",this._grayElementObj=null,this._backupElement=null,this._isGray=!1):cc._renderType===r.RENDER_TYPE_WEBGL&&(this._gl=t||cc._renderContext,this._glID=null)},update:function(t){},getPixelWidth:function(){return this.width},getPixelHeight:function(){return this.height},getContentSize:function(){return cc.size(this.width,this.height)},getContentSizeInPixels:function(){return this.getContentSize()},initWithElement:function(t){t&&(this._image=t,this.width=t.width,this.height=t.height,this.loaded=!0)},initWithData:function(t,e,i,n,r){return!1},initWithImage:function(t){return!1},getHtmlElementObj:function(){return this._image},isLoaded:function(){return this.loaded},handleLoadedTexture:function(){if(this._image&&this._image.width&&this._image.height){var t=this._image;this.width=t.width,this.height=t.height,this.loaded=!0,this.emit("load")}},description:function(){return"<cc.Texture2D | Name = "+this.url+" | Dimensions = "+this.width+" x "+this.height+">"},releaseTexture:function(){this._gl&&null!==this._glID&&(this._gl.deleteTexture(this._glID),this._glID=null)},getPixelFormat:function(){return this._format},hasPremultipliedAlpha:function(){return this._premultiplyAlpha||!1},hasMipmaps:function(){return this._hasMipmap||!1},setTexParameters:function(t,e,i,n){void 0!==e&&(t={minFilter:t,magFilter:e,wrapS:i,wrapT:n}),t.wrapS!==l.REPEAT||t.wrapT!==l.REPEAT?t.wrapS!==l.REPEAT?t.wrapT!==l.REPEAT?this._pattern="":this._pattern="repeat-y":this._pattern="repeat-x":this._pattern="repeat"},setAntiAliasTexParameters:function(){},setAliasTexParameters:function(){}}),d=_.prototype;d.pixelFormat,cc.defineGetterSetter(d,"pixelFormat",d.getPixelFormat),d.pixelWidth,cc.defineGetterSetter(d,"pixelWidth",d.getPixelWidth),d.pixelHeight,cc.defineGetterSetter(d,"pixelHeight",d.getPixelHeight),r.once(r.EVENT_RENDERER_INITED,function(){if(cc._renderType===r.RENDER_TYPE_CANVAS){var i=function(t,e,i){if(null===t)return null;i=i||document.createElement("canvas"),e=e||cc.rect(0,0,t.width,t.height),i.width=e.width,i.height=e.height;var n=i.getContext("2d");n.drawImage(t,e.x,e.y,e.width,e.height,0,0,e.width,e.height);for(var r=n.getImageData(0,0,e.width,e.height),o=r.data,s=0,a=o.length;s<a;s+=4)o[s]=o[s+1]=o[s+2]=.34*o[s]+.5*o[s+1]+.16*o[s+2];return n.putImageData(r,0,0),i};d._generateTextureCacheForColor=function(){if(this.channelCache)return this.channelCache;var t=[document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas"),document.createElement("canvas")];return function(t,e){var i=t.width,n=t.height;e[0].width=i,e[0].height=n,e[1].width=i,e[1].height=n,e[2].width=i,e[2].height=n,e[3].width=i,e[3].height=n;var r=e[3].getContext("2d");r.drawImage(t,0,0);for(var o,s=r.getImageData(0,0,i,n).data,a=0;a<4;a++){for(var c=(o=e[a].getContext("2d")).getImageData(0,0,i,n),h=c.data,l=0;l<s.length;l+=4)h[l]=0===a?s[l]:0,h[l+1]=1===a?s[l+1]:0,h[l+2]=2===a?s[l+2]:0,h[l+3]=s[l+3];o.putImageData(c,0,0)}t.onload=null}(this._image,t),this.channelCache=t},d._switchToGray=function(t){this.loaded&&this._isGray!==t&&(this._isGray=t,this._isGray?(this._backupElement=this._image,this._grayElementObj||(this._grayElementObj=i(this._image)),this._image=this._grayElementObj):null!==this._backupElement&&(this._image=this._backupElement))},d._generateGrayTexture=function(){if(!this.loaded)return null;var t=i(this._image),e=new _;return e.initWithElement(t),e.handleLoadedTexture(),e},d._generateColorTexture=c._supportCanvasNewBlendModes?function(t,e,i,n,r){var o=!1;r?o=!0:r=document.createElement("canvas");var s=this._image;if(n||(n=cc.rect(0,0,s.width,s.height)),r.width=n.width,r.height=n.height,n.width&&n.height){var a=r.getContext("2d");a.globalCompositeOperation="source-over",a.fillStyle="rgb("+(0|t)+","+(0|e)+","+(0|i)+")",a.fillRect(0,0,n.width,n.height),a.globalCompositeOperation="multiply",a.drawImage(s,n.x,n.y,n.width,n.height,0,0,n.width,n.height),a.globalCompositeOperation="destination-atop",a.drawImage(s,n.x,n.y,n.width,n.height,0,0,n.width,n.height)}if(o)return r;var c=new _;return c.initWithElement(r),c.handleLoadedTexture(),c}:function(t,e,i,n,r){var o=!1;r?o=!0:r=document.createElement("canvas");var s=this._image;if(n||(n=cc.rect(0,0,s.width,s.height)),r.width=n.width,r.height=n.height,n.width&&n.height){var a=r.getContext("2d");a.drawImage(s,n.x,n.y,n.width,n.height,0,0,n.width,n.height);var c=a.getImageData(0,0,r.width,r.height),h=c.data;t/=255,e/=255,i/=255;for(var l=0;l<h.length;l+=4)h[l]=h[l]*t,h[l+1]=h[l+1]*e,h[l+2]=h[l+2]*i;a.putImageData(c,0,0)}if(o)return r;var u=new _;return u.initWithElement(r),u.handleLoadedTexture(),u}}else if(cc._renderType===r.RENDER_TYPE_WEBGL){var e;!function(){function s(t){return!(t&t-1||!t)}function a(){for(var t in e)e[t]=void 0;return e}e={width:void 0,height:void 0,minFilter:void 0,magFilter:void 0,wrapS:void 0,wrapT:void 0,format:void 0,mipmap:void 0,image:void 0,premultiplyAlpha:void 0},d.update=function(t){var e,i,n=this._hasMipmap,r=this._gl,o=!1;t&&(void 0!==t.width&&(this.width=t.width),void 0!==t.height&&(this.height=t.height),void 0!==t.minFilter&&(this._minFilter=t.minFilter),void 0!==t.magFilter&&(this._magFilter=t.magFilter),void 0!==t.wrapS&&(this._wrapS=t.wrapS),void 0!==t.wrapT&&(this._wrapT=t.wrapT),void 0!==t.format&&(this._format=t.format,o=!0),void 0!==t.premultiplyAlpha&&(this._premultiplyAlpha=t.premultiplyAlpha,o=!0),void 0!==t.image&&(this._image=t.image,o=!0),void 0!==t.mipmap&&(n=this._hasMipmap=t.mipmap)),this._image&&(o?(this.releaseTexture(),this._glID=r.createTexture(),r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this._glID),this._setImage(this._image,this.width,this.height,(e=this._format,i=h[e],cc.assertID(i,3113),i),this._premultiplyAlpha)):(r.activeTexture(r.TEXTURE0),r.bindTexture(r.TEXTURE_2D,this._glID)),this._setTexInfo(),n&&(cc.assertID(s(this.width)&&s(this.height),3117),r.hint(r.GENERATE_MIPMAP_HINT,r.NICEST),r.generateMipmap(r.TEXTURE_2D)),r.bindTexture(r.TEXTURE_2D,null))},d._setImage=function(t,e,i,n,r){var o=this._gl;o.pixelStorei(o.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),c.platform===c.WECHAT_GAME&&!(t instanceof Uint8Array)||c.platform===c.QQ_PLAY||t instanceof HTMLCanvasElement||t instanceof HTMLImageElement||t instanceof HTMLVideoElement?o.texImage2D(o.TEXTURE_2D,0,n.internalFormat,n.format,n.pixelType,t):o.texImage2D(o.TEXTURE_2D,0,n.internalFormat,e,i,0,n.format,n.pixelType,t)},d._setTexInfo=function(){var t=this._gl;s(this.width)&&s(this.height)||this._wrapS===l.CLAMP_TO_EDGE&&this._wrapT===l.CLAMP_TO_EDGE||(cc.warnID(3116),this._wrapS=l.CLAMP_TO_EDGE,this._wrapT=l.CLAMP_TO_EDGE),this._minFilter===u.LINEAR?t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this._hasMipmap?t.LINEAR_MIPMAP_NEAREST:t.LINEAR):t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,this._hasMipmap?t.NEAREST_MIPMAP_NEAREST:t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,this._magFilter),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,this._wrapS),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,this._wrapT)},d.initWithData=function(t,e,i,n,r){r&&cc.warnID(3118);var o=a();return o.image=t,o.format=e,o.width=i,o.height=n,this.update(o),this.width=i,this.height=n,this.loaded=!0,this.emit("load"),!0},d.initWithElement=function(t){if(t&&0!==t.width&&0!==t.height)return this._image=t,!0},d.handleLoadedTexture=function(t,e){if(this._image&&this._image.width&&this._image.height){var i=a();if(i.image=this._image,i.format=o.RGBA8888,void 0===e){if("undefined"!=typeof engine&&engine.Texture2D&&(e=engine.Texture2D.DEFAULT_FORMAT,i.format=e,this.url)){var n=this.url;void 0!==(e=engine.Texture2D.getDesignatedFormat(n))&&(i.format=e)}}else i.format=e;i.width=this._image.width,i.height=this._image.height,i.premultiplyAlpha=!!t;var r=cc.view._antiAliasEnabled?u.LINEAR:u.NEAREST;i.minFilter=i.magFilter=r,this.update(i),this.loaded=!0,this.emit("load")}},d.setTexParameters=function(t,e,i,n){void 0!==e&&(t={minFilter:t,magFilter:e,wrapS:i,wrapT:n}),this.update(t)},d.setAntiAliasTexParameters=function(){var t=a();t.minFilter=u.LINEAR,t.magFilter=u.LINEAR,this.update(t)},d.setAliasTexParameters=function(){var t=a();t.minFilter=u.NEAREST,t.magFilter=u.NEAREST,this.update(t)}}()}}),cc.Texture2D=e.exports=_},{"../CCGame":28,"../assets/CCRawAsset":38,"../event/event-target":85,"../platform/CCClass":123,"../platform/CCSys":132,"../platform/_CCClass":135,"../platform/js":144,"../utils/misc":173}],164:[function(t,e,i){var n=t("../CCGame"),s=t("./CCTexture2D"),a={_textures:{},_textureColorsCache:{},_textureKeySeq:0|1e3*Math.random(),handleLoadedTexture:null,description:function(){return"<TextureCache | Number of textures = "+this._textures.length+">"},textureForKey:function(t){return cc.logID(3002),this.getTextureForKey(t)},getTextureForKey:function(t){return"undefined"!=typeof engine&&engine.TextureCache?engine.TextureCache.getTextureForKey(t):this._textures[t]},getKeyByTexture:function(t){if("undefined"!=typeof engine&&engine.TextureCache)return engine.TextureCache.getKeyByTexture(t);for(var e in this._textures)if(this._textures[e]===t)return e;return null},_generalTextureKey:function(t){return"_textureKey_"+t},getTextureColors:function(t){var e=t._image,i=this.getKeyByTexture(e);return i||(i=e instanceof HTMLImageElement?e.src:this._generalTextureKey(t.__instanceId)),this._textureColorsCache[i]||(this._textureColorsCache[i]=t._generateTextureCacheForColor()),this._textureColorsCache[i]},removeAllTextures:function(){if("undefined"!=typeof engine&&engine.TextureCache)engine.TextureCache.removeAllTextures();else{var t=this._textures;for(var e in t)t[e]&&t[e].releaseTexture();this._textures={}}},removeTexture:function(t){if(t)if("undefined"!=typeof engine&&engine.TextureCache)engine.TextureCache.removeTexture(t);else{var e=this._textures;for(var i in e)e[i]===t&&(e[i].releaseTexture(),delete e[i])}},removeTextureForKey:function(t){if("string"==typeof t)if("undefined"!=typeof engine&&engine.TextureCache)engine.TextureCache.removeTextureForKey(t);else{var e=this._textures;e[t]&&(e[t].releaseTexture(),delete e[t])}},addImage:null,addImageAsync:null,cacheImage:function(t,e){if("undefined"!=typeof engine&&engine.TextureCache)engine.TextureCache.cacheImage(t,e);else if(cc.assertID(t,3009),e instanceof s)this._textures[t]=e;else{var i=new s;i.initWithElement(e),i.handleLoadedTexture(),this._textures[t]=i}},dumpCachedTextureInfo:function(){var t=0,e=0,i=this._textures;for(var n in i){var r=i[n];t++,r.getHtmlElementObj()instanceof HTMLImageElement?cc.logID(3005,n,r.getHtmlElementObj().src,r.getPixelWidth(),r.getPixelHeight()):cc.logID(3006,n,r.getPixelWidth(),r.getPixelHeight()),e+=r.getPixelWidth()*r.getPixelHeight()*4}var o=this._textureColorsCache;for(n in o){var s=o[n];for(var a in s){var c=s[a];t++,cc.logID(3006,n,c.width,c.height),e+=c.width*c.height*4}}cc.logID(3007,t,e/1024,(e/1048576).toFixed(2))},_clear:function(){this._textures={},this._textureColorsCache={},this._textureKeySeq=0|1e3*Math.random()}};n.once(n.EVENT_RENDERER_INITED,function(){var t=a;cc._renderType===n.RENDER_TYPE_CANVAS?(t.handleLoadedTexture=function(t){if("undefined"!=typeof engine&&engine.TextureCache)engine.TextureCache.handleLoadedTexture(t);else{var e=this._textures,i=e[t];i||(cc.assertID(t,3009),(i=e[t]=new s).url=t),i.handleLoadedTexture()}},t.addImage=function(i,n,r){if("undefined"!=typeof engine&&engine.TextureCache)return engine.TextureCache.addImage(i,n,r);cc.assertID(i,3103);var t=this._textures,o=t[i];return o?o.isLoaded()?n&&n.call(r,o):o.once("load",function(){n&&n.call(r,o)},r):((o=t[i]=new s).url=i,cc.loader.load(i,function(t,e){if(t)return n&&n.call(r,t||new Error("Unknown error"));a.handleLoadedTexture(i),n&&n.call(r,o)})),o},t.addImageAsync=t.addImage):cc._renderType===n.RENDER_TYPE_WEBGL&&(t.handleLoadedTexture=function(t){if("undefined"!=typeof engine&&engine.TextureCache)engine.TextureCache.handleLoadedTexture(t);else{var e,i=this._textures;(e=i[t])||(cc.assertID(t,3009),(e=i[t]=new s).url=t),e.handleLoadedTexture()}},t.addImage=function(i,n,r){if("undefined"!=typeof engine&&engine.TextureCache)return engine.TextureCache.addImage(i,n,r);cc.assertID(i,3112);var t=this._textures,o=t[i];return o?o.isLoaded()?n&&n.call(r,o):o.once("load",function(){n&&n.call(r,o)},r):((o=t[i]=new s).url=i,cc.loader.load(i,function(t,e){if(t)return n&&n.call(r,t||new Error("Unknown error"));a.handleLoadedTexture(i),n&&n.call(r,o)})),o},t.addImageAsync=t.addImage)}),cc.textureCache=e.exports=a},{"../CCGame":28,"./CCTexture2D":163}],165:[function(t,e,i){t("./CCTexture2D"),t("./CCTextureCache")},{"./CCTexture2D":163,"./CCTextureCache":164}],166:[function(t,e,i){t("../platform/CCSys");var n=/(\.[^\.\/\?\\]*)(\?.*)?$/,r=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,o=/[^\.\/]+\/\.\.\//;cc.path={join:function(){for(var t=arguments.length,e="",i=0;i<t;i++)e=(e+(""===e?"":"/")+arguments[i]).replace(/(\/|\\\\)$/,"");return e},extname:function(t){var e=n.exec(t);return e?e[1]:""},mainFileName:function(t){if(t){var e=t.lastIndexOf(".");if(-1!==e)return t.substring(0,e)}return t},basename:function(t,e){var i=t.indexOf("?");0<i&&(t=t.substring(0,i));var n=/(\/|\\\\)([^(\/|\\\\)]+)$/g.exec(t.replace(/(\/|\\\\)$/,""));if(!n)return null;var r=n[2];return e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?r.substring(0,r.length-e.length):r},dirname:function(t){var e=r.exec(t);return e?e[2]:""},changeExtname:function(t,e){e=e||"";var i=t.indexOf("?"),n="";return 0<i&&(n=t.substring(i),t=t.substring(0,i)),(i=t.lastIndexOf("."))<0?t+e+n:t.substring(0,i)+e+n},changeBasename:function(t,e,i){if(0===e.indexOf("."))return this.changeExtname(t,e);var n=t.indexOf("?"),r="",o=i?this.extname(t):"";return 0<n&&(r=t.substring(n),t=t.substring(0,n)),n=(n=t.lastIndexOf("/"))<=0?0:n+1,t.substring(0,n)+e+o+r},_normalize:function(t){for(var e=t=String(t);t=(e=t).replace(o,""),e.length!==t.length;);return t},sep:cc.sys.os===cc.sys.OS_WINDOWS?"\\":"/",stripSep:function(t){return t.replace(/[\/\\]$/,"")}},e.exports=cc.path},{"../platform/CCSys":132}],167:[function(t,e,i){var n=t("../../../external/pstats/pstats"),r=t("../platform/CCMacro"),o=document.createElement("div");o.id="fps";var s=null,a=!1;function c(){s("frame").start(),s("logic").start()}function h(){cc.director.isPaused()?s("frame").start():s("logic").end(),s("render").start()}function l(){s("render").end(),s("draws").value=cc.g_NumberOfDraws,s("frame").end(),s("fps").frame(),s().tick()}cc.profiler=e.exports={isShowingStats:function(){return a},hideStats:function(){a&&(o.parentElement===document.body&&document.body.removeChild(o),cc.director.off(cc.Director.EVENT_BEFORE_UPDATE,c),cc.director.off(cc.Director.EVENT_AFTER_VISIT,h),cc.director.off(cc.Director.EVENT_AFTER_DRAW,l),a=!1)},showStats:function(){a||(s||(s=n.new(o,{showGraph:!1,values:{frame:{desc:"Frame time (ms)",min:0,max:50,average:500},fps:{desc:"Framerate (FPS)",below:30,average:500},draws:{desc:"Draw call"},logic:{desc:"Game Logic (ms)",min:0,max:50,average:500,color:"#080"},render:{desc:"Renderer (ms)",min:0,max:50,average:500,color:"#f90"},mode:{desc:cc._renderType===cc.game.RENDER_TYPE_WEBGL?"WebGL":"Canvas",min:1}},css:".pstats {left: "+r.DIRECTOR_STATS_POSITION.x+"px; bottom: "+r.DIRECTOR_STATS_POSITION.y+"px;}"})),null===o.parentElement&&document.body.appendChild(o),cc.director.on(cc.Director.EVENT_BEFORE_UPDATE,c),cc.director.on(cc.Director.EVENT_AFTER_VISIT,h),cc.director.on(cc.Director.EVENT_AFTER_DRAW,l),a=!0)}}},{"../../../external/pstats/pstats":216,"../platform/CCMacro":128}],168:[function(t,e,i){var n=t("../platform/CCObject").Flags,r=t("./misc"),o=t("../platform/id-generater"),s=t("../event-manager"),a=cc.js,c=n.Destroying,h=n.DontDestroy,l=new o("Node");function u(t){return t?"string"==typeof t?a.getClassByName(t):t:(cc.errorID(3804),null)}function _(t,e){if(e._sealed)for(var i=0;i<t._components.length;++i){var n=t._components[i];if(n.constructor===e)return n}else for(var r=0;r<t._components.length;++r){var o=t._components[r];if(o instanceof e)return o}return null}function d(t,e,i){if(e._sealed)for(var n=0;n<t._components.length;++n){var r=t._components[n];r.constructor===e&&i.push(r)}else for(var o=0;o<t._components.length;++o){var s=t._components[o];s instanceof e&&i.push(s)}}var f=cc.Class({name:"cc._BaseNode",extends:cc.Object,mixins:[cc.EventTarget],properties:{_parent:null,_children:[],_tag:cc.macro.NODE_TAG_INVALID,_active:!0,_components:[],_prefab:null,_persistNode:{get:function(){return 0<(this._objFlags&h)},set:function(t){t?this._objFlags|=h:this._objFlags&=~h}},name:{get:function(){return this._name},set:function(t){this._name=t}},_id:{default:"",editorOnly:!0},uuid:{get:function(){var t=this._id;return t||(t=this._id=l.getNewId()),t}},children:{get:function(){return this._children}},childrenCount:{get:function(){return this._children.length}},active:{get:function(){return this._active},set:function(t){if(t=!!t,this._active!==t){this._active=t;var e=this._parent;e&&e._activeInHierarchy&&cc.director._nodeActivator.activateNode(this,t)}}},activeInHierarchy:{get:function(){return this._activeInHierarchy}}},ctor:function(t){this._name=void 0!==t?t:"New Node",this._activeInHierarchy=!1,this.__instanceId=this._id||cc.ClassManager.getNewInstanceId(),this.__eventTargets=[]},getTag:function(){return this._tag},setTag:function(t){this._tag=t},getParent:function(){return this._parent},setParent:function(t){if(this._parent!==t){var e=this._parent;if(this._parent=t||null,this._onSetParent(t),t&&(s._setDirtyForNode(this),t._children.push(this)),e){if(!(e._objFlags&c)){var i=e._children.indexOf(this);e._children.splice(i,1),this._onHierarchyChanged(e)}}else t&&this._onHierarchyChanged(null)}},init:function(){return!0},attr:function(t){a.mixin(this,t)},getChildByTag:function(t){var e=this._children;if(null!==e)for(var i=0;i<e.length;i++){var n=e[i];if(n&&n._tag===t)return n}return null},getChildByUuid:function(t){if(!t)return cc.log("Invalid uuid"),null;for(var e=this._children,i=0,n=e.length;i<n;i++)if(e[i]._id===t)return e[i];return null},getChildByName:function(t){if(!t)return cc.log("Invalid name"),null;for(var e=this._children,i=0,n=e.length;i<n;i++)if(e[i]._name===t)return e[i];return null},addChild:function(t){cc.assertID(t,1606),cc.assertID(null===t._parent,1605),t.setParent(this)},insertChild:function(t,e){t.parent=this,t.setSiblingIndex(e)},getSiblingIndex:function(){return this._parent?this._parent._children.indexOf(this):0},setSiblingIndex:function(t){if(this._parent){var e=this._parent._children;t=-1!==t?t:e.length-1;var i=e.indexOf(this);t!==i&&(e.splice(i,1),t<e.length?e.splice(t,0,this):e.push(this),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(t))}},cleanup:function(){},removeFromParent:function(t){this._parent&&(void 0===t&&(t=!0),this._parent.removeChild(this,t))},removeChild:function(t,e){-1<this._children.indexOf(t)&&((e||void 0===e)&&t.cleanup(),t.parent=null)},removeChildByTag:function(t,e){t===cc.macro.NODE_TAG_INVALID&&cc.logID(1609);var i=this.getChildByTag(t);i?this.removeChild(i,e):cc.logID(1610,t)},removeAllChildren:function(t){var e=this._children;void 0===t&&(t=!0);for(var i=e.length-1;0<=i;i--){var n=e[i];n&&(t&&n.cleanup(),n.parent=null)}this._children.length=0},isChildOf:function(t){var e=this;do{if(e===t)return!0;e=e._parent}while(e);return!1},getComponent:function(t){var e=u(t);return e?_(this,e):null},getComponents:function(t){var e=u(t),i=[];return e&&d(this,e,i),i},getComponentInChildren:function(t){var e=u(t);return e?function t(e,i){for(var n=0;n<e.length;++n){var r=e[n],o=_(r,i);if(o)return o;if(0<r._children.length&&(o=t(r._children,i)))return o}return null}(this._children,e):null},getComponentsInChildren:function(t){var e=u(t),i=[];return e&&(d(this,e,i),function t(e,i,n){for(var r=0;r<e.length;++r){var o=e[r];d(o,i,n),0<o._children.length&&t(o._children,i,n)}}(this._children,e,i)),i},_checkMultipleComp:!1,addComponent:function(t){var e;if("string"==typeof t){if(!(e=a.getClassByName(t)))return cc.errorID(3807,t),cc._RFpeek()&&cc.errorID(3808,t),null}else{if(!t)return cc.errorID(3804),null;e=t}if("function"!=typeof e)return cc.errorID(3809),null;if(!cc.isChildClassOf(e,cc.Component))return cc.errorID(3810),null;var i=e._requireComponent;if(i&&!this.getComponent(i)&&!this.addComponent(i))return null;var n=new e;return(n.node=this)._components.push(n),this._activeInHierarchy&&cc.director._nodeActivator.activateComp(n),n},_addComponentAt:!1,removeComponent:function(t){t?(t instanceof cc.Component||(t=this.getComponent(t)),t&&t.destroy()):cc.errorID(3813)},_getDependComponent:!1,_removeComponent:function(t){if(t){if(!(this._objFlags&c)){var e=this._components.indexOf(t);-1!==e?this._components.splice(e,1):t.node!==this&&cc.errorID(3815)}}else cc.errorID(3814)},_disableChildComps:function(){var t,e=this._components.length;for(t=0;t<e;++t){var i=this._components[t];i._enabled&&cc.director._compScheduler.disableComp(i)}for(t=0,e=this._children.length;t<e;++t){var n=this._children[t];n._active&&n._disableChildComps()}},destroy:function(){cc.Object.prototype.destroy.call(this)&&this._activeInHierarchy&&this._disableChildComps()},destroyAllChildren:function(){for(var t=this._children,e=0;e<t.length;++e)t[e].destroy()},_onSetParent:function(t){},_onPostActivated:function(){},_onHierarchyChanged:function(t){var e=this._parent;!this._persistNode||e instanceof cc.Scene||cc.game.removePersistRootNode(this);var i=this._active&&!(!e||!e._activeInHierarchy);this._activeInHierarchy!==i&&cc.director._nodeActivator.activateNode(this,i)},_onBatchCreated:function(){var t=this._prefab;t&&t.sync&&!t._synced&&t.root===this&&PrefabHelper.syncWithPrefab(this);for(var e=this._children,i=0,n=e.length;i<n;i++)e[i]._onBatchCreated()},_instantiate:function(t){t||(t=cc.instantiate._clone(this,this));var e=this._prefab;return e&&this===e.root&&e.sync&&(t._prefab._synced=e._synced),t._parent=null,t._onBatchCreated(),t},_registerIfAttached:!1,_onPreDestroy:function(){var t,e;this._objFlags|=c;var i=this._parent,n=i&&i._objFlags&c,r=this._children;for(t=0,e=r.length;t<e;++t)r[t]._destroyImmediate();for(t=0,e=this._components.length;t<e;++t)this._components[t]._destroyImmediate();var o=this.__eventTargets;for(t=0,e=o.length;t<e;++t){var s=o[t];s&&s.targetOff(this)}if(o.length=0,this._persistNode&&cc.game.removePersistRootNode(this),!n&&i){var a=i._children.indexOf(this);i._children.splice(a,1)}return n},onRestore:!1});f.prototype._onPreDestroyBase=f.prototype._onPreDestroy,f.prototype._onHierarchyChangedBase=f.prototype._onHierarchyChanged,r.propertyDefine(f,["name","children","childrenCount"],{}),cc._BaseNode=e.exports=f},{"../event-manager":83,"../platform/CCObject":129,"../platform/id-generater":140,"./misc":173}],169:[function(t,e,i){e.exports={binarySearchEpsilon:function(t,e){for(var i=0,n=t.length-1,r=n>>>1;i<=n;r=i+n>>>1){var o=t[r];if(e+1e-6<o)n=r-1;else{if(!(o<e-1e-6))return r;i=r+1}}return~i}}},{}],170:[function(t,e,i){var o=t("./misc").BASE64_VALUES,s="0123456789abcdef".split(""),n=["","","",""],a=n.concat(n,"-",n,"-",n,"-",n,"-",n,n,n),c=a.map(function(t,e){return"-"===t?NaN:e}).filter(isFinite);e.exports=function(t){if(22!==t.length)return t;a[0]=t[0],a[1]=t[1];for(var e=2,i=2;e<22;e+=2){var n=o[t.charCodeAt(e)],r=o[t.charCodeAt(e+1)];a[c[i++]]=s[n>>2],a[c[i++]]=s[(3&n)<<2|r>>4],a[c[i++]]=s[15&r]}return a.join("")}},{"./misc":173}],171:[function(t,e,i){cc.find=e.exports=function(t,e){if(null==t)return cc.errorID(5600),null;if(e);else{var i=cc.director.getScene();if(!i)return null;e=i}for(var n=e,r="/"!==t[0]?0:1,o=t.split("/"),s=r;s<o.length;s++){var a=o[s],c=n._children;n=null;for(var h=0,l=c.length;h<l;++h){var u=c[h];if(u.name===a){n=u;break}}if(!n)return null}return n}},{}],172:[function(t,e,i){t("./CCPath"),CC_QQPLAY||t("./CCProfiler"),t("./find"),t("./mutable-forward-iterator")},{"./CCPath":166,"./CCProfiler":167,"./find":171,"./mutable-forward-iterator":174}],173:[function(t,e,i){var n=t("../platform/js"),r=t("../platform/CCSys"),o=i;o.propertyDefine=function(t,e,i){function n(t,e,i,n){var r=Object.getOwnPropertyDescriptor(t,e);if(r)r.get&&(t[i]=r.get),r.set&&n&&(t[n]=r.set);else{var o=t[i];cc.js.getset(t,e,o,t[n])}}for(var r,o=t.prototype,s=0;s<e.length;s++){var a=(r=e[s])[0].toUpperCase()+r.slice(1);n(o,r,"get"+a,"set"+a)}for(r in i){var c=i[r];n(o,r,c[0],c[1])}},o.NextPOT=function(t){return t-=1,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,1+(t|=t>>16)},o.imagePool=new n.Pool(function(t){return t instanceof HTMLImageElement&&(t.src=this._smallImg,!0)},10),o.imagePool.get=function(){return this._get()||new Image},o.imagePool._smallImg="data:image/gif;base64,R0lGODlhAQABAAAAACwAAAAAAQABAAA=",r.os!==r.OS_WINDOWS&&r.os!==r.OS_LINUX||r.browserType===r.BROWSER_TYPE_CHROME||o.imagePool.resize(0),o.BUILTIN_CLASSID_RE=/^(?:cc|dragonBones|sp|ccsg)\..+/;for(var s=new Array(123),a=0;a<123;++a)s[a]=64;for(var c=0;c<64;++c)s["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(c)]=c;o.BASE64_VALUES=s,o.pushToMap=function(t,e,i,n){var r=t[e];r?Array.isArray(r)?n?(r.push(r[0]),r[0]=i):r.push(i):t[e]=n?[i,r]:[r,i]:t[e]=i}},{"../platform/CCSys":132,"../platform/js":144}],174:[function(t,e,i){function n(t){this.i=0,this.array=t}var r=n.prototype;r.remove=function(t){var e=this.array.indexOf(t);0<=e&&this.removeAt(e)},r.removeAt=function(t){this.array.splice(t,1),t<=this.i&&--this.i},r.fastRemove=function(t){var e=this.array.indexOf(t);0<=e&&this.fastRemoveAt(e)},r.fastRemoveAt=function(t){var e=this.array;e[t]=e[e.length-1],--e.length,t<=this.i&&--this.i},r.push=function(t){this.array.push(t)},e.exports=n},{}],175:[function(t,e,i){cc._PrefabInfo=cc.Class({name:"cc.PrefabInfo",properties:{root:null,asset:null,fileId:"",sync:!1,_synced:{default:!1,serializable:!1}}}),e.exports={syncWithPrefab:function(t){var e=t._prefab;if(e._synced=!0,!e.asset)return cc.errorID(3701,t.name),void(t._prefab=null);var i=t._objFlags,n=t._parent,r=t._id,o=t._name,s=t._active,a=t._position.x,c=t._position.y,h=t._rotationX,l=t._rotationY,u=t._localZOrder,_=t._globalZOrder;cc.game._isCloning=!0,e.asset._doInstantiate(t),cc.game._isCloning=!1,t._objFlags=i,t._parent=n,t._id=r,t._prefab=e,t._name=o,t._active=s,t._position.x=a,t._position.y=c,t._rotationX=h,t._rotationY=l,t._localZOrder=u,t._globalZOrder=_}}},{}],176:[function(t,e,i){var n={removeSgNode:function(){var t=this._sgNode;if(t){var e=t._parent;e?e.removeChild(t):t.performRecursive(_ccsg.Node.performType.cleanup),t._entity&&(t._entity=null)}}};e.exports=n},{}],177:[function(t,e,i){cc.AffineTransform=function(t,e,i,n,r,o){this.a=t,this.b=e,this.c=i,this.d=n,this.tx=r,this.ty=o},cc.affineTransformMake=function(t,e,i,n,r,o){return{a:t,b:e,c:i,d:n,tx:r,ty:o}},cc.affineTransformClone=function(t){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx,ty:t.ty}},cc.pointApplyAffineTransform=function(t,e,i){var n,r;return void 0===i?(i=e,n=t.x,r=t.y):(n=t,r=e),{x:i.a*n+i.c*r+i.tx,y:i.b*n+i.d*r+i.ty}},cc._pointApplyAffineTransformIn=function(t,e,i,n){var r,o,s;void 0===n?(s=e,r=t.x,o=t.y,n=i):(r=t,o=e,s=i),n.x=s.a*r+s.c*o+s.tx,n.y=s.b*r+s.d*o+s.ty},cc._pointApplyAffineTransform=function(t,e,i){return cc.pointApplyAffineTransform(t,e,i)},cc.sizeApplyAffineTransform=function(t,e){return{width:e.a*t.width+e.c*t.height,height:e.b*t.width+e.d*t.height}},cc.affineTransformMakeIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.affineTransformIdentity=function(){return{a:1,b:0,c:0,d:1,tx:0,ty:0}},cc.rectApplyAffineTransform=function(t,e){var i=t.x,n=t.y,r=i+t.width,o=n+t.height,s=e.a*i+e.c*n+e.tx,a=e.b*i+e.d*n+e.ty,c=e.a*r+e.c*n+e.tx,h=e.b*r+e.d*n+e.ty,l=e.a*i+e.c*o+e.tx,u=e.b*i+e.d*o+e.ty,_=e.a*r+e.c*o+e.tx,d=e.b*r+e.d*o+e.ty,f=Math.min(s,c,l,_),p=Math.max(s,c,l,_),g=Math.min(a,h,u,d),m=Math.max(a,h,u,d);return cc.rect(f,g,p-f,m-g)},cc._rectApplyAffineTransformIn=function(t,e){var i=t.x,n=t.y,r=i+t.width,o=n+t.height,s=e.a*i+e.c*n+e.tx,a=e.b*i+e.d*n+e.ty,c=e.a*r+e.c*n+e.tx,h=e.b*r+e.d*n+e.ty,l=e.a*i+e.c*o+e.tx,u=e.b*i+e.d*o+e.ty,_=e.a*r+e.c*o+e.tx,d=e.b*r+e.d*o+e.ty,f=Math.min(s,c,l,_),p=Math.max(s,c,l,_),g=Math.min(a,h,u,d),m=Math.max(a,h,u,d);return t.x=f,t.y=g,t.width=p-f,t.height=m-g,t},cc.obbApplyAffineTransform=function(t,e,i,n,r,o){var s=t.x,a=t.y,c=t.width,h=t.height,l=e.a*s+e.c*a+e.tx,u=e.b*s+e.d*a+e.ty,_=e.a*c,d=e.b*c,f=e.c*h,p=e.d*h;n.x=l,n.y=u,r.x=_+l,r.y=d+u,i.x=f+l,i.y=p+u,o.x=_+f+l,o.y=d+p+u},cc.affineTransformTranslate=function(t,e,i){return{a:t.a,b:t.b,c:t.c,d:t.d,tx:t.tx+t.a*e+t.c*i,ty:t.ty+t.b*e+t.d*i}},cc.affineTransformScale=function(t,e,i){return{a:t.a*e,b:t.b*e,c:t.c*i,d:t.d*i,tx:t.tx,ty:t.ty}},cc.affineTransformRotate=function(t,e){var i=Math.sin(e),n=Math.cos(e);return{a:t.a*n+t.c*i,b:t.b*n+t.d*i,c:t.c*n-t.a*i,d:t.d*n-t.b*i,tx:t.tx,ty:t.ty}},cc.affineTransformConcat=function(t,e){return{a:t.a*e.a+t.b*e.c,b:t.a*e.b+t.b*e.d,c:t.c*e.a+t.d*e.c,d:t.c*e.b+t.d*e.d,tx:t.tx*e.a+t.ty*e.c+e.tx,ty:t.tx*e.b+t.ty*e.d+e.ty}},cc.affineTransformConcatIn=function(t,e){var i=t.a,n=t.b,r=t.c,o=t.d,s=t.tx,a=t.ty;return t.a=i*e.a+n*e.c,t.b=i*e.b+n*e.d,t.c=r*e.a+o*e.c,t.d=r*e.b+o*e.d,t.tx=s*e.a+a*e.c+e.tx,t.ty=s*e.b+a*e.d+e.ty,t},cc.affineTransformEqualToTransform=function(t,e){return t.a===e.a&&t.b===e.b&&t.c===e.c&&t.d===e.d&&t.tx===e.tx&&t.ty===e.ty},cc.affineTransformInvert=function(t){var e=1/(t.a*t.d-t.b*t.c);return{a:e*t.d,b:-e*t.b,c:-e*t.c,d:e*t.a,tx:e*(t.c*t.ty-t.d*t.tx),ty:e*(t.b*t.tx-t.a*t.ty)}},cc.affineTransformInvertIn=function(t){var e=t.a,i=t.b,n=t.c,r=t.d,o=1/(e*r-i*n),s=t.tx,a=t.ty;return t.a=o*r,t.b=-o*i,t.c=-o*n,t.d=o*e,t.tx=o*(n*a-r*s),t.ty=o*(i*s-e*a),t},cc.affineTransformInvertOut=function(t,e){var i=t.a,n=t.b,r=t.c,o=t.d,s=1/(i*o-n*r);e.a=s*o,e.b=-s*n,e.c=-s*r,e.d=s*i,e.tx=s*(r*t.ty-o*t.tx),e.ty=s*(n*t.tx-i*t.ty)}},{}],178:[function(n,t,e){var r=n("./CCValueType"),o=n("../platform/js"),i=function(){function a(t,e,i,n){"object"==typeof t&&(e=t.g,i=t.b,n=t.a,t=t.r),t=t||0,e=e||0,i=i||0,n="number"==typeof n?n:255,this._val=(~~t<<24>>>0)+(~~e<<16)+(~~i<<8)+~~n}o.extend(a,r),n("../platform/CCClass").fastDefine("cc.Color",a,{r:0,g:0,b:0,a:255});var t={WHITE:[255,255,255,255],BLACK:[0,0,0,255],TRANSPARENT:[0,0,0,0],GRAY:[127.5,127.5,127.5],RED:[255,0,0],GREEN:[0,255,0],BLUE:[0,0,255],YELLOW:[255,235,4],ORANGE:[255,127,0],CYAN:[0,255,255],MAGENTA:[255,0,255]};for(var e in t)o.get(a,e,function(t){return function(){return new a(t[0],t[1],t[2],t[3])}}(t[e]));var i=a.prototype;return i.clone=function(){var t=new a;return t._val=this._val,t},i.equals=function(t){return t&&this._val===t._val},i.lerp=function(t,e,i){i=i||new a;var n=this.r,r=this.g,o=this.b,s=this.a;return i.r=n+(t.r-n)*e,i.g=r+(t.g-r)*e,i.b=o+(t.b-o)*e,i.a=s+(t.a-s)*e,i},i.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},i.getR=function(){return(4278190080&this._val)>>>24},i.setR=function(t){return this._val=(16777215&this._val|~~t<<24>>>0)>>>0,this},i.getG=function(){return(16711680&this._val)>>16},i.setG=function(t){return this._val=(4278255615&this._val|~~t<<16)>>>0,this},i.getB=function(){return(65280&this._val)>>8},i.setB=function(t){return this._val=(4294902015&this._val|~~t<<8)>>>0,this},i.getA=function(){return 255&this._val},i.setA=function(t){return this._val=(4294967040&this._val|~~t)>>>0,this},o.getset(i,"r",i.getR,i.setR,!0),o.getset(i,"g",i.getG,i.setG,!0),o.getset(i,"b",i.getB,i.setB,!0),o.getset(i,"a",i.getA,i.setA,!0),i.toCSS=function(t){return"rgba"===t?"rgba("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+","+(this.a/255).toFixed(2)+")":"rgb"===t?"rgb("+(0|this.r)+","+(0|this.g)+","+(0|this.b)+")":"#"+this.toHEX(t)},i.clamp=function(){},i.fromHEX=function(t){t.length<8&&(t+="FF");var e=parseInt(-1<t.indexOf("#")?t.substring(1):t,16);return this._val=(0&this._val|e)>>>0,this},i.toHEX=function(t){var e=[(0|this.r).toString(16),(0|this.g).toString(16),(0|this.b).toString(16)],i=-1;if("#rgb"===t)for(i=0;i<e.length;++i)1<e[i].length&&(e[i]=e[i][0]);else if("#rrggbb"===t)for(i=0;i<e.length;++i)1===e[i].length&&(e[i]="0"+e[i]);return e.join("")},i.toRGBValue=function(){return 16777215&this._val},i.fromHSV=function(t,e,i){var n=a.hsv2rgb(t,e,i);return this._val=(n.r<<24>>>0)+(n.g<<16)+(n.b<<8)+this.a,this},i.toHSV=function(){return a.rgb2hsv(this.r,this.g,this.b)},i.fromColor=function(t){t._val?this._val=t._val:(this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a)},a}();i.rgb2hsv=function(t,e,i){t/=255,e/=255,i/=255;var n={h:0,s:0,v:0},r=Math.max(t,e,i),o=Math.min(t,e,i),s=0;return n.v=r,n.s=r?(r-o)/r:0,n.s?(s=r-o,n.h=t===r?(e-i)/s:e===r?2+(i-t)/s:4+(t-e)/s,n.h/=6,n.h<0&&(n.h+=1)):n.h=0,n},i.hsv2rgb=function(t,e,i){var n={r:0,g:0,b:0};if(0===e)n.r=n.g=n.b=i;else if(0===i)n.r=n.g=n.b=0;else{1===t&&(t=0),t*=6,e=e,i=i;var r=Math.floor(t),o=t-r,s=i*(1-e),a=i*(1-e*o),c=i*(1-e*(1-o));switch(r){case 0:n.r=i,n.g=c,n.b=s;break;case 1:n.r=a,n.g=i,n.b=s;break;case 2:n.r=s,n.g=i,n.b=c;break;case 3:n.r=s,n.g=a,n.b=i;break;case 4:n.r=c,n.g=s,n.b=i;break;case 5:n.r=i,n.g=s,n.b=a}}return n.r*=255,n.g*=255,n.b*=255,n},cc.Color=i,cc.color=function(t,e,i,n){return"string"==typeof t?(new cc.Color).fromHEX(t):"object"==typeof t?new cc.Color(t.r,t.g,t.b,t.a):new cc.Color(t,e,i,n)},cc.colorEqual=function(t,e){return void 0!==t._val&&void 0!==e._val?t._val===e._val:t.r===e.r&&t.g===e.g&&t.b===e.b},cc.hexToColor=function(t){t=t.replace(/^#?/,"0x");var e=parseInt(t),i=e>>16,n=(65280&e)>>8,r=255&e;return cc.color(i,n,r)},cc.colorToHex=function(t){var e=t.r.toString(16),i=t.g.toString(16),n=t.b.toString(16);return"#"+(t.r<16?"0"+e:e)+(t.g<16?"0"+i:i)+(t.b<16?"0"+n:n)},t.exports=cc.Color},{"../platform/CCClass":123,"../platform/js":144,"./CCValueType":184}],179:[function(t,e,i){var o=parseFloat("1.192092896e-07F");cc.pNeg=function(t){return cc.p(-t.x,-t.y)},cc.pAdd=function(t,e){return cc.p(t.x+e.x,t.y+e.y)},cc.pSub=function(t,e){return cc.p(t.x-e.x,t.y-e.y)},cc.pMult=function(t,e){return cc.p(t.x*e,t.y*e)},cc.pMidpoint=function(t,e){return cc.pMult(cc.pAdd(t,e),.5)},cc.pDot=function(t,e){return t.x*e.x+t.y*e.y},cc.pCross=function(t,e){return t.x*e.y-t.y*e.x},cc.pPerp=function(t){return cc.p(-t.y,t.x)},cc.pRPerp=function(t){return cc.p(t.y,-t.x)},cc.pProject=function(t,e){return cc.pMult(e,cc.pDot(t,e)/cc.pDot(e,e))},cc.pLengthSQ=function(t){return cc.pDot(t,t)},cc.pDistanceSQ=function(t,e){return cc.pLengthSQ(cc.pSub(t,e))},cc.pLength=function(t){return Math.sqrt(cc.pLengthSQ(t))},cc.pDistance=function(t,e){return cc.pLength(cc.pSub(t,e))},cc.pNormalize=function(t){var e=cc.pLength(t);return 0===e?cc.p(t):cc.pMult(t,1/e)},cc.pForAngle=function(t){return cc.p(Math.cos(t),Math.sin(t))},cc.pToAngle=function(t){return Math.atan2(t.y,t.x)},cc.clampf=function(t,e,i){if(i<e){var n=e;e=i,i=n}return t<e?e:t<i?t:i},cc.clamp01=function(t){return t<0?0:t<1?t:1},cc.pClamp=function(t,e,i){return cc.p(cc.clampf(t.x,e.x,i.x),cc.clampf(t.y,e.y,i.y))},cc.pFromSize=function(t){return cc.p(t.width,t.height)},cc.pCompOp=function(t,e){return cc.p(e(t.x),e(t.y))},cc.pLerp=function(t,e,i){return cc.pAdd(cc.pMult(t,1-i),cc.pMult(e,i))},cc.pFuzzyEqual=function(t,e,i){return t.x-i<=e.x&&e.x<=t.x+i&&t.y-i<=e.y&&e.y<=t.y+i},cc.pCompMult=function(t,e){return cc.p(t.x*e.x,t.y*e.y)},cc.pAngleSigned=function(t,e){var i=cc.pNormalize(t),n=cc.pNormalize(e),r=Math.atan2(i.x*n.y-i.y*n.x,cc.pDot(i,n));return Math.abs(r)<o?0:r},cc.pAngle=function(t,e){var i=Math.acos(cc.pDot(cc.pNormalize(t),cc.pNormalize(e)));return Math.abs(i)<o?0:i},cc.pRotateByAngle=function(t,e,i){var n=cc.pSub(t,e),r=Math.cos(i),o=Math.sin(i),s=n.x;return n.x=s*r-n.y*o+e.x,n.y=s*o+n.y*r+e.y,n},cc.pLineIntersect=function(t,e,i,n,r){if(t.x===e.x&&t.y===e.y||i.x===n.x&&i.y===n.y)return!1;var o=e.x-t.x,s=e.y-t.y,a=n.x-i.x,c=n.y-i.y,h=t.x-i.x,l=t.y-i.y,u=c*o-a*s;return r.x=a*l-c*h,r.y=o*l-s*h,0===u?0===r.x||0===r.y:(r.x=r.x/u,r.y=r.y/u,!0)},cc.pSegmentIntersect=function(t,e,i,n){var r=cc.p(0,0);return!!(cc.pLineIntersect(t,e,i,n,r)&&0<=r.x&&r.x<=1&&0<=r.y&&r.y<=1)},cc.pIntersectPoint=function(t,e,i,n){var r=cc.p(0,0);if(cc.pLineIntersect(t,e,i,n,r)){var o=cc.p(0,0);return o.x=t.x+r.x*(e.x-t.x),o.y=t.y+r.x*(e.y-t.y),o}return cc.p(0,0)},cc.pSameAs=function(t,e){return null!=t&&null!=e&&t.x===e.x&&t.y===e.y},cc.pZeroIn=function(t){t.x=0,t.y=0},cc.pIn=function(t,e){t.x=e.x,t.y=e.y},cc.pMultIn=function(t,e){t.x*=e,t.y*=e},cc.pSubIn=function(t,e){t.x-=e.x,t.y-=e.y},cc.pAddIn=function(t,e){t.x+=e.x,t.y+=e.y},cc.pNormalizeIn=function(t){cc.pMultIn(t,1/Math.sqrt(t.x*t.x+t.y*t.y))}},{}],180:[function(t,e,i){var n=t("./CCValueType"),r=t("../platform/js");function a(t,e,i,n){t&&"object"==typeof t&&(e=t.y,i=t.width,n=t.height,t=t.x),this.x=t||0,this.y=e||0,this.width=i||0,this.height=n||0}r.extend(a,n),t("../platform/CCClass").fastDefine("cc.Rect",a,{x:0,y:0,width:0,height:0}),a.fromMinMax=function(t,e){var i=Math.min(t.x,e.x),n=Math.min(t.y,e.y);return new a(i,n,Math.max(t.x,e.x)-i,Math.max(t.y,e.y)-n)},a.contain=function(t,e){return t.x<e.x&&t.x+t.width>e.x+e.width&&t.y<e.y&&t.y+t.height>e.y+e.height?1:e.x<t.x&&e.x+e.width>t.x+t.width&&e.y<t.y&&e.y+e.height>t.y+t.height?-1:0};var o=a.prototype;o.clone=function(){return new a(this.x,this.y,this.width,this.height)},o.equals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},o.lerp=function(t,e,i){i=i||new a;var n=this.x,r=this.y,o=this.width,s=this.height;return i.x=n+(t.x-n)*e,i.y=r+(t.y-r)*e,i.width=o+(t.width-o)*e,i.height=s+(t.height-s)*e,i},o.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},r.getset(o,"xMin",function(){return this.x},function(t){this.width+=this.x-t,this.x=t}),r.getset(o,"yMin",function(){return this.y},function(t){this.height+=this.y-t,this.y=t}),r.getset(o,"xMax",function(){return this.x+this.width},function(t){this.width=t-this.x}),r.getset(o,"yMax",function(){return this.y+this.height},function(t){this.height=t-this.y}),r.getset(o,"center",function(){return new cc.Vec2(this.x+.5*this.width,this.y+.5*this.height)},function(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}),r.getset(o,"origin",function(){return new cc.Vec2(this.x,this.y)},function(t){this.x=t.x,this.y=t.y}),r.getset(o,"size",function(){return new cc.Size(this.width,this.height)},function(t){this.width=t.width,this.height=t.height}),o.intersects=function(t){return cc.rectIntersectsRect(this,t)},o.contains=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y},o.containsRect=function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height},cc.Rect=a,cc.rect=function(t,e,i,n){return new a(t,e,i,n)},cc.rectEqualToRect=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y&&t.width===e.width&&t.height===e.height},cc._rectEqualToZero=function(t){return t&&0===t.x&&0===t.y&&0===t.width&&0===t.height},cc.rectContainsRect=function(t,e){return!(!t||!e||t.x>=e.x||t.y>=e.y||t.x+t.width<=e.x+e.width||t.y+t.height<=e.y+e.height)},cc.rectGetMaxX=function(t){return t.x+t.width},cc.rectGetMidX=function(t){return t.x+t.width/2},cc.rectGetMinX=function(t){return t.x},cc.rectGetMaxY=function(t){return t.y+t.height},cc.rectGetMidY=function(t){return t.y+t.height/2},cc.rectGetMinY=function(t){return t.y},cc.rectContainsPoint=function(t,e){return e.x>=cc.rectGetMinX(t)&&e.x<=cc.rectGetMaxX(t)&&e.y>=cc.rectGetMinY(t)&&e.y<=cc.rectGetMaxY(t)},cc.rectIntersectsRect=function(t,e){var i=t.x+t.width,n=t.y+t.height,r=e.x+e.width,o=e.y+e.height;return!(i<e.x||r<t.x||n<e.y||o<t.y)},cc.rectOverlapsRect=function(t,e){return!(t.x+t.width<e.x||e.x+e.width<t.x||t.y+t.height<e.y||e.y+e.height<t.y)},cc.rectUnion=function(t,e){var i=cc.rect(0,0,0,0);return i.x=Math.min(t.x,e.x),i.y=Math.min(t.y,e.y),i.width=Math.max(t.x+t.width,e.x+e.width)-i.x,i.height=Math.max(t.y+t.height,e.y+e.height)-i.y,i},cc.rectIntersection=function(t,e){var i=cc.rect(Math.max(cc.rectGetMinX(t),cc.rectGetMinX(e)),Math.max(cc.rectGetMinY(t),cc.rectGetMinY(e)),0,0);return i.width=Math.min(cc.rectGetMaxX(t),cc.rectGetMaxX(e))-cc.rectGetMinX(i),i.height=Math.min(cc.rectGetMaxY(t),cc.rectGetMaxY(e))-cc.rectGetMinY(i),i},e.exports=cc.Rect},{"../platform/CCClass":123,"../platform/js":144,"./CCValueType":184}],181:[function(t,e,i){var n=t("./CCValueType"),r=t("../platform/js");function o(t,e){t&&"object"==typeof t&&(e=t.height,t=t.width),this.width=t||0,this.height=e||0}r.extend(o,n),t("../platform/CCClass").fastDefine("cc.Size",o,{width:0,height:0}),r.get(o,"ZERO",function(){return new o(0,0)});var s=o.prototype;s.clone=function(){return new o(this.width,this.height)},s.equals=function(t){return t&&this.width===t.width&&this.height===t.height},s.lerp=function(t,e,i){i=i||new o;var n=this.width,r=this.height;return i.width=n+(t.width-n)*e,i.height=r+(t.height-r)*e,i},s.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},cc.size=function(t,e){return new o(t,e)},cc.sizeEqualToSize=function(t,e){return t&&e&&t.width===e.width&&t.height===e.height},cc.Size=e.exports=o},{"../platform/CCClass":123,"../platform/js":144,"./CCValueType":184}],182:[function(t,e,i){cc.Acceleration=function(t,e,i,n){this.x=t||0,this.y=e||0,this.z=i||0,this.timestamp=n||0},cc.BlendFunc=function(t,e){this.src=t,this.dst=e};var n=cc.Enum({ONE:1,ZERO:0,SRC_ALPHA:770,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775});cc.BlendFunc._disable=function(){return new cc.BlendFunc(n.ONE,n.ZERO)},cc.BlendFunc._alphaPremultiplied=function(){return new cc.BlendFunc(n.ONE,n.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._alphaNonPremultiplied=function(){return new cc.BlendFunc(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA)},cc.BlendFunc._additive=function(){return new cc.BlendFunc(n.SRC_ALPHA,n.ONE)},cc.BlendFunc.BlendFactor=n,cc.BlendFunc.DISABLE,cc.js.get(cc.BlendFunc,"DISABLE",cc.BlendFunc._disable),cc.BlendFunc.ALPHA_PREMULTIPLIED,cc.js.get(cc.BlendFunc,"ALPHA_PREMULTIPLIED",cc.BlendFunc._alphaPremultiplied),cc.BlendFunc.ALPHA_NON_PREMULTIPLIED,cc.js.get(cc.BlendFunc,"ALPHA_NON_PREMULTIPLIED",cc.BlendFunc._alphaNonPremultiplied),cc.BlendFunc.ADDITIVE,cc.js.get(cc.BlendFunc,"ADDITIVE",cc.BlendFunc._additive),cc.blendFuncDisable=cc.BlendFunc._disable,cc.TextAlignment=cc.Enum({LEFT:0,CENTER:1,RIGHT:2}),cc.VerticalTextAlignment=cc.Enum({TOP:0,CENTER:1,BOTTOM:2})},{}],183:[function(t,e,i){var n;cc.WebGLColor=function(t,e,i,n,r,o){this._arrayBuffer=r||new ArrayBuffer(cc.WebGLColor.BYTES_PER_ELEMENT),this._offset=o||0;var s=this._arrayBuffer,a=this._offset;this._view=new Uint8Array(s,a,4),this._view[0]=t||0,this._view[1]=e||0,this._view[2]=i||0,"number"==typeof n?this._view[3]=n:(this._view[3]=255,this.a_undefined=!0)},cc.WebGLColor.BYTES_PER_ELEMENT=4,(n=cc.WebGLColor.prototype)._getR=function(){return this._view[0]},n._setR=function(t){this._view[0]=t<0?0:t},n._getG=function(){return this._view[1]},n._setG=function(t){this._view[1]=t<0?0:t},n._getB=function(){return this._view[2]},n._setB=function(t){this._view[2]=t<0?0:t},n._getA=function(){return this._view[3]},n._setA=function(t){this._view[3]=t<0?0:t},n.r,cc.js.getset(n,"r",n._getR,n._setR),n.g,cc.js.getset(n,"g",n._getG,n._setG),n.b,cc.js.getset(n,"b",n._getB,n._setB),n.a,cc.js.getset(n,"a",n._getA,n._setA),cc.Vertex2F=function(t,e,i,n){this._arrayBuffer=i||new ArrayBuffer(cc.Vertex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=t||0,this._view[1]=e||0},cc.Vertex2F.BYTES_PER_ELEMENT=8,(n=cc.Vertex2F.prototype)._getX=function(){return this._view[0]},n._setX=function(t){this._view[0]=t},n._getY=function(){return this._view[1]},n._setY=function(t){this._view[1]=t},cc.js.getset(n,"x",n._getX,n._setX),cc.js.getset(n,"y",n._getY,n._setY),cc.Vertex3F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.Vertex3F.BYTES_PER_ELEMENT),this._offset=r||0;var o=this._arrayBuffer,s=this._offset;this._view=new Float32Array(o,s,3),this._view[0]=t||0,this._view[1]=e||0,this._view[2]=i||0},cc.Vertex3F.BYTES_PER_ELEMENT=12,(n=cc.Vertex3F.prototype)._getX=function(){return this._view[0]},n._setX=function(t){this._view[0]=t},n._getY=function(){return this._view[1]},n._setY=function(t){this._view[1]=t},n._getZ=function(){return this._view[2]},n._setZ=function(t){this._view[2]=t},cc.js.getset(n,"x",n._getX,n._setX),cc.js.getset(n,"y",n._getY,n._setY),cc.js.getset(n,"z",n._getZ,n._setZ),cc.Tex2F=function(t,e,i,n){this._arrayBuffer=i||new ArrayBuffer(cc.Tex2F.BYTES_PER_ELEMENT),this._offset=n||0,this._view=new Float32Array(this._arrayBuffer,this._offset,2),this._view[0]=t||0,this._view[1]=e||0},cc.Tex2F.BYTES_PER_ELEMENT=8,(n=cc.Tex2F.prototype)._getU=function(){return this._view[0]},n._setU=function(t){this._view[0]=t},n._getV=function(){return this._view[1]},n._setV=function(t){this._view[1]=t},cc.js.getset(n,"u",n._getU,n._setU),cc.js.getset(n,"v",n._getV,n._setV),cc.Quad2=function(t,e,i,n,r,o){this._arrayBuffer=r||new ArrayBuffer(cc.Quad2.BYTES_PER_ELEMENT),this._offset=o||0;var s=this._arrayBuffer,a=this._offset,c=cc.Vertex2F.BYTES_PER_ELEMENT;this._tl=t?new cc.Vertex2F(t.x,t.y,s,a):new cc.Vertex2F(0,0,s,a),a+=c,this._tr=e?new cc.Vertex2F(e.x,e.y,s,a):new cc.Vertex2F(0,0,s,a),a+=c,this._bl=i?new cc.Vertex2F(i.x,i.y,s,a):new cc.Vertex2F(0,0,s,a),a+=c,this._br=n?new cc.Vertex2F(n.x,n.y,s,a):new cc.Vertex2F(0,0,s,a)},cc.Quad2.BYTES_PER_ELEMENT=32,(n=cc.Quad2.prototype)._getTL=function(){return this._tl},n._setTL=function(t){this._tl._view[0]=t.x,this._tl._view[1]=t.y},n._getTR=function(){return this._tr},n._setTR=function(t){this._tr._view[0]=t.x,this._tr._view[1]=t.y},n._getBL=function(){return this._bl},n._setBL=function(t){this._bl._view[0]=t.x,this._bl._view[1]=t.y},n._getBR=function(){return this._br},n._setBR=function(t){this._br._view[0]=t.x,this._br._view[1]=t.y},cc.js.getset(n,"tl",n._getTL,n._setTL),cc.js.getset(n,"tr",n._getTR,n._setTR),cc.js.getset(n,"bl",n._getBL,n._setBL),cc.js.getset(n,"br",n._getBR,n._setBR),cc.Quad3=function(t,e,i,n,r,o){this._arrayBuffer=r||new ArrayBuffer(cc.Quad3.BYTES_PER_ELEMENT),this._offset=o||0;var s=this._arrayBuffer,a=this._offset,c=cc.Vertex3F.BYTES_PER_ELEMENT;this.bl=bl?new cc.Vertex3F(bl.x,bl.y,bl.z,s,a):new cc.Vertex3F(0,0,0,s,a),a+=c,this.br=br?new cc.Vertex3F(br.x,br.y,br.z,s,a):new cc.Vertex3F(0,0,0,s,a),a+=c,this.tl=tl?new cc.Vertex3F(tl.x,tl.y,tl.z,s,a):new cc.Vertex3F(0,0,0,s,a),a+=c,this.tr=tr?new cc.Vertex3F(tr.x,tr.y,tr.z,s,a):new cc.Vertex3F(0,0,0,s,a)},cc.Quad3.BYTES_PER_ELEMENT=48,cc.V3F_C4B_T2F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V3F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=r||0;var o=this._arrayBuffer,s=this._offset;this._vertices=t?new cc.Vertex3F(t.x,t.y,t.z,o,s):new cc.Vertex3F(0,0,0,o,s),s+=cc.Vertex3F.BYTES_PER_ELEMENT,this._colors=e?new cc.WebGLColor(e.r,e.g,e.b,e.a,o,s):new cc.WebGLColor(0,0,0,0,o,s),s+=cc.WebGLColor.BYTES_PER_ELEMENT,this._texCoords=i?new cc.Tex2F(i.u,i.v,o,s):new cc.Tex2F(0,0,o,s)},cc.V3F_C4B_T2F.BYTES_PER_ELEMENT=24,(n=cc.V3F_C4B_T2F.prototype)._getVertices=function(){return this._vertices},n._setVertices=function(t){var e=this._vertices;e._view[0]=t.x,e._view[1]=t.y,e._view[2]=t.z},n._getColor=function(){return this._colors},n._setColor=function(t){var e=this._colors;e._view[0]=t.r,e._view[1]=t.g,e._view[2]=t.b,e._view[3]=t.a},n._getTexCoords=function(){return this._texCoords},n._setTexCoords=function(t){this._texCoords._view[0]=t.u,this._texCoords._view[1]=t.v},cc.js.getset(n,"vertices",n._getVertices,n._setVertices),cc.js.getset(n,"colors",n._getColor,n._setColor),cc.js.getset(n,"texCoords",n._getTexCoords,n._setTexCoords),cc.V3F_C4B_T2F_Quad=function(t,e,i,n,r,o){this._arrayBuffer=r||new ArrayBuffer(cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT),this._offset=o||0;var s=this._arrayBuffer,a=this._offset,c=cc.V3F_C4B_T2F.BYTES_PER_ELEMENT;this._tl=t?new cc.V3F_C4B_T2F(t.vertices,t.colors,t.texCoords,s,a):new cc.V3F_C4B_T2F(null,null,null,s,a),a+=c,this._bl=e?new cc.V3F_C4B_T2F(e.vertices,e.colors,e.texCoords,s,a):new cc.V3F_C4B_T2F(null,null,null,s,a),a+=c,this._tr=i?new cc.V3F_C4B_T2F(i.vertices,i.colors,i.texCoords,s,a):new cc.V3F_C4B_T2F(null,null,null,s,a),a+=c,this._br=n?new cc.V3F_C4B_T2F(n.vertices,n.colors,n.texCoords,s,a):new cc.V3F_C4B_T2F(null,null,null,s,a)},cc.V3F_C4B_T2F_Quad.BYTES_PER_ELEMENT=96,(n=cc.V3F_C4B_T2F_Quad.prototype)._getTL=function(){return this._tl},n._setTL=function(t){var e=this._tl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getBL=function(){return this._bl},n._setBL=function(t){var e=this._bl;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getTR=function(){return this._tr},n._setTR=function(t){var e=this._tr;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getBR=function(){return this._br},n._setBR=function(t){var e=this._br;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getArrayBuffer=function(){return this._arrayBuffer},cc.js.getset(n,"tl",n._getTL,n._setTL),cc.js.getset(n,"tr",n._getTR,n._setTR),cc.js.getset(n,"bl",n._getBL,n._setBL),cc.js.getset(n,"br",n._getBR,n._setBR),cc.js.get(n,"arrayBuffer",n._getArrayBuffer),cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad},cc.V3F_C4B_T2F_QuadCopy=function(t){if(!t)return cc.V3F_C4B_T2F_QuadZero();var e=t.tl,i=t.bl,n=t.tr,r=t.br;return{tl:{vertices:{x:e.vertices.x,y:e.vertices.y,z:e.vertices.z},colors:{r:e.colors.r,g:e.colors.g,b:e.colors.b,a:e.colors.a},texCoords:{u:e.texCoords.u,v:e.texCoords.v}},bl:{vertices:{x:i.vertices.x,y:i.vertices.y,z:i.vertices.z},colors:{r:i.colors.r,g:i.colors.g,b:i.colors.b,a:i.colors.a},texCoords:{u:i.texCoords.u,v:i.texCoords.v}},tr:{vertices:{x:n.vertices.x,y:n.vertices.y,z:n.vertices.z},colors:{r:n.colors.r,g:n.colors.g,b:n.colors.b,a:n.colors.a},texCoords:{u:n.texCoords.u,v:n.texCoords.v}},br:{vertices:{x:r.vertices.x,y:r.vertices.y,z:r.vertices.z},colors:{r:r.colors.r,g:r.colors.g,b:r.colors.b,a:r.colors.a},texCoords:{u:r.texCoords.u,v:r.texCoords.v}}}},cc.V3F_C4B_T2F_QuadsCopy=function(t){if(!t)return[];for(var e=[],i=0;i<t.length;i++)e.push(cc.V3F_C4B_T2F_QuadCopy(t[i]));return e},cc.V2F_C4B_T2F=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F.BYTES_PER_ELEMENT),this._offset=r||0;var o=this._arrayBuffer,s=this._offset;this._vertices=t?new cc.Vertex2F(t.x,t.y,o,s):new cc.Vertex2F(0,0,o,s),s+=cc.Vertex2F.BYTES_PER_ELEMENT,this._colors=e?new cc.WebGLColor(e.r,e.g,e.b,e.a,o,s):new cc.WebGLColor(0,0,0,0,o,s),s+=cc.WebGLColor.BYTES_PER_ELEMENT,this._texCoords=i?new cc.Tex2F(i.u,i.v,o,s):new cc.Tex2F(0,0,o,s)},cc.V2F_C4B_T2F.BYTES_PER_ELEMENT=20,(n=cc.V2F_C4B_T2F.prototype)._getVertices=function(){return this._vertices},n._setVertices=function(t){this._vertices._view[0]=t.x,this._vertices._view[1]=t.y},n._getColor=function(){return this._colors},n._setColor=function(t){var e=this._colors;e._view[0]=t.r,e._view[1]=t.g,e._view[2]=t.b,e._view[3]=t.a},n._getTexCoords=function(){return this._texCoords},n._setTexCoords=function(t){this._texCoords._view[0]=t.u,this._texCoords._view[1]=t.v},cc.js.getset(n,"vertices",n._getVertices,n._setVertices),cc.js.getset(n,"colors",n._getColor,n._setColor),cc.js.getset(n,"texCoords",n._getTexCoords,n._setTexCoords),cc.V2F_C4B_T2F_Triangle=function(t,e,i,n,r){this._arrayBuffer=n||new ArrayBuffer(cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT),this._offset=r||0;var o=this._arrayBuffer,s=this._offset,a=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;this._a=t?new cc.V2F_C4B_T2F(t.vertices,t.colors,t.texCoords,o,s):new cc.V2F_C4B_T2F(null,null,null,o,s),s+=a,this._b=e?new cc.V2F_C4B_T2F(e.vertices,e.colors,e.texCoords,o,s):new cc.V2F_C4B_T2F(null,null,null,o,s),s+=a,this._c=i?new cc.V2F_C4B_T2F(i.vertices,i.colors,i.texCoords,o,s):new cc.V2F_C4B_T2F(null,null,null,o,s)},cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT=60,(n=cc.V2F_C4B_T2F_Triangle.prototype)._getA=function(){return this._a},n._setA=function(t){var e=this._a;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getB=function(){return this._b},n._setB=function(t){var e=this._b;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},n._getC=function(){return this._c},n._setC=function(t){var e=this._c;e.vertices=t.vertices,e.colors=t.colors,e.texCoords=t.texCoords},cc.js.getset(n,"a",n._getA,n._setA),cc.js.getset(n,"b",n._getB,n._setB),cc.js.getset(n,"c",n._getC,n._setC)},{}],184:[function(t,e,i){function n(){}t("../platform/js").setClassName("cc.ValueType",n),n.prototype.toString=function(){return""+{}},cc.ValueType=n,e.exports=n},{"../platform/js":144}],185:[function(t,e,i){var n=t("./CCValueType"),r=t("../platform/js"),o=t("../platform/CCClass");function s(t,e){t&&"object"==typeof t&&(e=t.y,t=t.x),this.x=t||0,this.y=e||0}r.extend(s,n),o.fastDefine("cc.Vec2",s,{x:0,y:0});var a=s.prototype;a.clone=function(){return new s(this.x,this.y)},a.set=function(t){return this.x=t.x,this.y=t.y,this},a.equals=function(t){return t&&this.x===t.x&&this.y===t.y},a.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},a.lerp=function(t,e,i){i=i||new s;var n=this.x,r=this.y;return i.x=n+(t.x-n)*e,i.y=r+(t.y-r)*e,i},a.addSelf=function(t){return this.x+=t.x,this.y+=t.y,this},a.add=function(t,e){return(e=e||new s).x=this.x+t.x,e.y=this.y+t.y,e},a.subSelf=function(t){return this.x-=t.x,this.y-=t.y,this},a.sub=function(t,e){return(e=e||new s).x=this.x-t.x,e.y=this.y-t.y,e},a.mulSelf=function(t){return this.x*=t,this.y*=t,this},a.mul=function(t,e){return(e=e||new s).x=this.x*t,e.y=this.y*t,e},a.scaleSelf=function(t){return this.x*=t.x,this.y*=t.y,this},a.scale=function(t,e){return(e=e||new s).x=this.x*t.x,e.y=this.y*t.y,e},a.divSelf=function(t){return this.x/=t,this.y/=t,this},a.div=function(t,e){return(e=e||new s).x=this.x/t,e.y=this.y/t,e},a.negSelf=function(){return this.x=-this.x,this.y=-this.y,this},a.neg=function(t){return(t=t||new s).x=-this.x,t.y=-this.y,t},a.dot=function(t){return this.x*t.x+this.y*t.y},a.cross=function(t){return this.y*t.x-this.x*t.y},a.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},a.magSqr=function(){return this.x*this.x+this.y*this.y},a.normalizeSelf=function(){var t=this.x*this.x+this.y*this.y;if(1===t)return this;if(0===t)return console.warn("Can't normalize zero vector"),this;var e=1/Math.sqrt(t);return this.x*=e,this.y*=e,this},a.normalize=function(t){return(t=t||new s).x=this.x,t.y=this.y,t.normalizeSelf(),t},a.angle=function(t){var e=this.magSqr(),i=t.magSqr();if(0===e||0===i)return console.warn("Can't get angle between zero vector"),0;var n=this.dot(t)/Math.sqrt(e*i);return n=cc.clampf(n,-1,1),Math.acos(n)},a.signAngle=function(t){return Math.atan2(this.y,this.x)-Math.atan2(t.y,t.x)},a.rotate=function(t,e){return(e=e||new s).x=this.x,e.y=this.y,e.rotateSelf(t)},a.rotateSelf=function(t){var e=Math.sin(t),i=Math.cos(t),n=this.x;return this.x=i*n-e*this.y,this.y=e*n+i*this.y,this},r.get(s,"ONE",function(){return new s(1,1)}),r.get(s,"ZERO",function(){return new s(0,0)}),r.get(s,"UP",function(){return new s(0,1)}),r.get(s,"RIGHT",function(){return new s(1,0)}),cc.Vec2=s,cc.v2=function(t,e){return new s(t,e)},cc.p=cc.v2,cc.pointEqualToPoint=function(t,e){return t&&e&&t.x===e.x&&t.y===e.y},e.exports=cc.Vec2},{"../platform/CCClass":123,"../platform/js":144,"./CCValueType":184}],186:[function(t,e,i){t("./CCValueType"),t("./CCVec2"),t("./CCPointExtension"),t("./CCSize"),t("./CCRect"),t("./CCColor"),t("./CCTypes"),t("./CCAffineTransform"),t("./CCTypesWebGL")},{"./CCAffineTransform":177,"./CCColor":178,"./CCPointExtension":179,"./CCRect":180,"./CCSize":181,"./CCTypes":182,"./CCTypesWebGL":183,"./CCValueType":184,"./CCVec2":185}],187:[function(t,e,i){cc.js},{}],188:[function(t,e,i){t("./core/CCGame"),t("./actions"),t("./core/base-nodes/CCSGNode"),t("./core/base-nodes/CCSGNodeBaseRenderCmd"),t("./core/base-nodes/CCSGNodeCanvasRenderCmd"),t("./core/base-nodes/CCSGNodeWebGLRenderCmd"),t("./core/scenes/CCSGScene"),t("./core/CCConfiguration"),t("./core/sprites/CCSGSprite"),t("./core/sprites/CCSGSpriteCanvasRenderCmd"),t("./core/sprites/CCSGSpriteWebGLRenderCmd"),t("./core/sprites/CCScale9Sprite"),t("./core/sprites/CCScale9SpriteCanvasRenderCmd"),t("./core/sprites/CCScale9SpriteWebGLRenderCmd"),t("./core/sprites/CCSpriteBatchNode"),t("./render-texture/CCRenderTexture"),t("./render-texture/CCRenderTextureCanvasRenderCmd"),t("./render-texture/CCRenderTextureWebGLRenderCmd")},{"./actions":218,"./core/CCConfiguration":21,"./core/CCGame":28,"./core/base-nodes/CCSGNode":44,"./core/base-nodes/CCSGNodeBaseRenderCmd":45,"./core/base-nodes/CCSGNodeCanvasRenderCmd":46,"./core/base-nodes/CCSGNodeWebGLRenderCmd":47,"./core/scenes/CCSGScene":154,"./core/sprites/CCSGSprite":155,"./core/sprites/CCSGSpriteCanvasRenderCmd":156,"./core/sprites/CCSGSpriteWebGLRenderCmd":157,"./core/sprites/CCScale9Sprite":158,"./core/sprites/CCScale9SpriteCanvasRenderCmd":159,"./core/sprites/CCScale9SpriteWebGLRenderCmd":160,"./core/sprites/CCSpriteBatchNode":161,"./render-texture/CCRenderTexture":202,"./render-texture/CCRenderTextureCanvasRenderCmd":203,"./render-texture/CCRenderTextureWebGLRenderCmd":204}],189:[function(t,e,i){cc.math.AABB=function(t,e){this.min=t||new cc.math.Vec3,this.max=e||new cc.math.Vec3},cc.math.AABB.prototype.containsPoint=function(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z},cc.math.AABB.containsPoint=function(t,e){return t.x>=e.min.x&&t.x<=e.max.x&&t.y>=e.min.y&&t.y<=e.max.y&&t.z>=e.min.z&&t.z<=e.max.z},cc.math.AABB.prototype.assignFrom=function(t){this.min.assignFrom(t.min),this.max.assignFrom(t.max)},cc.math.AABB.assign=function(t,e){return t.min.assignFrom(e.min),t.max.assignFrom(e.max),t}},{}],190:[function(t,e,i){cc.math.Matrix4Stack=function(t,e){this.top=t,this.stack=e||[],this.lastUpdated=0};var n=cc.math.Matrix4Stack.prototype;n.initialize=function(){this.stack.length=0,this.top=null},n.push=function(t){t=t||this.top,this.stack.push(this.top),this.top=new cc.math.Matrix4(t),this.update()},n.pop=function(){this.top=this.stack.pop(),this.update()},n.update=function(){this.lastUpdated++},n.release=function(){this.stack=null,this.top=null,this._matrixPool=null},n._getFromPool=function(t){var e=this._matrixPool;if(0===e.length)return new cc.math.Matrix4(t);var i=e.pop();return i.assignFrom(t),i},n._putInPool=function(t){this._matrixPool.push(t)}},{}],191:[function(t,e,i){var o=cc.math;o.KM_GL_MODELVIEW=5888,o.KM_GL_PROJECTION=5889,o.KM_GL_TEXTURE=5890,o.modelview_matrix_stack=new o.Matrix4Stack,o.projection_matrix_stack=new o.Matrix4Stack,o.texture_matrix_stack=new o.Matrix4Stack,cc.current_stack=null;var n=!1;(function(){if(!n){var t=new o.Matrix4;o.modelview_matrix_stack.initialize(),o.projection_matrix_stack.initialize(),o.texture_matrix_stack.initialize(),cc.current_stack=o.modelview_matrix_stack,n=!0,t.identity(),o.modelview_matrix_stack.push(t),o.projection_matrix_stack.push(t),o.texture_matrix_stack.push(t)}})(),o.glFreeAll=function(){o.modelview_matrix_stack.release(),o.modelview_matrix_stack=null,o.projection_matrix_stack.release(),o.projection_matrix_stack=null,o.texture_matrix_stack.release(),o.texture_matrix_stack=null,n=!1,cc.current_stack=null},o.glPushMatrix=function(){cc.current_stack.push(cc.current_stack.top),cc.current_stack.update()},o.glPushMatrixWitMat4=function(t){cc.current_stack.stack.push(cc.current_stack.top),t.assignFrom(cc.current_stack.top),cc.current_stack.top=t,cc.current_stack.update()},o.glPopMatrix=function(){cc.current_stack.top=cc.current_stack.stack.pop(),cc.current_stack.update()},o.glMatrixMode=function(t){switch(t){case o.KM_GL_MODELVIEW:cc.current_stack=o.modelview_matrix_stack;break;case o.KM_GL_PROJECTION:cc.current_stack=o.projection_matrix_stack;break;case o.KM_GL_TEXTURE:cc.current_stack=o.texture_matrix_stack;break;default:throw new Error("Invalid matrix mode specified")}},o.glLoadIdentity=function(){cc.current_stack.top.identity(),cc.current_stack.update()},o.glLoadMatrix=function(t){cc.current_stack.top.assignFrom(t),cc.current_stack.update()},o.glMultMatrix=function(t){cc.current_stack.top.multiply(t),cc.current_stack.update()};var s=new o.Matrix4;o.glTranslatef=function(t,e,i){var n=o.Matrix4.createByTranslation(t,e,i,s);cc.current_stack.top.multiply(n),cc.current_stack.update()};var a=new o.Vec3;o.glRotatef=function(t,e,i,n){a.fill(e,i,n);var r=o.Matrix4.createByAxisAndAngle(a,cc.degreesToRadians(t),s);cc.current_stack.top.multiply(r),cc.current_stack.update()},o.glScalef=function(t,e,i){var n=o.Matrix4.createByScale(t,e,i,s);cc.current_stack.top.multiply(n),cc.current_stack.update()},o.glGetMatrix=function(t,e){switch(t){case o.KM_GL_MODELVIEW:e.assignFrom(o.modelview_matrix_stack.top);break;case o.KM_GL_PROJECTION:e.assignFrom(o.projection_matrix_stack.top);break;case o.KM_GL_TEXTURE:e.assignFrom(o.texture_matrix_stack.top);break;default:throw new Error("Invalid matrix mode specified")}}},{}],192:[function(t,e,i){t("./utility"),t("./vec2"),t("./vec3"),t("./vec4"),t("./ray2"),t("./mat3"),t("./mat4"),t("./plane"),t("./quaternion"),t("./aabb"),t("./gl/mat4stack"),t("./gl/matrix")},{"./aabb":189,"./gl/mat4stack":190,"./gl/matrix":191,"./mat3":193,"./mat4":194,"./plane":195,"./quaternion":196,"./ray2":197,"./utility":198,"./vec2":199,"./vec3":200,"./vec4":201}],193:[function(t,e,i){window.Uint16Array=window.Uint16Array||window.Array,window.Float32Array=window.Float32Array||window.Array,cc.math.Matrix3=function(t){t&&t.mat?this.mat=new Float32Array(t.mat):this.mat=new Float32Array(9)};var n=cc.math.Matrix3.prototype;n.fill=function(t){var e=this.mat,i=t.mat;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},n.adjugate=function(){var t=this.mat,e=t[0],i=t[1],n=t[2],r=t[3],o=t[4],s=t[5],a=t[6],c=t[7],h=t[8];return t[0]=o*h-s*c,t[1]=n*c-i*h,t[2]=i*s-n*o,t[3]=s*a-r*h,t[4]=e*h-n*a,t[5]=n*r-e*s,t[6]=r*c-o*a,t[8]=e*o-i*r,this},n.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[5]=t[6]=t[7]=0,t[0]=t[4]=t[8]=1,this};var r=new cc.math.Matrix3;n.inverse=function(t){if(0===t)return this;r.assignFrom(this);var e=1/t;return this.adjugate(),this.multiplyScalar(e),this},n.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&1===t[4]&&0===t[5]&&0===t[6]&&0===t[7]&&1===t[8]},n.transpose=function(){var t=this.mat,e=t[1],i=t[2],n=t[3],r=t[5],o=t[6],s=t[7];return t[1]=n,t[2]=o,t[3]=e,t[5]=s,t[6]=i,t[7]=r,this},n.determinant=function(){var t=this.mat;return t[0]*t[4]*t[8]+t[1]*t[5]*t[6]+t[2]*t[3]*t[7]-(t[2]*t[4]*t[6]+t[0]*t[5]*t[7]+t[1]*t[3]*t[8])},n.multiply=function(t){var e=this.mat,i=t.mat,n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],c=e[5],h=e[6],l=e[7],u=e[8],_=i[0],d=i[1],f=i[2],p=i[3],g=i[4],m=i[5],v=i[6],y=i[7],C=i[8];return e[0]=n*_+s*d+h*f,e[1]=r*_+a*d+l*f,e[2]=o*_+c*d+u*f,e[3]=o*_+c*d+u*f,e[4]=r*p+a*g+l*m,e[5]=o*p+c*g+u*m,e[6]=n*v+s*y+h*C,e[7]=r*v+a*y+l*C,e[8]=o*v+c*y+u*C,this},n.multiplyScalar=function(t){var e=this.mat;return e[0]*=t,e[1]*=t,e[2]*=t,e[3]*=t,e[4]*=t,e[5]*=t,e[6]*=t,e[7]*=t,e[8]*=t,this},cc.math.Matrix3.rotationAxisAngle=function(t,e){var i=Math.cos(e),n=Math.sin(e),r=new cc.math.Matrix3,o=r.mat;return o[0]=i+t.x*t.x*(1-i),o[1]=t.z*n+t.y*t.x*(1-i),o[2]=-t.y*n+t.z*t.x*(1-i),o[3]=-t.z*n+t.x*t.y*(1-i),o[4]=i+t.y*t.y*(1-i),o[5]=t.x*n+t.z*t.y*(1-i),o[6]=t.y*n+t.x*t.z*(1-i),o[7]=-t.x*n+t.y*t.z*(1-i),o[8]=i+t.z*t.z*(1-i),r},n.assignFrom=function(t){if(this===t)return cc.logID(7900),this;var e=this.mat,i=t.mat;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],this},n.equals=function(t){if(this===t)return!0;for(var e=cc.math.EPSILON,i=this.mat,n=t.mat,r=0;r<9;++r)if(!(i[r]+e>n[r]&&i[r]-e<n[r]))return!1;return!0},cc.math.Matrix3.createByRotationX=function(t){var e=new cc.math.Matrix3,i=e.mat;return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=Math.cos(t),i[5]=Math.sin(t),i[6]=0,i[7]=-Math.sin(t),i[8]=Math.cos(t),e},cc.math.Matrix3.createByRotationY=function(t){var e=new cc.math.Matrix3,i=e.mat;return i[0]=Math.cos(t),i[1]=0,i[2]=-Math.sin(t),i[3]=0,i[4]=1,i[5]=0,i[6]=Math.sin(t),i[7]=0,i[8]=Math.cos(t),e},cc.math.Matrix3.createByRotationZ=function(t){var e=new cc.math.Matrix3,i=e.mat;return i[0]=Math.cos(t),i[1]=-Math.sin(t),i[2]=0,i[3]=Math.sin(t),i[4]=Math.cos(t),i[5]=0,i[6]=0,i[7]=0,i[8]=1,e},cc.math.Matrix3.createByRotation=function(t){var e=new cc.math.Matrix3,i=e.mat;return i[0]=Math.cos(t),i[1]=Math.sin(t),i[2]=0,i[3]=-Math.sin(t),i[4]=Math.cos(t),i[5]=0,i[6]=0,i[7]=0,i[8]=1,e},cc.math.Matrix3.createByScale=function(t,e){var i=new cc.math.Matrix3;return i.identity(),i.mat[0]=t,i.mat[4]=e,i},cc.math.Matrix3.createByTranslation=function(t,e){var i=new cc.math.Matrix3;return i.identity(),i.mat[6]=t,i.mat[7]=e,i},cc.math.Matrix3.createByQuaternion=function(t){if(!t)return null;var e=new cc.math.Matrix3,i=e.mat;return i[0]=1-2*(t.y*t.y+t.z*t.z),i[1]=2*(t.x*t.y-t.w*t.z),i[2]=2*(t.x*t.z+t.w*t.y),i[3]=2*(t.x*t.y+t.w*t.z),i[4]=1-2*(t.x*t.x+t.z*t.z),i[5]=2*(t.y*t.z-t.w*t.x),i[6]=2*(t.x*t.z-t.w*t.y),i[7]=2*(t.y*t.z+t.w*t.x),i[8]=1-2*(t.x*t.x+t.y*t.y),e},n.rotationToAxisAngle=function(){return cc.math.Quaternion.rotationMatrix(this).toAxisAndAngle()}},{}],194:[function(t,e,i){cc.math.Matrix4=function(t){t&&t.mat?this.mat=new Float32Array(t.mat):this.mat=new Float32Array(16)};var n=cc.math.Matrix4.prototype;n.fill=function(t){for(var e=this.mat,i=0;i<16;i++)e[i]=t[i];return this},cc.math.mat4Identity=function(t){var e=t.mat;return e[1]=e[2]=e[3]=e[4]=e[6]=e[7]=e[8]=e[9]=e[11]=e[12]=e[13]=e[14]=0,e[0]=e[5]=e[10]=e[15]=1,t},n.identity=function(){var t=this.mat;return t[1]=t[2]=t[3]=t[4]=t[6]=t[7]=t[8]=t[9]=t[11]=t[12]=t[13]=t[14]=0,t[0]=t[5]=t[10]=t[15]=1,this},n.get=function(t,e){return this.mat[t+4*e]},n.set=function(t,e,i){this.mat[t+4*e]=i},n.swap=function(t,e,i,n){var r=this.mat,o=r[t+4*e];r[t+4*e]=r[i+4*n],r[i+4*n]=o},cc.math.Matrix4._gaussj=function(t,e){var i,n,r,o,s,a,c,h,l,u=0,_=0,d=[0,0,0,0],f=[0,0,0,0],p=[0,0,0,0];for(i=0;i<4;i++){for(n=c=0;n<4;n++)if(1!==p[n])for(r=0;r<4;r++)0===p[r]&&(a=Math.abs(t.get(n,r)))>=c&&(c=a,_=n,u=r);if(++p[u],_!==u){for(o=0;o<4;o++)t.swap(_,o,u,o);for(o=0;o<4;o++)e.swap(_,o,u,o)}if(f[i]=_,d[i]=u,0===t.get(u,u))return!1;for(l=1/t.get(u,u),t.set(u,u,1),o=0;o<4;o++)t.set(u,o,t.get(u,o)*l);for(o=0;o<4;o++)e.set(u,o,e.get(u,o)*l);for(s=0;s<4;s++)if(s!==u){for(h=t.get(s,u),t.set(s,u,0),o=0;o<4;o++)t.set(s,o,t.get(s,o)-t.get(u,o)*h);for(o=0;o<4;o++)e.set(s,o,t.get(s,o)-e.get(u,o)*h)}}for(o=3;0<=o;o--)if(f[o]!==d[o])for(r=0;r<4;r++)t.swap(r,f[o],r,d[o]);return!0};var r=(new cc.math.Matrix4).identity();cc.math.mat4Inverse=function(t,e){var i=new cc.math.Matrix4(e),n=new cc.math.Matrix4(r);return!1===cc.math.Matrix4._gaussj(i,n)?null:(t.assignFrom(i),t)},n.inverse=function(){var t=new cc.math.Matrix4(this),e=new cc.math.Matrix4(r);return!1===cc.math.Matrix4._gaussj(t,e)?null:t},n.isIdentity=function(){var t=this.mat;return 1===t[0]&&0===t[1]&&0===t[2]&&0===t[3]&&0===t[4]&&1===t[5]&&0===t[6]&&0===t[7]&&0===t[8]&&0===t[9]&&1===t[10]&&0===t[11]&&0===t[12]&&0===t[13]&&0===t[14]&&1===t[15]},n.transpose=function(){var t=this.mat,e=t[1],i=t[2],n=t[3],r=t[4],o=t[6],s=t[7],a=t[8],c=t[9],h=t[11],l=t[12],u=t[13],_=t[14];return t[1]=r,t[2]=a,t[3]=l,t[4]=e,t[6]=c,t[7]=u,t[8]=i,t[9]=o,t[11]=_,t[12]=n,t[13]=s,t[14]=h,this},cc.math.mat4Multiply=function(t,e,i){var n=t.mat,r=e.mat,o=i.mat,s=r[0],a=r[1],c=r[2],h=r[3],l=r[4],u=r[5],_=r[6],d=r[7],f=r[8],p=r[9],g=r[10],m=r[11],v=r[12],y=r[13],C=r[14],T=r[15],x=o[0],E=o[1],S=o[2],b=o[3],R=o[4],A=o[5],O=o[6],I=o[7],w=o[8],L=o[9],N=o[10],P=o[11],D=o[12],F=o[13],M=o[14],B=o[15];return n[0]=x*s+E*l+S*f+b*v,n[1]=x*a+E*u+S*p+b*y,n[2]=x*c+E*_+S*g+b*C,n[3]=x*h+E*d+S*m+b*T,n[4]=R*s+A*l+O*f+I*v,n[5]=R*a+A*u+O*p+I*y,n[6]=R*c+A*_+O*g+I*C,n[7]=R*h+A*d+O*m+I*T,n[8]=w*s+L*l+N*f+P*v,n[9]=w*a+L*u+N*p+P*y,n[10]=w*c+L*_+N*g+P*C,n[11]=w*h+L*d+N*m+P*T,n[12]=D*s+F*l+M*f+B*v,n[13]=D*a+F*u+M*p+B*y,n[14]=D*c+F*_+M*g+B*C,n[15]=D*h+F*d+M*m+B*T,t},n.multiply=function(t){var e=this.mat,i=t.mat,n=e[0],r=e[1],o=e[2],s=e[3],a=e[4],c=e[5],h=e[6],l=e[7],u=e[8],_=e[9],d=e[10],f=e[11],p=e[12],g=e[13],m=e[14],v=e[15],y=i[0],C=i[1],T=i[2],x=i[3],E=i[4],S=i[5],b=i[6],R=i[7],A=i[8],O=i[9],I=i[10],w=i[11],L=i[12],N=i[13],P=i[14],D=i[15];return e[0]=y*n+C*a+T*u+x*p,e[1]=y*r+C*c+T*_+x*g,e[2]=y*o+C*h+T*d+x*m,e[3]=y*s+C*l+T*f+x*v,e[4]=E*n+S*a+b*u+R*p,e[5]=E*r+S*c+b*_+R*g,e[6]=E*o+S*h+b*d+R*m,e[7]=E*s+S*l+b*f+R*v,e[8]=A*n+O*a+I*u+w*p,e[9]=A*r+O*c+I*_+w*g,e[10]=A*o+O*h+I*d+w*m,e[11]=A*s+O*l+I*f+w*v,e[12]=L*n+N*a+P*u+D*p,e[13]=L*r+N*c+P*_+D*g,e[14]=L*o+N*h+P*d+D*m,e[15]=L*s+N*l+P*f+D*v,this},cc.math.getMat4MultiplyValue=function(t,e){var i=t.mat,n=e.mat,r=new Float32Array(16);return r[0]=i[0]*n[0]+i[4]*n[1]+i[8]*n[2]+i[12]*n[3],r[1]=i[1]*n[0]+i[5]*n[1]+i[9]*n[2]+i[13]*n[3],r[2]=i[2]*n[0]+i[6]*n[1]+i[10]*n[2]+i[14]*n[3],r[3]=i[3]*n[0]+i[7]*n[1]+i[11]*n[2]+i[15]*n[3],r[4]=i[0]*n[4]+i[4]*n[5]+i[8]*n[6]+i[12]*n[7],r[5]=i[1]*n[4]+i[5]*n[5]+i[9]*n[6]+i[13]*n[7],r[6]=i[2]*n[4]+i[6]*n[5]+i[10]*n[6]+i[14]*n[7],r[7]=i[3]*n[4]+i[7]*n[5]+i[11]*n[6]+i[15]*n[7],r[8]=i[0]*n[8]+i[4]*n[9]+i[8]*n[10]+i[12]*n[11],r[9]=i[1]*n[8]+i[5]*n[9]+i[9]*n[10]+i[13]*n[11],r[10]=i[2]*n[8]+i[6]*n[9]+i[10]*n[10]+i[14]*n[11],r[11]=i[3]*n[8]+i[7]*n[9]+i[11]*n[10]+i[15]*n[11],r[12]=i[0]*n[12]+i[4]*n[13]+i[8]*n[14]+i[12]*n[15],r[13]=i[1]*n[12]+i[5]*n[13]+i[9]*n[14]+i[13]*n[15],r[14]=i[2]*n[12]+i[6]*n[13]+i[10]*n[14]+i[14]*n[15],r[15]=i[3]*n[12]+i[7]*n[13]+i[11]*n[14]+i[15]*n[15],r},cc.math.mat4Assign=function(t,e){if(t===e)return cc.logID(7901),t;var i=t.mat,n=e.mat;return i[0]=n[0],i[1]=n[1],i[2]=n[2],i[3]=n[3],i[4]=n[4],i[5]=n[5],i[6]=n[6],i[7]=n[7],i[8]=n[8],i[9]=n[9],i[10]=n[10],i[11]=n[11],i[12]=n[12],i[13]=n[13],i[14]=n[14],i[15]=n[15],t},n.assignFrom=function(t){if(this===t)return cc.logID(7902),this;var e=this.mat,i=t.mat;return e[0]=i[0],e[1]=i[1],e[2]=i[2],e[3]=i[3],e[4]=i[4],e[5]=i[5],e[6]=i[6],e[7]=i[7],e[8]=i[8],e[9]=i[9],e[10]=i[10],e[11]=i[11],e[12]=i[12],e[13]=i[13],e[14]=i[14],e[15]=i[15],this},n.equals=function(t){if(this===t)return cc.logID(7903),!0;for(var e=this.mat,i=t.mat,n=cc.math.EPSILON,r=0;r<16;r++)if(!(e[r]+n>i[r]&&e[r]-n<i[r]))return!1;return!0},cc.math.Matrix4.createByRotationX=function(t,e){var i=(e=e||new cc.math.Matrix4).mat;return i[0]=1,i[3]=i[2]=i[1]=0,i[4]=0,i[5]=Math.cos(t),i[6]=Math.sin(t),i[7]=0,i[8]=0,i[9]=-Math.sin(t),i[10]=Math.cos(t),i[11]=0,i[14]=i[13]=i[12]=0,i[15]=1,e},cc.math.Matrix4.createByRotationY=function(t,e){var i=(e=e||new cc.math.Matrix4).mat;return i[0]=Math.cos(t),i[1]=0,i[2]=-Math.sin(t),i[3]=0,i[7]=i[6]=i[4]=0,i[5]=1,i[8]=Math.sin(t),i[9]=0,i[10]=Math.cos(t),i[11]=0,i[14]=i[13]=i[12]=0,i[15]=1,e},cc.math.Matrix4.createByRotationZ=function(t,e){var i=(e=e||new cc.math.Matrix4).mat;return i[0]=Math.cos(t),i[1]=Math.sin(t),i[3]=i[2]=0,i[4]=-Math.sin(t),i[5]=Math.cos(t),i[7]=i[6]=0,i[11]=i[9]=i[8]=0,i[10]=1,i[14]=i[13]=i[12]=0,i[15]=1,e},cc.math.Matrix4.createByPitchYawRoll=function(t,e,i,n){n=n||new cc.math.Matrix4;var r=Math.cos(t),o=Math.sin(t),s=Math.cos(e),a=Math.sin(e),c=Math.cos(i),h=Math.sin(i),l=o*a,u=r*a,_=n.mat;return _[0]=s*c,_[4]=s*h,_[8]=-a,_[1]=l*c-r*h,_[5]=l*h+r*c,_[9]=o*s,_[2]=u*c+o*h,_[6]=u*h-o*c,_[10]=r*s,_[3]=_[7]=_[11]=0,_[15]=1,n},cc.math.Matrix4.createByQuaternion=function(t,e){var i=(e=e||new cc.math.Matrix4).mat;return i[0]=1-2*(t.y*t.y+t.z*t.z),i[1]=2*(t.x*t.y+t.z*t.w),i[2]=2*(t.x*t.z-t.y*t.w),i[3]=0,i[4]=2*(t.x*t.y-t.z*t.w),i[5]=1-2*(t.x*t.x+t.z*t.z),i[6]=2*(t.z*t.y+t.x*t.w),i[7]=0,i[8]=2*(t.x*t.z+t.y*t.w),i[9]=2*(t.y*t.z-t.x*t.w),i[10]=1-2*(t.x*t.x+t.y*t.y),i[11]=0,i[14]=i[13]=i[12]=0,i[15]=1,e},cc.math.Matrix4.createByRotationTranslation=function(t,e,i){var n=(i=i||new cc.math.Matrix4).mat,r=t.mat;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=0,n[4]=r[3],n[5]=r[4],n[6]=r[5],n[7]=0,n[8]=r[6],n[9]=r[7],n[10]=r[8],n[11]=0,n[12]=e.x,n[13]=e.y,n[14]=e.z,n[15]=1,i},cc.math.Matrix4.createByScale=function(t,e,i,n){var r=(n=n||new cc.math.Matrix4).mat;return r[0]=t,r[5]=e,r[10]=i,r[15]=1,r[1]=r[2]=r[3]=r[4]=r[6]=r[7]=r[8]=r[9]=r[11]=r[12]=r[13]=r[14]=0,n},cc.math.mat4Translation=function(t,e,i,n){return t.mat[0]=t.mat[5]=t.mat[10]=t.mat[15]=1,t.mat[1]=t.mat[2]=t.mat[3]=t.mat[4]=t.mat[6]=t.mat[7]=t.mat[8]=t.mat[9]=t.mat[11]=0,t.mat[12]=e,t.mat[13]=i,t.mat[14]=n,t},cc.math.Matrix4.createByTranslation=function(t,e,i,n){return(n=n||new cc.math.Matrix4).identity(),n.mat[12]=t,n.mat[13]=e,n.mat[14]=i,n},n.getUpVec3=function(){var t=this.mat;return new cc.math.Vec3(t[4],t[5],t[6]).normalize()},n.getRightVec3=function(){var t=this.mat;return new cc.math.Vec3(t[0],t[1],t[2]).normalize()},n.getForwardVec3=function(){var t=this.mat;return new cc.math.Vec3(t[8],t[9],t[10]).normalize()},cc.math.mat4PerspectiveProjection=function(t,e,i,n,r){var o=cc.degreesToRadians(e/2),s=r-n,a=Math.sin(o);if(0===s||0===a||0===i)return null;var c=Math.cos(o)/a;return t.identity(),t.mat[0]=c/i,t.mat[5]=c,t.mat[10]=-(r+n)/s,t.mat[11]=-1,t.mat[14]=-2*n*r/s,t.mat[15]=0,t},cc.math.Matrix4.createPerspectiveProjection=function(t,e,i,n){var r=cc.degreesToRadians(t/2),o=n-i,s=Math.sin(r);if(0===o||0===s||0===e)return null;var a=Math.cos(r)/s,c=new cc.math.Matrix4,h=c.mat;return c.identity(),h[0]=a/e,h[5]=a,h[10]=-(n+i)/o,h[11]=-1,h[14]=-2*i*n/o,h[15]=0,c},cc.math.mat4OrthographicProjection=function(t,e,i,n,r,o,s){return t.identity(),t.mat[0]=2/(i-e),t.mat[5]=2/(r-n),t.mat[10]=-2/(s-o),t.mat[12]=-(i+e)/(i-e),t.mat[13]=-(r+n)/(r-n),t.mat[14]=-(s+o)/(s-o),t},cc.math.Matrix4.createOrthographicProjection=function(t,e,i,n,r,o){var s=new cc.math.Matrix4,a=s.mat;return s.identity(),a[0]=2/(e-t),a[5]=2/(n-i),a[10]=-2/(o-r),a[12]=-(e+t)/(e-t),a[13]=-(n+i)/(n-i),a[14]=-(o+r)/(o-r),s},cc.math.mat4LookAt=function(t,e,i,n){var r=new cc.math.Vec3(i),o=new cc.math.Vec3(n);r.subtract(e),r.normalize(),o.normalize();var s=new cc.math.Vec3(r);s.cross(o),s.normalize();var a=new cc.math.Vec3(s);a.cross(r),s.normalize(),t.identity(),t.mat[0]=s.x,t.mat[4]=s.y,t.mat[8]=s.z,t.mat[1]=a.x,t.mat[5]=a.y,t.mat[9]=a.z,t.mat[2]=-r.x,t.mat[6]=-r.y,t.mat[10]=-r.z;var c=cc.math.Matrix4.createByTranslation(-e.x,-e.y,-e.z);return t.multiply(c),t};var c=new cc.math.Matrix4;n.lookAt=function(t,e,i){var n=new cc.math.Vec3(e),r=new cc.math.Vec3(i),o=this.mat;n.subtract(t),n.normalize(),r.normalize();var s=new cc.math.Vec3(n);s.cross(r),s.normalize();var a=new cc.math.Vec3(s);return a.cross(n),s.normalize(),this.identity(),o[0]=s.x,o[4]=s.y,o[8]=s.z,o[1]=a.x,o[5]=a.y,o[9]=a.z,o[2]=-n.x,o[6]=-n.y,o[10]=-n.z,c=cc.math.Matrix4.createByTranslation(-t.x,-t.y,-t.z,c),this.multiply(c),this},cc.math.mat4RotationAxisAngle=function(t,e,i){var n=Math.cos(i),r=Math.sin(i),o=new cc.math.Vec3(e);return o.normalize(),t.mat[0]=n+o.x*o.x*(1-n),t.mat[1]=o.z*r+o.y*o.x*(1-n),t.mat[2]=-o.y*r+o.z*o.x*(1-n),t.mat[3]=0,t.mat[4]=-o.z*r+o.x*o.y*(1-n),t.mat[5]=n+o.y*o.y*(1-n),t.mat[6]=o.x*r+o.z*o.y*(1-n),t.mat[7]=0,t.mat[8]=o.y*r+o.x*o.z*(1-n),t.mat[9]=-o.x*r+o.y*o.z*(1-n),t.mat[10]=n+o.z*o.z*(1-n),t.mat[11]=0,t.mat[12]=0,t.mat[13]=0,t.mat[14]=0,t.mat[15]=1,t},cc.math.Matrix4.createByAxisAndAngle=function(t,e,i){i=i||new cc.math.Matrix4;var n=this.mat,r=Math.cos(e),o=Math.sin(e),s=new cc.math.Vec3(t);return s.normalize(),n[0]=r+s.x*s.x*(1-r),n[1]=s.z*o+s.y*s.x*(1-r),n[2]=-s.y*o+s.z*s.x*(1-r),n[3]=0,n[4]=-s.z*o+s.x*s.y*(1-r),n[5]=r+s.y*s.y*(1-r),n[6]=s.x*o+s.z*s.y*(1-r),n[7]=0,n[8]=s.y*o+s.x*s.z*(1-r),n[9]=-s.x*o+s.y*s.z*(1-r),n[10]=r+s.z*s.z*(1-r),n[11]=0,n[12]=n[13]=n[14]=0,n[15]=1,i},n.extractRotation=function(){var t=new cc.math.Matrix3,e=this.mat,i=t.mat;return i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=e[4],i[4]=e[5],i[5]=e[6],i[6]=e[8],i[7]=e[9],i[8]=e[10],t},n.extractPlane=function(t){var e=new cc.math.Plane,i=this.mat;switch(t){case cc.math.Plane.RIGHT:e.a=i[3]-i[0],e.b=i[7]-i[4],e.c=i[11]-i[8],e.d=i[15]-i[12];break;case cc.math.Plane.LEFT:e.a=i[3]+i[0],e.b=i[7]+i[4],e.c=i[11]+i[8],e.d=i[15]+i[12];break;case cc.math.Plane.BOTTOM:e.a=i[3]+i[1],e.b=i[7]+i[5],e.c=i[11]+i[9],e.d=i[15]+i[13];break;case cc.math.Plane.TOP:e.a=i[3]-i[1],e.b=i[7]-i[5],e.c=i[11]-i[9],e.d=i[15]-i[13];break;case cc.math.Plane.FAR:e.a=i[3]-i[2],e.b=i[7]-i[6],e.c=i[11]-i[10],e.d=i[15]-i[14];break;case cc.math.Plane.NEAR:e.a=i[3]+i[2],e.b=i[7]+i[6],e.c=i[11]+i[10],e.d=i[15]+i[14];break;default:cc.logID(7904)}var n=Math.sqrt(e.a*e.a+e.b*e.b+e.c*e.c);return e.a/=n,e.b/=n,e.c/=n,e.d/=n,e},n.toAxisAndAngle=function(){var t=this.extractRotation();return cc.math.Quaternion.rotationMatrix(t).toAxisAndAngle()}},{}],195:[function(t,e,i){cc.math.Plane=function(t,e,i,n){t&&void 0===e?(this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d):(this.a=t||0,this.b=e||0,this.c=i||0,this.d=n||0)};var n=cc.math.Plane.prototype;cc.math.Plane.LEFT=0,cc.math.Plane.RIGHT=1,cc.math.Plane.BOTTOM=2,cc.math.Plane.TOP=3,cc.math.Plane.NEAR=4,cc.math.Plane.FAR=5,cc.math.Plane.POINT_INFRONT_OF_PLANE=0,cc.math.Plane.POINT_BEHIND_PLANE=1,cc.math.Plane.POINT_ON_PLANE=2,n.dot=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d*t.w},n.dotCoord=function(t){return this.a*t.x+this.b*t.y+this.c*t.z+this.d},n.dotNormal=function(t){return this.a*t.x+this.b*t.y+this.c*t.z},cc.math.Plane.fromPointNormal=function(t,e){return new cc.math.Plane(e.x,e.y,e.z,-e.dot(t))},cc.math.Plane.fromPoints=function(t,e,i){var n=new cc.math.Vec3(e),r=new cc.math.Vec3(i),o=new cc.math.Plane;return n.subtract(t),r.subtract(t),n.cross(r),n.normalize(),o.a=n.x,o.b=n.y,o.c=n.z,o.d=n.scale(-1).dot(t),o},n.normalize=function(){var t=new cc.math.Vec3(this.a,this.b,this.c),e=1/t.length();return t.normalize(),this.a=t.x,this.b=t.y,this.c=t.z,this.d=this.d*e,this},n.classifyPoint=function(t){var e=this.a*t.x+this.b*t.y+this.c*t.z+this.d;return.001<e?cc.math.Plane.POINT_INFRONT_OF_PLANE:e<-.001?cc.math.Plane.POINT_BEHIND_PLANE:cc.math.Plane.POINT_ON_PLANE}},{}],196:[function(t,e,i){cc.math.Quaternion=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0)};var n=cc.math.Quaternion.prototype;n.conjugate=function(t){return this.x=-t.x,this.y=-t.y,this.z=-t.z,this.w=t.w,this},n.dot=function(t){return this.w*t.w+this.x*t.x+this.y*t.y+this.z*t.z},n.exponential=function(){return this},n.identity=function(){return this.x=0,this.y=0,this.z=0,this.w=1,this},n.inverse=function(){var t=this.length();return Math.abs(t)>cc.math.EPSILON?(this.x=0,this.y=0,this.z=0,this.w=0):this.conjugate(this).scale(1/t),this},n.isIdentity=function(){return 0===this.x&&0===this.y&&0===this.z&&1===this.w},n.length=function(){return Math.sqrt(this.lengthSq())},n.lengthSq=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},n.multiply=function(t){var e=this.x,i=this.y,n=this.z,r=this.w;return this.w=r*t.w-e*t.x-i*t.y-n*t.z,this.x=r*t.x+e*t.w+i*t.z-n*t.y,this.y=r*t.y+i*t.w+n*t.x-e*t.z,this.z=r*t.z+n*t.w+e*t.y-i*t.x,this},n.normalize=function(){var t=this.length();if(Math.abs(t)<=cc.math.EPSILON)throw new Error("current quaternion is an invalid value");return this.scale(1/t),this},n.rotationAxis=function(t,e){var i=.5*e,n=Math.sin(i);return this.w=Math.cos(i),this.x=t.x*n,this.y=t.y*n,this.z=t.z*n,this},cc.math.Quaternion.rotationMatrix=function(t){if(!t)return null;var e,i,n,r,o=[],s=t.mat,a=0;o[0]=s[0],o[1]=s[3],o[2]=s[6],o[4]=s[1],o[5]=s[4],o[6]=s[7],o[8]=s[2],o[9]=s[5],o[10]=s[8],o[15]=1;var c=o[0],h=c[0]+c[5]+c[10]+1;return h>cc.math.EPSILON?(a=2*Math.sqrt(h),e=(c[9]-c[6])/a,i=(c[2]-c[8])/a,n=(c[4]-c[1])/a,r=.25*a):c[0]>c[5]&&c[0]>c[10]?(e=.25*(a=2*Math.sqrt(1+c[0]-c[5]-c[10])),i=(c[4]+c[1])/a,n=(c[2]+c[8])/a,r=(c[9]-c[6])/a):c[5]>c[10]?(a=2*Math.sqrt(1+c[5]-c[0]-c[10]),e=(c[4]+c[1])/a,i=.25*a,n=(c[9]+c[6])/a,r=(c[2]-c[8])/a):(a=2*Math.sqrt(1+c[10]-c[0]-c[5]),e=(c[2]+c[8])/a,i=(c[9]+c[6])/a,n=.25*a,r=(c[4]-c[1])/a),new cc.math.Quaternion(e,i,n,r)},cc.math.Quaternion.rotationYawPitchRoll=function(t,e,i){var n,r,o,s,a,c,h,l,u,_,d;n=cc.degreesToRadians(e)/2,r=cc.degreesToRadians(t)/2,o=cc.degreesToRadians(i)/2,s=Math.cos(n),a=Math.cos(r),c=Math.cos(o),h=Math.sin(n),_=a*c,d=(l=Math.sin(r))*(u=Math.sin(o));var f=new cc.math.Quaternion;return f.w=s*_+h*d,f.x=h*_-s*d,f.y=s*l*c+h*a*u,f.z=s*a*u-h*l*c,f.normalize(),f},n.slerp=function(t,e){if(this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w)return this;var i=this.dot(t),n=Math.acos(i),r=Math.sqrt(1-cc.math.square(i)),o=Math.sin(e*n)/r,s=Math.sin((1-e)*n)/r,a=new cc.math.Quaternion(t);return this.scale(s),a.scale(o),this.add(a),this},n.toAxisAndAngle=function(){var t,e,i,n=new cc.math.Vec3;return t=Math.acos(this.w),(e=Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)))>-cc.math.EPSILON&&e<cc.math.EPSILON||e<2*Math.PI+cc.math.EPSILON&&e>2*Math.PI-cc.math.EPSILON?(i=0,n.x=0,n.y=0,n.z=1):(i=2*t,n.x=this.x/e,n.y=this.y/e,n.z=this.z/e,n.normalize()),{axis:n,angle:i}},n.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},n.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},cc.math.Quaternion.rotationBetweenVec3=function(t,e,i){var n=new cc.math.Vec3(t),r=new cc.math.Vec3(e);n.normalize(),r.normalize();var o=n.dot(r),s=new cc.math.Quaternion;if(1<=o)return s.identity(),s;if(o<1e-6-1)if(Math.abs(i.lengthSq())<cc.math.EPSILON)s.rotationAxis(i,Math.PI);else{var a=new cc.math.Vec3(1,0,0);a.cross(t),Math.abs(a.lengthSq())<cc.math.EPSILON&&(a.fill(0,1,0),a.cross(t)),a.normalize(),s.rotationAxis(a,Math.PI)}else{var c=Math.sqrt(2*(1+o)),h=1/c;n.cross(r),s.x=n.x*h,s.y=n.y*h,s.z=n.z*h,s.w=.5*c,s.normalize()}return s},n.multiplyVec3=function(t){var e=this.x,i=this.y,n=this.z,r=new cc.math.Vec3(t),o=new cc.math.Vec3(e,i,n),s=new cc.math.Vec3(e,i,n);return o.cross(t),s.cross(o),o.scale(2*q.w),s.scale(2),r.add(o),r.add(s),r}},{}],197:[function(t,e,i){function u(t,e,i){var n=new cc.math.Vec2(e);n.subtract(t),i.x=-n.y,i.y=n.x,i.normalize()}cc.math.Ray2=function(t,e){this.start=t||new cc.math.Vec2,this.dir=e||new cc.math.Vec2},cc.math.Ray2.prototype.fill=function(t,e,i,n){this.start.x=t,this.start.y=e,this.dir.x=i,this.dir.y=n},cc.math.Ray2.prototype.intersectLineSegment=function(t,e,i){var n,r,o,s=this.start.x,a=this.start.y,c=this.start.x+this.dir.x,h=this.start.y+this.dir.y,l=t.x,u=t.y,_=e.x,d=e.y,f=(d-u)*(c-s)-(_-l)*(h-a);return!(f>-cc.math.EPSILON&&f<cc.math.EPSILON||(o=a+(n=((_-l)*(a-u)-(d-u)*(s-l))/f)*(h-a),(r=s+n*(c-s))<Math.min(t.x,e.x)-cc.math.EPSILON||r>Math.max(t.x,e.x)+cc.math.EPSILON||o<Math.min(t.y,e.y)-cc.math.EPSILON||o>Math.max(t.y,e.y)+cc.math.EPSILON||r<Math.min(s,c)-cc.math.EPSILON||r>Math.max(s,c)+cc.math.EPSILON||o<Math.min(a,h)-cc.math.EPSILON||o>Math.max(a,h)+cc.math.EPSILON||(i.x=r,i.y=o,0)))},cc.math.Ray2.prototype.intersectTriangle=function(t,e,i,n,r){var o,s=new cc.math.Vec2,a=new cc.math.Vec2,c=new cc.math.Vec2,h=1e4,l=!1;return this.intersectLineSegment(t,e,s)&&(l=!0,(o=s.subtract(this.start).length())<h&&(a.x=s.x,a.y=s.y,h=o,u(t,e,c))),this.intersectLineSegment(e,i,s)&&(l=!0,(o=s.subtract(this.start).length())<h&&(a.x=s.x,a.y=s.y,h=o,u(e,i,c))),this.intersectLineSegment(i,t,s)&&(l=!0,(o=s.subtract(this.start).length())<h&&(a.x=s.x,a.y=s.y,h=o,u(i,t,c))),l&&(n.x=a.x,n.y=a.y,r&&(r.x=c.x,r.y=c.y)),l}},{}],198:[function(t,e,i){cc.math=cc.math||{},cc.math.EPSILON=1/64,cc.math.square=function(t){return t*t},cc.math.almostEqual=function(t,e){return t+cc.math.EPSILON>e&&t-cc.math.EPSILON<e}},{}],199:[function(t,e,i){cc.math.Vec2=function(t,e){void 0===e?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0)};var n=cc.math.Vec2.prototype;n.fill=function(t,e){this.x=t,this.y=e},n.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y))},n.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)},n.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this},cc.math.Vec2.add=function(t,e,i){return t.x=e.x+i.x,t.y=e.y+i.y,t},n.add=function(t){return this.x+=t.x,this.y+=t.y,this},n.dot=function(t){return this.x*t.x+this.y*t.y},cc.math.Vec2.subtract=function(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},n.transform=function(t){var e=this.x,i=this.y;return this.x=e*t.mat[0]+i*t.mat[3]+t.mat[6],this.y=e*t.mat[1]+i*t.mat[4]+t.mat[7],this},cc.math.Vec2.scale=function(t,e,i){return t.x=e.x*i,t.y=e.y*i,t},n.scale=function(t){return this.x*=t,this.y*=t,this},n.equals=function(t){return this.x<t.x+cc.math.EPSILON&&this.x>t.x-cc.math.EPSILON&&this.y<t.y+cc.math.EPSILON&&this.y>t.y-cc.math.EPSILON}},{}],200:[function(t,e,i){cc.math.Vec3=cc.math.Vec3=function(t,e,i){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=e||0,this.z=i||0)},cc.math.vec3=function(t,e,i){return new cc.math.Vec3(t,e,i)};var n=cc.math.Vec3.prototype;n.fill=function(t,e,i){return t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=e,this.z=i),this},n.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z))},n.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)},n.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this},n.cross=function(t){var e=this.x,i=this.y,n=this.z;return this.x=i*t.z-n*t.y,this.y=n*t.x-e*t.z,this.z=e*t.y-i*t.x,this},n.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},n.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},n.transform=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;return this.x=e*r[0]+i*r[4]+n*r[8]+r[12],this.y=e*r[1]+i*r[5]+n*r[9]+r[13],this.z=e*r[2]+i*r[6]+n*r[10]+r[14],this},n.transformNormal=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;return this.x=e*r[0]+i*r[4]+n*r[8],this.y=e*r[1]+i*r[5]+n*r[9],this.z=e*r[2]+i*r[6]+n*r[10],this},n.transformCoord=function(t){var e=new cc.math.Vec4(this.x,this.y,this.z,1);return e.transform(t),this.x=e.x/e.w,this.y=e.y/e.w,this.z=e.z/e.w,this},n.scale=function(t){return this.x*=t,this.y*=t,this.z*=t,this},n.equals=function(t){var e=cc.math.EPSILON;return this.x<t.x+e&&this.x>t.x-e&&this.y<t.y+e&&this.y>t.y-e&&this.z<t.z+e&&this.z>t.z-e},n.inverseTransform=function(t){var e=t.mat,i=new cc.math.Vec3(this.x-e[12],this.y-e[13],this.z-e[14]);return this.x=i.x*e[0]+i.y*e[1]+i.z*e[2],this.y=i.x*e[4]+i.y*e[5]+i.z*e[6],this.z=i.x*e[8]+i.y*e[9]+i.z*e[10],this},n.inverseTransformNormal=function(t){var e=this.x,i=this.y,n=this.z,r=t.mat;return this.x=e*r[0]+i*r[1]+n*r[2],this.y=e*r[4]+i*r[5]+n*r[6],this.z=e*r[8]+i*r[9]+n*r[10],this},n.assignFrom=function(t){return t&&(this.x=t.x,this.y=t.y,this.z=t.z),this},cc.math.Vec3.zero=function(t){return t.x=t.y=t.z=0,t},n.toTypeArray=function(){var t=new Float32Array(3);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t}},{}],201:[function(t,e,i){cc.math.Vec4=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=i||0,this.w=n||0)};var n=cc.math.Vec4.prototype;n.fill=function(t,e,i,n){t&&void 0===e?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t,this.y=e,this.z=i,this.w=n)},n.add=function(t){return t&&(this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w),this},n.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},n.length=function(){return Math.sqrt(cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)+cc.math.square(this.w))},n.lengthSq=function(){return cc.math.square(this.x)+cc.math.square(this.y)+cc.math.square(this.z)+cc.math.square(this.w)},n.lerp=function(t,e){return this},n.normalize=function(){var t=1/this.length();return this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.scale=function(t){return this.normalize(),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.subtract=function(t){this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w},n.transform=function(t){var e=this.x,i=this.y,n=this.z,r=this.w,o=t.mat;return this.x=e*o[0]+i*o[4]+n*o[8]+r*o[12],this.y=e*o[1]+i*o[5]+n*o[9]+r*o[13],this.z=e*o[2]+i*o[6]+n*o[10]+r*o[14],this.w=e*o[3]+i*o[7]+n*o[11]+r*o[15],this},cc.math.Vec4.transformArray=function(t,e){for(var i=[],n=0;n<t.length;n++){var r=new cc.math.Vec4(t[n]);r.transform(e),i.push(r)}return i},n.equals=function(t){var e=cc.math.EPSILON;return this.x<t.x+e&&this.x>t.x-e&&this.y<t.y+e&&this.y>t.y-e&&this.z<t.z+e&&this.z>t.z-e&&this.w<t.w+e&&this.w>t.w-e},n.assignFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},n.toTypeArray=function(){var t=new Float32Array(4);return t[0]=this.x,t[1]=this.y,t[2]=this.z,t[3]=this.w,t}},{}],202:[function(t,e,i){cc.RenderTexture=_ccsg.Node.extend({sprite:null,clearFlags:0,clearDepthVal:0,autoDraw:!1,_texture:null,_pixelFormat:0,clearStencilVal:0,_clearColor:null,_className:"RenderTexture",ctor:function(t,e,i,n){_ccsg.Node.prototype.ctor.call(this),this._cascadeColorEnabled=!0,this._cascadeOpacityEnabled=!0,this._pixelFormat=cc.Texture2D.PixelFormat.RGBA8888,this._clearColor=new cc.Color(0,0,0,255),void 0!==t&&void 0!==e&&(i=i||cc.Texture2D.PixelFormat.RGBA8888,n=n||0,this.initWithWidthAndHeight(t,e,i,n)),this.setAnchorPoint(0,0)},_createRenderCmd:function(){return cc._renderType===cc.game.RENDER_TYPE_CANVAS?new cc.RenderTexture.CanvasRenderCmd(this):new cc.RenderTexture.WebGLRenderCmd(this)},visit:function(t){var e=this._renderCmd,i=t?t._renderCmd:null;if(this._visible){var n=cc.renderer;e.visit(i),n.pushRenderCommand(e),this.sprite.visit(this),e._dirtyFlag=0}else e._propagateFlagsDown(i)},cleanup:function(){_ccsg.Node.prototype.onExit.call(this),this._renderCmd.cleanup()},getSprite:function(){return this.sprite},setSprite:function(t){this.sprite=t},setVirtualViewport:function(t,e,i){this._renderCmd.setVirtualViewport(t,e,i)},initWithWidthAndHeight:function(t,e,i,n){return this._pixelFormat=i,this._renderCmd.initWithWidthAndHeight(t,e,i,n)},begin:function(){cc.renderer._turnToCacheMode(this.__instanceId),this._renderCmd.begin()},beginWithClear:function(t,e,i,n,r,o){var s=cc._renderContext;r=r||s.COLOR_BUFFER_BIT,o=o||s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT,this._beginWithClear(t,e,i,n,r,o,s.COLOR_BUFFER_BIT|s.DEPTH_BUFFER_BIT|s.STENCIL_BUFFER_BIT)},_beginWithClear:function(t,e,i,n,r,o,s){this.begin(),this._renderCmd._beginWithClear(t,e,i,n,r,o,s)},end:function(){this._renderCmd.end()},clear:function(t,e,i,n){this.beginWithClear(t,e,i,n),this.end()},clearRect:function(t,e,i,n){this._renderCmd.clearRect(t,e,i,n)},clearDepth:function(t){this._renderCmd.clearDepth(t)},clearStencil:function(t){this._renderCmd.clearStencil(t)},getClearFlags:function(){return this.clearFlags},setClearFlags:function(t){this.clearFlags=t},getClearColor:function(){return this._clearColor},setClearColor:function(t){var e=this._clearColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=t.a,this._renderCmd.updateClearColor(t)},getClearDepth:function(){return this.clearDepthVal},setClearDepth:function(t){this.clearDepthVal=t},getClearStencil:function(){return this.clearStencilVal},setClearStencil:function(t){this.clearStencilVal=t},isAutoDraw:function(){return this.autoDraw},setAutoDraw:function(t){this.autoDraw=t},saveToFile:function(t,e){cc.log("saveToFile isn't supported on Cocos2d-Html5")},newCCImage:function(t){return cc.log("saveToFile isn't supported on cocos2d-html5"),null},listenToBackground:function(t){},listenToForeground:function(t){}});var n=cc.RenderTexture.prototype;n.clearColorVal,cc.defineGetterSetter(n,"clearColorVal",n.getClearColor,n.setClearColor),cc.RenderTexture.create=function(t,e,i,n){return new cc.RenderTexture(t,e,i,n)}},{}],203:[function(t,e,i){cc.RenderTexture.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!1,this._clearColorStr="rgba(255,255,255,1)",this._cacheCanvas=document.createElement("canvas"),this._cacheContext=new cc.CanvasContextWrapper(this._cacheCanvas.getContext("2d"))};var n=cc.RenderTexture.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);n.constructor=cc.RenderTexture.CanvasRenderCmd,n.cleanup=function(){this._cacheContext=null,this._cacheCanvas=null},n.clearStencil=function(t){},n.setVirtualViewport=function(t,e,i){},n.updateClearColor=function(t){this._clearColorStr="rgba("+(0|t.r)+","+(0|t.g)+","+(0|t.b)+","+t.a/255+")"},n.initWithWidthAndHeight=function(t,e,i,n){var r=this._node,o=this._cacheCanvas;o.width=0|t,o.height=0|e;var s=new cc.Texture2D;s.initWithElement(o),s.handleLoadedTexture(!1,i);var a=r.sprite=new _ccsg.Sprite(s);return a.setBlendFunc(cc.macro.ONE,cc.macro.ONE_MINUS_SRC_ALPHA),r.autoDraw=!1,r.addChild(a),!0},n.begin=function(){},n._beginWithClear=function(t,e,i,n,r,o,s){t=t||0,e=e||0,i=i||0,n=isNaN(n)?255:n;var a=this._cacheContext.getContext(),c=this._cacheCanvas;a.setTransform(1,0,0,1,0,0),this._cacheContext.setFillStyle("rgba("+(0|t)+","+(0|e)+","+(0|i)+","+n/255+")"),a.clearRect(0,0,c.width,c.height),a.fillRect(0,0,c.width,c.height)},n.end=function(){var t=this._node;cc.renderer._renderingToCacheCanvas(this._cacheContext,t.__instanceId);var e=t.sprite._renderCmd;e._notifyRegionStatus&&e._notifyRegionStatus(_ccsg.Node.CanvasRenderCmd.RegionStatus.Dirty)},n.clearRect=function(t,e,i,n){this._cacheContext.clearRect(t,e,i,-n)},n.clearDepth=function(t){cc.log("clearDepth isn't supported on Cocos2d-Html5")}},{}],204:[function(t,e,i){var d=t("../core/utils/misc");cc.RenderTexture.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._fBO=null,this._oldFBO=null,this._textureCopy=null,this._depthRenderBuffer=null,this._rtTextureRect=new cc.Rect,this._fullRect=new cc.Rect,this._fullViewport=new cc.Rect};var n=cc.RenderTexture.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype);n.constructor=cc.RenderTexture.WebGLRenderCmd,n.setVirtualViewport=function(t,e,i){this._rtTextureRect.x=t.x,this._rtTextureRect.y=t.y,this._fullRect=e,this._fullViewport=i},n.needDraw=function(){return this._needDraw&&this._node.autoDraw},n.rendering=function(t){var e=t||cc._renderContext,i=this._node;if(i.autoDraw){i.begin();var n=i.clearFlags;if(n){var r=[0,0,0,0],o=0,s=0;n&e.COLOR_BUFFER_BIT&&(r=e.getParameter(e.COLOR_CLEAR_VALUE),e.clearColor(i._clearColor.r/255,i._clearColor.g/255,i._clearColor.b/255,i._clearColor.a/255)),n&e.DEPTH_BUFFER_BIT&&(o=e.getParameter(e.DEPTH_CLEAR_VALUE),e.clearDepth(i.clearDepthVal)),n&e.STENCIL_BUFFER_BIT&&(s=e.getParameter(e.STENCIL_CLEAR_VALUE),e.clearStencil(i.clearStencilVal)),e.clear(n),n&e.COLOR_BUFFER_BIT&&e.clearColor(r[0],r[1],r[2],r[3]),n&e.DEPTH_BUFFER_BIT&&e.clearDepth(o),n&e.STENCIL_BUFFER_BIT&&e.clearStencil(s)}i.sortAllChildren();for(var a=i._children,c=0;c<a.length;c++){var h=a[c];h!==i.sprite&&h.visit(i.sprite)}i.end()}},n.clearStencil=function(t){var e=cc._renderContext,i=e.getParameter(e.STENCIL_CLEAR_VALUE);e.clearStencil(t),e.clear(e.STENCIL_BUFFER_BIT),e.clearStencil(i)},n.cleanup=function(){this._node,this._textureCopy=null;var t=cc._renderContext;t.deleteFramebuffer(this._fBO),this._depthRenderBuffer&&t.deleteRenderbuffer(this._depthRenderBuffer)},n.updateClearColor=function(t){},n.initWithWidthAndHeight=function(t,e,i,n){var r=this._node;i===cc.Texture2D.PixelFormat.A8&&cc.log("cc.RenderTexture._initWithWidthAndHeightForWebGL() : only RGB and RGBA formats are valid for a render texture;");var o,s,a=cc._renderContext;this._fullRect=new cc.Rect(0,0,t,e),t|=0,e|=0,this._oldFBO=a.getParameter(a.FRAMEBUFFER_BINDING),cc.configuration.supportsNPOT()?(o=t,s=e):(o=d.NextPOT(t),s=d.NextPOT(e)),this._fullViewport=new cc.Rect(0,0,o,s);for(var c=new Uint8Array(o*s*4),h=0;h<o*s*4;h++)c[h]=0;this._pixelFormat=i;var l=r._texture=new cc.Texture2D;if(!r._texture)return!1;l.initWithData(c,r._pixelFormat,o,s);var u=a.getParameter(a.RENDERBUFFER_BINDING);if(cc.configuration.checkForGLExtension("GL_QCOM")){if(this._textureCopy=new cc.Texture2D,!this._textureCopy)return!1;this._textureCopy.initWithData(c,r._pixelFormat,o,s)}this._fBO=a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,this._fBO),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,l._glID,0),0!==n&&(this._depthRenderBuffer=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,this._depthRenderBuffer),a.renderbufferStorage(a.RENDERBUFFER,n,o,s),n===a.DEPTH_STENCIL?a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_STENCIL_ATTACHMENT,a.RENDERBUFFER,this._depthRenderBuffer):n===a.STENCIL_INDEX||n===a.STENCIL_INDEX8?a.framebufferRenderbuffer(a.FRAMEBUFFER,a.STENCIL_ATTACHMENT,a.RENDERBUFFER,this._depthRenderBuffer):n===a.DEPTH_COMPONENT16&&a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,this._depthRenderBuffer)),a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE&&cc.log("Could not attach texture to the framebuffer"),l.setAliasTexParameters();var _=r.sprite=new _ccsg.Sprite(l);return _.scaleY=-1,_.setBlendFunc(a.ONE,a.ONE_MINUS_SRC_ALPHA),a.bindRenderbuffer(a.RENDERBUFFER,u),a.bindFramebuffer(a.FRAMEBUFFER,this._oldFBO),r.autoDraw=!1,r.addChild(_),!0},n.begin=function(){var t=this._node;cc.math.glMatrixMode(cc.math.KM_GL_PROJECTION),cc.math.glPushMatrix(),cc.math.glMatrixMode(cc.math.KM_GL_MODELVIEW),cc.math.glPushMatrix();var e=cc._renderContext,i=cc.director;i.setProjection(i.getProjection());var n=cc.director.getWinSizeInPixels(),r=n.width/t._texture.width,o=n.height/t._texture.height,s=cc.math.Matrix4.createOrthographicProjection(-1/r,1/r,-1/o,1/o,-1,1);cc.math.glMatrixMode(cc.math.KM_GL_PROJECTION),cc.math.glMultMatrix(s);var a=new cc.Rect(0,0,0,0);a.width=this._fullViewport.width,a.height=this._fullViewport.height;var c=a.width/this._fullRect.width,h=a.height/this._fullRect.height;a.x=(this._fullRect.x-this._rtTextureRect.x)*c,a.y=(this._fullRect.y-this._rtTextureRect.y)*h,e.viewport(a.x,a.y,a.width,a.height),this._oldFBO=e.getParameter(e.FRAMEBUFFER_BINDING),e.bindFramebuffer(e.FRAMEBUFFER,this._fBO),cc.configuration.checkForGLExtension("GL_QCOM")&&(e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,this._textureCopy._glID,0),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t._texture._glID,0))},n._beginWithClear=function(t,e,i,n,r,o,s){t/=255,e/=255,i/=255,n/=255;var a=cc._renderContext,c=[0,0,0,0],h=0,l=0;s&a.COLOR_BUFFER_BIT&&(c=a.getParameter(a.COLOR_CLEAR_VALUE),a.clearColor(t,e,i,n)),s&a.DEPTH_BUFFER_BIT&&(h=a.getParameter(a.DEPTH_CLEAR_VALUE),a.clearDepth(r)),s&a.STENCIL_BUFFER_BIT&&(l=a.getParameter(a.STENCIL_CLEAR_VALUE),a.clearStencil(o)),a.clear(s),s&a.COLOR_BUFFER_BIT&&a.clearColor(c[0],c[1],c[2],c[3]),s&a.DEPTH_BUFFER_BIT&&a.clearDepth(h),s&a.STENCIL_BUFFER_BIT&&a.clearStencil(l)},n.end=function(){var t=this._node;cc.renderer._renderingToBuffer(t.__instanceId);var e=cc._renderContext,i=cc.director;e.bindFramebuffer(e.FRAMEBUFFER,this._oldFBO),i.setViewport(),cc.math.glMatrixMode(cc.math.KM_GL_PROJECTION),cc.math.glPopMatrix(),cc.math.glMatrixMode(cc.math.KM_GL_MODELVIEW),cc.math.glPopMatrix()},n.clearRect=function(t,e,i,n){},n.clearDepth=function(t){var e=this._node;e.begin();var i=cc._renderContext,n=i.getParameter(i.DEPTH_CLEAR_VALUE);i.clearDepth(t),i.clear(i.DEPTH_BUFFER_BIT),i.clearDepth(n),e.end()}},{"../core/utils/misc":173}],205:[function(t,e,i){var o=cc.macro,s=cc.math;cc.GLProgram=cc._Class.extend({_updateUniformLocation:function(t){if(!t)return!1;var e,i=this._hashForUniforms[t];if(i){e=!1;for(var n=arguments.length-1,r=0;r<n;++r)arguments[r+1]!==i[r]&&(i[r]=arguments[r+1],e=!0)}else i=[arguments[1],arguments[2],arguments[3],arguments[4]],this._hashForUniforms[t]=i,e=!0;return e},_description:function(){return"<CCGLProgram = "+this.toString()+" | Program = "+this._programObj.toString()+", VertexShader = "+this._vertShader.toString()+", FragmentShader = "+this._fragShader.toString()+">"},_compileShader:function(t,e,i){if(!i||!t)return!1;i=(cc.GLProgram._isHighpSupported()?"precision highp float;\n":"precision mediump float;\n")+"uniform mat4 CC_PMatrix;\nuniform mat4 CC_MVMatrix;\nuniform mat4 CC_MVPMatrix;\nuniform vec4 CC_Time;\nuniform vec4 CC_SinTime;\nuniform vec4 CC_CosTime;\nuniform vec4 CC_Random01;\nuniform sampler2D CC_Texture0;\n//CC INCLUDES END\n"+i,this._glContext.shaderSource(t,i),this._glContext.compileShader(t);var n=this._glContext.getShaderParameter(t,this._glContext.COMPILE_STATUS);return n||(cc.logID(8100,this._glContext.getShaderSource(t)),e===this._glContext.VERTEX_SHADER?cc.log("cocos2d: \n"+this.vertexShaderLog()):cc.log("cocos2d: \n"+this.fragmentShaderLog())),!!n},ctor:function(t,e,i){cc.GLProgram.count++,this._uniforms={},this._hashForUniforms={},this._glContext=i||cc._renderContext,this._programObj=null,this._vertShader=null,this._fragShader=null,this._usesTime=!1,this._projectionUpdated=-1,t&&e&&this.init(t,e)},destroyProgram:function(){this._vertShader=null,this._fragShader=null,this._uniforms=null,this._hashForUniforms=null,this._glContext&&(this._glContext.deleteProgram(this._programObj),this._glContext=null,cc.GLProgram.count--)},initWithVertexShaderByteArray:function(t,e){var i=this._glContext;for(var n in this._programObj=i.createProgram(),this._projectionUpdated=-1,this._vertShader=null,this._fragShader=null,t&&(this._vertShader=i.createShader(i.VERTEX_SHADER),this._compileShader(this._vertShader,i.VERTEX_SHADER,t)||cc.logID(8101)),e&&(this._fragShader=i.createShader(i.FRAGMENT_SHADER),this._compileShader(this._fragShader,i.FRAGMENT_SHADER,e)||cc.logID(8102)),this._vertShader&&i.attachShader(this._programObj,this._vertShader),this._fragShader&&i.attachShader(this._programObj,this._fragShader),this._hashForUniforms)delete this._hashForUniforms[n];return!0},initWithString:function(t,e){return this.initWithVertexShaderByteArray(t,e)},initWithVertexShaderFilename:function(t,e){var i=cc.loader.getRes(t);if(!i)throw new Error("Please load the resource firset : "+t);var n=cc.loader.getRes(e);if(!n)throw new Error("Please load the resource firset : "+e);return this.initWithVertexShaderByteArray(i,n)},init:function(t,e){return this.initWithVertexShaderFilename(t,e)},addAttribute:function(t,e){this._glContext.bindAttribLocation(this._programObj,e,t)},link:function(){return this._programObj?(this._glContext.linkProgram(this._programObj),this._vertShader&&this._glContext.deleteShader(this._vertShader),this._fragShader&&this._glContext.deleteShader(this._fragShader),this._vertShader=null,this._fragShader=null,!(cc.game.config[cc.game.CONFIG_KEY.debugMode]&&!this._glContext.getProgramParameter(this._programObj,this._glContext.LINK_STATUS))||(cc.logID(8104,this._glContext.getProgramInfoLog(this._programObj)),cc.gl.deleteProgram(this._programObj),this._programObj=null,!1)):(cc.logID(8103),!1)},use:function(){cc.gl.useProgram(this._programObj)},updateUniforms:function(){this._uniforms[o.UNIFORM_PMATRIX]=this._glContext.getUniformLocation(this._programObj,o.UNIFORM_PMATRIX_S),this._uniforms[o.UNIFORM_MVMATRIX]=this._glContext.getUniformLocation(this._programObj,o.UNIFORM_MVMATRIX_S),this._uniforms[o.UNIFORM_MVPMATRIX]=this._glContext.getUniformLocation(this._programObj,o.UNIFORM_MVPMATRIX_S),this._uniforms[o.UNIFORM_TIME]=this._glContext.getUniformLocation(this._programObj,o.UNIFORM_TIME_S),this._uniforms[o.UNIFORM_SINTIME]=this._glContext.getUniformLocation(this._programObj,o.UNIFORM_SINTIME_S),this._uniforms[o.UNIFORM_COSTIME]=this._glContext.getUniformLocation(this._programObj,o.UNIFORM_COSTIME_S),this._usesTime=null!=this._uniforms[o.UNIFORM_TIME]||null!=this._uniforms[o.UNIFORM_SINTIME]||null!=this._uniforms[o.UNIFORM_COSTIME],this._uniforms[o.UNIFORM_RANDOM01]=this._glContext.getUniformLocation(this._programObj,o.UNIFORM_RANDOM01_S),this._uniforms[o.UNIFORM_SAMPLER]=this._glContext.getUniformLocation(this._programObj,o.UNIFORM_SAMPLER_S),this.use(),this.setUniformLocationWith1i(this._uniforms[o.UNIFORM_SAMPLER],0)},_addUniformLocation:function(t){var e=this._glContext.getUniformLocation(this._programObj,t);this._uniforms[t]=e},getUniformLocationForName:function(t){if(!t)throw new Error("cc.GLProgram.getUniformLocationForName(): uniform name should be non-null");if(!this._programObj)throw new Error("cc.GLProgram.getUniformLocationForName(): Invalid operation. Cannot get uniform location when program is not initialized");return this._uniforms[t]||this._glContext.getUniformLocation(this._programObj,t)},getUniformMVPMatrix:function(){return this._uniforms[o.UNIFORM_MVPMATRIX]},getUniformSampler:function(){return this._uniforms[o.UNIFORM_SAMPLER]},setUniformLocationWith1i:function(t,e){var i=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,e)){var n=this.getUniformLocationForName(t);i.uniform1i(n,e)}}else i.uniform1i(t,e)},setUniformLocationWith2i:function(t,e,i){var n=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,e,i)){var r=this.getUniformLocationForName(t);n.uniform2i(r,e,i)}}else n.uniform2i(t,e,i)},setUniformLocationWith3i:function(t,e,i,n){var r=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,e,i,n)){var o=this.getUniformLocationForName(t);r.uniform3i(o,e,i,n)}}else r.uniform3i(t,e,i,n)},setUniformLocationWith4i:function(t,e,i,n,r){var o=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,e,i,n,r)){var s=this.getUniformLocationForName(t);o.uniform4i(s,e,i,n,r)}}else o.uniform4i(t,e,i,n,r)},setUniformLocationWith2iv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform2iv(i,e)},setUniformLocationWith3iv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform3iv(i,e)},setUniformLocationWith4iv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform4iv(i,e)},setUniformLocationI32:function(t,e){this.setUniformLocationWith1i(t,e)},setUniformLocationWith1f:function(t,e){var i=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,e)){var n=this.getUniformLocationForName(t);i.uniform1f(n,e)}}else i.uniform1f(t,e)},setUniformLocationWith2f:function(t,e,i){var n=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,e,i)){var r=this.getUniformLocationForName(t);n.uniform2f(r,e,i)}}else n.uniform2f(t,e,i)},setUniformLocationWith3f:function(t,e,i,n){var r=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,e,i,n)){var o=this.getUniformLocationForName(t);r.uniform3f(o,e,i,n)}}else r.uniform3f(t,e,i,n)},setUniformLocationWith4f:function(t,e,i,n,r){var o=this._glContext;if("string"==typeof t){if(this._updateUniformLocation(t,e,i,n,r)){var s=this.getUniformLocationForName(t);o.uniform4f(s,e,i,n,r)}}else o.uniform4f(t,e,i,n,r)},setUniformLocationWith2fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform2fv(i,e)},setUniformLocationWith3fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform3fv(i,e)},setUniformLocationWith4fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniform4fv(i,e)},setUniformLocationWithMatrix3fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniformMatrix3fv(i,!1,e)},setUniformLocationWithMatrix4fv:function(t,e){var i="string"==typeof t?this.getUniformLocationForName(t):t;this._glContext.uniformMatrix4fv(i,!1,e)},setUniformLocationF32:function(t,e,i,n,r){"use strict";switch(arguments.length){case 0:case 1:return;case 2:this.setUniformLocationWith1f(t,e);break;case 3:this.setUniformLocationWith2f(t,e,i);break;case 4:this.setUniformLocationWith3f(t,e,i,n);break;case 5:this.setUniformLocationWith4f(t,e,i,n,r)}},setUniformsForBuiltins:function(){var t=new s.Matrix4,e=new s.Matrix4,i=new s.Matrix4;if(s.glGetMatrix(s.KM_GL_PROJECTION,t),s.glGetMatrix(s.KM_GL_MODELVIEW,e),s.mat4Multiply(i,t,e),this.setUniformLocationWithMatrix4fv(this._uniforms[o.UNIFORM_PMATRIX],t.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[o.UNIFORM_MVMATRIX],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[o.UNIFORM_MVPMATRIX],i.mat,1),this._usesTime){var n=cc.director,r=n.getTotalFrames()*n.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[o.UNIFORM_TIME],r/10,r,2*r,4*r),this.setUniformLocationWith4f(this._uniforms[o.UNIFORM_SINTIME],r/8,r/4,r/2,Math.sin(r)),this.setUniformLocationWith4f(this._uniforms[o.UNIFORM_COSTIME],r/8,r/4,r/2,Math.cos(r))}-1!==this._uniforms[o.UNIFORM_RANDOM01]&&this.setUniformLocationWith4f(this._uniforms[o.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())},_setUniformsForBuiltinsForRenderer:function(t){if(t&&t._renderCmd){var e=new s.Matrix4,i=new s.Matrix4;if(s.glGetMatrix(s.KM_GL_PROJECTION,e),s.mat4Multiply(i,e,t._renderCmd._stackMatrix),this.setUniformLocationWithMatrix4fv(this._uniforms[o.UNIFORM_PMATRIX],e.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[o.UNIFORM_MVMATRIX],t._renderCmd._stackMatrix.mat,1),this.setUniformLocationWithMatrix4fv(this._uniforms[o.UNIFORM_MVPMATRIX],i.mat,1),this._usesTime){var n=cc.director,r=n.getTotalFrames()*n.getAnimationInterval();this.setUniformLocationWith4f(this._uniforms[o.UNIFORM_TIME],r/10,r,2*r,4*r),this.setUniformLocationWith4f(this._uniforms[o.UNIFORM_SINTIME],r/8,r/4,r/2,Math.sin(r)),this.setUniformLocationWith4f(this._uniforms[o.UNIFORM_COSTIME],r/8,r/4,r/2,Math.cos(r))}-1!==this._uniforms[o.UNIFORM_RANDOM01]&&this.setUniformLocationWith4f(this._uniforms[o.UNIFORM_RANDOM01],Math.random(),Math.random(),Math.random(),Math.random())}},setUniformForModelViewProjectionMatrix:function(){this._glContext.uniformMatrix4fv(this._uniforms[o.UNIFORM_MVPMATRIX],!1,s.getMat4MultiplyValue(s.projection_matrix_stack.top,s.modelview_matrix_stack.top))},setUniformForModelViewProjectionMatrixWithMat4:function(t){s.mat4Multiply(t,s.projection_matrix_stack.top,s.modelview_matrix_stack.top),this._glContext.uniformMatrix4fv(this._uniforms[o.UNIFORM_MVPMATRIX],!1,t.mat)},setUniformForModelViewAndProjectionMatrixWithMat4:function(){this._glContext.uniformMatrix4fv(this._uniforms[o.UNIFORM_MVMATRIX],!1,s.modelview_matrix_stack.top.mat),this._glContext.uniformMatrix4fv(this._uniforms[o.UNIFORM_PMATRIX],!1,s.projection_matrix_stack.top.mat)},_setUniformForMVPMatrixWithMat4:function(t){if(!t)throw new Error("modelView matrix is undefined.");this._glContext.uniformMatrix4fv(this._uniforms[o.UNIFORM_MVMATRIX],!1,t.mat),this._glContext.uniformMatrix4fv(this._uniforms[o.UNIFORM_PMATRIX],!1,s.projection_matrix_stack.top.mat)},_updateProjectionUniform:function(){var t=s.projection_matrix_stack;t.lastUpdated!==this._projectionUpdated&&(this._glContext.uniformMatrix4fv(this._uniforms[o.UNIFORM_PMATRIX],!1,t.top.mat),this._projectionUpdated=t.lastUpdated)},vertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getVertexShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},getFragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._vertShader)},fragmentShaderLog:function(){return this._glContext.getShaderInfoLog(this._fragShader)},programLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},getProgramLog:function(){return this._glContext.getProgramInfoLog(this._programObj)},reset:function(){for(var t in this._vertShader=null,this._fragShader=null,this._uniforms.length=0,this._glContext.deleteProgram(this._programObj),this._programObj=null,this._hashForUniforms)this._hashForUniforms[t].length=0,delete this._hashForUniforms[t]},getProgram:function(){return this._programObj},retain:function(){},release:function(){}}),cc.GLProgram._highpSupported=null,cc.GLProgram._isHighpSupported=function(){var t=cc._renderContext;if(t.getShaderPrecisionFormat&&null==cc.GLProgram._highpSupported){var e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);cc.GLProgram._highpSupported=0!==e.precision}return cc.GLProgram._highpSupported},cc.GLProgram.count=0},{}],206:[function(t,e,i){var n=cc.macro.ENABLE_GL_STATE_CACHE,r=0,o=0,s=null,a=0,c=0;n&&(r=16,o=-1,s=new Array(r),c=a=-1),cc.gl={},cc.gl.invalidateStateCache=function(){if(cc.math.glFreeAll(),n){o=-1;for(var t=0;t<r;t++)s[t]=null;c=a=-1}},cc.gl.useProgram=n?function(t){t!==o&&(o=t,cc._renderContext.useProgram(t))}:function(t){cc._renderContext.useProgram(t)},cc.gl.deleteProgram=function(t){n&&t===o&&(o=-1),gl.deleteProgram(t)},cc.gl.setBlending=function(t,e){var i=cc._renderContext;t===i.ONE&&e===i.ZERO?i.disable(i.BLEND):(i.enable(i.BLEND),i.blendFunc(t,e))},cc.gl.blendFunc=n?function(t,e){t===a&&e===c||(a=t,c=e,cc.gl.setBlending(t,e))}:cc.gl.setBlending,cc.gl.blendFuncForParticle=function(t,e){if(t!==a||e!==c){a=t,c=e;var i=cc._renderContext;t===i.ONE&&e===i.ZERO?i.disable(i.BLEND):(i.enable(i.BLEND),i.blendFuncSeparate(i.SRC_ALPHA,e,t,e))}},cc.gl.blendResetToCache=function(){var t=cc._renderContext;t.blendEquation(t.FUNC_ADD),n?cc.gl.setBlending(a,c):cc.gl.setBlending(t.BLEND_SRC,t.BLEND_DST)},cc.gl.setProjectionMatrixDirty=function(){},cc.gl.bindTexture2D=function(t){cc.gl.bindTexture2DN(0,t)},cc.gl.bindTexture2DN=n?function(t,e){if(s[t]!==e){s[t]=e;var i=cc._renderContext;i.activeTexture(i.TEXTURE0+t),e?i.bindTexture(i.TEXTURE_2D,e._glID):i.bindTexture(i.TEXTURE_2D,null)}}:function(t,e){var i=cc._renderContext;i.activeTexture(i.TEXTURE0+t),e?i.bindTexture(i.TEXTURE_2D,e._glID):i.bindTexture(i.TEXTURE_2D,null)},cc.gl.deleteTexture2D=function(t){cc.gl.deleteTexture2DN(0,t)},cc.gl.deleteTexture2DN=function(t,e){n&&e===s[t]&&(s[t]=null),cc._renderContext.deleteTexture(e._glID)},cc.gl.enable=function(t){}},{}],207:[function(t,e,i){var n=cc.PresetShaders,r=cc.macro;cc.shaderCache={TYPE_POSITION_TEXTURECOLOR:0,TYPE_POSITION_TEXTURECOLOR_ALPHATEST:1,TYPE_POSITION_COLOR:2,TYPE_POSITION_TEXTURE:3,TYPE_POSITION_TEXTURE_UCOLOR:4,TYPE_POSITION_TEXTURE_A8COLOR:5,TYPE_POSITION_UCOLOR:6,TYPE_POSITION_LENGTH_TEXTURECOLOR:7,TYPE_SPRITE_POSITION_TEXTURECOLOR:8,TYPE_SPRITE_POSITION_TEXTURECOLOR_ALPHATEST:9,TYPE_SPRITE_POSITION_COLOR:10,TYPE_MAX:10,_programs:{},_init:function(){return this.loadDefaultShaders(),!0},_loadDefaultShader:function(t,e){switch(e){case r.SHADER_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_COLOR_VERT,n.POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case r.SHADER_SPRITE_POSITION_TEXTURECOLOR:t.initWithVertexShaderByteArray(n.SPRITE_POSITION_TEXTURE_COLOR_VERT,n.POSITION_TEXTURE_COLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case r.SHADER_POSITION_TEXTURECOLORALPHATEST:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_COLOR_VERT,n.POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case r.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST:t.initWithVertexShaderByteArray(n.SPRITE_POSITION_TEXTURE_COLOR_VERT,n.POSITION_TEXTURE_COLOR_ALPHATEST_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case r.SHADER_POSITION_COLOR:t.initWithVertexShaderByteArray(n.POSITION_COLOR_VERT,n.POSITION_COLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR);break;case r.SHADER_SPRITE_POSITION_COLOR:t.initWithVertexShaderByteArray(n.SPRITE_POSITION_COLOR_VERT,n.POSITION_COLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR);break;case r.SHADER_POSITION_TEXTURE:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_VERT,n.POSITION_TEXTURE_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case r.SHADER_POSITION_TEXTURE_UCOLOR:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_UCOLOR_VERT,n.POSITION_TEXTURE_UCOLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case r.SHADER_POSITION_TEXTUREA8COLOR:t.initWithVertexShaderByteArray(n.POSITION_TEXTURE_A8COLOR_VERT,n.POSITION_TEXTURE_A8COLOR_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS);break;case r.SHADER_POSITION_UCOLOR:t.initWithVertexShaderByteArray(n.POSITION_UCOLOR_VERT,n.POSITION_UCOLOR_FRAG),t.addAttribute("aVertex",r.VERTEX_ATTRIB_POSITION);break;case r.SHADER_POSITION_LENGTHTEXTURECOLOR:t.initWithVertexShaderByteArray(n.POSITION_COLOR_LENGTH_TEXTURE_VERT,n.POSITION_COLOR_LENGTH_TEXTURE_FRAG),t.addAttribute(r.ATTRIBUTE_NAME_POSITION,r.VERTEX_ATTRIB_POSITION),t.addAttribute(r.ATTRIBUTE_NAME_TEX_COORD,r.VERTEX_ATTRIB_TEX_COORDS),t.addAttribute(r.ATTRIBUTE_NAME_COLOR,r.VERTEX_ATTRIB_COLOR);break;default:return void cc.logID(8105)}t.link(),t.updateUniforms()},_reloadShader:function(t){var e=this.programForKey(t);e.reset(),this._loadDefaultShader(e,t)},loadDefaultShaders:function(){},reloadDefaultShaders:function(){this._reloadShader(r.SHADER_POSITION_TEXTURECOLOR),this._reloadShader(r.SHADER_SPRITE_POSITION_TEXTURECOLOR),this._reloadShader(r.SHADER_POSITION_TEXTURECOLORALPHATEST),this._reloadShader(r.SHADER_SPRITE_POSITION_TEXTURECOLORALPHATEST),this._reloadShader(r.SHADER_POSITION_COLOR),this._reloadShader(r.SHADER_POSITION_TEXTURE),this._reloadShader(r.SHADER_POSITION_TEXTURE_UCOLOR),this._reloadShader(r.SHADER_POSITION_TEXTUREA8COLOR),this._reloadShader(r.SHADER_POSITION_UCOLOR)},programForKey:function(t){if(!this._programs[t]){var e=new cc.GLProgram;this._loadDefaultShader(e,t),this._programs[t]=e}return this._programs[t]},getProgram:function(t){return this.programForKey(t)},addProgram:function(t,e){this._programs[e]=t}}},{}],208:[function(t,e,i){cc.PresetShaders={POSITION_UCOLOR_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvoid main()\n{\ngl_FragColor = v_fragmentColor;\n}",POSITION_UCOLOR_VERT:"attribute vec4 a_position;\nuniform vec4 u_color;\nuniform float u_pointSize;\nvarying lowp vec4 v_fragmentColor;\nvoid main(void)\n{\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\ngl_PointSize = u_pointSize;\nv_fragmentColor = u_color;\n}",POSITION_COLOR_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvoid main()\n{\ngl_FragColor = v_fragmentColor;\n}",POSITION_COLOR_VERT:"attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\nv_fragmentColor = a_color;\n}",SPRITE_POSITION_COLOR_VERT:"attribute vec4 a_position;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvoid main()\n{\ngl_Position = CC_PMatrix * a_position;\nv_fragmentColor = a_color;\n}",POSITION_COLOR_LENGTH_TEXTURE_FRAG:"//#extension GL_OES_standard_derivatives : enable\nvarying mediump vec4 v_color;\nvarying mediump vec2 v_texcoord;\nvoid main()\n{\n//#if defined GL_OES_standard_derivatives\n//gl_FragColor=v_color*smoothstep(0.0, length(fwidth(v_texcoord)), 1.0-length(v_texcoord));\n//#else\ngl_FragColor = v_color * step(0.0, 1.0 - length(v_texcoord));\n//#endif\n}",POSITION_COLOR_LENGTH_TEXTURE_VERT:"attribute mediump vec4 a_position;\nattribute mediump vec2 a_texcoord;\nattribute mediump vec4 a_color;\nvarying mediump vec4 v_color;\nvarying mediump vec2 v_texcoord;\nvoid main()\n{\nv_color = a_color;\nv_texcoord = a_texcoord;\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\n}",POSITION_TEXTURE_FRAG:"precision lowp float;\nvarying vec2 v_texCoord;\nvoid main()\n{\ngl_FragColor = texture2D(CC_Texture0, v_texCoord);\n}",POSITION_TEXTURE_VERT:"attribute vec4 a_position;\nattribute vec2 a_texCoord;\nvarying mediump vec2 v_texCoord;\nvoid main()\n{\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\nv_texCoord = a_texCoord;\n}",POSITION_TEXTURE_UCOLOR_FRAG:"precision lowp float;\nuniform vec4 u_color;\nvarying vec2 v_texCoord;\nvoid main()\n{\ngl_FragColor=texture2D(CC_Texture0, v_texCoord) * u_color;\n}",POSITION_TEXTURE_UCOLOR_VERT:"attribute vec4 a_position;\nattribute vec2 a_texCoord;\nvarying mediump vec2 v_texCoord;\nvoid main()\n{\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\nv_texCoord = a_texCoord;\n}",POSITION_TEXTURE_A8COLOR_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nvoid main()\n{\ngl_FragColor = vec4(v_fragmentColor.rgb,\nv_fragmentColor.a * texture2D(CC_Texture0, v_texCoord).a);\n}",POSITION_TEXTURE_A8COLOR_VERT:"attribute vec4 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvarying mediump vec2 v_texCoord;\nvoid main()\n{\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\nv_fragmentColor = a_color;\nv_texCoord = a_texCoord;\n}",POSITION_TEXTURE_COLOR_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nvoid main()\n{\ngl_FragColor = v_fragmentColor * texture2D(CC_Texture0, v_texCoord);\n}",POSITION_TEXTURE_COLOR_VERT:"attribute vec4 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvarying mediump vec2 v_texCoord;\nvoid main()\n{\ngl_Position = (CC_PMatrix * CC_MVMatrix) * a_position;\nv_fragmentColor = a_color;\nv_texCoord = a_texCoord;\n}",SPRITE_POSITION_TEXTURE_COLOR_VERT:"attribute vec4 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying lowp vec4 v_fragmentColor;\nvarying mediump vec2 v_texCoord;\nvoid main()\n{\ngl_Position = CC_PMatrix * a_position;\nv_fragmentColor = a_color;\nv_texCoord = a_texCoord;\n}",POSITION_TEXTURE_COLOR_ALPHATEST_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nuniform float CC_alpha_value;\nvoid main()\n{\nvec4 texColor=texture2D(CC_Texture0, v_texCoord);\nif(texColor.a <= CC_alpha_value)\n discard; \ngl_FragColor=texColor*v_fragmentColor;\n}",EX_SWITCHMASK_FRAG:"precision lowp float;\nvarying vec4 v_fragmentColor;\nvarying vec2 v_texCoord;\nuniform sampler2D u_texture;\nuniform sampler2D u_mask;\nvoid main()\n{\nvec4 texColorc=texture2D(u_texture, v_texCoord);\nvec4 maskColor=texture2D(u_mask, v_texCoord);\nvec4 finalColor=vec4(texColor.r, texColor.g, texColor.b, maskColor.a*texColor.a);\ngl_FragColor=v_fragmentColor*finalColor;\n}"}},{}],209:[function(t,e,i){t("./CCShaders"),t("./CCShaderCache"),t("./CCGLProgram"),t("./CCGLStateCache")},{"./CCGLProgram":205,"./CCGLStateCache":206,"./CCShaderCache":207,"./CCShaders":208}],210:[function(e,t,i){var N=function(t){return{u:t.x,v:t.y}};cc.DrawNode=_ccsg.Node.extend({_buffer:null,_blendFunc:null,_lineWidth:1,_drawColor:null,getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(t,e){void 0===e?(this._blendFunc.src=t.src,this._blendFunc.dst=t.dst):(this._blendFunc.src=t,this._blendFunc.dst=e)},setLineWidth:function(t){this._lineWidth=t},getLineWidth:function(){return this._lineWidth},setDrawColor:function(t){var e=this._drawColor;e.r=t.r,e.g=t.g,e.b=t.b,e.a=null==t.a?255:t.a},getDrawColor:function(){return cc.color(this._drawColor.r,this._drawColor.g,this._drawColor.b,this._drawColor.a)}}),cc.DrawNode.TYPE_DOT=0,cc.DrawNode.TYPE_SEGMENT=1,cc.DrawNode.TYPE_POLY=2,cc.game.once(cc.game.EVENT_RENDERER_INITED,function(){var t=cc.DrawNode.prototype;cc._renderType===cc.game.RENDER_TYPE_CANVAS?(cc._DrawNodeElement=function(t,e,i,n,r,o,s,a,c){this.type=t,this.verts=e||null,this.fillColor=i||null,this.lineWidth=n||0,this.lineColor=r||null,this.lineCap=o||"butt",this.isClosePolygon=s||!1,this.isFill=a||!1,this.isStroke=c||!1},t._className="DrawNodeCanvas",t.ctor=function(){_ccsg.Node.prototype.ctor.call(this);var t=this._renderCmd;t._buffer=this._buffer=[],t._drawColor=this._drawColor=cc.color(255,255,255,255),t._blendFunc=this._blendFunc=new cc.BlendFunc(cc.macro.SRC_ALPHA,cc.macro.ONE_MINUS_SRC_ALPHA),this.init()},t.drawRect=function(t,e,i,n,r){n=null==n?this._lineWidth:n,null==(r=r||this.getDrawColor()).a&&(r.a=255);var o=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)],s=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);s.verts=o,s.lineWidth=n,s.lineColor=r,s.isClosePolygon=!0,s.isStroke=!0,s.lineCap="butt",(s.fillColor=i)&&(null==i.a&&(i.a=255),s.isFill=!0),this._buffer.push(s)},t.drawCircle=function(t,e,i,n,r,o,s){o=o||this._lineWidth,null==(s=s||this.getDrawColor()).a&&(s.a=255);for(var a=2*Math.PI/n,c=[],h=0;h<=n;h++){var l=h*a,u=e*Math.cos(l+i)+t.x,_=e*Math.sin(l+i)+t.y;c.push(cc.p(u,_))}r&&c.push(cc.p(t.x,t.y));var d=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);d.verts=c,d.lineWidth=o,d.lineColor=s,d.isClosePolygon=!0,d.isStroke=!0,this._buffer.push(d)},t.drawQuadBezier=function(t,e,i,n,r,o){r=r||this._lineWidth,null==(o=o||this.getDrawColor()).a&&(o.a=255);for(var s=[],a=0,c=0;c<n;c++){var h=Math.pow(1-a,2)*t.x+2*(1-a)*a*e.x+a*a*i.x,l=Math.pow(1-a,2)*t.y+2*(1-a)*a*e.y+a*a*i.y;s.push(cc.p(h,l)),a+=1/n}s.push(cc.p(i.x,i.y));var u=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);u.verts=s,u.lineWidth=r,u.lineColor=o,u.isStroke=!0,u.lineCap="round",this._buffer.push(u)},t.drawCubicBezier=function(t,e,i,n,r,o,s){o=o||this._lineWidth,null==(s=s||this.getDrawColor()).a&&(s.a=255);for(var a=[],c=0,h=0;h<r;h++){var l=Math.pow(1-c,3)*t.x+3*Math.pow(1-c,2)*c*e.x+3*(1-c)*c*c*i.x+c*c*c*n.x,u=Math.pow(1-c,3)*t.y+3*Math.pow(1-c,2)*c*e.y+3*(1-c)*c*c*i.y+c*c*c*n.y;a.push(cc.p(l,u)),c+=1/r}a.push(cc.p(n.x,n.y));var _=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);_.verts=a,_.lineWidth=o,_.lineColor=s,_.isStroke=!0,_.lineCap="round",this._buffer.push(_)},t.drawCatmullRom=function(t,e,i,n){this.drawCardinalSpline(t,.5,e,i,n)},t.drawCardinalSpline=function(t,e,i,n,r){n=n||this._lineWidth,null==(r=r||this.getDrawColor()).a&&(r.a=255);for(var o,s,a=[],c=1/t.length,h=0;h<i+1;h++){var l=h/i;1===l?(o=t.length-1,s=1):s=(l-c*(o=0|l/c))/c;var u=cc.cardinalSplineAt(cc.getControlPointAt(t,o-1),cc.getControlPointAt(t,o-0),cc.getControlPointAt(t,o+1),cc.getControlPointAt(t,o+2),e,s);a.push(u)}var _=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);_.verts=a,_.lineWidth=n,_.lineColor=r,_.isStroke=!0,_.lineCap="round",this._buffer.push(_)},t.drawDot=function(t,e,i){null==(i=i||this.getDrawColor()).a&&(i.a=255);var n=new cc._DrawNodeElement(cc.DrawNode.TYPE_DOT);n.verts=[t],n.lineWidth=e,n.fillColor=i,this._buffer.push(n)},t.drawDots=function(t,e,i){if(t&&0!=t.length){null==(i=i||this.getDrawColor()).a&&(i.a=255);for(var n=0,r=t.length;n<r;n++)this.drawDot(t[n],e,i)}},t.drawSegment=function(t,e,i,n){i=i||this._lineWidth,null==(n=n||this.getDrawColor()).a&&(n.a=255);var r=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);r.verts=[t,e],r.lineWidth=2*i,r.lineColor=n,r.isStroke=!0,r.lineCap="round",this._buffer.push(r)},t.drawPoly_=function(t,e,i,n,r){i=null==i?this._lineWidth:i,null==(n=n||this.getDrawColor()).a&&(n.a=255);var o=new cc._DrawNodeElement(cc.DrawNode.TYPE_POLY);o.verts=t,o.fillColor=e,o.lineWidth=i,o.lineColor=n,o.isClosePolygon=!r,o.isStroke=!0,o.lineCap="round",e&&(o.isFill=!0),this._buffer.push(o)},t.drawPoly=function(t,e,i,n,r){for(var o=[],s=0;s<t.length;s++)o.push(cc.p(t[s].x,t[s].y));return this.drawPoly_(o,e,i,n,r)},t.clear=function(){this._buffer.length=0},e("./CCDrawNodeCanvasRenderCmd"),t._createRenderCmd=function(){return new cc.DrawNode.CanvasRenderCmd(this)}):cc._renderType===cc.game.RENDER_TYPE_WEBGL&&(t._bufferCapacity=0,t._trianglesArrayBuffer=null,t._trianglesWebBuffer=null,t._trianglesReader=null,t._dirty=!1,t._className="DrawNodeWebGL",t.ctor=function(){_ccsg.Node.prototype.ctor.call(this),this._buffer=[],this._blendFunc=new cc.BlendFunc(cc.macro.SRC_ALPHA,cc.macro.ONE_MINUS_SRC_ALPHA),this._drawColor=cc.color(255,255,255,255),this.init()},t.init=function(){return!!_ccsg.Node.prototype.init.call(this)&&(this.shaderProgram=cc.shaderCache.programForKey(cc.macro.SHADER_POSITION_LENGTHTEXTURECOLOR),this._ensureCapacity(64),this._trianglesWebBuffer=cc._renderContext.createBuffer(),this._dirty=!0)},t.drawRect=function(t,e,i,n,r){n=null==n?this._lineWidth:n,null==(r=r||this.getDrawColor()).a&&(r.a=255);var o=[t,cc.p(e.x,t.y),e,cc.p(t.x,e.y)];null==i?this._drawSegments(o,n,r,!0):this.drawPoly(o,i,n,r)},t.drawCircle=function(t,e,i,n,r,o,s){o=o||this._lineWidth,null==(s=s||this.getDrawColor()).a&&(s.a=255);var a,c,h=2*Math.PI/n,l=[];for(a=0;a<=n;a++){var u=a*h,_=e*Math.cos(u+i)+t.x,d=e*Math.sin(u+i)+t.y;l.push(cc.p(_,d))}for(r&&l.push(cc.p(t.x,t.y)),o*=.5,a=0,c=l.length;a<c-1;a++)this.drawSegment(l[a],l[a+1],o,s)},t.drawQuadBezier=function(t,e,i,n,r,o){r=r||this._lineWidth,null==(o=o||this.getDrawColor()).a&&(o.a=255);for(var s=[],a=0,c=0;c<n;c++){var h=Math.pow(1-a,2)*t.x+2*(1-a)*a*e.x+a*a*i.x,l=Math.pow(1-a,2)*t.y+2*(1-a)*a*e.y+a*a*i.y;s.push(cc.p(h,l)),a+=1/n}s.push(cc.p(i.x,i.y)),this._drawSegments(s,r,o,!1)},t.drawCubicBezier=function(t,e,i,n,r,o,s){o=o||this._lineWidth,null==(s=s||this.getDrawColor()).a&&(s.a=255);for(var a=[],c=0,h=0;h<r;h++){var l=Math.pow(1-c,3)*t.x+3*Math.pow(1-c,2)*c*e.x+3*(1-c)*c*c*i.x+c*c*c*n.x,u=Math.pow(1-c,3)*t.y+3*Math.pow(1-c,2)*c*e.y+3*(1-c)*c*c*i.y+c*c*c*n.y;a.push(cc.p(l,u)),c+=1/r}a.push(cc.p(n.x,n.y)),this._drawSegments(a,o,s,!1)},t.drawCatmullRom=function(t,e,i,n){this.drawCardinalSpline(t,.5,e,i,n)},t.drawCardinalSpline=function(t,e,i,n,r){n=n||this._lineWidth,null==(r=r||this.getDrawColor()).a&&(r.a=255);for(var o,s,a=[],c=1/t.length,h=0;h<i+1;h++){var l=h/i;1===l?(o=t.length-1,s=1):s=(l-c*(o=0|l/c))/c;var u=cc.cardinalSplineAt(cc.getControlPointAt(t,o-1),cc.getControlPointAt(t,o-0),cc.getControlPointAt(t,o+1),cc.getControlPointAt(t,o+2),e,s);a.push(u)}n*=.5;for(var _=0,d=a.length;_<d-1;_++)this.drawSegment(a[_],a[_+1],n,r)},t._render=function(){var t=cc._renderContext;t.bindBuffer(t.ARRAY_BUFFER,this._trianglesWebBuffer),this._dirty&&(t.bufferData(t.ARRAY_BUFFER,this._trianglesArrayBuffer,t.STREAM_DRAW),this._dirty=!1);var e=cc.V2F_C4B_T2F.BYTES_PER_ELEMENT;t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_POSITION),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_COLOR),t.enableVertexAttribArray(cc.macro.VERTEX_ATTRIB_TEX_COORDS),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_POSITION,2,t.FLOAT,!1,e,0),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_COLOR,4,t.UNSIGNED_BYTE,!0,e,8),t.vertexAttribPointer(cc.macro.VERTEX_ATTRIB_TEX_COORDS,2,t.FLOAT,!1,e,12),t.drawArrays(t.TRIANGLES,0,3*this._buffer.length),cc.incrementGLDraws(1)},t._ensureCapacity=function(t){var e=this,i=e._buffer;if(i.length+t>e._bufferCapacity){var n=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT;if(e._bufferCapacity+=Math.max(e._bufferCapacity,t),null==i||0===i.length)e._buffer=[],e._trianglesArrayBuffer=new ArrayBuffer(n*e._bufferCapacity),e._trianglesReader=new Uint8Array(e._trianglesArrayBuffer);else{for(var r=[],o=new ArrayBuffer(n*e._bufferCapacity),s=0;s<i.length;s++)r[s]=new cc.V2F_C4B_T2F_Triangle(i[s].a,i[s].b,i[s].c,o,s*n);e._trianglesReader=new Uint8Array(o),e._trianglesArrayBuffer=o,e._buffer=r}}},t.drawDot=function(t,e,i){null==(i=i||this.getDrawColor()).a&&(i.a=255);var n={r:0|i.r,g:0|i.g,b:0|i.b,a:0|i.a},r={vertices:{x:t.x-e,y:t.y-e},colors:n,texCoords:{u:-1,v:-1}},o={vertices:{x:t.x-e,y:t.y+e},colors:n,texCoords:{u:-1,v:1}},s={vertices:{x:t.x+e,y:t.y+e},colors:n,texCoords:{u:1,v:1}},a={vertices:{x:t.x+e,y:t.y-e},colors:n,texCoords:{u:1,v:-1}};this._ensureCapacity(6),this._buffer.push(new cc.V2F_C4B_T2F_Triangle(r,o,s,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._buffer.push(new cc.V2F_C4B_T2F_Triangle(r,s,a,this._trianglesArrayBuffer,this._buffer.length*cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT)),this._dirty=!0},t.drawDots=function(t,e,i){if(t&&0!==t.length){null==(i=i||this.getDrawColor()).a&&(i.a=255);for(var n=0,r=t.length;n<r;n++)this.drawDot(t[n],e,i)}},t.drawSegment=function(t,e,i,n){null==(n=n||this.getDrawColor()).a&&(n.a=255),i=i||.5*this._lineWidth,this._ensureCapacity(18);var r={r:0|n.r,g:0|n.g,b:0|n.b,a:0|n.a},o=cc.v2(t),s=cc.v2(e),a=cc.pNormalize(cc.pPerp(cc.pSub(s,o))),c=cc.pPerp(a),h=cc.pMult(a,i),l=cc.pMult(c,i),u=cc.pSub(s,cc.pAdd(h,l)),_=cc.pAdd(s,cc.pSub(h,l)),d=cc.pSub(s,h),f=cc.pAdd(s,h),p=cc.pSub(o,h),g=cc.pAdd(o,h),m=cc.pSub(o,cc.pSub(h,l)),v=cc.pAdd(o,cc.pAdd(h,l)),y=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,C=this._trianglesArrayBuffer,T=this._buffer;T.push(new cc.V2F_C4B_T2F_Triangle({vertices:u,colors:r,texCoords:N(cc.pNeg(cc.pAdd(a,c)))},{vertices:_,colors:r,texCoords:N(cc.pSub(a,c))},{vertices:d,colors:r,texCoords:N(cc.pNeg(a))},C,T.length*y)),T.push(new cc.V2F_C4B_T2F_Triangle({vertices:f,colors:r,texCoords:N(a)},{vertices:_,colors:r,texCoords:N(cc.pSub(a,c))},{vertices:d,colors:r,texCoords:N(cc.pNeg(a))},C,T.length*y)),T.push(new cc.V2F_C4B_T2F_Triangle({vertices:f,colors:r,texCoords:N(a)},{vertices:p,colors:r,texCoords:N(cc.pNeg(a))},{vertices:d,colors:r,texCoords:N(cc.pNeg(a))},C,T.length*y)),T.push(new cc.V2F_C4B_T2F_Triangle({vertices:f,colors:r,texCoords:N(a)},{vertices:p,colors:r,texCoords:N(cc.pNeg(a))},{vertices:g,colors:r,texCoords:N(a)},C,T.length*y)),T.push(new cc.V2F_C4B_T2F_Triangle({vertices:m,colors:r,texCoords:N(cc.pSub(c,a))},{vertices:p,colors:r,texCoords:N(cc.pNeg(a))},{vertices:g,colors:r,texCoords:N(a)},C,T.length*y)),T.push(new cc.V2F_C4B_T2F_Triangle({vertices:m,colors:r,texCoords:N(cc.pSub(c,a))},{vertices:v,colors:r,texCoords:N(cc.pAdd(a,c))},{vertices:g,colors:r,texCoords:N(a)},C,T.length*y)),this._dirty=!0},t.drawPoly=function(t,e,i,n,r){if(null!=e){null==e.a&&(e.a=255),null==n.a&&(n.a=255),i=null==i?this._lineWidth:i,i*=.5;var o,s,a,c,h={r:0|e.r,g:0|e.g,b:0|e.b,a:0|e.a},l={r:0|n.r,g:0|n.g,b:0|n.b,a:0|n.a},u=[],_=t.length;for(o=0;o<_;o++){s=cc.v2(t[(o-1+_)%_]),a=cc.v2(t[o]),c=cc.v2(t[(o+1)%_]);var d=cc.pNormalize(cc.pPerp(cc.pSub(a,s))),f=cc.pNormalize(cc.pPerp(cc.pSub(c,a))),p=cc.pMult(cc.pAdd(d,f),1/(cc.pDot(d,f)+1));u[o]={offset:p,n:f}}var g=0<i,m=3*(3*_-2);this._ensureCapacity(m);var v,y,C,T=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,x=this._trianglesArrayBuffer,E=this._buffer;for(o=0;o<_-2;o++)v={vertices:t[0],colors:h,texCoords:N(cc.v2())},y={vertices:t[o+1],colors:h,texCoords:N(cc.v2())},C={vertices:t[o+2],colors:h,texCoords:N(cc.v2())},E.push(new cc.V2F_C4B_T2F_Triangle(v,y,C,x,E.length*T));if(g)for(o=0;o<_;o++){var S=(o+1)%_;s=cc.v2(t[o]),a=cc.v2(t[S]);var b=u[o].n,R=u[o].offset,A=u[S].offset,O=cc.pSub(s,cc.pMult(R,i)),I=cc.pSub(a,cc.pMult(A,i)),w=cc.pAdd(s,cc.pMult(R,i)),L=cc.pAdd(a,cc.pMult(A,i));v={vertices:O,colors:l,texCoords:N(cc.pNeg(b))},y={vertices:I,colors:l,texCoords:N(cc.pNeg(b))},C={vertices:L,colors:l,texCoords:N(b)},E.push(new cc.V2F_C4B_T2F_Triangle(v,y,C,x,E.length*T)),v={vertices:O,colors:l,texCoords:N(cc.pNeg(b))},y={vertices:w,colors:l,texCoords:N(b)},C={vertices:L,colors:l,texCoords:N(b)},E.push(new cc.V2F_C4B_T2F_Triangle(v,y,C,x,E.length*T))}u=null,this._dirty=!0}else this._drawSegments(t,i,n,!r)},t._drawSegments=function(t,e,i,n){if(e=null==e?this._lineWidth:e,null==(i=i||this._drawColor).a&&(i.a=255),!((e*=.5)<=0)){var r,o,s,a,c={r:0|i.r,g:0|i.g,b:0|i.b,a:0|i.a},h=[],l=t.length;for(r=0;r<l;r++){o=cc.v2(t[(r-1+l)%l]),s=cc.v2(t[r]),a=cc.v2(t[(r+1)%l]);var u=cc.pNormalize(cc.pPerp(cc.pSub(s,o))),_=cc.pNormalize(cc.pPerp(cc.pSub(a,s))),d=cc.pMult(cc.pAdd(u,_),1/(cc.pDot(u,_)+1));h[r]={offset:d,n:_}}var f=3*(3*l-2);this._ensureCapacity(f);var p=cc.V2F_C4B_T2F_Triangle.BYTES_PER_ELEMENT,g=this._trianglesArrayBuffer,m=this._buffer,v=n?l:l-1;for(r=0;r<v;r++){var y=(r+1)%l;o=cc.v2(t[r]),s=cc.v2(t[y]);var C=h[r].n,T=h[r].offset,x=h[y].offset,E=cc.pSub(o,cc.pMult(T,e)),S=cc.pSub(s,cc.pMult(x,e)),b=cc.pAdd(o,cc.pMult(T,e)),R=cc.pAdd(s,cc.pMult(x,e));m.push(new cc.V2F_C4B_T2F_Triangle({vertices:E,colors:c,texCoords:N(cc.pNeg(C))},{vertices:S,colors:c,texCoords:N(cc.pNeg(C))},{vertices:R,colors:c,texCoords:N(C)},g,m.length*p)),m.push(new cc.V2F_C4B_T2F_Triangle({vertices:E,colors:c,texCoords:N(cc.pNeg(C))},{vertices:b,colors:c,texCoords:N(C)},{vertices:R,colors:c,texCoords:N(C)},g,m.length*p))}h=null,this._dirty=!0}},t.clear=function(){this._buffer.length=0,this._dirty=!0},e("./CCDrawNodeWebGLRenderCmd"),t._createRenderCmd=function(){return new cc.DrawNode.WebGLRenderCmd(this)})})},{"./CCDrawNodeCanvasRenderCmd":211,"./CCDrawNodeWebGLRenderCmd":212}],211:[function(t,e,i){cc.DrawNode.CanvasRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._buffer=null,this._drawColor=null,this._blendFunc=null};var n=cc.DrawNode.CanvasRenderCmd.prototype=Object.create(_ccsg.Node.CanvasRenderCmd.prototype);n.constructor=cc.DrawNode.CanvasRenderCmd,n.rendering=function(t,e,i){var n=t||cc._renderContext,r=(n.getContext(),this._node._displayedOpacity/255);if(0!==r){n.setTransform(this._worldTransform,e,i),n.setGlobalAlpha(r),this._blendFunc&&this._blendFunc.src===cc.macro.SRC_ALPHA&&this._blendFunc.dst===cc.macro.ONE&&n.setCompositeOperation("lighter");for(var o=this._buffer,s=0,a=o.length;s<a;s++){var c=o[s];switch(c.type){case cc.DrawNode.TYPE_DOT:this._drawDot(n,c,e,i);break;case cc.DrawNode.TYPE_SEGMENT:this._drawSegment(n,c,e,i);break;case cc.DrawNode.TYPE_POLY:this._drawPoly(n,c,e,i)}}}},n._drawDot=function(t,e,i,n){var r=e.fillColor,o=e.verts[0],s=e.lineWidth,a=t.getContext();t.setFillStyle("rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b)+","+r.a/255+")"),a.beginPath(),a.arc(o.x,-o.y,s,0,2*Math.PI,!1),a.closePath(),a.fill()},n._drawSegment=function(t,e,i,n){var r=e.lineColor,o=e.verts[0],s=e.verts[1],a=e.lineWidth,c=e.lineCap,h=t.getContext();t.setStrokeStyle("rgba("+(0|r.r)+","+(0|r.g)+","+(0|r.b)+","+r.a/255+")"),h.lineWidth=a*i,h.beginPath(),h.lineCap=c,h.moveTo(o.x,-o.y),h.lineTo(s.x,-s.y),h.stroke()},n._drawPoly=function(t,e,i,n){var r=e.verts,o=e.lineCap;if(null!=r){var s=e.fillColor,a=e.lineWidth,c=e.lineColor,h=e.isClosePolygon,l=e.isFill,u=e.isStroke,_=t.getContext(),d=r[0];_.lineCap=o,s&&t.setFillStyle("rgba("+(0|s.r)+","+(0|s.g)+","+(0|s.b)+","+s.a/255+")"),a&&(_.lineWidth=a*i),c&&t.setStrokeStyle("rgba("+(0|c.r)+","+(0|c.g)+","+(0|c.b)+","+c.a/255+")"),_.beginPath(),_.moveTo(d.x,-d.y);for(var f=1,p=r.length;f<p;f++)_.lineTo(r[f].x,-r[f].y);h&&_.closePath(),l&&_.fill(),u&&_.stroke()}}},{}],212:[function(t,e,i){cc.DrawNode.WebGLRenderCmd=function(t){this._rootCtor(t),this._needDraw=!0,this._matrix=new cc.math.Matrix4,this._matrix.identity()},cc.DrawNode.WebGLRenderCmd.prototype=Object.create(_ccsg.Node.WebGLRenderCmd.prototype),cc.DrawNode.WebGLRenderCmd.prototype.constructor=cc.DrawNode.WebGLRenderCmd,cc.DrawNode.WebGLRenderCmd.prototype.rendering=function(t){var e=this._node;if(0<e._buffer.length){var i=this._worldTransform,n=this._matrix.mat;n[0]=i.a,n[4]=i.c,n[12]=i.tx,n[1]=i.b,n[5]=i.d,n[13]=i.ty,cc.gl.blendFunc(e._blendFunc.src,e._blendFunc.dst),this._shaderProgram.use(),this._shaderProgram._setUniformForMVPMatrixWithMat4(this._matrix),e._render()}}},{}],213:[function(t,e,i){t("./cocos2d/core"),t("./cocos2d/animation"),t("./cocos2d/particle/CCParticleSystem"),t("./cocos2d/tilemap/CCTiledMap"),t("./cocos2d/motion-streak/CCMotionStreak"),t("./cocos2d/core/components/CCStudioComponent"),t("./extensions/ccpool/CCNodePool"),t("./extensions/ccpool/CCPool"),t("./cocos2d/actions"),t("./external/chipmunk/chipmunk"),t("./extensions/spine"),t("./extensions/dragonbones"),t("./cocos2d/deprecated")},{"./cocos2d/actions":218,"./cocos2d/animation":11,"./cocos2d/core":97,"./cocos2d/core/components/CCStudioComponent":218,"./cocos2d/deprecated":187,"./cocos2d/motion-streak/CCMotionStreak":218,"./cocos2d/particle/CCParticleAsset":218,"./cocos2d/particle/CCParticleSystem":218,"./cocos2d/tilemap/CCTiledMap":218,"./cocos2d/tilemap/CCTiledMapAsset":218,"./extensions/ccpool/CCNodePool":214,"./extensions/ccpool/CCPool":215,"./extensions/dragonbones":218,"./extensions/spine":218,"./external/chipmunk/chipmunk":218}],214:[function(t,e,i){cc.NodePool=function(t){this.poolHandlerComp=t,this._pool=[]},cc.NodePool.prototype={constructor:cc.NodePool,size:function(){return this._pool.length},clear:function(){for(var t=this._pool.length,e=0;e<t;++e)this._pool[e].destroy();this._pool.length=0},put:function(t){if(t&&-1===this._pool.indexOf(t)){t.removeFromParent(!1);var e=this.poolHandlerComp?t.getComponent(this.poolHandlerComp):null;e&&e.unuse&&e.unuse(),this._pool.push(t)}},get:function(){var t=this._pool.length-1;if(t<0)return null;var e=this._pool[t];this._pool.length=t;var i=this.poolHandlerComp?e.getComponent(this.poolHandlerComp):null;return i&&i.reuse&&i.reuse.apply(i,arguments),e}},e.exports=cc.NodePool},{}],215:[function(t,e,i){var o=[];cc.pool={_pool:{},_releaseCB:function(){this.release()},_autoRelease:function(t){var e=void 0!==t._running&&!t._running;cc.director.getScheduler().schedule(this._releaseCB,t,0,0,0,e)},putInPool:function(t){var e=cc.js._getClassId(t.constructor);e&&(this._pool[e]||(this._pool[e]=[]),t.unuse&&t.unuse(),this._pool[e].push(t))},hasObject:function(t){var e=cc.js._getClassId(t),i=this._pool[e];return!(!i||0===i.length)},removeObject:function(t){var e=cc.js._getClassId(t.constructor);if(e){var i=this._pool[e];if(i)for(var n=0;n<i.length;n++)t===i[n]&&i.splice(n,1)}},getFromPool:function(t){if(this.hasObject(t)){var e=cc.js._getClassId(t),i=this._pool[e];o.length=arguments.length-1;for(var n=0;n<o.length;n++)o[n]=arguments[n+1];var r=i.pop();return r.reuse&&r.reuse.apply(r,o),o.length=0,r}},drainAllPools:function(){this._pool={}}}},{}],216:[function(t,e,i){e.exports=function(){"use strict";var r=Math.round(window.devicePixelRatio||1),t=function(t,e){this._color=e||"#666",this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._canvas.className="pstats-canvas",t.appendChild(this._canvas)};t.prototype.init=function(t,e){var i=t*r,n=e*r;this._canvas.width=i,this._canvas.height=n,this._canvas.style.width=t+"px",this._canvas.style.height=e+"px",this._ctx.globalAlpha=1,this._ctx.fillStyle="#444",this._ctx.fillRect(0,0,i,n)};var o=Math.round(window.devicePixelRatio||1),b=function(i){function t(t,e){i.call(this,t,e),this._current=0,this._max=0}return i&&(t.__proto__=i),((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.draw=function(t,e){var i=this._canvas.width,n=this._canvas.height;this._current+=.1*(t-this._current),this._max*=.99,this._current>this._max&&(this._max=this._current);var r=Math.round((1-this._current/this._max)*n);this._ctx.globalAlpha=1,this._ctx.drawImage(this._canvas,o,0,i-o,n,0,0,i-o,n),e?(this._ctx.fillStyle="#444",this._ctx.fillRect(i-o,0,o,n),this._ctx.fillStyle="#b70000"):(this._ctx.fillStyle="#444",this._ctx.fillRect(i-o,0,o,n),this._ctx.fillStyle=this._color),this._ctx.fillRect(i-o,r,o,n-r),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(i-o,r,o,o)},t}(t),a=Math.round(window.devicePixelRatio||1),R=function(r){function t(t,e){r.call(this,t,e),this._threshold=0,this._canvas2=document.createElement("canvas"),this._ctx2=this._canvas2.getContext("2d")}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.init=function(t,e){r.prototype.init.call(this,t,e);var i=t*a,n=e*a;this._canvas2.width=i,this._canvas2.height=n,this._canvas2.style.width=t+"px",this._canvas2.style.height=e+"px",this._ctx2.globalAlpha=1,this._ctx2.fillStyle="#444",this._ctx2.fillRect(0,0,i,n)},t.prototype.draw=function(t,e){var i=this._canvas.width,n=this._canvas.height;if(this._ctx.globalAlpha=1,this._ctx2.globalAlpha=1,t>this._threshold){var r=n*((t-t%n)/n+1),o=this._threshold/(this._threshold=r);this._ctx2.drawImage(this._canvas,0,0),this._ctx.fillStyle="#444",this._ctx.fillRect(0,0,i,n),this._ctx.drawImage(this._canvas2,a,0,i-a,n,0,Math.round((1-o)*n),i-a,n)}else this._ctx.drawImage(this._canvas,a,0,i-a,n,0,0,i-a,n);var s=Math.round(n*(1-t/this._threshold));e?(this._ctx.fillStyle="#444",this._ctx.fillRect(i-a,0,a,n),this._ctx.fillStyle="#b70000"):(this._ctx.fillStyle="#444",this._ctx.fillRect(i-a,0,a,n),this._ctx.fillStyle=this._color),this._ctx.fillRect(i-a,s,a,n-s),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(i-a,s,a,a)},t}(t),s=Math.round(window.devicePixelRatio||1),A=function(r){function t(t,e,i,n){r.call(this,t,e),this._min=i,this._max=n}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.draw=function(t,e){var i=this._canvas.width,n=this._canvas.height,r=(t-this._min)/(this._max-this._min),o=Math.round((1-r)*n);this._ctx.globalAlpha=1,this._ctx.drawImage(this._canvas,s,0,i-s,n,0,0,i-s,n),e?(this._ctx.fillStyle="#444",this._ctx.fillRect(i-s,0,s,n),this._ctx.fillStyle="#b70000"):(this._ctx.fillStyle="#444",this._ctx.fillRect(i-s,0,s,n),this._ctx.fillStyle=this._color),this._ctx.fillRect(i-s,o,s,n-o),this._ctx.globalAlpha=.5,this._ctx.fillStyle="#fff",this._ctx.fillRect(i-s,o,s,s)},t}(t),c=Math.round(window.devicePixelRatio||1),O=function(t,e){this._colors=e,this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._canvas.className="pstats-canvas",t.appendChild(this._canvas)};O.prototype.init=function(t,e,i){var n=t*c,r=e*c;this._canvas.width=n,this._canvas.height=r*i,this._canvas.style.width=t+"px",this._canvas.style.height=e*i+"px",this._ctx.globalAlpha=1,this._ctx.fillStyle="#444",this._ctx.fillRect(0,0,n,r*i)},O.prototype.draw=function(t){var e=this._canvas.width,i=this._canvas.height;this._ctx.globalAlpha=1,this._ctx.drawImage(this._canvas,c,0,e-c,i,0,0,e-c,i);for(var n=0,r=0;r<t.length;++r){var o=t[r]*i;this._ctx.fillStyle=this._colors[r],this._ctx.fillRect(e-c,n,c,o),n+=o}};var e=function(t,e){this._id=t,this._opts=e||{},this._value=0,this._total=0,this._averageValue=0,this._accumValue=0,this._accumSamples=0,this._accumStart=window.performance.now()},i={value:{}};e.prototype._average=function(t){if(this._opts.average){this._accumValue+=t,++this._accumSamples;var e=performance.now();e-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=e,this._accumSamples=0)}},i.value.get=function(){return this._value},i.value.set=function(t){this._value=t},e.prototype.sample=function(){this._average(this._value)},e.prototype.human=function(){var t=this._opts.average?this._averageValue:this._value;return Math.round(100*t)/100},e.prototype.alarm=function(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over},Object.defineProperties(e.prototype,i);var h=function(i){function t(t,e){i.call(this,t,e),this._time=window.performance.now()}return i&&(t.__proto__=i),((t.prototype=Object.create(i&&i.prototype)).constructor=t).prototype.start=function(){this._time=window.performance.now()},t.prototype.end=function(){this._value=window.performance.now()-this._time,this._average(this._value)},t.prototype.tick=function(){this.end(),this.start()},t.prototype.frame=function(){var t=window.performance.now(),e=t-this._time;this._total++,e>(this._opts.average||1e3)&&(this._value=1e3*this._total/e,this._total=0,this._time=t,this._average(this._value))},t}(e),l=Math.log(1024),u=["Bytes","KB","MB","GB","TB"],n=function(n){function t(t,e,i){n.call(this,e,i),this._stats=t,(this._start=0)===i.extension.indexOf("memory.")&&(this._field=i.extension.substring(7))}return n&&(t.__proto__=n),((t.prototype=Object.create(n&&n.prototype)).constructor=t).prototype.snapshot=function(){this._value=this._stats[this._field]},t.prototype.start=function(){this._start=this._stats[this._field]},t.prototype.end=function(){this._value=this._stats[this._field]-this._start},t.prototype.human=function(){return t=n.prototype.human.call(this),e=Math.floor(Math.log(t)/l),0===t?"n/a":Math.round(100*t/Math.pow(1024,e))/100+" "+u[e];var t,e},t}(e),_=function(){0===window.performance.memory.totalJSHeapSize&&console.warn("totalJSHeapSize === 0, performance.memory is only available in Chrome."),this._used=0,this._total=0,this._lastUsed=0},d={alarm:{},used:{},total:{}};_.prototype.tick=function(){this._lastUsed=this._used,this._used=window.performance.memory.usedJSHeapSize,this._total=window.performance.memory.totalJSHeapSize},d.alarm.get=function(){return this._used-this._lastUsed<0},d.used.get=function(){return window.performance.memory.usedJSHeapSize},d.total.get=function(){return this._total},_.prototype.counter=function(t,e){return new n(this,t,e)},Object.defineProperties(_.prototype,d);var I={memory:_},f=document.createElement("style");f.type="text/css",f.textContent="\n  .pstats {\n    position: fixed;\n    z-index: 9999;\n\n    padding: 5px;\n    width: 250px;\n    right: 5px;\n    bottom: 5px;\n\n    font-size: 10px;\n    font-family: 'Roboto Condensed', tahoma, sans-serif;\n    overflow: hidden;\n    user-select: none;\n    cursor: default;\n\n    background: #222;\n    border-radius: 3px;\n  }\n\n  .pstats-container {\n    display: block;\n    position: relative;\n    color: #888;\n    white-space: nowrap;\n  }\n\n  .pstats-item {\n    position: absolute;\n    width: 250px;\n    height: 12px;\n    left: 0px;\n  }\n\n  .pstats-label {\n    position: absolute;\n    width: 150px;\n    height: 12px;\n    text-align: left;\n    transition: background 0.3s;\n  }\n\n  .pstats-label.alarm {\n    color: #ccc;\n    background: #800;\n\n    transition: background 0s;\n  }\n\n  .pstats-counter-id {\n    position: absolute;\n    width: 90px;\n    left: 0px;\n  }\n\n  .pstats-counter-value {\n    position: absolute;\n    width: 60px;\n    left: 90px;\n    text-align: right;\n  }\n\n  .pstats-canvas {\n    display: block;\n    position: absolute;\n    right: 0px;\n    top: 1px;\n  }\n\n  .pstats-fraction {\n    position: absolute;\n    width: 250px;\n    left: 0px;\n  }\n\n  .pstats-legend {\n    position: absolute;\n    width: 150px;\n\n    text-align: right;\n  }\n\n  .pstats-legend > span {\n    position: absolute;\n    right: 0px;\n  }\n",document.head.appendChild(f);var p=function(t,e){if(e=e||{},this._showGraph=void 0===e.showGraph||e._showGraph,this._values=e.values||{},this._fractions=e.fractions||[],this._id2counter={},this._id2item={},this._name2extStats={},e.css){var i=document.createElement("style");i.type="text/css",i.textContent=e.css,document.head.appendChild(i)}if(e.extensions)for(var n=0;n<e.extensions.length;++n){var r=e.extensions[n],o=I[r];o?this._name2extStats[r]=new o:console.warn("Can not find extensions "+r+", please register your extension via pstats.register().")}this._root=document.createElement("div"),this._root.className="pstats";var s=document.createElement("div");s.className="pstats-container",this._root.appendChild(s);var a=0;for(var c in this._values){var h=this._values[c],l=document.createElement("div");l.className="pstats-item";var u=document.createElement("div");u.className="pstats-label";var _=document.createElement("span");_.className="pstats-counter-id",_.textContent=h.desc||c;var d=document.createElement("div");d.className="pstats-counter-value";var f=document.createTextNode("");f.nodeValue="0",u.appendChild(_),u.appendChild(d),d.appendChild(f),l.appendChild(u);var p=void 0;this._showGraph&&(p=void 0!==h.min||void 0!==h.max?new A(l,h.color,h.min||0,h.max||9999):h.threshold?new R(l,h.color):new b(l,h.color)).init(95,10),this._id2item[c]={label:u,valueText:f,graph:p},l.style.top=a+"px",s.appendChild(l),a+=12}if(this._showGraph&&e.fractions)for(var g=0;g<e.fractions.length;++g){var m=e.fractions[g],v=m.steps,y=10*v.length+2;m.colors=m.colors||["#850700","#c74900","#fcb300","#284280","#4c7c0c"];var C=document.createElement("div");C.className="pstats-fraction";var T=document.createElement("div");T.className="pstats-legend",T.style.height=y+"px";for(var x=0;x<v.length;++x){var E=document.createElement("span");E.textContent=v[x],E.style.color=m.colors[x],E.style.top=10*x+"px",T.appendChild(E)}C.appendChild(T),C.style.height=y+"px",C.style.top=a+"px";var S=new O(C,m.colors);S.init(95,10,v.length),m.graph=S,m.values=new Array(v.length),s.appendChild(C),a+=10*v.length+2}s.style.height=a+"px",this._root.style.height=a+"px",this._showGraph||(this._root.style.width="150px"),t.appendChild(this._root)};return p.prototype.item=function(t){if(!t)return null;var e=this._id2counter[t];if(e)return e;var i=this._values[t];if(!i)return null;if(i.extension){var n=i.extension.indexOf("."),r=i.extension.substring(0,n),o=this._name2extStats[r];if(!o)return console.error("extension "+r+" not found, make sure you have register and enable it."),null;e=o.counter(t,i)}else e=new h(t,i);return this._id2counter[t]=e},p.prototype.tick=function(){for(var t in this._name2extStats)this._name2extStats[t].tick();for(var e in this._values){var i=this._id2counter[e];if(i){i.sample();var n=i.alarm(),r=i.human(),o=this._id2item[e];o.label.classList.toggle("alarm",0<n),o.valueText.nodeValue=r,this._showGraph&&o.graph.draw(i.value,n)}}if(this._showGraph)for(var s=0;s<this._fractions.length;++s){var a=this._fractions[s],c=this._id2counter[a.base];if(c){for(var h=a.steps,l=0;l<h.length;++l){var u=h[l],_=this._id2counter[u];_&&(a.values[l]=_.value/c.value)}a.graph.draw(a.values)}}},function(){if(void 0===window.performance&&(window.performance={}),!window.performance.now){var t=Date.now();performance.timing&&performance.timing.navigationStart&&(t=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-t}}window.performance.mark||(window.performance.mark=function(){}),window.performance.measure||(window.performance.measure=function(){}),window.performance.memory||(window.performance.memory={usedJSHeapSize:0,totalJSHeapSize:0})}(),{new:function(t,e){var i=new p(t,e);return function(t){return t?i.item(t):i}},register:function(t,e){I[t]=e}}}()},{}],217:[function(t,e,i){var n="undefined"==typeof window?global:window;function r(t,e){void 0===n[t]&&(n[t]=e)}function o(t){return"object"==typeof n[t]}r("CC_TEST",o("tap")||o("QUnit")),r("CC_EDITOR",o("Editor")&&o("process")&&"electron"in process.versions),r("CC_PREVIEW",!0),r("CC_DEV",!0),r("CC_DEBUG",!0),r("CC_JSB",o("jsb")),r("CC_BUILD",!1),r("CC_WECHATGAME",!1),r("CC_QQPLAY",!1),r("CC_SUPPORT_JIT",!CC_QQPLAY),cc={},_ccsg={},t("./CCDebugger"),cc._initDebugSetting(cc.DebugMode.INFO),t("./polyfill/string"),t("./polyfill/misc"),t("./polyfill/array"),t("./polyfill/typescript"),t("./cocos2d/kazmath"),t("./cocos2d/core/predefine"),ccs={},cp={},t("./cocos2d/shaders"),t("./CCBoot"),t("./cocos2d"),t("./extends"),e.exports=cc},{"./CCBoot":1,"./CCDebugger":2,"./DebugInfos":3,"./cocos2d":188,"./cocos2d/core/predefine":149,"./cocos2d/kazmath":192,"./cocos2d/shaders":209,"./extends":213,"./package.json":void 0,"./polyfill/array":219,"./polyfill/misc":220,"./polyfill/string":221,"./polyfill/typescript":222}],218:[function(t,e,i){},{}],219:[function(t,e,i){Array.isArray||(Array.isArray=function(t){return"[object Array]"===Object.prototype.toString.call(t)})},{}],220:[function(t,e,i){if(Math.sign||(Math.sign=function(t){return 0==(t=+t)||isNaN(t)?t:0<t?1:-1}),Number.isInteger||(Number.isInteger=function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t}),!console.time){var n=window.performance||Date,r=Object.create(null);console.time=function(t){r[t]=n.now()},console.timeEnd=function(t){var e=r[t],i=n.now()-e;console.log(t+": "+i+"ms")}}},{}],221:[function(t,e,i){String.prototype.startsWith||(String.prototype.startsWith=function(t,e){return e=e||0,this.lastIndexOf(t,e)===e}),String.prototype.endsWith||(String.prototype.endsWith=function(t,e){(void 0===e||e>this.length)&&(e=this.length),e-=t.length;var i=this.indexOf(t,e);return-1!==i&&i===e})},{}],222:[function(t,e,i){var n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};window.__extends=function(t,e){function i(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},window.__assign=Object.assign||function(t){for(var e,i=1,n=arguments.length;i<n;i++)for(var r in e=arguments[i])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},window.__rest=function(t,e){var i={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.indexOf(n)<0&&(i[n]=t[n]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(n=Object.getOwnPropertySymbols(t);r<n.length;r++)e.indexOf(n[r])<0&&(i[n[r]]=t[n[r]])}return i},window.__decorate=function(t,e,i,n){var r,o=arguments.length,s=o<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,i,n);else for(var a=t.length-1;0<=a;a--)(r=t[a])&&(s=(o<3?r(s):3<o?r(e,i,s):r(e,i))||s);return 3<o&&s&&Object.defineProperty(e,i,s),s},window.__param=function(i,n){return function(t,e){n(t,e,i)}},window.__metadata=function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},window.__awaiter=function(o,s,a,c){return new(a||(a=Promise))(function(t,e){function i(t){try{r(c.next(t))}catch(t){e(t)}}function n(t){try{r(c.throw(t))}catch(t){e(t)}}function r(e){e.done?t(e.value):new a(function(t){t(e.value)}).then(i,n)}r((c=c.apply(o,s||[])).next())})},window.__generator=function(i,n){var r,o,s,t,a={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return t={next:e(0),throw:e(1),return:e(2)},"function"==typeof Symbol&&(t[Symbol.iterator]=function(){return this}),t;function e(e){return function(t){return function(e){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,o&&(s=o[2&e[0]?"return":e[0]?"throw":"next"])&&!(s=s.call(o,e[1])).done)return s;switch(o=0,s&&(e=[0,s.value]),e[0]){case 0:case 1:s=e;break;case 4:return a.label++,{value:e[1],done:!1};case 5:a.label++,o=e[1],e=[0];continue;case 7:e=a.ops.pop(),a.trys.pop();continue;default:if(!(s=0<(s=a.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){a=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){a.label=e[1];break}if(6===e[0]&&a.label<s[1]){a.label=s[1],s=e;break}if(s&&a.label<s[2]){a.label=s[2],a.ops.push(e);break}s[2]&&a.ops.pop(),a.trys.pop();continue}e=n.call(i,a)}catch(t){e=[6,t],o=0}finally{r=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([e,t])}}},window.__exportStar=function(t,e){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])},window.__values=function(t){var e="function"==typeof Symbol&&t[Symbol.iterator],i=0;return e?e.call(t):{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}}},window.__read=function(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var n,r,o=i.call(t),s=[];try{for(;(void 0===e||0<e--)&&!(n=o.next()).done;)s.push(n.value)}catch(t){r={error:t}}finally{try{n&&!n.done&&(i=o.return)&&i.call(o)}finally{if(r)throw r.error}}return s},window.__spread=function(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(__read(arguments[e]));return t},window.__await=function(t){return this instanceof __await?(this.v=t,this):new __await(t)},window.__asyncGenerator=function(t,e,i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,o=i.apply(t,e||[]),s=[];return r={},n("next"),n("throw"),n("return"),r[Symbol.asyncIterator]=function(){return this},r;function n(n){o[n]&&(r[n]=function(i){return new Promise(function(t,e){1<s.push([n,i,t,e])||a(n,i)})})}function a(t,e){try{(i=o[t](e)).value instanceof __await?Promise.resolve(i.value.v).then(c,h):l(s[0][2],i)}catch(t){l(s[0][3],t)}var i}function c(t){a("next",t)}function h(t){a("throw",t)}function l(t,e){t(e),s.shift(),s.length&&a(s[0][0],s[0][1])}},window.__asyncDelegator=function(n){var t,r;return t={},e("next"),e("throw",function(t){throw t}),e("return"),t[Symbol.iterator]=function(){return this},t;function e(e,i){n[e]&&(t[e]=function(t){return(r=!r)?{value:__await(n[e](t)),done:"return"===e}:i?i(t):t})}},window.__asyncValues=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator];return e?e.call(t):"function"==typeof __values?__values(t):t[Symbol.iterator]()}},{}]},{},[217]);